<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
}

.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","endpoint.rs"],"content":"use crate::util::{CollectToResult, ExpectLit};\nuse lazy_regex::regex_is_match;\nuse paste::paste;\nuse proc_macro2::{Ident, Span, TokenStream};\nuse quote::{format_ident, quote, quote_spanned, ToTokens};\nuse std::str::FromStr;\nuse syn::{\n\tparse::Parse, spanned::Spanned, Attribute, AttributeArgs, Error, Expr, FnArg, ItemFn, LitBool, LitStr, Meta, NestedMeta,\n\tPatType, Result, ReturnType, Type\n};\n\n#[allow(clippy::large_enum_variant)]\npub enum EndpointType {\n\tReadAll,\n\tRead,\n\tSearch,\n\tCreate,\n\tUpdateAll,\n\tUpdate,\n\tDeleteAll,\n\tDelete,\n\tCustom {\n\t\tmethod: Option\u003cExpr\u003e,\n\t\turi: Option\u003cLitStr\u003e,\n\t\tparams: Option\u003cLitBool\u003e,\n\t\tbody: Option\u003cLitBool\u003e\n\t}\n}\n\nimpl EndpointType {\n\tpub fn custom() -\u003e Self {\n\t\tSelf::Custom {\n\t\t\tmethod: None,\n\t\t\turi: None,\n\t\t\tparams: None,\n\t\t\tbody: None\n\t\t}\n\t}\n}\n\nmacro_rules! endpoint_type_setter {\n\t($name:ident : $ty:ty) =\u003e {\n\t\timpl EndpointType {\n\t\t\tpaste! {\n\t\t\t\tfn [\u003cset_ $name\u003e](\u0026mut self, span: Span, [\u003cnew_ $name\u003e]: $ty) -\u003e Result\u003c()\u003e {\n\t\t\t\t\tmatch self {\n\t\t\t\t\t\tSelf::Custom { $name, .. } if $name.is_some() =\u003e {\n\t\t\t\t\t\t\tErr(Error::new(span, concat!(\"`\", concat!(stringify!($name), \"` must not appear more than once\"))))\n\t\t\t\t\t\t},\n\t\t\t\t\t\tSelf::Custom { $name, .. } =\u003e {\n\t\t\t\t\t\t\t*$name = Some([\u003cnew_ $name\u003e]);\n\t\t\t\t\t\t\tOk(())\n\t\t\t\t\t\t},\n\t\t\t\t\t\t_ =\u003e Err(Error::new(span, concat!(\"`\", concat!(stringify!($name), \"` can only be used on custom endpoints\"))))\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nendpoint_type_setter!(method: Expr);\nendpoint_type_setter!(uri: LitStr);\nendpoint_type_setter!(params: LitBool);\nendpoint_type_setter!(body: LitBool);\n\nimpl FromStr for EndpointType {\n\ttype Err = Error;\n\n\tfn from_str(str: \u0026str) -\u003e Result\u003cSelf\u003e {\n\t\tmatch str {\n\t\t\t\"ReadAll\" | \"read_all\" =\u003e Ok(Self::ReadAll),\n\t\t\t\"Read\" | \"read\" =\u003e Ok(Self::Read),\n\t\t\t\"Search\" | \"search\" =\u003e Ok(Self::Search),\n\t\t\t\"Create\" | \"create\" =\u003e Ok(Self::Create),\n\t\t\t\"ChangeAll\" | \"change_all\" =\u003e Ok(Self::UpdateAll),\n\t\t\t\"Change\" | \"change\" =\u003e Ok(Self::Update),\n\t\t\t\"RemoveAll\" | \"remove_all\" =\u003e Ok(Self::DeleteAll),\n\t\t\t\"Remove\" | \"remove\" =\u003e Ok(Self::Delete),\n\t\t\t_ =\u003e Err(Error::new(Span::call_site(), format!(\"Unknown method: `{}'\", str)))\n\t\t}\n\t}\n}\n\nimpl EndpointType {\n\tfn http_method(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tlet hyper_method = quote!(::gotham_restful::gotham::hyper::Method);\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Search =\u003e Some(quote!(#hyper_method::GET)),\n\t\t\tSelf::Create =\u003e Some(quote!(#hyper_method::POST)),\n\t\t\tSelf::UpdateAll | Self::Update =\u003e Some(quote!(#hyper_method::PUT)),\n\t\t\tSelf::DeleteAll | Self::Delete =\u003e Some(quote!(#hyper_method::DELETE)),\n\t\t\tSelf::Custom { method, .. } =\u003e method.as_ref().map(ToTokens::to_token_stream)\n\t\t}\n\t}\n\n\tfn uri(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Create | Self::UpdateAll | Self::DeleteAll =\u003e Some(quote!(\"\")),\n\t\t\tSelf::Read | Self::Update | Self::Delete =\u003e Some(quote!(\":id\")),\n\t\t\tSelf::Search =\u003e Some(quote!(\"search\")),\n\t\t\tSelf::Custom { uri, .. } =\u003e uri.as_ref().map(ToTokens::to_token_stream)\n\t\t}\n\t}\n\n\tfn operation_verb(\u0026self) -\u003e TokenStream {\n\t\tlet some = quote!(::core::option::Option::Some);\n\t\tmatch self {\n\t\t\tSelf::ReadAll =\u003e quote!(#some(\"read_all\")),\n\t\t\tSelf::Read =\u003e quote!(#some(\"read\")),\n\t\t\tSelf::Search =\u003e quote!(#some(\"search\")),\n\t\t\tSelf::Create =\u003e quote!(#some(\"create\")),\n\t\t\tSelf::UpdateAll =\u003e quote!(#some(\"update_all\")),\n\t\t\tSelf::Update =\u003e quote!(#some(\"update\")),\n\t\t\tSelf::DeleteAll =\u003e quote!(#some(\"delete_all\")),\n\t\t\tSelf::Delete =\u003e quote!(#some(\"delete\")),\n\t\t\tSelf::Custom { .. } =\u003e quote!(::core::option::Option::None)\n\t\t}\n\t}\n\n\tfn has_placeholders(\u0026self) -\u003e LitBool {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Search | Self::Create | Self::UpdateAll | Self::DeleteAll =\u003e LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Read | Self::Update | Self::Delete =\u003e LitBool {\n\t\t\t\tvalue: true,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Custom { uri, .. } =\u003e LitBool {\n\t\t\t\tvalue: uri\n\t\t\t\t\t.as_ref()\n\t\t\t\t\t.map(|uri| regex_is_match!(r#\"(^|/):[^/]+(/|$)\"#, \u0026uri.value()))\n\t\t\t\t\t.unwrap_or(false),\n\t\t\t\tspan: Span::call_site()\n\t\t\t}\n\t\t}\n\t}\n\n\tfn placeholders_ty(\u0026self, arg_ty: Option\u003c\u0026Type\u003e) -\u003e TokenStream {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Search | Self::Create | Self::UpdateAll | Self::DeleteAll =\u003e {\n\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t},\n\t\t\tSelf::Read | Self::Update | Self::Delete =\u003e quote!(::gotham_restful::private::IdPlaceholder::\u003c#arg_ty\u003e),\n\t\t\tSelf::Custom { .. } =\u003e {\n\t\t\t\tif self.has_placeholders().value {\n\t\t\t\t\targ_ty.to_token_stream()\n\t\t\t\t} else {\n\t\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfn needs_params(\u0026self) -\u003e LitBool {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Create | Self::UpdateAll | Self::Update | Self::DeleteAll | Self::Delete =\u003e {\n\t\t\t\tLitBool {\n\t\t\t\t\tvalue: false,\n\t\t\t\t\tspan: Span::call_site()\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::Search =\u003e LitBool {\n\t\t\t\tvalue: true,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Custom { params, .. } =\u003e params.clone().unwrap_or_else(|| LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t})\n\t\t}\n\t}\n\n\tfn params_ty(\u0026self, arg_ty: Option\u003c\u0026Type\u003e) -\u003e TokenStream {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Create | Self::UpdateAll | Self::Update | Self::DeleteAll | Self::Delete =\u003e {\n\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t},\n\t\t\tSelf::Search =\u003e quote!(#arg_ty),\n\t\t\tSelf::Custom { .. } =\u003e {\n\t\t\t\tif self.needs_params().value {\n\t\t\t\t\targ_ty.to_token_stream()\n\t\t\t\t} else {\n\t\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfn needs_body(\u0026self) -\u003e LitBool {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Search | Self::DeleteAll | Self::Delete =\u003e LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Create | Self::UpdateAll | Self::Update =\u003e LitBool {\n\t\t\t\tvalue: true,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Custom { body, .. } =\u003e body.clone().unwrap_or_else(|| LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t})\n\t\t}\n\t}\n\n\tfn body_ty(\u0026self, arg_ty: Option\u003c\u0026Type\u003e) -\u003e TokenStream {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Search | Self::DeleteAll | Self::Delete =\u003e quote!(()),\n\t\t\tSelf::Create | Self::UpdateAll | Self::Update =\u003e quote!(#arg_ty),\n\t\t\tSelf::Custom { .. } =\u003e {\n\t\t\t\tif self.needs_body().value {\n\t\t\t\t\targ_ty.to_token_stream()\n\t\t\t\t} else {\n\t\t\t\t\tquote!(())\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n}\n\n#[allow(clippy::large_enum_variant)]\nenum HandlerArgType {\n\tStateRef,\n\tStateMutRef,\n\tMethodArg(Type),\n\tDatabaseConnection(Type),\n\tAuthStatus(Type),\n\tAuthStatusRef(Type)\n}\n\nimpl HandlerArgType {\n\tfn is_method_arg(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::MethodArg(_))\n\t}\n\n\tfn is_database_conn(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::DatabaseConnection(_))\n\t}\n\n\tfn is_auth_status(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::AuthStatus(_) | Self::AuthStatusRef(_))\n\t}\n\n\tfn ty(\u0026self) -\u003e Option\u003c\u0026Type\u003e {\n\t\tmatch self {\n\t\t\tSelf::MethodArg(ty) | Self::DatabaseConnection(ty) | Self::AuthStatus(ty) | Self::AuthStatusRef(ty) =\u003e Some(ty),\n\t\t\t_ =\u003e None\n\t\t}\n\t}\n\n\tfn quote_ty(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tself.ty().map(|ty| quote!(#ty))\n\t}\n}\n\nstruct HandlerArg {\n\tident_span: Span,\n\tty: HandlerArgType\n}\n\nimpl Spanned for HandlerArg {\n\tfn span(\u0026self) -\u003e Span {\n\t\tself.ident_span\n\t}\n}\n\nfn interpret_arg_ty(attrs: \u0026[Attribute], name: \u0026str, ty: Type) -\u003e Result\u003cHandlerArgType\u003e {\n\tlet attr = attrs\n\t\t.iter()\n\t\t.find(|arg| arg.path.segments.iter().any(|path| \u0026path.ident.to_string() == \"rest_arg\"))\n\t\t.map(|arg| arg.tokens.to_string());\n\n\t// TODO issue a warning for _state usage once diagnostics become stable\n\tif attr.as_deref() == Some(\"state\") || (attr.is_none() \u0026\u0026 (name == \"state\" || name == \"_state\")) {\n\t\treturn match ty {\n\t\t\tType::Reference(ty) =\u003e Ok(if ty.mutability.is_none() {\n\t\t\t\tHandlerArgType::StateRef\n\t\t\t} else {\n\t\t\t\tHandlerArgType::StateMutRef\n\t\t\t}),\n\t\t\t_ =\u003e Err(Error::new(\n\t\t\t\tty.span(),\n\t\t\t\t\"The state parameter has to be a (mutable) reference to gotham_restful::State\"\n\t\t\t))\n\t\t};\n\t}\n\n\tif cfg!(feature = \"auth\") \u0026\u0026 (attr.as_deref() == Some(\"auth\") || (attr.is_none() \u0026\u0026 name == \"auth\")) {\n\t\treturn Ok(match ty {\n\t\t\tType::Reference(ty) =\u003e HandlerArgType::AuthStatusRef(*ty.elem),\n\t\t\tty =\u003e HandlerArgType::AuthStatus(ty)\n\t\t});\n\t}\n\n\tif cfg!(feature = \"database\")\n\t\t\u0026\u0026 (attr.as_deref() == Some(\"connection\") || attr.as_deref() == Some(\"conn\") || (attr.is_none() \u0026\u0026 name == \"conn\"))\n\t{\n\t\treturn Ok(HandlerArgType::DatabaseConnection(match ty {\n\t\t\tType::Reference(ty) =\u003e *ty.elem,\n\t\t\tty =\u003e ty\n\t\t}));\n\t}\n\n\tOk(HandlerArgType::MethodArg(ty))\n}\n\nfn interpret_arg(_index: usize, arg: \u0026PatType) -\u003e Result\u003cHandlerArg\u003e {\n\tlet pat = \u0026arg.pat;\n\tlet orig_name = quote!(#pat);\n\tlet ty = interpret_arg_ty(\u0026arg.attrs, \u0026orig_name.to_string(), *arg.ty.clone())?;\n\n\tOk(HandlerArg {\n\t\tident_span: arg.pat.span(),\n\t\tty\n\t})\n}\n\n#[cfg(feature = \"openapi\")]\nfn expand_operation_verb(operation_verb: TokenStream) -\u003e Option\u003cTokenStream\u003e {\n\tSome(quote! {\n\t\tfn operation_verb() -\u003e ::core::option::Option\u003c\u0026'static ::core::primitive::str\u003e {\n\t\t\t#operation_verb\n\t\t}\n\t})\n}\n\n#[cfg(not(feature = \"openapi\"))]\nfn expand_operation_verb(_: TokenStream) -\u003e Option\u003cTokenStream\u003e {\n\tNone\n}\n\n#[cfg(feature = \"openapi\")]\nfn expand_operation_id(operation_id: Option\u003cLitStr\u003e) -\u003e Option\u003cTokenStream\u003e {\n\toperation_id.map(|operation_id| {\n\t\tquote! {\n\t\t\tfn operation_id() -\u003e ::core::option::Option\u003c::std::string::String\u003e {\n\t\t\t\t::core::option::Option::Some(::std::string::String::from(#operation_id))\n\t\t\t}\n\t\t}\n\t})\n}\n\n#[cfg(not(feature = \"openapi\"))]\nfn expand_operation_id(_: Option\u003cLitStr\u003e) -\u003e Option\u003cTokenStream\u003e {\n\tNone\n}\n\nfn expand_wants_auth(wants_auth: Option\u003cLitBool\u003e, default: bool) -\u003e TokenStream {\n\tlet wants_auth = wants_auth.unwrap_or_else(|| LitBool {\n\t\tvalue: default,\n\t\tspan: Span::call_site()\n\t});\n\n\tquote! {\n\t\tfn wants_auth() -\u003e ::core::primitive::bool {\n\t\t\t#wants_auth\n\t\t}\n\t}\n}\n\npub fn endpoint_ident(fn_ident: \u0026Ident) -\u003e Ident {\n\tformat_ident!(\"{}___gotham_restful_endpoint\", fn_ident)\n}\n\n// clippy doesn't realize that vectors can be used in closures\n#[cfg_attr(feature = \"cargo-clippy\", allow(clippy::needless_collect))]\nfn expand_endpoint_type(mut ty: EndpointType, attrs: AttributeArgs, fun: \u0026ItemFn) -\u003e Result\u003cTokenStream\u003e {\n\t// reject unsafe functions\n\tif let Some(unsafety) = fun.sig.unsafety {\n\t\treturn Err(Error::new(unsafety.span(), \"Endpoint handler methods must not be unsafe\"));\n\t}\n\n\t// parse arguments\n\tlet mut debug: bool = false;\n\tlet mut operation_id: Option\u003cLitStr\u003e = None;\n\tlet mut wants_auth: Option\u003cLitBool\u003e = None;\n\tfor meta in attrs {\n\t\tmatch meta {\n\t\t\tNestedMeta::Meta(Meta::NameValue(kv)) =\u003e {\n\t\t\t\tif kv.path.is_ident(\"debug\") {\n\t\t\t\t\tdebug = kv.lit.expect_bool()?.value;\n\t\t\t\t} else if kv.path.is_ident(\"operation_id\") {\n\t\t\t\t\toperation_id = Some(kv.lit.expect_str()?);\n\t\t\t\t} else if kv.path.is_ident(\"wants_auth\") {\n\t\t\t\t\twants_auth = Some(kv.lit.expect_bool()?);\n\t\t\t\t} else if kv.path.is_ident(\"method\") {\n\t\t\t\t\tty.set_method(kv.path.span(), kv.lit.expect_str()?.parse_with(Expr::parse)?)?;\n\t\t\t\t} else if kv.path.is_ident(\"uri\") {\n\t\t\t\t\tty.set_uri(kv.path.span(), kv.lit.expect_str()?)?;\n\t\t\t\t} else if kv.path.is_ident(\"params\") {\n\t\t\t\t\tty.set_params(kv.path.span(), kv.lit.expect_bool()?)?;\n\t\t\t\t} else if kv.path.is_ident(\"body\") {\n\t\t\t\t\tty.set_body(kv.path.span(), kv.lit.expect_bool()?)?;\n\t\t\t\t} else {\n\t\t\t\t\treturn Err(Error::new(kv.path.span(), \"Unknown attribute\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\t_ =\u003e return Err(Error::new(meta.span(), \"Invalid attribute syntax\"))\n\t\t}\n\t}\n\t#[cfg(not(feature = \"openapi\"))]\n\tif let Some(operation_id) = operation_id {\n\t\treturn Err(Error::new(\n\t\t\toperation_id.span(),\n\t\t\t\"`operation_id` is only supported with the openapi feature\"\n\t\t));\n\t}\n\n\t// extract the documentation\n\tlet mut doc: Vec\u003cString\u003e = Vec::new();\n\tfor attr in \u0026fun.attrs {\n\t\tif attr.path.is_ident(\"doc\") {\n\t\t\tif let Some(lit) = attr.parse_meta().and_then(|meta| {\n\t\t\t\tOk(match meta {\n\t\t\t\t\tMeta::NameValue(kv) =\u003e Some(kv.lit.expect_str()?),\n\t\t\t\t\t_ =\u003e None\n\t\t\t\t})\n\t\t\t})? {\n\t\t\t\tdoc.push(lit.value());\n\t\t\t}\n\t\t}\n\t}\n\tlet doc = doc.join(\"\\n\");\n\t#[allow(unused_variables)]\n\tlet doc = doc.trim();\n\n\t#[allow(unused_mut)]\n\tlet mut description = quote!();\n\t#[cfg(feature = \"openapi\")]\n\tif !doc.is_empty() {\n\t\tdescription = quote! {\n\t\t\tfn description() -\u003e ::core::option::Option\u003c::std::string::String\u003e {\n\t\t\t\t::core::option::Option::Some(::std::string::String::from(#doc))\n\t\t\t}\n\t\t};\n\t}\n\n\t// extract arguments into pattern, ident and type\n\tlet args = fun\n\t\t.sig\n\t\t.inputs\n\t\t.iter()\n\t\t.enumerate()\n\t\t.map(|(i, arg)| match arg {\n\t\t\tFnArg::Typed(arg) =\u003e interpret_arg(i, arg),\n\t\t\tFnArg::Receiver(_) =\u003e Err(Error::new(arg.span(), \"Didn't expect self parameter\"))\n\t\t})\n\t\t.collect_to_result()?;\n\n\tlet fun_vis = \u0026fun.vis;\n\tlet fun_ident = \u0026fun.sig.ident;\n\tlet fun_is_async = fun.sig.asyncness.is_some();\n\n\tlet ident = endpoint_ident(fun_ident);\n\tlet dummy_ident = format_ident!(\"_IMPL_Endpoint_for_{}\", ident);\n\tlet (output_ty, is_no_content) = match \u0026fun.sig.output {\n\t\tReturnType::Default =\u003e (quote!(::gotham_restful::NoContent), true),\n\t\tReturnType::Type(_, ty) =\u003e (quote!(#ty), false)\n\t};\n\tlet output_typedef = quote_spanned!(output_ty.span() =\u003e type Output = #output_ty;);\n\n\tlet arg_tys = args.iter().filter(|arg| arg.ty.is_method_arg()).collect::\u003cVec\u003c_\u003e\u003e();\n\tlet mut arg_ty_idx = 0;\n\tlet mut next_arg_ty = |return_none: bool| {\n\t\tif return_none {\n\t\t\treturn Ok(None);\n\t\t}\n\t\tif arg_ty_idx \u003e= arg_tys.len() {\n\t\t\treturn Err(Error::new(fun_ident.span(), \"Too few arguments\"));\n\t\t}\n\t\tlet ty = arg_tys[arg_ty_idx].ty.ty().unwrap();\n\t\targ_ty_idx += 1;\n\t\tOk(Some(ty))\n\t};\n\n\tlet http_method = ty.http_method().ok_or_else(|| {\n\t\tError::new(\n\t\t\tSpan::call_site(),\n\t\t\t\"Missing `method` attribute (e.g. `#[endpoint(method = \\\"gotham_restful::gotham::hyper::Method::GET\\\")]`)\"\n\t\t)\n\t})?;\n\tlet uri = ty.uri().ok_or_else(|| {\n\t\tError::new(\n\t\t\tSpan::call_site(),\n\t\t\t\"Missing `uri` attribute (e.g. `#[endpoint(uri = \\\"custom_endpoint\\\")]`)\"\n\t\t)\n\t})?;\n\tlet has_placeholders = ty.has_placeholders();\n\tlet placeholder_ty = ty.placeholders_ty(next_arg_ty(!has_placeholders.value)?);\n\tlet placeholder_typedef = quote_spanned!(placeholder_ty.span() =\u003e type Placeholders = #placeholder_ty;);\n\tlet needs_params = ty.needs_params();\n\tlet params_ty = ty.params_ty(next_arg_ty(!needs_params.value)?);\n\tlet params_typedef = quote_spanned!(params_ty.span() =\u003e type Params = #params_ty;);\n\tlet needs_body = ty.needs_body();\n\tlet body_ty = ty.body_ty(next_arg_ty(!needs_body.value)?);\n\tlet body_typedef = quote_spanned!(body_ty.span() =\u003e type Body = #body_ty;);\n\n\tif arg_ty_idx \u003c arg_tys.len() {\n\t\treturn Err(Error::new(fun_ident.span(), \"Too many arguments\"));\n\t}\n\n\tlet mut handle_args: Vec\u003cTokenStream\u003e = Vec::new();\n\tif has_placeholders.value {\n\t\tif matches!(ty, EndpointType::Custom { .. }) {\n\t\t\thandle_args.push(quote!(placeholders));\n\t\t} else {\n\t\t\thandle_args.push(quote!(placeholders.id));\n\t\t}\n\t}\n\tif needs_params.value {\n\t\thandle_args.push(quote!(params));\n\t}\n\tif needs_body.value {\n\t\thandle_args.push(quote!(body.unwrap()));\n\t}\n\tlet handle_args = args.iter().map(|arg| match arg.ty {\n\t\tHandlerArgType::StateRef | HandlerArgType::StateMutRef =\u003e quote!(state),\n\t\tHandlerArgType::MethodArg(_) =\u003e handle_args.remove(0),\n\t\tHandlerArgType::DatabaseConnection(_) =\u003e quote!(\u0026conn),\n\t\tHandlerArgType::AuthStatus(_) =\u003e quote!(auth),\n\t\tHandlerArgType::AuthStatusRef(_) =\u003e quote!(\u0026auth)\n\t});\n\n\tlet expand_handle_content = || {\n\t\tlet mut state_block = quote!();\n\t\tif let Some(arg) = args.iter().find(|arg| arg.ty.is_auth_status()) {\n\t\t\tlet auth_ty = arg.ty.quote_ty();\n\t\t\tlet auth_borrow = quote_spanned! { auth_ty.span() =\u003e\n\t\t\t\t\u003c#auth_ty as ::core::clone::Clone\u003e::clone(\n\t\t\t\t\t\u003c#auth_ty as ::gotham_restful::gotham::state::FromState\u003e::borrow_from(state)\n\t\t\t\t)\n\t\t\t};\n\t\t\tstate_block = quote! {\n\t\t\t\t#state_block\n\t\t\t\tlet auth: #auth_ty = #auth_borrow;\n\t\t\t}\n\t\t}\n\n\t\tlet mut handle_content = quote!(#fun_ident(#(#handle_args),*));\n\t\tif fun_is_async {\n\t\t\tif let Some(arg) = args.iter().find(|arg| matches!(arg.ty, HandlerArgType::StateRef)) {\n\t\t\t\treturn Err(Error::new(arg.span(), \"Endpoint handler functions that are async must not take `\u0026State` as an argument, consider taking `\u0026mut State`\"));\n\t\t\t}\n\t\t\thandle_content = quote!(#handle_content.await);\n\t\t}\n\t\tif is_no_content {\n\t\t\thandle_content = quote!(#handle_content; \u003c::gotham_restful::NoContent as ::std::default::Default\u003e::default())\n\t\t}\n\n\t\tif let Some(arg) = args.iter().find(|arg| arg.ty.is_database_conn()) {\n\t\t\tlet conn_ty = arg.ty.quote_ty();\n\t\t\tstate_block = quote! {\n\t\t\t\t#state_block\n\t\t\t\tlet repo = \u003c::gotham_restful::private::Repo\u003c#conn_ty\u003e\u003e::borrow_from(state).clone();\n\t\t\t};\n\t\t\thandle_content = quote! {\n\t\t\t\trepo.run::\u003c_, _, ()\u003e(move |conn| {\n\t\t\t\t\tOk({ #handle_content })\n\t\t\t\t}).await.unwrap()\n\t\t\t};\n\t\t}\n\n\t\tOk(quote! {\n\t\t\tuse ::gotham_restful::private::FutureExt as _;\n\t\t\tuse ::gotham_restful::gotham::state::FromState as _;\n\t\t\t#state_block\n\t\t\tasync move {\n\t\t\t\t#handle_content\n\t\t\t}.boxed()\n\t\t})\n\t};\n\tlet handle_content = match expand_handle_content() {\n\t\tOk(content) =\u003e content,\n\t\tErr(err) =\u003e err.to_compile_error()\n\t};\n\n\tlet tr8 = if cfg!(feature = \"openapi\") {\n\t\tquote!(::gotham_restful::EndpointWithSchema)\n\t} else {\n\t\tquote!(::gotham_restful::Endpoint)\n\t};\n\tlet operation_verb = expand_operation_verb(ty.operation_verb());\n\tlet operation_id = expand_operation_id(operation_id);\n\tlet wants_auth = expand_wants_auth(wants_auth, args.iter().any(|arg| arg.ty.is_auth_status()));\n\tlet code = quote! {\n\t\t#[doc(hidden)]\n\t\t/// `gotham_restful` implementation detail\n\t\t#[allow(non_camel_case_types)]\n\t\t#fun_vis struct #ident;\n\n\t\t#[allow(non_upper_case_globals)]\n\t\tstatic #dummy_ident: () = {\n\t\t\timpl #tr8 for #ident {\n\t\t\t\tfn http_method() -\u003e ::gotham_restful::gotham::hyper::Method {\n\t\t\t\t\t#http_method\n\t\t\t\t}\n\n\t\t\t\tfn uri() -\u003e ::std::borrow::Cow\u003c'static, ::core::primitive::str\u003e {\n\t\t\t\t\t{ #uri }.into()\n\t\t\t\t}\n\n\t\t\t\t#operation_verb\n\n\t\t\t\t#output_typedef\n\n\t\t\t\tfn has_placeholders() -\u003e ::core::primitive::bool {\n\t\t\t\t\t#has_placeholders\n\t\t\t\t}\n\t\t\t\t#placeholder_typedef\n\n\t\t\t\tfn needs_params() -\u003e ::core::primitive::bool {\n\t\t\t\t\t#needs_params\n\t\t\t\t}\n\t\t\t\t#params_typedef\n\n\t\t\t\tfn needs_body() -\u003e ::core::primitive::bool {\n\t\t\t\t\t#needs_body\n\t\t\t\t}\n\t\t\t\t#body_typedef\n\n\t\t\t\tfn handle\u003c'a\u003e(\n\t\t\t\t\tstate: \u0026'a mut ::gotham_restful::gotham::state::State,\n\t\t\t\t\tplaceholders: Self::Placeholders,\n\t\t\t\t\tparams: Self::Params,\n\t\t\t\t\tbody: ::core::option::Option\u003cSelf::Body\u003e\n\t\t\t\t) -\u003e ::gotham_restful::private::BoxFuture\u003c'a, Self::Output\u003e {\n\t\t\t\t\t#handle_content\n\t\t\t\t}\n\n\t\t\t\t#operation_id\n\t\t\t\t#description\n\t\t\t\t#wants_auth\n\t\t\t}\n\t\t};\n\t};\n\tif debug {\n\t\teprintln!(\"{}\", code);\n\t}\n\tOk(code)\n}\n\npub fn expand_endpoint(ty: EndpointType, attrs: AttributeArgs, fun: ItemFn) -\u003e Result\u003cTokenStream\u003e {\n\tlet endpoint_type = match expand_endpoint_type(ty, attrs, \u0026fun) {\n\t\tOk(code) =\u003e code,\n\t\tErr(err) =\u003e err.to_compile_error()\n\t};\n\tOk(quote! {\n\t\t#fun\n\t\t#endpoint_type\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","from_body.rs"],"content":"use proc_macro2::TokenStream;\nuse quote::{format_ident, quote};\nuse std::cmp::min;\nuse syn::{spanned::Spanned, Data, DeriveInput, Error, Field, Fields, Ident, Result, Type};\n\nstruct ParsedFields {\n\tfields: Vec\u003c(Ident, Type)\u003e,\n\tnamed: bool\n}\n\nimpl ParsedFields {\n\tfn from_named\u003cI\u003e(fields: I) -\u003e Self\n\twhere\n\t\tI: Iterator\u003cItem = Field\u003e\n\t{\n\t\tlet fields = fields.map(|field| (field.ident.unwrap(), field.ty)).collect();\n\t\tSelf { fields, named: true }\n\t}\n\n\tfn from_unnamed\u003cI\u003e(fields: I) -\u003e Self\n\twhere\n\t\tI: Iterator\u003cItem = Field\u003e\n\t{\n\t\tlet fields = fields\n\t\t\t.enumerate()\n\t\t\t.map(|(i, field)| (format_ident!(\"arg{}\", i), field.ty))\n\t\t\t.collect();\n\t\tSelf { fields, named: false }\n\t}\n\n\tfn from_unit() -\u003e Self {\n\t\tSelf {\n\t\t\tfields: Vec::new(),\n\t\t\tnamed: false\n\t\t}\n\t}\n}\n\npub fn expand_from_body(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\tlet generics = input.generics;\n\n\tlet strukt = match input.data {\n\t\tData::Enum(inum) =\u003e Err(inum.enum_token.span()),\n\t\tData::Struct(strukt) =\u003e Ok(strukt),\n\t\tData::Union(uni) =\u003e Err(uni.union_token.span())\n\t}\n\t.map_err(|span| Error::new(span, \"#[derive(FromBody)] only works for structs\"))?;\n\n\tlet fields = match strukt.fields {\n\t\tFields::Named(named) =\u003e ParsedFields::from_named(named.named.into_iter()),\n\t\tFields::Unnamed(unnamed) =\u003e ParsedFields::from_unnamed(unnamed.unnamed.into_iter()),\n\t\tFields::Unit =\u003e ParsedFields::from_unit()\n\t};\n\n\tlet mut where_clause = quote!();\n\tlet mut block = quote!();\n\tlet mut body_ident = format_ident!(\"_body\");\n\tlet mut type_ident = format_ident!(\"_type\");\n\n\tif let Some(body_field) = fields.fields.get(0) {\n\t\tbody_ident = body_field.0.clone();\n\t\tlet body_ty = \u0026body_field.1;\n\t\twhere_clause = quote! {\n\t\t\t#where_clause\n\t\t\t#body_ty: for\u003c'a\u003e From\u003c\u0026'a [u8]\u003e,\n\t\t};\n\t\tblock = quote! {\n\t\t\t#block\n\t\t\tlet #body_ident: \u0026[u8] = \u0026#body_ident;\n\t\t\tlet #body_ident: #body_ty = #body_ident.into();\n\t\t};\n\t}\n\n\tif let Some(type_field) = fields.fields.get(1) {\n\t\ttype_ident = type_field.0.clone();\n\t\tlet type_ty = \u0026type_field.1;\n\t\twhere_clause = quote! {\n\t\t\t#where_clause\n\t\t\t#type_ty: From\u003c::gotham_restful::Mime\u003e,\n\t\t};\n\t\tblock = quote! {\n\t\t\t#block\n\t\t\tlet #type_ident: #type_ty = #type_ident.into();\n\t\t};\n\t}\n\n\tfor field in \u0026fields.fields[min(2, fields.fields.len())..] {\n\t\tlet field_ident = \u0026field.0;\n\t\tlet field_ty = \u0026field.1;\n\t\twhere_clause = quote! {\n\t\t\t#where_clause\n\t\t\t#field_ty: ::std::default::Default,\n\t\t};\n\t\tblock = quote! {\n\t\t\t#block\n\t\t\tlet #field_ident: #field_ty = Default::default();\n\t\t};\n\t}\n\n\tlet field_names: Vec\u003c\u0026Ident\u003e = fields.fields.iter().map(|field| \u0026field.0).collect();\n\tlet ctor = if fields.named {\n\t\tquote!(Self { #(#field_names),* })\n\t} else {\n\t\tquote!(Self ( #(#field_names),* ))\n\t};\n\n\tOk(quote! {\n\t\timpl #generics ::gotham_restful::FromBody for #ident #generics\n\t\twhere #where_clause\n\t\t{\n\t\t\ttype Err = ::std::convert::Infallible;\n\n\t\t\tfn from_body(\n\t\t\t\t#body_ident: ::gotham_restful::gotham::hyper::body::Bytes,\n\t\t\t\t#type_ident: ::gotham_restful::Mime\n\t\t\t) -\u003e ::std::result::Result\u003cSelf, ::std::convert::Infallible\u003e\n\t\t\t{\n\t\t\t\t#block\n\t\t\t\t::std::result::Result::Ok(#ctor)\n\t\t\t}\n\t\t}\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","lib.rs"],"content":"#![warn(missing_debug_implementations, rust_2018_idioms)]\n#![deny(broken_intra_doc_links)]\n#![forbid(unsafe_code)]\n\nuse proc_macro::TokenStream;\nuse proc_macro2::TokenStream as TokenStream2;\nuse syn::{parse_macro_input, parse_macro_input::ParseMacroInput, DeriveInput, Result};\n\nmod util;\n\nmod endpoint;\nuse endpoint::{expand_endpoint, EndpointType};\n\nmod from_body;\nuse from_body::expand_from_body;\n\nmod request_body;\nuse request_body::expand_request_body;\n\nmod resource;\nuse resource::expand_resource;\n\nmod resource_error;\nuse resource_error::expand_resource_error;\n\nmod private_openapi_trait;\nuse private_openapi_trait::expand_private_openapi_trait;\n\n#[inline]\nfn print_tokens(tokens: TokenStream2) -\u003e TokenStream {\n\t// eprintln!(\"{}\", tokens);\n\ttokens.into()\n}\n\n#[inline]\nfn expand_derive\u003cF\u003e(input: TokenStream, expand: F) -\u003e TokenStream\nwhere\n\tF: FnOnce(DeriveInput) -\u003e Result\u003cTokenStream2\u003e\n{\n\tprint_tokens(expand(parse_macro_input!(input)).unwrap_or_else(|err| err.to_compile_error()))\n}\n\n#[inline]\nfn expand_macro\u003cF, A, I\u003e(attrs: TokenStream, item: TokenStream, expand: F) -\u003e TokenStream\nwhere\n\tF: FnOnce(A, I) -\u003e Result\u003cTokenStream2\u003e,\n\tA: ParseMacroInput,\n\tI: ParseMacroInput\n{\n\tprint_tokens(expand(parse_macro_input!(attrs), parse_macro_input!(item)).unwrap_or_else(|err| err.to_compile_error()))\n}\n\n#[proc_macro_derive(FromBody)]\npub fn derive_from_body(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_from_body)\n}\n\n#[proc_macro_derive(RequestBody, attributes(supported_types))]\npub fn derive_request_body(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_request_body)\n}\n\n#[proc_macro_derive(Resource, attributes(resource))]\npub fn derive_resource(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_resource)\n}\n\n#[proc_macro_derive(ResourceError, attributes(display, from, status))]\npub fn derive_resource_error(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_resource_error)\n}\n\n#[proc_macro_attribute]\npub fn endpoint(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::custom(), attr, item))\n}\n\n#[proc_macro_attribute]\npub fn read_all(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::ReadAll, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn read(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Read, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn search(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Search, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn create(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Create, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn update_all(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::UpdateAll, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn update(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Update, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn delete_all(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::DeleteAll, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn delete(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Delete, attr, item))\n}\n\n/// PRIVATE MACRO - DO NOT USE\n#[doc(hidden)]\n#[proc_macro_attribute]\npub fn _private_openapi_trait(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, expand_private_openapi_trait)\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","private_openapi_trait.rs"],"content":"use crate::util::{remove_parens, CollectToResult};\nuse proc_macro2::{Span, TokenStream};\nuse quote::{quote, ToTokens};\nuse syn::{\n\tparse::Parse, spanned::Spanned, Attribute, AttributeArgs, Error, ItemTrait, LitStr, Meta, NestedMeta, PredicateType,\n\tResult, TraitItem, WherePredicate\n};\n\nstruct TraitItemAttrs {\n\topenapi_only: bool,\n\topenapi_bound: Vec\u003cPredicateType\u003e,\n\tnon_openapi_bound: Vec\u003cPredicateType\u003e,\n\tother_attrs: Vec\u003cAttribute\u003e\n}\n\nimpl TraitItemAttrs {\n\tfn parse(attrs: Vec\u003cAttribute\u003e) -\u003e Result\u003cSelf\u003e {\n\t\tlet mut openapi_only = false;\n\t\tlet mut openapi_bound = Vec::new();\n\t\tlet mut non_openapi_bound = Vec::new();\n\t\tlet mut other = Vec::new();\n\n\t\tfor attr in attrs {\n\t\t\tif attr.path.is_ident(\"openapi_only\") {\n\t\t\t\topenapi_only = true;\n\t\t\t} else if attr.path.is_ident(\"openapi_bound\") {\n\t\t\t\tlet attr_arg: LitStr = syn::parse2(remove_parens(attr.tokens))?;\n\t\t\t\tlet predicate = attr_arg.parse_with(WherePredicate::parse)?;\n\t\t\t\topenapi_bound.push(match predicate {\n\t\t\t\t\tWherePredicate::Type(ty) =\u003e ty,\n\t\t\t\t\t_ =\u003e return Err(Error::new(predicate.span(), \"Expected type bound\"))\n\t\t\t\t});\n\t\t\t} else if attr.path.is_ident(\"non_openapi_bound\") {\n\t\t\t\tlet attr_arg: LitStr = syn::parse2(remove_parens(attr.tokens))?;\n\t\t\t\tlet predicate = attr_arg.parse_with(WherePredicate::parse)?;\n\t\t\t\tnon_openapi_bound.push(match predicate {\n\t\t\t\t\tWherePredicate::Type(ty) =\u003e ty,\n\t\t\t\t\t_ =\u003e return Err(Error::new(predicate.span(), \"Expected type bound\"))\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tother.push(attr);\n\t\t\t}\n\t\t}\n\n\t\tOk(Self {\n\t\t\topenapi_only,\n\t\t\topenapi_bound,\n\t\t\tnon_openapi_bound,\n\t\t\tother_attrs: other\n\t\t})\n\t}\n}\n\npub(crate) fn expand_private_openapi_trait(mut attrs: AttributeArgs, tr8: ItemTrait) -\u003e Result\u003cTokenStream\u003e {\n\tlet tr8_attrs = \u0026tr8.attrs;\n\tlet vis = \u0026tr8.vis;\n\tlet ident = \u0026tr8.ident;\n\tlet generics = \u0026tr8.generics;\n\tlet colon_token = \u0026tr8.colon_token;\n\tlet supertraits = \u0026tr8.supertraits;\n\n\tif attrs.len() != 1 {\n\t\treturn Err(Error::new(\n\t\t\tSpan::call_site(),\n\t\t\t\"Expected one argument. Example: #[_private_openapi_trait(OpenapiTraitName)]\"\n\t\t));\n\t}\n\tlet openapi_ident = match attrs.remove(0) {\n\t\tNestedMeta::Meta(Meta::Path(path)) =\u003e path,\n\t\tp =\u003e {\n\t\t\treturn Err(Error::new(\n\t\t\t\tp.span(),\n\t\t\t\t\"Expected name of the Resource struct this method belongs to\"\n\t\t\t))\n\t\t},\n\t};\n\n\tlet orig_trait = {\n\t\tlet items = tr8\n\t\t\t.items\n\t\t\t.clone()\n\t\t\t.into_iter()\n\t\t\t.map(|item| {\n\t\t\t\tOk(match item {\n\t\t\t\t\tTraitItem::Method(mut method) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(method.attrs)?;\n\t\t\t\t\t\tmethod.attrs = attrs.other_attrs;\n\t\t\t\t\t\tfor bound in attrs.non_openapi_bound {\n\t\t\t\t\t\t\t// we compare two incompatible types using their `Display` implementation\n\t\t\t\t\t\t\t// this triggers a false positive in clippy\n\t\t\t\t\t\t\t#[cfg_attr(feature = \"cargo-clippy\", allow(clippy::cmp_owned))]\n\t\t\t\t\t\t\tmethod\n\t\t\t\t\t\t\t\t.sig\n\t\t\t\t\t\t\t\t.generics\n\t\t\t\t\t\t\t\t.type_params_mut()\n\t\t\t\t\t\t\t\t.filter(|param| param.ident.to_string() == bound.bounded_ty.to_token_stream().to_string())\n\t\t\t\t\t\t\t\t.for_each(|param| param.bounds.extend(bound.bounds.clone()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif attrs.openapi_only {\n\t\t\t\t\t\t\tNone\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tSome(TraitItem::Method(method))\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tTraitItem::Type(mut ty) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(ty.attrs)?;\n\t\t\t\t\t\tty.attrs = attrs.other_attrs;\n\t\t\t\t\t\tSome(TraitItem::Type(ty))\n\t\t\t\t\t},\n\t\t\t\t\titem =\u003e Some(item)\n\t\t\t\t})\n\t\t\t})\n\t\t\t.collect_to_result()?;\n\t\tquote! {\n\t\t\t#(#tr8_attrs)*\n\t\t\t#vis trait #ident #generics #colon_token #supertraits {\n\t\t\t\t#(#items)*\n\t\t\t}\n\t\t}\n\t};\n\n\tlet openapi_trait = if !cfg!(feature = \"openapi\") {\n\t\tNone\n\t} else {\n\t\tlet items = tr8\n\t\t\t.items\n\t\t\t.clone()\n\t\t\t.into_iter()\n\t\t\t.map(|item| {\n\t\t\t\tOk(match item {\n\t\t\t\t\tTraitItem::Method(mut method) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(method.attrs)?;\n\t\t\t\t\t\tmethod.attrs = attrs.other_attrs;\n\t\t\t\t\t\tfor bound in attrs.openapi_bound {\n\t\t\t\t\t\t\t// we compare two incompatible types using their `Display` implementation\n\t\t\t\t\t\t\t// this triggers a false positive in clippy\n\t\t\t\t\t\t\t#[cfg_attr(feature = \"cargo-clippy\", allow(clippy::cmp_owned))]\n\t\t\t\t\t\t\tmethod\n\t\t\t\t\t\t\t\t.sig\n\t\t\t\t\t\t\t\t.generics\n\t\t\t\t\t\t\t\t.type_params_mut()\n\t\t\t\t\t\t\t\t.filter(|param| param.ident.to_string() == bound.bounded_ty.to_token_stream().to_string())\n\t\t\t\t\t\t\t\t.for_each(|param| param.bounds.extend(bound.bounds.clone()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTraitItem::Method(method)\n\t\t\t\t\t},\n\t\t\t\t\tTraitItem::Type(mut ty) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(ty.attrs)?;\n\t\t\t\t\t\tty.attrs = attrs.other_attrs;\n\t\t\t\t\t\tfor bound in attrs.openapi_bound {\n\t\t\t\t\t\t\tty.bounds.extend(bound.bounds.clone());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTraitItem::Type(ty)\n\t\t\t\t\t},\n\t\t\t\t\titem =\u003e item\n\t\t\t\t})\n\t\t\t})\n\t\t\t.collect_to_result()?;\n\t\tSome(quote! {\n\t\t\t#(#tr8_attrs)*\n\t\t\t#vis trait #openapi_ident #generics #colon_token #supertraits {\n\t\t\t\t#(#items)*\n\t\t\t}\n\t\t})\n\t};\n\n\tOk(quote! {\n\t\t#orig_trait\n\t\t#openapi_trait\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","request_body.rs"],"content":"use crate::util::CollectToResult;\nuse proc_macro2::{Ident, TokenStream};\nuse quote::quote;\nuse std::iter;\nuse syn::{\n\tparse::{Parse, ParseStream},\n\tpunctuated::Punctuated,\n\tspanned::Spanned,\n\tDeriveInput, Error, Generics, Path, Result, Token\n};\n\nstruct MimeList(Punctuated\u003cPath, Token![,]\u003e);\n\nimpl Parse for MimeList {\n\tfn parse(input: ParseStream\u003c'_\u003e) -\u003e Result\u003cSelf\u003e {\n\t\tlet list = Punctuated::parse_separated_nonempty(\u0026input)?;\n\t\tOk(Self(list))\n\t}\n}\n\n#[cfg(not(feature = \"openapi\"))]\nfn impl_openapi_type(_ident: \u0026Ident, _generics: \u0026Generics) -\u003e TokenStream {\n\tquote!()\n}\n\n#[cfg(feature = \"openapi\")]\nfn impl_openapi_type(ident: \u0026Ident, generics: \u0026Generics) -\u003e TokenStream {\n\tlet openapi = quote!(::gotham_restful::private::openapi);\n\tquote! {\n\t\timpl #generics ::gotham_restful::private::OpenapiType for #ident #generics {\n\t\t\tfn schema() -\u003e ::gotham_restful::private::OpenapiSchema {\n\t\t\t\t::gotham_restful::private::OpenapiSchema::new(\n\t\t\t\t\t#openapi::SchemaKind::Type(\n\t\t\t\t\t\t#openapi::Type::String(\n\t\t\t\t\t\t\t#openapi::StringType {\n\t\t\t\t\t\t\t\tformat: #openapi::VariantOrUnknownOrEmpty::Item(\n\t\t\t\t\t\t\t\t\t#openapi::StringFormat::Binary\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t.. ::std::default::Default::default()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\t}\n}\n\npub fn expand_request_body(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\tlet generics = input.generics;\n\n\tlet types = input\n\t\t.attrs\n\t\t.into_iter()\n\t\t.filter(|attr| {\n\t\t\tattr.path.segments.iter().last().map(|segment| segment.ident.to_string()) == Some(\"supported_types\".to_string())\n\t\t})\n\t\t.flat_map(|attr| {\n\t\t\tlet span = attr.span();\n\t\t\tattr.parse_args::\u003cMimeList\u003e()\n\t\t\t\t.map(|list| Box::new(list.0.into_iter().map(Ok)) as Box\u003cdyn Iterator\u003cItem = Result\u003cPath\u003e\u003e\u003e)\n\t\t\t\t.unwrap_or_else(|mut err| {\n\t\t\t\t\terr.combine(Error::new(\n\t\t\t\t\t\tspan,\n\t\t\t\t\t\t\"Hint: Types list should look like #[supported_types(TEXT_PLAIN, APPLICATION_JSON)]\"\n\t\t\t\t\t));\n\t\t\t\t\tBox::new(iter::once(Err(err)))\n\t\t\t\t})\n\t\t})\n\t\t.collect_to_result()?;\n\n\tlet types = match types {\n\t\tref types if types.is_empty() =\u003e quote!(None),\n\t\ttypes =\u003e quote!(Some(vec![#(#types),*]))\n\t};\n\n\tlet impl_openapi_type = impl_openapi_type(\u0026ident, \u0026generics);\n\n\tOk(quote! {\n\t\timpl #generics ::gotham_restful::RequestBody for #ident #generics\n\t\twhere #ident #generics : ::gotham_restful::FromBody\n\t\t{\n\t\t\tfn supported_types() -\u003e ::core::option::Option\u003c::std::vec::Vec\u003c::gotham_restful::Mime\u003e\u003e {\n\t\t\t\t#types\n\t\t\t}\n\t\t}\n\n\t\t#impl_openapi_type\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","resource.rs"],"content":"use crate::{endpoint::endpoint_ident, util::CollectToResult};\nuse proc_macro2::{Ident, TokenStream};\nuse quote::quote;\nuse std::iter;\nuse syn::{\n\tparenthesized,\n\tparse::{Parse, ParseStream},\n\tpunctuated::Punctuated,\n\tDeriveInput, Result, Token\n};\n\nstruct MethodList(Punctuated\u003cIdent, Token![,]\u003e);\n\nimpl Parse for MethodList {\n\tfn parse(input: ParseStream\u003c'_\u003e) -\u003e Result\u003cSelf\u003e {\n\t\tlet content;\n\t\tlet _paren = parenthesized!(content in input);\n\t\tlet list = Punctuated::parse_separated_nonempty(\u0026content)?;\n\t\tOk(Self(list))\n\t}\n}\n\npub fn expand_resource(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\n\tlet methods = input\n\t\t.attrs\n\t\t.into_iter()\n\t\t.filter(|attr| attr.path.is_ident(\"resource\"))\n\t\t.map(|attr| syn::parse2(attr.tokens).map(|m: MethodList| m.0.into_iter()))\n\t\t.flat_map(|list| match list {\n\t\t\tOk(iter) =\u003e Box::new(iter.map(|method| {\n\t\t\t\tlet ident = endpoint_ident(\u0026method);\n\t\t\t\tOk(quote!(route.endpoint::\u003c#ident\u003e();))\n\t\t\t})) as Box\u003cdyn Iterator\u003cItem = Result\u003cTokenStream\u003e\u003e\u003e,\n\t\t\tErr(err) =\u003e Box::new(iter::once(Err(err)))\n\t\t})\n\t\t.collect_to_result()?;\n\n\tlet non_openapi_impl = quote! {\n\t\timpl ::gotham_restful::Resource for #ident {\n\t\t\tfn setup\u003cD: ::gotham_restful::DrawResourceRoutes\u003e(mut route: D) {\n\t\t\t\t#(#methods)*\n\t\t\t}\n\t\t}\n\t};\n\tlet openapi_impl = if !cfg!(feature = \"openapi\") {\n\t\tNone\n\t} else {\n\t\tSome(quote! {\n\t\t\timpl ::gotham_restful::ResourceWithSchema for #ident {\n\t\t\t\tfn setup\u003cD: ::gotham_restful::DrawResourceRoutesWithSchema\u003e(mut route: D) {\n\t\t\t\t\t#(#methods)*\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\tOk(quote! {\n\t\t#non_openapi_impl\n\t\t#openapi_impl\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","resource_error.rs"],"content":"use crate::util::{remove_parens, CollectToResult};\nuse proc_macro2::{Ident, TokenStream};\nuse quote::{format_ident, quote};\nuse std::iter;\nuse syn::{\n\tspanned::Spanned, Attribute, Data, DeriveInput, Error, Fields, GenericParam, LitStr, Path, PathSegment, Result, Type,\n\tVariant\n};\n\nstruct ErrorVariantField {\n\tattrs: Vec\u003cAttribute\u003e,\n\tident: Ident,\n\tty: Type\n}\n\nstruct ErrorVariant {\n\tident: Ident,\n\tstatus: Option\u003cPath\u003e,\n\tis_named: bool,\n\tfields: Vec\u003cErrorVariantField\u003e,\n\tfrom_ty: Option\u003c(usize, Type)\u003e,\n\tdisplay: Option\u003cLitStr\u003e\n}\n\nfn process_variant(variant: Variant) -\u003e Result\u003cErrorVariant\u003e {\n\tlet status =\n\t\tmatch variant.attrs.iter().find(|attr| {\n\t\t\tattr.path.segments.iter().last().map(|segment| segment.ident.to_string()) == Some(\"status\".to_string())\n\t\t}) {\n\t\t\tSome(attr) =\u003e Some(syn::parse2(remove_parens(attr.tokens.clone()))?),\n\t\t\tNone =\u003e None\n\t\t};\n\n\tlet mut is_named = false;\n\tlet mut fields = Vec::new();\n\tmatch variant.fields {\n\t\tFields::Named(named) =\u003e {\n\t\t\tis_named = true;\n\t\t\tfor field in named.named {\n\t\t\t\tlet span = field.span();\n\t\t\t\tfields.push(ErrorVariantField {\n\t\t\t\t\tattrs: field.attrs,\n\t\t\t\t\tident: field\n\t\t\t\t\t\t.ident\n\t\t\t\t\t\t.ok_or_else(|| Error::new(span, \"Missing ident for this enum variant field\"))?,\n\t\t\t\t\tty: field.ty\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tFields::Unnamed(unnamed) =\u003e {\n\t\t\tfor (i, field) in unnamed.unnamed.into_iter().enumerate() {\n\t\t\t\tfields.push(ErrorVariantField {\n\t\t\t\t\tattrs: field.attrs,\n\t\t\t\t\tident: format_ident!(\"arg{}\", i),\n\t\t\t\t\tty: field.ty\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tFields::Unit =\u003e {}\n\t}\n\n\tlet from_ty = fields\n\t\t.iter()\n\t\t.enumerate()\n\t\t.find(|(_, field)| {\n\t\t\tfield\n\t\t\t\t.attrs\n\t\t\t\t.iter()\n\t\t\t\t.any(|attr| attr.path.segments.last().map(|segment| segment.ident.to_string()) == Some(\"from\".to_string()))\n\t\t})\n\t\t.map(|(i, field)| (i, field.ty.clone()));\n\n\tlet display = match variant.attrs.iter().find(|attr| {\n\t\tattr.path.segments.iter().last().map(|segment| segment.ident.to_string()) == Some(\"display\".to_string())\n\t}) {\n\t\tSome(attr) =\u003e Some(syn::parse2(remove_parens(attr.tokens.clone()))?),\n\t\tNone =\u003e None\n\t};\n\n\tOk(ErrorVariant {\n\t\tident: variant.ident,\n\t\tstatus,\n\t\tis_named,\n\t\tfields,\n\t\tfrom_ty,\n\t\tdisplay\n\t})\n}\n\nfn path_segment(name: \u0026str) -\u003e PathSegment {\n\tPathSegment {\n\t\tident: format_ident!(\"{}\", name),\n\t\targuments: Default::default()\n\t}\n}\n\nimpl ErrorVariant {\n\tfn fields_pat(\u0026self) -\u003e TokenStream {\n\t\tlet mut fields = self.fields.iter().map(|field| \u0026field.ident).peekable();\n\t\tif fields.peek().is_none() {\n\t\t\tquote!()\n\t\t} else if self.is_named {\n\t\t\tquote!( { #( #fields ),* } )\n\t\t} else {\n\t\t\tquote!( ( #( #fields ),* ) )\n\t\t}\n\t}\n\n\tfn to_display_match_arm(\u0026self, formatter_ident: \u0026Ident, enum_ident: \u0026Ident) -\u003e Result\u003cTokenStream\u003e {\n\t\tlet ident = \u0026self.ident;\n\t\tlet display = self\n\t\t\t.display\n\t\t\t.as_ref()\n\t\t\t.ok_or_else(|| Error::new(self.ident.span(), \"Missing display string for this variant\"))?;\n\n\t\t// lets find all required format parameters\n\t\tlet display_str = display.value();\n\t\tlet mut params: Vec\u003c\u0026str\u003e = Vec::new();\n\t\tlet len = display_str.len();\n\t\tlet mut start = len;\n\t\tlet mut iter = display_str.chars().enumerate().peekable();\n\t\twhile let Some((i, c)) = iter.next() {\n\t\t\t// we found a new opening brace\n\t\t\tif start == len \u0026\u0026 c == '{' {\n\t\t\t\tstart = i + 1;\n\t\t\t}\n\t\t\t// we found a duplicate opening brace\n\t\t\telse if start == i \u0026\u0026 c == '{' {\n\t\t\t\tstart = len;\n\t\t\t}\n\t\t\t// we found a closing brace\n\t\t\telse if start \u003c i \u0026\u0026 c == '}' {\n\t\t\t\tmatch iter.peek() {\n\t\t\t\t\tSome((_, '}')) =\u003e {\n\t\t\t\t\t\treturn Err(Error::new(\n\t\t\t\t\t\t\tdisplay.span(),\n\t\t\t\t\t\t\t\"Error parsing format string: curly braces not allowed inside parameter name\"\n\t\t\t\t\t\t))\n\t\t\t\t\t},\n\t\t\t\t\t_ =\u003e params.push(\u0026display_str[start..i])\n\t\t\t\t};\n\t\t\t\tstart = len;\n\t\t\t}\n\t\t\t// we found a closing brace without content\n\t\t\telse if start == i \u0026\u0026 c == '}' {\n\t\t\t\treturn Err(Error::new(\n\t\t\t\t\tdisplay.span(),\n\t\t\t\t\t\"Error parsing format string: parameter name must not be empty\"\n\t\t\t\t));\n\t\t\t}\n\t\t}\n\t\tif start != len {\n\t\t\treturn Err(Error::new(\n\t\t\t\tdisplay.span(),\n\t\t\t\t\"Error parsing format string: Unmatched opening brace\"\n\t\t\t));\n\t\t}\n\t\tlet params = params\n\t\t\t.into_iter()\n\t\t\t.map(|name| format_ident!(\"{}{}\", if self.is_named { \"\" } else { \"arg\" }, name));\n\n\t\tlet fields_pat = self.fields_pat();\n\t\tOk(quote! {\n\t\t\t#enum_ident::#ident #fields_pat =\u003e ::std::write!(#formatter_ident, #display #(, #params = #params)*)\n\t\t})\n\t}\n\n\tfn status(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tself.status.as_ref().map(|status| {\n\t\t\t// the status might be relative to StatusCode, so let's fix that\n\t\t\tif status.leading_colon.is_none() \u0026\u0026 status.segments.len() \u003c 2 {\n\t\t\t\tlet status_ident = status.segments.first().cloned().unwrap_or_else(|| path_segment(\"OK\"));\n\t\t\t\tquote!(::gotham_restful::gotham::hyper::StatusCode::#status_ident)\n\t\t\t} else {\n\t\t\t\tquote!(::gotham_restful::gotham::hyper::StatusCode::from(#status))\n\t\t\t}\n\t\t})\n\t}\n\n\tfn into_match_arm(self, enum_ident: \u0026Ident) -\u003e Result\u003cTokenStream\u003e {\n\t\tlet ident = \u0026self.ident;\n\t\tlet fields_pat = self.fields_pat();\n\t\tlet status = self.status();\n\n\t\t// the response will come directly from the from_ty if present\n\t\tlet res = match (self.from_ty, status) {\n\t\t\t(Some((from_index, _)), None) =\u003e {\n\t\t\t\tlet from_field = \u0026self.fields[from_index].ident;\n\t\t\t\tquote!(#from_field.into_response_error())\n\t\t\t},\n\t\t\t(Some(_), Some(_)) =\u003e return Err(Error::new(ident.span(), \"When #[from] is used, #[status] must not be used!\")),\n\t\t\t(None, Some(status)) =\u003e quote!(::std::result::Result::Ok(::gotham_restful::Response::new(\n\t\t\t\t#status,\n\t\t\t\t::gotham_restful::gotham::hyper::Body::empty(),\n\t\t\t\t::core::option::Option::None\n\t\t\t))),\n\t\t\t(None, None) =\u003e return Err(Error::new(ident.span(), \"Missing #[status(code)] for this variant\"))\n\t\t};\n\n\t\tOk(quote! {\n\t\t\t#enum_ident::#ident #fields_pat =\u003e #res\n\t\t})\n\t}\n\n\tfn were(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tself.from_ty.as_ref().map(|(_, ty)| quote!( #ty : ::std::error::Error ))\n\t}\n}\n\npub fn expand_resource_error(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\tlet generics = input.generics;\n\n\tlet inum = match input.data {\n\t\tData::Enum(inum) =\u003e Ok(inum),\n\t\tData::Struct(strukt) =\u003e Err(strukt.struct_token.span()),\n\t\tData::Union(uni) =\u003e Err(uni.union_token.span())\n\t}\n\t.map_err(|span| Error::new(span, \"#[derive(ResourceError)] only works for enums\"))?;\n\tlet variants = inum.variants.into_iter().map(process_variant).collect_to_result()?;\n\n\tlet display_impl = if variants.iter().any(|v| v.display.is_none()) {\n\t\tNone // TODO issue warning if display is present on some but not all\n\t} else {\n\t\tlet were = generics.params.iter().filter_map(|param| match param {\n\t\t\tGenericParam::Type(ty) =\u003e {\n\t\t\t\tlet ident = \u0026ty.ident;\n\t\t\t\tSome(quote!(#ident : ::std::fmt::Display))\n\t\t\t},\n\t\t\t_ =\u003e None\n\t\t});\n\t\tlet formatter_ident = format_ident!(\"resource_error_display_formatter\");\n\t\tlet match_arms = variants\n\t\t\t.iter()\n\t\t\t.map(|v| v.to_display_match_arm(\u0026formatter_ident, \u0026ident))\n\t\t\t.collect_to_result()?;\n\t\tSome(quote! {\n\t\t\timpl #generics ::std::fmt::Display for #ident #generics\n\t\t\twhere #( #were ),*\n\t\t\t{\n\t\t\t\tfn fmt(\u0026self, #formatter_ident: \u0026mut ::std::fmt::Formatter\u003c'_\u003e) -\u003e ::std::fmt::Result {\n\t\t\t\t\tmatch self {\n\t\t\t\t\t\t#( #match_arms ),*\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tlet mut from_impls: Vec\u003cTokenStream\u003e = Vec::new();\n\n\tfor var in \u0026variants {\n\t\tlet var_ident = \u0026var.ident;\n\t\tlet (from_index, from_ty) = match var.from_ty.as_ref() {\n\t\t\tSome(f) =\u003e f,\n\t\t\tNone =\u003e continue\n\t\t};\n\t\tlet from_ident = \u0026var.fields[*from_index].ident;\n\n\t\tlet fields_pat = var.fields_pat();\n\t\tlet fields_where = var\n\t\t\t.fields\n\t\t\t.iter()\n\t\t\t.enumerate()\n\t\t\t.filter(|(i, _)| i != from_index)\n\t\t\t.map(|(_, field)| {\n\t\t\t\tlet ty = \u0026field.ty;\n\t\t\t\tquote!( #ty : Default )\n\t\t\t})\n\t\t\t.chain(iter::once(quote!( #from_ty : ::std::error::Error )));\n\t\tlet fields_let = var\n\t\t\t.fields\n\t\t\t.iter()\n\t\t\t.enumerate()\n\t\t\t.filter(|(i, _)| i != from_index)\n\t\t\t.map(|(_, field)| {\n\t\t\t\tlet id = \u0026field.ident;\n\t\t\t\tlet ty = \u0026field.ty;\n\t\t\t\tquote!( let #id : #ty = Default::default(); )\n\t\t\t});\n\n\t\tfrom_impls.push(quote! {\n\t\t\timpl #generics ::std::convert::From\u003c#from_ty\u003e for #ident #generics\n\t\t\twhere #( #fields_where ),*\n\t\t\t{\n\t\t\t\tfn from(#from_ident: #from_ty) -\u003e Self {\n\t\t\t\t\t#( #fields_let )*\n\t\t\t\t\tSelf::#var_ident #fields_pat\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet status_codes = if cfg!(feature = \"openapi\") {\n\t\tlet codes = variants.iter().map(|v| match v.status() {\n\t\t\tSome(code) =\u003e quote!(status_codes.push(#code);),\n\t\t\tNone =\u003e {\n\t\t\t\t// we would've errored before if from_ty was not set\n\t\t\t\tlet from_ty = \u0026v.from_ty.as_ref().unwrap().1;\n\t\t\t\tquote!(status_codes.extend(\u003c#from_ty as ::gotham_restful::IntoResponseError\u003e::status_codes());)\n\t\t\t}\n\t\t});\n\t\tSome(quote! {\n\t\t\tfn status_codes() -\u003e ::std::vec::Vec\u003c::gotham_restful::gotham::hyper::StatusCode\u003e {\n\t\t\t\tlet mut status_codes = \u003c::std::vec::Vec\u003c::gotham_restful::gotham::hyper::StatusCode\u003e\u003e::new();\n\t\t\t\t#(#codes)*\n\t\t\t\tstatus_codes\n\t\t\t}\n\t\t})\n\t} else {\n\t\tNone\n\t};\n\n\tlet schema = if cfg!(feature = \"openapi\") {\n\t\tlet codes = variants.iter().map(|v| match v.status() {\n\t\t\tSome(code) =\u003e quote! {\n\t\t\t\t#code =\u003e \u003c::gotham_restful::NoContent as ::gotham_restful::ResponseSchema\u003e::schema(\n\t\t\t\t\t::gotham_restful::gotham::hyper::StatusCode::NO_CONTENT\n\t\t\t\t)\n\t\t\t},\n\t\t\tNone =\u003e {\n\t\t\t\t// we would've errored before if from_ty was not set\n\t\t\t\tlet from_ty = \u0026v.from_ty.as_ref().unwrap().1;\n\t\t\t\tquote! {\n\t\t\t\t\tcode if \u003c#from_ty as ::gotham_restful::IntoResponseError\u003e::status_codes().contains(\u0026code) =\u003e {\n\t\t\t\t\t\t\u003c#from_ty as ::gotham_restful::IntoResponseError\u003e::schema(code)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tSome(quote! {\n\t\t\tfn schema(code: ::gotham_restful::gotham::hyper::StatusCode) -\u003e ::gotham_restful::private::OpenapiSchema {\n\t\t\t\tmatch code {\n\t\t\t\t\t#(#codes,)*\n\t\t\t\t\tcode =\u003e panic!(\"Invalid status code {}\", code)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tNone\n\t};\n\n\tlet were = variants.iter().filter_map(|variant| variant.were()).collect::\u003cVec\u003c_\u003e\u003e();\n\tlet variants = variants\n\t\t.into_iter()\n\t\t.map(|variant| variant.into_match_arm(\u0026ident))\n\t\t.collect_to_result()?;\n\n\tOk(quote! {\n\t\t#display_impl\n\n\t\timpl #generics ::gotham_restful::IntoResponseError for #ident #generics\n\t\twhere #( #were ),*\n\t\t{\n\t\t\ttype Err = ::gotham_restful::private::serde_json::Error;\n\n\t\t\tfn into_response_error(self) -\u003e ::std::result::Result\u003c::gotham_restful::Response, Self::Err\u003e\n\t\t\t{\n\t\t\t\tmatch self {\n\t\t\t\t\t#( #variants ),*\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t#status_codes\n\t\t\t#schema\n\t\t}\n\n\t\t#( #from_impls )*\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","util.rs"],"content":"use proc_macro2::{Delimiter, TokenStream, TokenTree};\nuse std::iter;\nuse syn::{Error, Lit, LitBool, LitStr, Result};\n\npub(crate) trait CollectToResult {\n\ttype Item;\n\n\tfn collect_to_result(self) -\u003e Result\u003cVec\u003cSelf::Item\u003e\u003e;\n}\n\nimpl\u003cItem, I\u003e CollectToResult for I\nwhere\n\tI: Iterator\u003cItem = Result\u003cItem\u003e\u003e\n{\n\ttype Item = Item;\n\n\tfn collect_to_result(self) -\u003e Result\u003cVec\u003cItem\u003e\u003e {\n\t\tself.fold(Ok(Vec::new()), |res, code| match (code, res) {\n\t\t\t(Ok(code), Ok(mut codes)) =\u003e {\n\t\t\t\tcodes.push(code);\n\t\t\t\tOk(codes)\n\t\t\t},\n\t\t\t(Ok(_), Err(errors)) =\u003e Err(errors),\n\t\t\t(Err(err), Ok(_)) =\u003e Err(err),\n\t\t\t(Err(err), Err(mut errors)) =\u003e {\n\t\t\t\terrors.combine(err);\n\t\t\t\tErr(errors)\n\t\t\t}\n\t\t})\n\t}\n}\n\npub(crate) trait ExpectLit {\n\tfn expect_bool(self) -\u003e Result\u003cLitBool\u003e;\n\tfn expect_str(self) -\u003e Result\u003cLitStr\u003e;\n}\n\nimpl ExpectLit for Lit {\n\tfn expect_bool(self) -\u003e Result\u003cLitBool\u003e {\n\t\tmatch self {\n\t\t\tSelf::Bool(bool) =\u003e Ok(bool),\n\t\t\t_ =\u003e Err(Error::new(self.span(), \"Expected boolean literal\"))\n\t\t}\n\t}\n\n\tfn expect_str(self) -\u003e Result\u003cLitStr\u003e {\n\t\tmatch self {\n\t\t\tSelf::Str(str) =\u003e Ok(str),\n\t\t\t_ =\u003e Err(Error::new(self.span(), \"Expected string literal\"))\n\t\t}\n\t}\n}\n\npub(crate) fn remove_parens(input: TokenStream) -\u003e TokenStream {\n\tlet iter = input.into_iter().flat_map(|tt| {\n\t\tif let TokenTree::Group(group) = \u0026tt {\n\t\t\tif group.delimiter() == Delimiter::Parenthesis {\n\t\t\t\treturn Box::new(group.stream().into_iter()) as Box\u003cdyn Iterator\u003cItem = TokenTree\u003e\u003e;\n\t\t\t}\n\t\t}\n\t\tBox::new(iter::once(tt))\n\t});\n\titer.collect()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","auth.rs"],"content":"use crate::{AuthError, Forbidden};\n\nuse cookie::CookieJar;\nuse futures_util::{\n\tfuture,\n\tfuture::{FutureExt, TryFutureExt}\n};\nuse gotham::{\n\tanyhow,\n\thandler::HandlerFuture,\n\thyper::header::{HeaderMap, HeaderName, AUTHORIZATION},\n\tmiddleware::{cookie::CookieParser, Middleware, NewMiddleware},\n\tstate::{FromState, State}\n};\nuse jsonwebtoken::{errors::ErrorKind, DecodingKey};\nuse serde::de::DeserializeOwned;\nuse std::{marker::PhantomData, panic::RefUnwindSafe, pin::Pin};\n\npub type AuthValidation = jsonwebtoken::Validation;\n\n/// The authentication status returned by the auth middleware for each request.\n#[derive(Debug, StateData)]\npub enum AuthStatus\u003cT: Send + 'static\u003e {\n\t/// The auth status is unknown.\n\tUnknown,\n\t/// The request has been performed without any kind of authentication.\n\tUnauthenticated,\n\t/// The request has been performed with an invalid authentication.\n\tInvalid,\n\t/// The request has been performed with an expired authentication.\n\tExpired,\n\t/// The request has been performed with a valid authentication.\n\tAuthenticated(T)\n}\n\nimpl\u003cT\u003e Clone for AuthStatus\u003cT\u003e\nwhere\n\tT: Clone + Send + 'static\n{\n\tfn clone(\u0026self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::Unknown =\u003e Self::Unknown,\n\t\t\tSelf::Unauthenticated =\u003e Self::Unauthenticated,\n\t\t\tSelf::Invalid =\u003e Self::Invalid,\n\t\t\tSelf::Expired =\u003e Self::Expired,\n\t\t\tSelf::Authenticated(data) =\u003e Self::Authenticated(data.clone())\n\t\t}\n\t}\n}\n\nimpl\u003cT\u003e Copy for AuthStatus\u003cT\u003e where T: Copy + Send + 'static {}\n\nimpl\u003cT: Send + 'static\u003e AuthStatus\u003cT\u003e {\n\tpub fn ok(self) -\u003e Result\u003cT, AuthError\u003e {\n\t\tmatch self {\n\t\t\tSelf::Authenticated(data) =\u003e Ok(data),\n\t\t\t_ =\u003e Err(Forbidden)\n\t\t}\n\t}\n}\n\n/// The source of the authentication token in the request.\n#[derive(Clone, Debug, StateData)]\npub enum AuthSource {\n\t/// Take the token from a cookie with the given name.\n\tCookie(String),\n\t/// Take the token from a header with the given name.\n\tHeader(HeaderName),\n\t/// Take the token from the HTTP Authorization header. This is different from `Header(\"Authorization\")`\n\t/// as it will follow the `scheme param` format from the HTTP specification. The `scheme` will\n\t/// be discarded, so its value doesn't matter.\n\tAuthorizationHeader\n}\n\n/**\nThis trait will help the auth middleware to determine the validity of an authentication token.\n\nA very basic implementation could look like this:\n\n```\n# use gotham_restful::{AuthHandler, gotham::state::State};\n#\nconst SECRET : \u0026'static [u8; 32] = b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\";\n\nstruct CustomAuthHandler;\nimpl\u003cT\u003e AuthHandler\u003cT\u003e for CustomAuthHandler {\n\tfn jwt_secret\u003cF : FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state : \u0026mut State, _decode_data : F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\tSome(SECRET.to_vec())\n\t}\n}\n```\n*/\npub trait AuthHandler\u003cData\u003e {\n\t/// Return the SHA256-HMAC secret used to verify the JWT token.\n\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cData\u003e\u003e(\u0026self, state: \u0026mut State, decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e;\n}\n\n/// An [AuthHandler] returning always the same secret. See [AuthMiddleware] for a usage example.\n#[derive(Clone, Debug)]\npub struct StaticAuthHandler {\n\tsecret: Vec\u003cu8\u003e\n}\n\nimpl StaticAuthHandler {\n\tpub fn from_vec(secret: Vec\u003cu8\u003e) -\u003e Self {\n\t\tSelf { secret }\n\t}\n\n\tpub fn from_array(secret: \u0026[u8]) -\u003e Self {\n\t\tSelf::from_vec(secret.to_vec())\n\t}\n}\n\nimpl\u003cT\u003e AuthHandler\u003cT\u003e for StaticAuthHandler {\n\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state: \u0026mut State, _decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\tSome(self.secret.clone())\n\t}\n}\n\n/**\nThis is the auth middleware. To use it, first make sure you have the `auth` feature enabled. Then\nsimply add it to your pipeline and request it inside your handler:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#\n#[derive(Resource)]\n#[resource(read_all)]\nstruct AuthResource;\n\n#[derive(Debug, Deserialize, Clone)]\nstruct AuthData {\n\tsub: String,\n\texp: u64\n}\n\n#[read_all]\nfn read_all(auth : \u0026AuthStatus\u003cAuthData\u003e) -\u003e Success\u003cString\u003e {\n\tformat!(\"{:?}\", auth).into()\n}\n\nfn main() {\n\tlet auth: AuthMiddleware\u003cAuthData, _\u003e = AuthMiddleware::new(\n\t\tAuthSource::AuthorizationHeader,\n\t\tAuthValidation::default(),\n\t\tStaticAuthHandler::from_array(b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\")\n\t);\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(auth).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cAuthResource\u003e(\"auth\");\n\t}));\n}\n```\n*/\n#[derive(Debug)]\npub struct AuthMiddleware\u003cData, Handler\u003e {\n\tsource: AuthSource,\n\tvalidation: AuthValidation,\n\thandler: Handler,\n\t_data: PhantomData\u003cData\u003e\n}\n\nimpl\u003cData, Handler\u003e Clone for AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tHandler: Clone\n{\n\tfn clone(\u0026self) -\u003e Self {\n\t\tSelf {\n\t\t\tsource: self.source.clone(),\n\t\t\tvalidation: self.validation.clone(),\n\t\t\thandler: self.handler.clone(),\n\t\t\t_data: self._data\n\t\t}\n\t}\n}\n\nimpl\u003cData, Handler\u003e AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tData: DeserializeOwned + Send,\n\tHandler: AuthHandler\u003cData\u003e + Default\n{\n\tpub fn from_source(source: AuthSource) -\u003e Self {\n\t\tSelf {\n\t\t\tsource,\n\t\t\tvalidation: Default::default(),\n\t\t\thandler: Default::default(),\n\t\t\t_data: Default::default()\n\t\t}\n\t}\n}\n\nimpl\u003cData, Handler\u003e AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tData: DeserializeOwned + Send,\n\tHandler: AuthHandler\u003cData\u003e\n{\n\tpub fn new(source: AuthSource, validation: AuthValidation, handler: Handler) -\u003e Self {\n\t\tSelf {\n\t\t\tsource,\n\t\t\tvalidation,\n\t\t\thandler,\n\t\t\t_data: Default::default()\n\t\t}\n\t}\n\n\tfn auth_status(\u0026self, state: \u0026mut State) -\u003e AuthStatus\u003cData\u003e {\n\t\t// extract the provided token, if any\n\t\tlet token = match \u0026self.source {\n\t\t\tAuthSource::Cookie(name) =\u003e CookieJar::try_borrow_from(\u0026state)\n\t\t\t\t.map(|jar| jar.get(\u0026name).map(|cookie| cookie.value().to_owned()))\n\t\t\t\t.unwrap_or_else(|| {\n\t\t\t\t\tCookieParser::from_state(\u0026state)\n\t\t\t\t\t\t.get(\u0026name)\n\t\t\t\t\t\t.map(|cookie| cookie.value().to_owned())\n\t\t\t\t}),\n\t\t\tAuthSource::Header(name) =\u003e HeaderMap::try_borrow_from(\u0026state)\n\t\t\t\t.and_then(|map| map.get(name))\n\t\t\t\t.and_then(|header| header.to_str().ok())\n\t\t\t\t.map(|value| value.to_owned()),\n\t\t\tAuthSource::AuthorizationHeader =\u003e HeaderMap::try_borrow_from(\u0026state)\n\t\t\t\t.and_then(|map| map.get(AUTHORIZATION))\n\t\t\t\t.and_then(|header| header.to_str().ok())\n\t\t\t\t.and_then(|value| value.split_whitespace().nth(1))\n\t\t\t\t.map(|value| value.to_owned())\n\t\t};\n\n\t\t// unauthed if no token\n\t\tlet token = match token {\n\t\t\tSome(token) =\u003e token,\n\t\t\tNone =\u003e return AuthStatus::Unauthenticated\n\t\t};\n\n\t\t// get the secret from the handler, possibly decoding claims ourselves\n\t\tlet secret = self.handler.jwt_secret(state, || {\n\t\t\tlet b64 = token.split('.').nth(1)?;\n\t\t\tlet raw = base64::decode_config(b64, base64::URL_SAFE_NO_PAD).ok()?;\n\t\t\tserde_json::from_slice(\u0026raw).ok()?\n\t\t});\n\n\t\t// unknown if no secret\n\t\tlet secret = match secret {\n\t\t\tSome(secret) =\u003e secret,\n\t\t\tNone =\u003e return AuthStatus::Unknown\n\t\t};\n\n\t\t// validate the token\n\t\tlet data: Data = match jsonwebtoken::decode(\u0026token, \u0026DecodingKey::from_secret(\u0026secret), \u0026self.validation) {\n\t\t\tOk(data) =\u003e data.claims,\n\t\t\tErr(e) =\u003e match e.into_kind() {\n\t\t\t\tErrorKind::ExpiredSignature =\u003e return AuthStatus::Expired,\n\t\t\t\t_ =\u003e return AuthStatus::Invalid\n\t\t\t}\n\t\t};\n\n\t\t// we found a valid token\n\t\tAuthStatus::Authenticated(data)\n\t}\n}\n\nimpl\u003cData, Handler\u003e Middleware for AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tData: DeserializeOwned + Send + 'static,\n\tHandler: AuthHandler\u003cData\u003e\n{\n\tfn call\u003cChain\u003e(self, mut state: State, chain: Chain) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\twhere\n\t\tChain: FnOnce(State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\t{\n\t\t// put the source in our state, required for e.g. openapi\n\t\tstate.put(self.source.clone());\n\n\t\t// put the status in our state\n\t\tlet status = self.auth_status(\u0026mut state);\n\t\tstate.put(status);\n\n\t\t// call the rest of the chain\n\t\tchain(state).and_then(|(state, res)| future::ok((state, res))).boxed()\n\t}\n}\n\nimpl\u003cData, Handler\u003e NewMiddleware for AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tSelf: Clone + Middleware + Sync + RefUnwindSafe\n{\n\ttype Instance = Self;\n\n\tfn new_middleware(\u0026self) -\u003e anyhow::Result\u003cSelf\u003e {\n\t\tlet c: Self = self.clone();\n\t\tOk(c)\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse cookie::Cookie;\n\tuse gotham::hyper::header::COOKIE;\n\tuse std::fmt::Debug;\n\n\t// 256-bit random string\n\tconst JWT_SECRET: \u0026'static [u8; 32] = b\"Lyzsfnta0cdxyF0T9y6VGxp3jpgoMUuW\";\n\n\t// some known tokens\n\tconst VALID_TOKEN : \u0026'static str = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJtc3JkMCIsInN1YiI6ImdvdGhhbS1yZXN0ZnVsIiwiaWF0IjoxNTc3ODM2ODAwLCJleHAiOjQxMDI0NDQ4MDB9.8h8Ax-nnykqEQ62t7CxmM3ja6NzUQ4L0MLOOzddjLKk\";\n\tconst EXPIRED_TOKEN : \u0026'static str = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJtc3JkMCIsInN1YiI6ImdvdGhhbS1yZXN0ZnVsIiwiaWF0IjoxNTc3ODM2ODAwLCJleHAiOjE1Nzc4MzcxMDB9.eV1snaGLYrJ7qUoMk74OvBY3WUU9M0Je5HTU2xtX1v0\";\n\tconst INVALID_TOKEN : \u0026'static str = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJtc3JkMCIsInN1YiI6ImdvdGhhbS1yZXN0ZnVsIiwiaWF0IjoxNTc3ODM2ODAwLCJleHAiOjQxMDI0NDQ4MDB9\";\n\n\t#[derive(Debug, Deserialize, PartialEq)]\n\tstruct TestData {\n\t\tiss: String,\n\t\tsub: String,\n\t\tiat: u64,\n\t\texp: u64\n\t}\n\n\timpl Default for TestData {\n\t\tfn default() -\u003e Self {\n\t\t\tSelf {\n\t\t\t\tiss: \"msrd0\".to_owned(),\n\t\t\t\tsub: \"gotham-restful\".to_owned(),\n\t\t\t\tiat: 1577836800,\n\t\t\t\texp: 4102444800\n\t\t\t}\n\t\t}\n\t}\n\n\t#[derive(Default)]\n\tstruct NoneAuthHandler;\n\timpl\u003cT\u003e AuthHandler\u003cT\u003e for NoneAuthHandler {\n\t\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state: \u0026mut State, _decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\t\tNone\n\t\t}\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_none_secret() {\n\t\tlet middleware = \u003cAuthMiddleware\u003cTestData, NoneAuthHandler\u003e\u003e::from_source(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tmiddleware.auth_status(\u0026mut state);\n\t\t});\n\t}\n\n\t#[derive(Default)]\n\tstruct TestAssertingHandler;\n\timpl\u003cT\u003e AuthHandler\u003cT\u003e for TestAssertingHandler\n\twhere\n\t\tT: Debug + Default + PartialEq\n\t{\n\t\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state: \u0026mut State, decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\t\tassert_eq!(decode_data(), Some(T::default()));\n\t\t\tSome(JWT_SECRET.to_vec())\n\t\t}\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_decode_data() {\n\t\tlet middleware = \u003cAuthMiddleware\u003cTestData, TestAssertingHandler\u003e\u003e::from_source(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tmiddleware.auth_status(\u0026mut state);\n\t\t});\n\t}\n\n\tfn new_middleware\u003cT\u003e(source: AuthSource) -\u003e AuthMiddleware\u003cT, StaticAuthHandler\u003e\n\twhere\n\t\tT: DeserializeOwned + Send\n\t{\n\t\tAuthMiddleware::new(source, Default::default(), StaticAuthHandler::from_array(JWT_SECRET))\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_no_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Unauthenticated =\u003e {},\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Unauthenticated, got {:?}\", status)\n\t\t\t};\n\t\t});\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_expired_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", EXPIRED_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Expired =\u003e {},\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Expired, got {:?}\", status)\n\t\t\t};\n\t\t});\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_invalid_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", INVALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Invalid =\u003e {},\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Invalid, got {:?}\", status)\n\t\t\t};\n\t\t});\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_auth_header_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_header_token() {\n\t\tlet header_name = \"x-znoiprwmvfexju\";\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::Header(HeaderName::from_static(header_name)));\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(header_name, VALID_TOKEN.parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_cookie_token() {\n\t\tlet cookie_name = \"znoiprwmvfexju\";\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::Cookie(cookie_name.to_owned()));\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut jar = CookieJar::new();\n\t\t\tjar.add_original(Cookie::new(cookie_name, VALID_TOKEN));\n\t\t\tstate.put(jar);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_cookie_no_jar() {\n\t\tlet cookie_name = \"znoiprwmvfexju\";\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::Cookie(cookie_name.to_owned()));\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(COOKIE, format!(\"{}={}\", cookie_name, VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n}\n","traces":[{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[2463632],"length":1,"stats":{"Line":3},"fn_name":"from_vec"},{"line":109,"address":[2463696],"length":1,"stats":{"Line":3},"fn_name":"from_array"},{"line":110,"address":[2463719],"length":1,"stats":{"Line":3},"fn_name":null},{"line":115,"address":[2463760,2463862],"length":1,"stats":{"Line":2},"fn_name":"jwt_secret\u003cgotham_restful::auth::test::TestData,closure-9\u003e"},{"line":116,"address":[2463803],"length":1,"stats":{"Line":2},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[2464144,2464294,2464054,2463904],"length":1,"stats":{"Line":2},"fn_name":"from_source\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":188,"address":[2463946,2464186],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[2464202,2463962],"length":1,"stats":{"Line":2},"fn_name":null},{"line":190,"address":[2463969,2464209],"length":1,"stats":{"Line":2},"fn_name":null},{"line":200,"address":[2464638,2464384],"length":1,"stats":{"Line":3},"fn_name":"new\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":205,"address":[2464490],"length":1,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[2464688,2466150,2466336,2467984,2469446,2467805],"length":1,"stats":{"Line":5},"fn_name":"auth_status\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":211,"address":[2466383,2468031,2468263,2464735,2464810,2466458,2464967,2466615,2468106],"length":1,"stats":{"Line":6},"fn_name":null},{"line":212,"address":[2468226,2466578,2466468,2468042,2468173,2464746,2464820,2464877,2468116,2466525,2464930,2466394],"length":1,"stats":{"Line":8},"fn_name":null},{"line":213,"address":[2464861,2470096,2469632,2469822,2469742,2469984,2469792,2469872,2470013,2469662,2466509,2469712,2468157,2470125,2469901],"length":1,"stats":{"Line":5},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":214,"address":[2464898,2470656,2468194,2470448,2470825,2470864,2471033,2466546,2470617],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":215,"address":[2470749,2470957,2470902,2470486,2470541,2470694],"length":1,"stats":{"Line":2},"fn_name":null},{"line":216,"address":[2470713,2470921,2470505],"length":1,"stats":{"Line":1},"fn_name":null},{"line":217,"address":[2470208,2470368,2470398,2470238,2470318,2470288],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":219,"address":[2465037,2466685,2468276,2464980,2468333,2466628],"length":1,"stats":{"Line":2},"fn_name":null},{"line":220,"address":[2466669,2471099,2471163,2471136,2471072,2471200,2471227,2468317,2465021],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":221,"address":[2471344,2471353,2471424,2471264,2471273,2471433],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":222,"address":[2471552,2471526,2471600,2471504,2471622,2471574],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":223,"address":[2468080,2464784,2466756,2468404,2465108,2466432],"length":1,"stats":{"Line":8},"fn_name":null},{"line":224,"address":[2471741,2471648,2471661,2471728,2471821,2471808],"length":1,"stats":{"Line":8},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":225,"address":[2471897,2471968,2471888,2471977,2472048,2472057],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":226,"address":[2472308,2472148,2472228,2472288,2472128,2472208],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":227,"address":[2472464,2472416,2472390,2472486,2472368,2472438],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":231,"address":[2466877,2465229,2468525],"length":1,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[2468535,2465186,2468482,2466834,2465239,2466887],"length":1,"stats":{"Line":7},"fn_name":null},{"line":233,"address":[2466865,2468513,2465217],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[2473225,2465303,2466951,2468599,2472512],"length":1,"stats":{"Line":5},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":238,"address":[2472772,2472550],"length":1,"stats":{"Line":1},"fn_name":null},{"line":239,"address":[2472958,2472708,2472795],"length":1,"stats":{"Line":2},"fn_name":null},{"line":240,"address":[2473137,2472924,2472998],"length":1,"stats":{"Line":2},"fn_name":null},{"line":244,"address":[2465393,2467048,2468689],"length":1,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[2467005,2468691,2465395,2467050,2465350,2468646],"length":1,"stats":{"Line":7},"fn_name":null},{"line":246,"address":[2465381,2467036,2468677],"length":1,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[2467324,2468763,2468965,2467122,2465467,2465669],"length":1,"stats":{"Line":3},"fn_name":null},{"line":251,"address":[2465671,2468915,2467326,2465619,2467274,2468967],"length":1,"stats":{"Line":6},"fn_name":null},{"line":252,"address":[2467289,2465634,2468930],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[2469085,2465828,2467444,2469124,2465789,2467483],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[2469104,2467463,2465808],"length":1,"stats":{"Line":1},"fn_name":null},{"line":259,"address":[2465848,2467503,2469144],"length":1,"stats":{"Line":3},"fn_name":null},{"line":268,"address":[2479040,2478080,2480405,2476608,2477568,2478965,2479925,2477088,2479520,2477996,2480000,2478560,2477493,2478485,2479445,2477013],"length":1,"stats":{"Line":1},"fn_name":"call\u003copenapi_specification::AuthData,gotham_restful::auth::StaticAuthHandler,closure-0\u003e"},{"line":273,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":54,"coverable":68},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","cors.rs"],"content":"use gotham::{\n\thandler::HandlerFuture,\n\thelpers::http::response::create_empty_response,\n\thyper::{\n\t\theader::{\n\t\t\tHeaderMap, HeaderName, HeaderValue, ACCESS_CONTROL_ALLOW_CREDENTIALS, ACCESS_CONTROL_ALLOW_HEADERS,\n\t\t\tACCESS_CONTROL_ALLOW_METHODS, ACCESS_CONTROL_ALLOW_ORIGIN, ACCESS_CONTROL_MAX_AGE,\n\t\t\tACCESS_CONTROL_REQUEST_HEADERS, ACCESS_CONTROL_REQUEST_METHOD, ORIGIN, VARY\n\t\t},\n\t\tBody, Method, Response, StatusCode\n\t},\n\tmiddleware::Middleware,\n\tpipeline::chain::PipelineHandleChain,\n\trouter::{\n\t\tbuilder::{DefineSingleRoute, DrawRoutes, ExtendRouteMatcher},\n\t\troute::matcher::AccessControlRequestMethodMatcher\n\t},\n\tstate::{FromState, State}\n};\nuse std::{panic::RefUnwindSafe, pin::Pin};\n\n/**\nSpecify the allowed origins of the request. It is up to the browser to check the validity of the\norigin. This, when sent to the browser, will indicate whether or not the request's origin was\nallowed to make the request.\n*/\n#[derive(Clone, Debug)]\npub enum Origin {\n\t/// Do not send any `Access-Control-Allow-Origin` headers.\n\tNone,\n\t/// Send `Access-Control-Allow-Origin: *`. Note that browser will not send credentials.\n\tStar,\n\t/// Set the `Access-Control-Allow-Origin` header to a single origin.\n\tSingle(String),\n\t/// Copy the `Origin` header into the `Access-Control-Allow-Origin` header.\n\tCopy\n}\n\nimpl Default for Origin {\n\tfn default() -\u003e Self {\n\t\tSelf::None\n\t}\n}\n\nimpl Origin {\n\t/// Get the header value for the `Access-Control-Allow-Origin` header.\n\tfn header_value(\u0026self, state: \u0026State) -\u003e Option\u003cHeaderValue\u003e {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e None,\n\t\t\tSelf::Star =\u003e Some(\"*\".parse().unwrap()),\n\t\t\tSelf::Single(origin) =\u003e Some(origin.parse().unwrap()),\n\t\t\tSelf::Copy =\u003e {\n\t\t\t\tlet headers = HeaderMap::borrow_from(state);\n\t\t\t\theaders.get(ORIGIN).map(Clone::clone)\n\t\t\t}\n\t\t}\n\t}\n\n\t/// Returns true if the `Vary` header has to include `Origin`.\n\tfn varies(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::Copy)\n\t}\n}\n\n/**\nSpecify the allowed headers of the request. It is up to the browser to check that only the allowed\nheaders are sent with the request.\n*/\n#[derive(Clone, Debug)]\npub enum Headers {\n\t/// Do not send any `Access-Control-Allow-Headers` headers.\n\tNone,\n\t/// Set the `Access-Control-Allow-Headers` header to the following header list. If empty, this\n\t/// is treated as if it was [None].\n\tList(Vec\u003cHeaderName\u003e),\n\t/// Copy the `Access-Control-Request-Headers` header into the `Access-Control-Allow-Header`\n\t/// header.\n\tCopy\n}\n\nimpl Default for Headers {\n\tfn default() -\u003e Self {\n\t\tSelf::None\n\t}\n}\n\nimpl Headers {\n\t/// Get the header value for the `Access-Control-Allow-Headers` header.\n\tfn header_value(\u0026self, state: \u0026State) -\u003e Option\u003cHeaderValue\u003e {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e None,\n\t\t\tSelf::List(list) =\u003e Some(list.join(\",\").parse().unwrap()),\n\t\t\tSelf::Copy =\u003e {\n\t\t\t\tlet headers = HeaderMap::borrow_from(state);\n\t\t\t\theaders.get(ACCESS_CONTROL_REQUEST_HEADERS).map(Clone::clone)\n\t\t\t}\n\t\t}\n\t}\n\n\t/// Returns true if the `Vary` header has to include `Origin`.\n\tfn varies(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::Copy)\n\t}\n}\n\n/**\nThis is the configuration that the CORS handler will follow. Its default configuration is basically\nnot to touch any responses, resulting in the browser's default behaviour.\n\nTo change settings, you need to put this type into gotham's [State]:\n\n```rust,no_run\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::{*, cors::Origin};\n# #[cfg_attr(feature = \"cargo-clippy\", allow(clippy::needless_doctest_main))]\nfn main() {\n\tlet cors = CorsConfig {\n\t\torigin: Origin::Star,\n\t\t..Default::default()\n\t};\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(cors).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\t// your routing logic\n\t}));\n}\n```\n\nThis easy approach allows you to have one global cors configuration. If you prefer to have separate\nconfigurations for different scopes, you need to register the middleware inside your routing logic:\n\n```rust,no_run\n# use gotham::{router::builder::*, pipeline::*, pipeline::set::*, state::State};\n# use gotham_restful::{*, cors::Origin};\nlet pipelines = new_pipeline_set();\n\n// The first cors configuration\nlet cors_a = CorsConfig {\n\torigin: Origin::Star,\n\t..Default::default()\n};\nlet (pipelines, chain_a) = pipelines.add(\n\tnew_pipeline().add(cors_a).build()\n);\n\n// The second cors configuration\nlet cors_b = CorsConfig {\n\torigin: Origin::Copy,\n\t..Default::default()\n};\nlet (pipelines, chain_b) = pipelines.add(\n\tnew_pipeline().add(cors_b).build()\n);\n\nlet pipeline_set = finalize_pipeline_set(pipelines);\ngotham::start(\"127.0.0.1:8080\", build_router((), pipeline_set, |route| {\n\t// routing without any cors config\n\troute.with_pipeline_chain((chain_a, ()), |route| {\n\t\t// routing with cors config a\n\t});\n\troute.with_pipeline_chain((chain_b, ()), |route| {\n\t\t// routing with cors config b\n\t});\n}));\n```\n*/\n#[derive(Clone, Debug, Default, NewMiddleware, StateData)]\npub struct CorsConfig {\n\t/// The allowed origins.\n\tpub origin: Origin,\n\t/// The allowed headers.\n\tpub headers: Headers,\n\t/// The amount of seconds that the preflight request can be cached.\n\tpub max_age: u64,\n\t/// Whether or not the request may be made with supplying credentials.\n\tpub credentials: bool\n}\n\nimpl Middleware for CorsConfig {\n\tfn call\u003cChain\u003e(self, mut state: State, chain: Chain) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\twhere\n\t\tChain: FnOnce(State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\t{\n\t\tstate.put(self);\n\t\tchain(state)\n\t}\n}\n\n/**\nHandle CORS for a non-preflight request. This means manipulating the `res` HTTP headers so that\nthe response is aligned with the `state`'s [CorsConfig].\n\nIf you are using the [Resource](crate::Resource) type (which is the recommended way), you'll never\nhave to call this method. However, if you are writing your own handler method, you might want to\ncall this after your request to add the required CORS headers.\n\nFor further information on CORS, read \u003chttps://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\u003e.\n*/\npub fn handle_cors(state: \u0026State, res: \u0026mut Response\u003cBody\u003e) {\n\tlet config = CorsConfig::try_borrow_from(state);\n\tif let Some(cfg) = config {\n\t\tlet headers = res.headers_mut();\n\n\t\t// non-preflight requests require the Access-Control-Allow-Origin header\n\t\tif let Some(header) = cfg.origin.header_value(state) {\n\t\t\theaders.insert(ACCESS_CONTROL_ALLOW_ORIGIN, header);\n\t\t}\n\n\t\t// if the origin is copied over, we should tell the browser by specifying the Vary header\n\t\tif cfg.origin.varies() {\n\t\t\tlet vary = headers.get(VARY).map(|vary| format!(\"{},origin\", vary.to_str().unwrap()));\n\t\t\theaders.insert(VARY, vary.as_deref().unwrap_or(\"origin\").parse().unwrap());\n\t\t}\n\n\t\t// if we allow credentials, tell the browser\n\t\tif cfg.credentials {\n\t\t\theaders.insert(ACCESS_CONTROL_ALLOW_CREDENTIALS, HeaderValue::from_static(\"true\"));\n\t\t}\n\t}\n}\n\n/// Add CORS routing for your path. This is required for handling preflight requests.\n///\n/// Example:\n///\n/// ```rust,no_run\n/// # use gotham::{hyper::{Body, Method, Response}, router::builder::*};\n/// # use gotham_restful::*;\n/// build_simple_router(|router| {\n/// \t// The handler that needs preflight handling\n/// \trouter.post(\"/foo\").to(|state| {\n/// \t\tlet mut res : Response\u003cBody\u003e = unimplemented!();\n/// \t\thandle_cors(\u0026state, \u0026mut res);\n/// \t\t(state, res)\n/// \t});\n/// \t// Add preflight handling\n/// \trouter.cors(\"/foo\", Method::POST);\n/// });\n/// ```\npub trait CorsRoute\u003cC, P\u003e\nwhere\n\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\tP: RefUnwindSafe + Send + Sync + 'static\n{\n\t/// Handle a preflight request on `path` for `method`. To configure the behaviour, use\n\t/// [CorsConfig].\n\tfn cors(\u0026mut self, path: \u0026str, method: Method);\n}\n\npub(crate) fn cors_preflight_handler(state: State) -\u003e (State, Response\u003cBody\u003e) {\n\tlet config = CorsConfig::try_borrow_from(\u0026state);\n\n\t// prepare the response\n\tlet mut res = create_empty_response(\u0026state, StatusCode::NO_CONTENT);\n\tlet headers = res.headers_mut();\n\tlet mut vary: Vec\u003cHeaderName\u003e = Vec::new();\n\n\t// copy the request method over to the response\n\tlet method = HeaderMap::borrow_from(\u0026state)\n\t\t.get(ACCESS_CONTROL_REQUEST_METHOD)\n\t\t.unwrap()\n\t\t.clone();\n\theaders.insert(ACCESS_CONTROL_ALLOW_METHODS, method);\n\tvary.push(ACCESS_CONTROL_REQUEST_METHOD);\n\n\tif let Some(cfg) = config {\n\t\t// if we allow any headers, copy them over\n\t\tif let Some(header) = cfg.headers.header_value(\u0026state) {\n\t\t\theaders.insert(ACCESS_CONTROL_ALLOW_HEADERS, header);\n\t\t}\n\n\t\t// if the headers are copied over, we should tell the browser by specifying the Vary header\n\t\tif cfg.headers.varies() {\n\t\t\tvary.push(ACCESS_CONTROL_REQUEST_HEADERS);\n\t\t}\n\n\t\t// set the max age for the preflight cache\n\t\tif let Some(age) = config.map(|cfg| cfg.max_age) {\n\t\t\theaders.insert(ACCESS_CONTROL_MAX_AGE, age.into());\n\t\t}\n\t}\n\n\t// make sure the browser knows that this request was based on the method\n\theaders.insert(VARY, vary.join(\",\").parse().unwrap());\n\n\thandle_cors(\u0026state, \u0026mut res);\n\t(state, res)\n}\n\nimpl\u003cD, C, P\u003e CorsRoute\u003cC, P\u003e for D\nwhere\n\tD: DrawRoutes\u003cC, P\u003e,\n\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\tP: RefUnwindSafe + Send + Sync + 'static\n{\n\tfn cors(\u0026mut self, path: \u0026str, method: Method) {\n\t\tlet matcher = AccessControlRequestMethodMatcher::new(method);\n\t\tself.options(path).extend_route_matcher(matcher).to(cors_preflight_handler);\n\t}\n}\n","traces":[{"line":40,"address":[1994352],"length":1,"stats":{"Line":2},"fn_name":"default"},{"line":41,"address":[1994355],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[1994368],"length":1,"stats":{"Line":2},"fn_name":"header_value"},{"line":48,"address":[1994551,1994664,1994469,1994480],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[1994476,1994411],"length":1,"stats":{"Line":4},"fn_name":null},{"line":50,"address":[1994485],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[1994561],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[1994445],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[1994666],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[1994752],"length":1,"stats":{"Line":2},"fn_name":"varies"},{"line":61,"address":[1994761],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[1994800],"length":1,"stats":{"Line":2},"fn_name":"default"},{"line":83,"address":[1994803],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[1995216,1994816],"length":1,"stats":{"Line":2},"fn_name":"header_value"},{"line":90,"address":[1994916,1994927],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[1994859,1994923],"length":1,"stats":{"Line":3},"fn_name":null},{"line":92,"address":[1995202,1994937],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[1994892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[1995127],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[1995264],"length":1,"stats":{"Line":2},"fn_name":"varies"},{"line":102,"address":[1995273],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[2925520,2925856,2925788,2926124,2926192,2926460],"length":1,"stats":{"Line":4},"fn_name":"call\u003cclosure-0\u003e"},{"line":183,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":198,"address":[1996116,1995312],"length":1,"stats":{"Line":6},"fn_name":"handle_cors"},{"line":199,"address":[1995345],"length":1,"stats":{"Line":6},"fn_name":null},{"line":200,"address":[1995363],"length":1,"stats":{"Line":6},"fn_name":null},{"line":201,"address":[1995414],"length":1,"stats":{"Line":2},"fn_name":null},{"line":204,"address":[1995443],"length":1,"stats":{"Line":2},"fn_name":null},{"line":205,"address":[1995527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":209,"address":[1996144,1995632,1995693],"length":1,"stats":{"Line":6},"fn_name":null},{"line":210,"address":[1995642,1996294,1995703,1996256],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":211,"address":[1995724],"length":1,"stats":{"Line":1},"fn_name":null},{"line":215,"address":[1995983,1996016,1996092],"length":1,"stats":{"Line":4},"fn_name":null},{"line":216,"address":[1995989,1996018],"length":1,"stats":{"Line":2},"fn_name":null},{"line":249,"address":[1998263,1996496],"length":1,"stats":{"Line":2},"fn_name":"cors_preflight_handler"},{"line":250,"address":[1996538],"length":1,"stats":{"Line":2},"fn_name":null},{"line":253,"address":[1996612],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[1996644],"length":1,"stats":{"Line":2},"fn_name":null},{"line":255,"address":[1996692],"length":1,"stats":{"Line":2},"fn_name":null},{"line":258,"address":[1996707],"length":1,"stats":{"Line":2},"fn_name":null},{"line":262,"address":[1996855],"length":1,"stats":{"Line":2},"fn_name":null},{"line":263,"address":[1997003],"length":1,"stats":{"Line":2},"fn_name":null},{"line":265,"address":[1997071],"length":1,"stats":{"Line":2},"fn_name":null},{"line":267,"address":[1997131],"length":1,"stats":{"Line":2},"fn_name":null},{"line":268,"address":[1997254],"length":1,"stats":{"Line":1},"fn_name":null},{"line":272,"address":[1998291,1997411,1997498],"length":1,"stats":{"Line":5},"fn_name":null},{"line":273,"address":[1997430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":277,"address":[1997715,1997502,1998560,1998569],"length":1,"stats":{"Line":8},"fn_name":"{{closure}}"},{"line":278,"address":[1997591],"length":1,"stats":{"Line":2},"fn_name":null},{"line":283,"address":[1997725,1998234],"length":1,"stats":{"Line":2},"fn_name":null},{"line":285,"address":[1998020],"length":1,"stats":{"Line":2},"fn_name":null},{"line":286,"address":[1998035],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":53,"coverable":58},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","endpoint.rs"],"content":"use crate::{IntoResponse, RequestBody};\nuse futures_util::future::BoxFuture;\nuse gotham::{\n\textractor::{PathExtractor, QueryStringExtractor},\n\thyper::{Body, Method, Response},\n\trouter::response::extender::StaticResponseExtender,\n\tstate::{State, StateData}\n};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\nuse serde::{Deserialize, Deserializer};\nuse std::borrow::Cow;\n\n/// A no-op extractor that can be used as a default type for [Endpoint::Placeholders] and\n/// [Endpoint::Params].\n#[derive(Debug, Clone, Copy)]\npub struct NoopExtractor;\n\nimpl\u003c'de\u003e Deserialize\u003c'de\u003e for NoopExtractor {\n\tfn deserialize\u003cD: Deserializer\u003c'de\u003e\u003e(_: D) -\u003e Result\u003cSelf, D::Error\u003e {\n\t\tOk(Self)\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl OpenapiType for NoopExtractor {\n\tfn schema() -\u003e OpenapiSchema {\n\t\twarn!(\"You're asking for the OpenAPI Schema for gotham_restful::NoopExtractor. This is probably not what you want.\");\n\t\t\u003c() as OpenapiType\u003e::schema()\n\t}\n}\n\nimpl StateData for NoopExtractor {}\n\nimpl StaticResponseExtender for NoopExtractor {\n\ttype ResBody = Body;\n\tfn extend(_: \u0026mut State, _: \u0026mut Response\u003cBody\u003e) {}\n}\n\n// TODO: Specify default types once https://github.com/rust-lang/rust/issues/29661 lands.\n#[_private_openapi_trait(EndpointWithSchema)]\npub trait Endpoint {\n\t/// The HTTP Verb of this endpoint.\n\tfn http_method() -\u003e Method;\n\t/// The URI that this endpoint listens on in gotham's format.\n\tfn uri() -\u003e Cow\u003c'static, str\u003e;\n\n\t/// The verb used for generating an operation id if [Self::operation_id] returns [None].\n\t/// For example `read`, `read_all`, `create`, `update` etc.\n\t#[openapi_only]\n\tfn operation_verb() -\u003e Option\u003c\u0026'static str\u003e;\n\n\t/// The output type that provides the response.\n\t#[openapi_bound(\"Output: crate::ResponseSchema\")]\n\ttype Output: IntoResponse + Send;\n\n\t/// Returns `true` _iff_ the URI contains placeholders. `false` by default.\n\tfn has_placeholders() -\u003e bool {\n\t\tfalse\n\t}\n\t/// The type that parses the URI placeholders. Use [NoopExtractor] if `has_placeholders()`\n\t/// returns `false`.\n\t#[openapi_bound(\"Placeholders: OpenapiType\")]\n\ttype Placeholders: PathExtractor\u003cBody\u003e + Clone + Sync;\n\n\t/// Returns `true` _iff_ the request parameters should be parsed. `false` by default.\n\tfn needs_params() -\u003e bool {\n\t\tfalse\n\t}\n\t/// The type that parses the request parameters. Use [NoopExtractor] if `needs_params()`\n\t/// returns `false`.\n\t#[openapi_bound(\"Params: OpenapiType\")]\n\ttype Params: QueryStringExtractor\u003cBody\u003e + Clone + Sync;\n\n\t/// Returns `true` _iff_ the request body should be parsed. `false` by default.\n\tfn needs_body() -\u003e bool {\n\t\tfalse\n\t}\n\t/// The type to parse the body into. Use `()` if `needs_body()` returns `false`.\n\ttype Body: RequestBody + Send;\n\n\t/// Returns `true` if the request wants to know the auth status of the client. `false` by default.\n\tfn wants_auth() -\u003e bool {\n\t\tfalse\n\t}\n\n\t/// Replace the automatically generated operation id with a custom one. Only relevant for the\n\t/// OpenAPI Specification.\n\t#[openapi_only]\n\tfn operation_id() -\u003e Option\u003cString\u003e {\n\t\tNone\n\t}\n\n\t/// Add a description to the openapi specification. Usually taken from the rustdoc comment\n\t/// when using the proc macro.\n\t#[openapi_only]\n\tfn description() -\u003e Option\u003cString\u003e {\n\t\tNone\n\t}\n\n\t/// The handler for this endpoint.\n\tfn handle(\n\t\tstate: \u0026mut State,\n\t\tplaceholders: Self::Placeholders,\n\t\tparams: Self::Params,\n\t\tbody: Option\u003cSelf::Body\u003e\n\t) -\u003e BoxFuture\u003c'_, Self::Output\u003e;\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cE: EndpointWithSchema\u003e Endpoint for E {\n\tfn http_method() -\u003e Method {\n\t\tE::http_method()\n\t}\n\tfn uri() -\u003e Cow\u003c'static, str\u003e {\n\t\tE::uri()\n\t}\n\n\ttype Output = E::Output;\n\n\tfn has_placeholders() -\u003e bool {\n\t\tE::has_placeholders()\n\t}\n\ttype Placeholders = E::Placeholders;\n\n\tfn needs_params() -\u003e bool {\n\t\tE::needs_params()\n\t}\n\ttype Params = E::Params;\n\n\tfn needs_body() -\u003e bool {\n\t\tE::needs_body()\n\t}\n\ttype Body = E::Body;\n\n\tfn wants_auth() -\u003e bool {\n\t\tE::wants_auth()\n\t}\n\n\tfn handle\u003c'a\u003e(\n\t\tstate: \u0026'a mut State,\n\t\tplaceholders: Self::Placeholders,\n\t\tparams: Self::Params,\n\t\tbody: Option\u003cSelf::Body\u003e\n\t) -\u003e BoxFuture\u003c'a, Self::Output\u003e {\n\t\tE::handle(state, placeholders, params, body)\n\t}\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":21,"address":[3687528,3687497],"length":1,"stats":{"Line":10},"fn_name":null},{"line":27,"address":[4664400],"length":1,"stats":{"Line":0},"fn_name":"schema"},{"line":28,"address":[4664485,4664414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[4664610],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[4664658,4664653,4664640],"length":1,"stats":{"Line":0},"fn_name":"extend"},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":98,"address":[3323763,3323795,3323875,3323779,3323811,3323747,3323827,3323859,3323843],"length":1,"stats":{"Line":6},"fn_name":null},{"line":112,"address":[3365824,3366016,3365856,3366080,3365984,3365888,3365952,3366048,3365920],"length":1,"stats":{"Line":29},"fn_name":"http_method\u003casync_methods::state_test___gotham_restful_endpoint\u003e"},{"line":113,"address":[3365832,3366088,3366056,3365896,3366024,3365928,3365960,3365992,3365864],"length":1,"stats":{"Line":29},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":29},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":29},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":21},"fn_name":null}],"covered":14,"coverable":32},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","lib.rs"],"content":"#![warn(missing_debug_implementations, rust_2018_idioms, unreachable_pub)]\n#![forbid(unsafe_code)]\n// deny warnings in CI\n#![cfg_attr(gotham_restful_deny_warnings, allow(renamed_and_removed_lints))]\n#![cfg_attr(gotham_restful_deny_warnings, deny(warnings))]\n// clippy doesn't like our code style\n#![cfg_attr(feature = \"cargo-clippy\", allow(clippy::tabs_in_doc_comments))]\n// intra-doc links only fully work when OpenAPI is enabled\n#![cfg_attr(feature = \"openapi\", deny(broken_intra_doc_links))]\n#![cfg_attr(not(feature = \"openapi\"), allow(broken_intra_doc_links))]\n\n/*!\nThis crate is an extension to the popular [gotham web framework][gotham] for Rust. It allows you to\ncreate resources with assigned endpoints that aim to be a more convenient way of creating handlers\nfor requests.\n\n# Features\n\n - Automatically parse **JSON** request and produce response bodies\n - Allow using **raw** request and response bodies\n - Convenient **macros** to create responses that can be registered with gotham's router\n - Auto-Generate an **OpenAPI** specification for your API\n - Manage **CORS** headers so you don't have to\n - Manage **Authentication** with JWT\n - Integrate diesel connection pools for easy **database** integration\n\n# Safety\n\nThis crate is just as safe as you'd expect from anything written in safe Rust - and\n`#![forbid(unsafe_code)]` ensures that no unsafe was used.\n\n# Endpoints\n\nThere are a set of pre-defined endpoints that should cover the majority of REST APIs. However,\nit is also possible to define your own endpoints.\n\n## Pre-defined Endpoints\n\nAssuming you assign `/foobar` to your resource, the following pre-defined endpoints exist:\n\n| Endpoint Name | Required Arguments | HTTP Verb | HTTP Path      |\n| ------------- | ------------------ | --------- | -------------- |\n| read_all      |                    | GET       | /foobar        |\n| read          | id                 | GET       | /foobar/:id    |\n| search        | query              | GET       | /foobar/search |\n| create        | body               | POST      | /foobar        |\n| update_all    | body               | PUT       | /foobar        |\n| update        | id, body           | PUT       | /foobar/:id    |\n| delete_all    |                    | DELETE    | /foobar        |\n| delete        | id                 | DELETE    | /foobar/:id    |\n\nEach of those endpoints has a macro that creates the neccessary boilerplate for the Resource. A\nsimple example looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n/// Our RESTful resource.\n#[derive(Resource)]\n#[resource(read)]\nstruct FooResource;\n\n/// The return type of the foo read endpoint.\n#[derive(Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Foo {\n\tid: u64\n}\n\n/// The foo read endpoint.\n#[read]\nfn read(id: u64) -\u003e Success\u003cFoo\u003e {\n\tFoo { id }.into()\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cFooResource\u003e(\"foo\");\n# \t}));\n# }\n```\n\n## Custom Endpoints\n\nDefining custom endpoints is done with the `#[endpoint]` macro. The syntax is similar to that\nof the pre-defined endpoints, but you need to give it more context:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_derive;\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(custom_endpoint)]\nstruct CustomResource;\n\n/// This type is used to parse path parameters.\n#[derive(Clone, Deserialize, StateData, StaticResponseExtender)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct CustomPath {\n\tname: String\n}\n\n#[endpoint(uri = \"custom/:name/read\", method = \"Method::GET\", params = false, body = false)]\nfn custom_endpoint(path: CustomPath) -\u003e Success\u003cString\u003e {\n\tpath.name.into()\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cCustomResource\u003e(\"custom\");\n# \t}));\n# }\n```\n\n# Arguments\n\nSome endpoints require arguments. Those should be\n * **id** Should be a deserializable json-primitive like [`i64`] or [`String`].\n * **body** Should be any deserializable object, or any type implementing [`RequestBody`].\n * **query** Should be any deserializable object whose variables are json-primitives. It will\n   however not be parsed from json, but from HTTP GET parameters like in `search?id=1`. The\n   type needs to implement [`QueryStringExtractor`](gotham::extractor::QueryStringExtractor).\n\nAdditionally, all handlers may take a reference to gotham's [`State`]. Please note that for async\nhandlers, it needs to be a mutable reference until rustc's lifetime checks across await bounds\nimprove.\n\n# Uploads and Downloads\n\nBy default, every request body is parsed from json, and every respone is converted to json using\n[serde_json]. However, you may also use raw bodies. This is an example where the request body\nis simply returned as the response again, no json parsing involved:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(create)]\nstruct ImageResource;\n\n#[derive(FromBody, RequestBody)]\n#[supported_types(mime::IMAGE_GIF, mime::IMAGE_JPEG, mime::IMAGE_PNG)]\nstruct RawImage {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n\n#[create]\nfn create(body : RawImage) -\u003e Raw\u003cVec\u003cu8\u003e\u003e {\n\tRaw::new(body.content, body.content_type)\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cImageResource\u003e(\"image\");\n# \t}));\n# }\n```\n\n# Custom HTTP Headers\n\nYou can read request headers from the state as you would in any other gotham handler, and specify\ncustom response headers using [Response::header].\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::hyper::header::{ACCEPT, HeaderMap, VARY};\n# use gotham::{router::builder::*, state::State};\n# use gotham_restful::*;\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nasync fn read_all(state: \u0026mut State) -\u003e NoContent {\n\tlet headers: \u0026HeaderMap = state.borrow();\n\tlet accept = \u0026headers[ACCEPT];\n# drop(accept);\n\n\tlet mut res = NoContent::default();\n\tres.header(VARY, \"accept\".parse().unwrap());\n\tres\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cFooResource\u003e(\"foo\");\n# \t}));\n# }\n```\n\n# Features\n\nTo make life easier for common use-cases, this create offers a few features that might be helpful\nwhen you implement your web server.  The complete feature list is\n - [`auth`](#authentication-feature) Advanced JWT middleware\n - `chrono` openapi support for chrono types\n - `full` enables all features except `without-openapi`\n - [`cors`](#cors-feature) CORS handling for all endpoint handlers\n - [`database`](#database-feature) diesel middleware support\n - `errorlog` log errors returned from endpoint handlers\n - [`openapi`](#openapi-feature) router additions to generate an openapi spec\n - `uuid` openapi support for uuid\n - `without-openapi` (**default**) disables `openapi` support.\n\n## Authentication Feature\n\nIn order to enable authentication support, enable the `auth` feature gate. This allows you to\nregister a middleware that can automatically check for the existence of an JWT authentication\ntoken. Besides being supported by the endpoint macros, it supports to lookup the required JWT secret\nwith the JWT data, hence you can use several JWT secrets and decide on the fly which secret to use.\nNone of this is currently supported by gotham's own JWT middleware.\n\nA simple example that uses only a single secret looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"auth\")]\n# mod auth_feature_enabled {\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(read)]\nstruct SecretResource;\n\n#[derive(Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Secret {\n\tid: u64,\n\tintended_for: String\n}\n\n#[derive(Deserialize, Clone)]\nstruct AuthData {\n\tsub: String,\n\texp: u64\n}\n\n#[read]\nfn read(auth: AuthStatus\u003cAuthData\u003e, id: u64) -\u003e AuthSuccess\u003cSecret\u003e {\n\tlet intended_for = auth.ok()?.sub;\n\tOk(Secret { id, intended_for })\n}\n\nfn main() {\n\tlet auth: AuthMiddleware\u003cAuthData, _\u003e = AuthMiddleware::new(\n\t\tAuthSource::AuthorizationHeader,\n\t\tAuthValidation::default(),\n\t\tStaticAuthHandler::from_array(b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\")\n\t);\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(auth).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cSecretResource\u003e(\"secret\");\n\t}));\n}\n# }\n```\n\n## CORS Feature\n\nThe cors feature allows an easy usage of this web server from other origins. By default, only\nthe `Access-Control-Allow-Methods` header is touched. To change the behaviour, add your desired\nconfiguration as a middleware.\n\nA simple example that allows authentication from every origin (note that `*` always disallows\nauthentication), and every content type, looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"cors\")]\n# mod cors_feature_enabled {\n# use gotham::{hyper::header::*, router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::{*, cors::*};\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() {\n\t// your handler\n}\n\nfn main() {\n\tlet cors = CorsConfig {\n\t\torigin: Origin::Copy,\n\t\theaders: Headers::List(vec![CONTENT_TYPE]),\n\t\tmax_age: 0,\n\t\tcredentials: true\n\t};\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(cors).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cFooResource\u003e(\"foo\");\n\t}));\n}\n# }\n```\n\nThe cors feature can also be used for non-resource handlers. Take a look at [`CorsRoute`]\nfor an example.\n\n## Database Feature\n\nThe database feature allows an easy integration of [diesel] into your handler functions. Please\nnote however that due to the way gotham's diesel middleware implementation, it is not possible\nto run async code while holding a database connection. If you need to combine async and database,\nyou'll need to borrow the connection from the [`State`] yourself and return a boxed future.\n\nA simple non-async example looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate diesel;\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"database\")]\n# mod database_feature_enabled {\n# use diesel::{table, PgConnection, QueryResult, RunQueryDsl};\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_middleware_diesel::DieselMiddleware;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n# use std::env;\n# table! {\n#   foo (id) {\n#     id -\u003e Int8,\n#     value -\u003e Text,\n#   }\n# }\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[derive(Queryable, Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Foo {\n\tid: i64,\n\tvalue: String\n}\n\n#[read_all]\nfn read_all(conn: \u0026PgConnection) -\u003e QueryResult\u003cVec\u003cFoo\u003e\u003e {\n\tfoo::table.load(conn)\n}\n\ntype Repo = gotham_middleware_diesel::Repo\u003cPgConnection\u003e;\n\nfn main() {\n\tlet repo = Repo::new(\u0026env::var(\"DATABASE_URL\").unwrap());\n\tlet diesel = DieselMiddleware::new(repo);\n\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(diesel).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cFooResource\u003e(\"foo\");\n\t}));\n}\n# }\n```\n\n## OpenAPI Feature\n\nThe OpenAPI feature is probably the most powerful one of this crate. Definitely read this section\ncarefully both as a binary as well as a library author to avoid unwanted suprises.\n\nIn order to automatically create an openapi specification, gotham-restful needs knowledge over\nall routes and the types returned. `serde` does a great job at serialization but doesn't give\nenough type information, so all types used in the router need to implement\n[`OpenapiType`](openapi_type::OpenapiType). This can be derived for almoust any type and there\nshould be no need to implement it manually. A simple example looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"openapi\")]\n# mod openapi_feature_enabled {\n# use gotham::{router::builder::*, state::State};\n# use gotham_restful::*;\n# use openapi_type::OpenapiType;\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[derive(OpenapiType, Serialize)]\nstruct Foo {\n\tbar: String\n}\n\n#[read_all]\nfn read_all() -\u003e Success\u003cFoo\u003e {\n\tFoo { bar: \"Hello World\".to_owned() }.into()\n}\n\nfn main() {\n\tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n\t\tlet info = OpenapiInfo {\n\t\t\ttitle: \"My Foo API\".to_owned(),\n\t\t\tversion: \"0.1.0\".to_owned(),\n\t\t\turls: vec![\"https://example.org/foo/api/v1\".to_owned()]\n\t\t};\n\t\troute.with_openapi(info, |mut route| {\n\t\t\troute.resource::\u003cFooResource\u003e(\"foo\");\n\t\t\troute.openapi_spec(\"openapi\");\n\t\t\troute.openapi_doc(\"/\");\n\t\t});\n\t}));\n}\n# }\n```\n\nAbove example adds the resource as before, but adds two other endpoints as well: `/openapi` and `/`.\nThe first one will return the generated openapi specification in JSON format, allowing you to easily\ngenerate clients in different languages without worying to exactly replicate your api in each of those\nlanguages. The second one will return documentation in HTML format, so you can easily view your\napi and share it with other people.\n\nHowever, please note that by default, the `without-openapi` feature of this crate is enabled.\nDisabling it in favour of the `openapi` feature will add additional type bounds and method requirements\nto some of the traits and types in this crate, for example instead of [`Endpoint`] you now have to\nimplement [`EndpointWithSchema`]. This means that some code might only compile on either feature, but not\non both. If you are writing a library that uses gotham-restful, it is strongly recommended to pass both\nfeatures through and conditionally enable the openapi code, like this:\n\n```rust\n# #[macro_use] extern crate gotham_restful;\n# use serde::{Deserialize, Serialize};\n#[derive(Deserialize, Serialize)]\n#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Foo;\n```\n\n [diesel]: https://diesel.rs/\n [`State`]: gotham::state::State\n*/\n\n#[cfg(all(feature = \"openapi\", feature = \"without-openapi\"))]\ncompile_error!(\"The 'openapi' and 'without-openapi' features cannot be combined\");\n\n#[cfg(all(not(feature = \"openapi\"), not(feature = \"without-openapi\")))]\ncompile_error!(\"Either the 'openapi' or 'without-openapi' feature needs to be enabled\");\n\n// weird proc macro issue\nextern crate self as gotham_restful;\n\n#[macro_use]\nextern crate gotham_derive;\n#[macro_use]\nextern crate gotham_restful_derive;\n#[macro_use]\nextern crate log;\n#[macro_use]\nextern crate serde;\n\n#[cfg(test)]\n#[macro_use]\nextern crate pretty_assertions;\n\n#[doc(no_inline)]\npub use gotham;\n#[doc(no_inline)]\npub use mime::Mime;\n\npub use gotham_restful_derive::*;\n\n/// Not public API\n#[doc(hidden)]\npub mod private {\n\tpub use crate::routing::PathExtractor as IdPlaceholder;\n\n\tpub use futures_util::future::{BoxFuture, FutureExt};\n\n\tpub use serde_json;\n\n\t#[cfg(feature = \"database\")]\n\tpub use gotham_middleware_diesel::Repo;\n\t#[cfg(feature = \"openapi\")]\n\tpub use openapi_type::{indexmap::IndexMap, openapi, OpenapiSchema, OpenapiType};\n}\n\n#[cfg(feature = \"auth\")]\nmod auth;\n#[cfg(feature = \"auth\")]\npub use auth::{AuthHandler, AuthMiddleware, AuthSource, AuthStatus, AuthValidation, StaticAuthHandler};\n\n#[cfg(feature = \"cors\")]\npub mod cors;\n#[cfg(feature = \"cors\")]\npub use cors::{handle_cors, CorsConfig, CorsRoute};\n\n#[cfg(feature = \"openapi\")]\nmod openapi;\n#[cfg(feature = \"openapi\")]\npub use openapi::{builder::OpenapiInfo, router::GetOpenapi};\n\nmod endpoint;\n#[cfg(feature = \"openapi\")]\npub use endpoint::EndpointWithSchema;\npub use endpoint::{Endpoint, NoopExtractor};\n\nmod response;\npub use response::{\n\tAuthError, AuthError::Forbidden, AuthErrorOrOther, AuthResult, AuthSuccess, IntoResponse, IntoResponseError, NoContent,\n\tRaw, Redirect, Response, Success\n};\n#[cfg(feature = \"openapi\")]\npub use response::{IntoResponseWithSchema, ResponseSchema};\n\nmod routing;\npub use routing::{DrawResourceRoutes, DrawResources};\n#[cfg(feature = \"openapi\")]\npub use routing::{DrawResourceRoutesWithSchema, DrawResourcesWithSchema, WithOpenapi};\n\nmod types;\npub use types::{FromBody, RequestBody, ResponseBody};\n\n/// This trait must be implemented for every resource. It allows you to register the different\n/// endpoints that can be handled by this resource to be registered with the underlying router.\n///\n/// It is not recommended to implement this yourself, just use `#[derive(Resource)]`.\n#[_private_openapi_trait(ResourceWithSchema)]\npub trait Resource {\n\t/// Register all methods handled by this resource with the underlying router.\n\t#[openapi_bound(\"D: crate::DrawResourceRoutesWithSchema\")]\n\t#[non_openapi_bound(\"D: crate::DrawResourceRoutes\")]\n\tfn setup\u003cD\u003e(route: D);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","builder.rs"],"content":"use openapi_type::{\n\tindexmap::IndexMap,\n\topenapi::{\n\t\tself, Components, OpenAPI, PathItem, ReferenceOr,\n\t\tReferenceOr::{Item, Reference},\n\t\tSchema, Server\n\t},\n\tOpenapiSchema\n};\nuse parking_lot::RwLock;\nuse std::sync::Arc;\n\n#[derive(Clone, Debug)]\npub struct OpenapiInfo {\n\tpub title: String,\n\tpub version: String,\n\tpub urls: Vec\u003cString\u003e\n}\n\n#[derive(Clone, Debug)]\npub(crate) struct OpenapiBuilder {\n\tpub(crate) openapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e\n}\n\nimpl OpenapiBuilder {\n\tpub(crate) fn new(info: OpenapiInfo) -\u003e Self {\n\t\tSelf {\n\t\t\topenapi: Arc::new(RwLock::new(OpenAPI {\n\t\t\t\topenapi: \"3.0.2\".to_string(),\n\t\t\t\tinfo: openapi::Info {\n\t\t\t\t\ttitle: info.title,\n\t\t\t\t\tversion: info.version,\n\t\t\t\t\t..Default::default()\n\t\t\t\t},\n\t\t\t\tservers: info\n\t\t\t\t\t.urls\n\t\t\t\t\t.into_iter()\n\t\t\t\t\t.map(|url| Server {\n\t\t\t\t\t\turl,\n\t\t\t\t\t\t..Default::default()\n\t\t\t\t\t})\n\t\t\t\t\t.collect(),\n\t\t\t\t..Default::default()\n\t\t\t}))\n\t\t}\n\t}\n\n\t/// Remove path from the OpenAPI spec, or return an empty one if not included. This is handy if you need to\n\t/// modify the path and add it back after the modification\n\tpub(crate) fn remove_path(\u0026mut self, path: \u0026str) -\u003e PathItem {\n\t\tlet mut openapi = self.openapi.write();\n\t\tmatch openapi.paths.swap_remove(path) {\n\t\t\tSome(Item(item)) =\u003e item,\n\t\t\t_ =\u003e PathItem::default()\n\t\t}\n\t}\n\n\tpub(crate) fn add_path\u003cPath: ToString\u003e(\u0026mut self, path: Path, item: PathItem) {\n\t\tlet mut openapi = self.openapi.write();\n\t\topenapi.paths.insert(path.to_string(), Item(item));\n\t}\n\n\tfn add_schema_impl(\u0026mut self, name: String, mut schema: OpenapiSchema) {\n\t\tself.add_schema_dependencies(\u0026mut schema.dependencies);\n\n\t\tlet mut openapi = self.openapi.write();\n\t\tmatch \u0026mut openapi.components {\n\t\t\tSome(comp) =\u003e {\n\t\t\t\tcomp.schemas.insert(name, Item(schema.into_schema()));\n\t\t\t},\n\t\t\tNone =\u003e {\n\t\t\t\tlet mut comp = Components::default();\n\t\t\t\tcomp.schemas.insert(name, Item(schema.into_schema()));\n\t\t\t\topenapi.components = Some(comp);\n\t\t\t}\n\t\t};\n\t}\n\n\tfn add_schema_dependencies(\u0026mut self, dependencies: \u0026mut IndexMap\u003cString, OpenapiSchema\u003e) {\n\t\tlet keys: Vec\u003cString\u003e = dependencies.keys().map(|k| k.to_string()).collect();\n\t\tfor dep in keys {\n\t\t\tlet dep_schema = dependencies.swap_remove(\u0026dep);\n\t\t\tif let Some(dep_schema) = dep_schema {\n\t\t\t\tself.add_schema_impl(dep, dep_schema);\n\t\t\t}\n\t\t}\n\t}\n\n\tpub(crate) fn add_schema(\u0026mut self, mut schema: OpenapiSchema) -\u003e ReferenceOr\u003cSchema\u003e {\n\t\tmatch schema.name.clone() {\n\t\t\tSome(name) =\u003e {\n\t\t\t\tlet reference = Reference {\n\t\t\t\t\treference: format!(\"#/components/schemas/{}\", name)\n\t\t\t\t};\n\t\t\t\tself.add_schema_impl(name, schema);\n\t\t\t\treference\n\t\t\t},\n\t\t\tNone =\u003e {\n\t\t\t\tself.add_schema_dependencies(\u0026mut schema.dependencies);\n\t\t\t\tItem(schema.into_schema())\n\t\t\t}\n\t\t}\n\t}\n}\n\n#[cfg(test)]\n#[allow(dead_code)]\nmod test {\n\tuse super::*;\n\tuse openapi_type::OpenapiType;\n\n\t#[derive(OpenapiType)]\n\tstruct Message {\n\t\tmsg: String\n\t}\n\n\t#[derive(OpenapiType)]\n\tstruct Messages {\n\t\tmsgs: Vec\u003cMessage\u003e\n\t}\n\n\tfn info() -\u003e OpenapiInfo {\n\t\tOpenapiInfo {\n\t\t\ttitle: \"TEST CASE\".to_owned(),\n\t\t\tversion: \"1.2.3\".to_owned(),\n\t\t\turls: vec![\"http://localhost:1234\".to_owned(), \"https://example.org\".to_owned()]\n\t\t}\n\t}\n\n\tfn openapi(builder: OpenapiBuilder) -\u003e OpenAPI {\n\t\tArc::try_unwrap(builder.openapi).unwrap().into_inner()\n\t}\n\n\t#[test]\n\tfn new_builder() {\n\t\tlet info = info();\n\t\tlet builder = OpenapiBuilder::new(info.clone());\n\t\tlet openapi = openapi(builder);\n\n\t\tassert_eq!(info.title, openapi.info.title);\n\t\tassert_eq!(info.version, openapi.info.version);\n\t\tassert_eq!(info.urls.len(), openapi.servers.len());\n\t}\n\n\t#[test]\n\tfn add_schema() {\n\t\tlet mut builder = OpenapiBuilder::new(info());\n\t\tbuilder.add_schema(\u003cOption\u003cMessages\u003e\u003e::schema());\n\t\tlet openapi = openapi(builder);\n\n\t\tassert_eq!(\n\t\t\topenapi.components.clone().unwrap_or_default().schemas[\"Message\"],\n\t\t\tReferenceOr::Item(Message::schema().into_schema())\n\t\t);\n\t\tassert_eq!(\n\t\t\topenapi.components.clone().unwrap_or_default().schemas[\"Messages\"],\n\t\t\tReferenceOr::Item(Messages::schema().into_schema())\n\t\t);\n\t}\n}\n","traces":[{"line":26,"address":[2205632,2206938],"length":1,"stats":{"Line":3},"fn_name":"new"},{"line":28,"address":[4695538,4696195],"length":1,"stats":{"Line":6},"fn_name":null},{"line":50,"address":[4697792,4698152],"length":1,"stats":{"Line":2},"fn_name":"remove_path"},{"line":51,"address":[4697862],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[2207980],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[2208035,2208080],"length":1,"stats":{"Line":3},"fn_name":null},{"line":54,"address":[2208385,2208070],"length":1,"stats":{"Line":4},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[2208464,2209448],"length":1,"stats":{"Line":2},"fn_name":"add_schema_impl"},{"line":64,"address":[2208519],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[2208602],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[4698937,4699508,4698681,4698594],"length":1,"stats":{"Line":6},"fn_name":null},{"line":68,"address":[4698701,4698641],"length":1,"stats":{"Line":4},"fn_name":null},{"line":69,"address":[4699591,4698709],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[4698671],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[2209562,2209002],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[2209468,2209546,2209234,2209397],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[2210628,2209888],"length":1,"stats":{"Line":3},"fn_name":"add_schema_dependencies"},{"line":80,"address":[2210896,2210931,2209934],"length":1,"stats":{"Line":7},"fn_name":"{{closure}}"},{"line":81,"address":[2210208,2210018,2210602],"length":1,"stats":{"Line":5},"fn_name":null},{"line":82,"address":[2210383],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[2210398],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[2210504],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[2211618,2210960],"length":1,"stats":{"Line":3},"fn_name":"add_schema"},{"line":90,"address":[2211006,2211093,2211484],"length":1,"stats":{"Line":4},"fn_name":null},{"line":91,"address":[2211046,2211095],"length":1,"stats":{"Line":4},"fn_name":null},{"line":93,"address":[2211128],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[2211359],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[2211458],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[2211076],"length":1,"stats":{"Line":3},"fn_name":null},{"line":100,"address":[2211491],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":33,"coverable":35},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","handler","mod.rs"],"content":"#![cfg_attr(not(feature = \"auth\"), allow(unused_imports))]\nuse super::SECURITY_NAME;\nuse either::Either;\nuse futures_util::{future, future::FutureExt};\nuse gotham::{\n\tanyhow,\n\thandler::{Handler, HandlerError, HandlerFuture, NewHandler},\n\thelpers::http::response::{create_empty_response, create_response},\n\thyper::{\n\t\theader::{\n\t\t\tHeaderMap, HeaderValue, CACHE_CONTROL, CONTENT_SECURITY_POLICY, ETAG, IF_NONE_MATCH, REFERRER_POLICY,\n\t\t\tX_CONTENT_TYPE_OPTIONS\n\t\t},\n\t\tBody, Response, StatusCode\n\t},\n\tstate::State\n};\nuse mime::{APPLICATION_JSON, TEXT_HTML_UTF_8, TEXT_PLAIN_UTF_8};\nuse openapi_type::{\n\tindexmap::IndexMap,\n\topenapi::{APIKeyLocation, OpenAPI, ReferenceOr, SecurityScheme}\n};\nuse parking_lot::RwLock;\nuse sha2::{Digest, Sha256};\nuse std::{io::Write, iter, panic::RefUnwindSafe, pin::Pin, sync::Arc};\n\n#[cfg(feature = \"auth\")]\nfn get_security(state: \u0026State) -\u003e IndexMap\u003cString, ReferenceOr\u003cSecurityScheme\u003e\u003e {\n\tuse crate::AuthSource;\n\tuse gotham::state::FromState;\n\n\tlet source = match AuthSource::try_borrow_from(state) {\n\t\tSome(source) =\u003e source,\n\t\tNone =\u003e return Default::default()\n\t};\n\n\tlet security_scheme = match source {\n\t\tAuthSource::Cookie(name) =\u003e SecurityScheme::APIKey {\n\t\t\tlocation: APIKeyLocation::Cookie,\n\t\t\tname: name.to_string()\n\t\t},\n\t\tAuthSource::Header(name) =\u003e SecurityScheme::APIKey {\n\t\t\tlocation: APIKeyLocation::Header,\n\t\t\tname: name.to_string()\n\t\t},\n\t\tAuthSource::AuthorizationHeader =\u003e SecurityScheme::HTTP {\n\t\t\tscheme: \"bearer\".to_owned(),\n\t\t\tbearer_format: Some(\"JWT\".to_owned())\n\t\t}\n\t};\n\n\tlet mut security_schemes: IndexMap\u003cString, ReferenceOr\u003cSecurityScheme\u003e\u003e = Default::default();\n\tsecurity_schemes.insert(SECURITY_NAME.to_owned(), ReferenceOr::Item(security_scheme));\n\n\tsecurity_schemes\n}\n\n#[cfg(not(feature = \"auth\"))]\nfn get_security(_state: \u0026State) -\u003e IndexMap\u003cString, ReferenceOr\u003cSecurityScheme\u003e\u003e {\n\tDefault::default()\n}\n\nfn openapi_string(state: \u0026State, openapi: \u0026Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Result\u003cString, serde_json::Error\u003e {\n\tlet openapi = openapi.read();\n\n\tlet mut openapi = openapi.clone();\n\tlet security_schemes = get_security(state);\n\tlet mut components = openapi.components.unwrap_or_default();\n\tcomponents.security_schemes = security_schemes;\n\topenapi.components = Some(components);\n\n\tserde_json::to_string(\u0026openapi)\n}\n\nfn create_openapi_response(state: \u0026State, openapi: \u0026Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Response\u003cBody\u003e {\n\tmatch openapi_string(state, openapi) {\n\t\tOk(body) =\u003e {\n\t\t\tlet mut res = create_response(state, StatusCode::OK, APPLICATION_JSON, body);\n\t\t\tlet headers = res.headers_mut();\n\t\t\theaders.insert(X_CONTENT_TYPE_OPTIONS, HeaderValue::from_static(\"nosniff\"));\n\t\t\tres\n\t\t},\n\t\tErr(e) =\u003e {\n\t\t\terror!(\"Unable to handle OpenAPI request due to error: {}\", e);\n\t\t\tcreate_response(state, StatusCode::INTERNAL_SERVER_ERROR, TEXT_PLAIN_UTF_8, \"\")\n\t\t}\n\t}\n}\n\n#[derive(Clone)]\npub(crate) struct OpenapiSpecHandler {\n\topenapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e\n}\n\n// safety: the handler only ever aquires a read lock, so this usage of\n// RwLock is, in fact, unwind safe\nimpl RefUnwindSafe for OpenapiSpecHandler {}\n\nimpl OpenapiSpecHandler {\n\tpub(crate) fn new(openapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Self {\n\t\tSelf { openapi }\n\t}\n}\n\nimpl NewHandler for OpenapiSpecHandler {\n\ttype Instance = Self;\n\n\tfn new_handler(\u0026self) -\u003e anyhow::Result\u003cSelf\u003e {\n\t\tOk(self.clone())\n\t}\n}\n\nimpl Handler for OpenapiSpecHandler {\n\tfn handle(self, mut state: State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e {\n\t\tlet res = create_openapi_response(\u0026mut state, \u0026self.openapi);\n\t\tfuture::ok((state, res)).boxed()\n\t}\n}\n\n#[derive(Clone)]\npub(crate) struct OpenapiDocHandler {\n\topenapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e\n}\n\n// safety: the handler only ever aquires a read lock, so this usage of\n// RwLock is, in fact, unwind safe\nimpl RefUnwindSafe for OpenapiDocHandler {}\n\nimpl OpenapiDocHandler {\n\tpub(crate) fn new(openapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Self {\n\t\tSelf { openapi }\n\t}\n}\n\nimpl NewHandler for OpenapiDocHandler {\n\ttype Instance = Self;\n\n\tfn new_handler(\u0026self) -\u003e anyhow::Result\u003cSelf\u003e {\n\t\tOk(self.clone())\n\t}\n}\n\nfn redoc_handler(state: \u0026State, openapi: \u0026Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Result\u003cResponse\u003cBody\u003e, HandlerError\u003e {\n\tlet spec = openapi_string(state, openapi)?;\n\tlet encoded_spec = spec\n\t\t.chars()\n\t\t.flat_map(|c| match c {\n\t\t\t'\u0026' =\u003e Either::Left(\"\u0026amp;\".chars()),\n\t\t\t'\u003c' =\u003e Either::Left(\"\u0026lt;\".chars()),\n\t\t\t'\u003e' =\u003e Either::Left(\"\u0026gt;\".chars()),\n\t\t\tc =\u003e Either::Right(iter::once(c))\n\t\t})\n\t\t.collect::\u003cString\u003e();\n\n\tlet script = include_str!(\"script.min.js\");\n\tlet mut script_hash = Sha256::new();\n\tscript_hash.update(\u0026script);\n\tlet script_hash = base64::encode(script_hash.finalize());\n\n\tlet mut buf = Vec::\u003cu8\u003e::new();\n\twrite!(\n\t\tbuf,\n\t\tr#\"\u003c!DOCTYPE HTML\u003e\u003chtml\u003e\u003chead\u003e\u003cmeta charset=\"utf-8\"/\u003e\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/\u003e\u003c/head\u003e\"#\n\t)?;\n\twrite!(\n\t\tbuf,\n\t\tr#\"\u003cbody style=\"margin:0\"\u003e\u003cdiv id=\"spec\" style=\"display:none\"\u003e{}\u003c/div\u003e\u003cdiv id=\"redoc\"\u003e\u003c/div\u003e\u003cscript\u003e{}\u003c/script\u003e\u003c/body\u003e\u003c/html\u003e\"#,\n\t\tencoded_spec, script\n\t)?;\n\n\tlet mut etag = Sha256::new();\n\tetag.update(\u0026buf);\n\tlet etag = format!(\"\\\"{}\\\"\", base64::encode(etag.finalize()));\n\n\tif state\n\t\t.borrow::\u003cHeaderMap\u003e()\n\t\t.get(IF_NONE_MATCH)\n\t\t.map_or(false, |header| header.as_bytes() == etag.as_bytes())\n\t{\n\t\tlet res = create_empty_response(\u0026state, StatusCode::NOT_MODIFIED);\n\t\treturn Ok(res);\n\t}\n\n\tlet mut res = create_response(state, StatusCode::OK, TEXT_HTML_UTF_8, buf);\n\tlet headers = res.headers_mut();\n\theaders.insert(CACHE_CONTROL, HeaderValue::from_static(\"public,max-age=2592000\"));\n\theaders.insert(\n\t\tCONTENT_SECURITY_POLICY,\n\t\tformat!(\n\t\t\t\"default-src 'none';base-uri 'none';script-src 'unsafe-inline' https://cdn.jsdelivr.net 'sha256-{}' 'strict-dynamic';style-src 'unsafe-inline' https://fonts.googleapis.com;font-src https://fonts.gstatic.com;connect-src 'self';img-src blob: data:\",\n\t\t\tscript_hash\n\t\t).parse().unwrap()\n\t);\n\theaders.insert(ETAG, etag.parse().unwrap());\n\theaders.insert(REFERRER_POLICY, HeaderValue::from_static(\"no-referrer\"));\n\theaders.insert(X_CONTENT_TYPE_OPTIONS, HeaderValue::from_static(\"nosniff\"));\n\tOk(res)\n}\n\nimpl Handler for OpenapiDocHandler {\n\tfn handle(self, state: State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e {\n\t\tmatch redoc_handler(\u0026state, \u0026self.openapi) {\n\t\t\tOk(res) =\u003e future::ok((state, res)).boxed(),\n\t\t\tErr(err) =\u003e future::err((state, err)).boxed()\n\t\t}\n\t}\n}\n","traces":[{"line":28,"address":[1999978,1999152],"length":1,"stats":{"Line":2},"fn_name":"get_security"},{"line":32,"address":[1999244,1999190],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[1999246,1999208],"length":1,"stats":{"Line":3},"fn_name":null},{"line":34,"address":[1999233],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[1999437,1999543,1999334],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[1999361],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[1999467],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[1999304],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[1999548],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[1999717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[1999736],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[1999909],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[2000553,2000096],"length":1,"stats":{"Line":2},"fn_name":"openapi_string"},{"line":64,"address":[2000153],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[2000215],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[2000268],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[2000283],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[2000362,2000568],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[2000695],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[2000827],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[2001536,2002513],"length":1,"stats":{"Line":2},"fn_name":"create_openapi_response"},{"line":76,"address":[2001652,2001989,2001574],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[2001654,2001584],"length":1,"stats":{"Line":4},"fn_name":null},{"line":78,"address":[2001687],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[2001794],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[2001834],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[2001971],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[2001596],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[2001609,2001994,2002070],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[2002325],"length":1,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[2002576],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":108,"address":[2002608],"length":1,"stats":{"Line":2},"fn_name":"new_handler"},{"line":109,"address":[2002617],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[2002672,2002983],"length":1,"stats":{"Line":2},"fn_name":"handle"},{"line":115,"address":[2002715],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[2002689,2002727],"length":1,"stats":{"Line":4},"fn_name":null},{"line":130,"address":[2003056],"length":1,"stats":{"Line":0},"fn_name":"new"},{"line":138,"address":[2003088],"length":1,"stats":{"Line":0},"fn_name":"new_handler"},{"line":139,"address":[2003097],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[2007115,2003152],"length":1,"stats":{"Line":0},"fn_name":"redoc_handler"},{"line":144,"address":[2003191,2003360],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[2003452,2003331],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[2007695,2007578,2007440,2007639],"length":1,"stats":{"Line":0},"fn_name":"{{closure}}"},{"line":148,"address":[2007522,2007467],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[2007583],"length":1,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[2007641],"length":1,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[2007504,2007706],"length":1,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[2003535],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[2003570],"length":1,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[2003593],"length":1,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[2003600],"length":1,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[2003758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[2003777,2004254,2004147],"length":1,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[2004787,2004043,2004309,2004680],"length":1,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[2004673],"length":1,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[2004818],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[2004825,2007041],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[2005331,2005206],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[2005323,2007760,2007728],"length":1,"stats":{"Line":0},"fn_name":"{{closure}}"},{"line":180,"address":[2005364],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[2005621],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[2005399],"length":1,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[2005689],"length":1,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[2005729],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[2006152],"length":1,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[2005869],"length":1,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[2006279],"length":1,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[2006470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[2006602],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[2006776],"length":1,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[2008463,2007840],"length":1,"stats":{"Line":0},"fn_name":"handle"},{"line":202,"address":[2008073,2007857,2008350,2008407],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[2008075,2007890],"length":1,"stats":{"Line":0},"fn_name":null},{"line":204,"address":[2008352,2007911],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":30,"coverable":74},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","mod.rs"],"content":"const SECURITY_NAME: \u0026str = \"authToken\";\n\npub(crate) mod builder;\npub(crate) mod handler;\npub(crate) mod operation;\npub(crate) mod router;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","operation.rs"],"content":"use super::SECURITY_NAME;\nuse crate::{response::OrAllTypes, EndpointWithSchema, IntoResponse, RequestBody};\nuse gotham::hyper::StatusCode;\nuse mime::Mime;\nuse openapi_type::{\n\tindexmap::IndexMap,\n\topenapi::{\n\t\tMediaType, Operation, Parameter, ParameterData, ParameterSchemaOrContent, ReferenceOr, ReferenceOr::Item,\n\t\tRequestBody as OARequestBody, Response, Responses, Schema, SchemaKind, StatusCode as OAStatusCode, Type\n\t},\n\tOpenapiSchema\n};\nuse std::collections::HashMap;\n\nfn new_parameter_data(name: String, required: bool, schema: ReferenceOr\u003cBox\u003cSchema\u003e\u003e) -\u003e ParameterData {\n\tParameterData {\n\t\tname,\n\t\tdescription: None,\n\t\trequired,\n\t\tdeprecated: None,\n\t\tformat: ParameterSchemaOrContent::Schema(schema.unbox()),\n\t\texample: None,\n\t\texamples: Default::default(),\n\t\textensions: Default::default()\n\t}\n}\n\n#[derive(Default)]\nstruct OperationParams {\n\tpath_params: Option\u003cOpenapiSchema\u003e,\n\tquery_params: Option\u003cOpenapiSchema\u003e\n}\n\nimpl OperationParams {\n\tfn add_path_params(path_params: Option\u003cOpenapiSchema\u003e, params: \u0026mut Vec\u003cReferenceOr\u003cParameter\u003e\u003e) {\n\t\tlet path_params = match path_params {\n\t\t\tSome(pp) =\u003e pp.schema,\n\t\t\tNone =\u003e return\n\t\t};\n\t\tlet path_params = match path_params {\n\t\t\tSchemaKind::Type(Type::Object(ty)) =\u003e ty,\n\t\t\t_ =\u003e panic!(\"Path Parameters needs to be a plain struct\")\n\t\t};\n\t\tfor (name, schema) in path_params.properties {\n\t\t\tlet required = path_params.required.contains(\u0026name);\n\t\t\tparams.push(Item(Parameter::Path {\n\t\t\t\tparameter_data: new_parameter_data(name, required, schema),\n\t\t\t\tstyle: Default::default()\n\t\t\t}))\n\t\t}\n\t}\n\n\tfn add_query_params(query_params: Option\u003cOpenapiSchema\u003e, params: \u0026mut Vec\u003cReferenceOr\u003cParameter\u003e\u003e) {\n\t\tlet query_params = match query_params {\n\t\t\tSome(qp) =\u003e qp.schema,\n\t\t\tNone =\u003e return\n\t\t};\n\t\tlet query_params = match query_params {\n\t\t\tSchemaKind::Type(Type::Object(ty)) =\u003e ty,\n\t\t\t_ =\u003e panic!(\"Query Parameters needs to be a plain struct\")\n\t\t};\n\t\tfor (name, schema) in query_params.properties {\n\t\t\tlet required = query_params.required.contains(\u0026name);\n\t\t\tparams.push(Item(Parameter::Query {\n\t\t\t\tparameter_data: new_parameter_data(name, required, schema),\n\t\t\t\tallow_reserved: false,\n\t\t\t\tstyle: Default::default(),\n\t\t\t\tallow_empty_value: None\n\t\t\t}))\n\t\t}\n\t}\n\n\tfn into_params(self) -\u003e Vec\u003cReferenceOr\u003cParameter\u003e\u003e {\n\t\tlet mut params: Vec\u003cReferenceOr\u003cParameter\u003e\u003e = Vec::new();\n\t\tSelf::add_path_params(self.path_params, \u0026mut params);\n\t\tSelf::add_query_params(self.query_params, \u0026mut params);\n\t\tparams\n\t}\n}\n\npub(crate) struct OperationDescription {\n\toperation_id: Option\u003cString\u003e,\n\tdescription: Option\u003cString\u003e,\n\n\taccepted_types: Option\u003cVec\u003cMime\u003e\u003e,\n\tresponses: HashMap\u003cStatusCode, ReferenceOr\u003cSchema\u003e\u003e,\n\tparams: OperationParams,\n\tbody_schema: Option\u003cReferenceOr\u003cSchema\u003e\u003e,\n\tsupported_types: Option\u003cVec\u003cMime\u003e\u003e,\n\trequires_auth: bool\n}\n\nimpl OperationDescription {\n\t/// Create a new operation description for the given endpoint type and schema. If the endpoint\n\t/// does not specify an operation id, the path is used to generate one.\n\tpub(crate) fn new\u003cE: EndpointWithSchema\u003e(responses: HashMap\u003cStatusCode, ReferenceOr\u003cSchema\u003e\u003e, path: \u0026str) -\u003e Self {\n\t\tlet operation_id = E::operation_id().or_else(|| {\n\t\t\tE::operation_verb().map(|verb| format!(\"{}_{}\", verb, path.replace(\"/\", \"_\").trim_start_matches('_')))\n\t\t});\n\t\tSelf {\n\t\t\toperation_id,\n\t\t\tdescription: E::description(),\n\n\t\t\taccepted_types: E::Output::accepted_types(),\n\t\t\tresponses,\n\t\t\tparams: Default::default(),\n\t\t\tbody_schema: None,\n\t\t\tsupported_types: None,\n\t\t\trequires_auth: E::wants_auth()\n\t\t}\n\t}\n\n\tpub(crate) fn set_path_params(\u0026mut self, params: OpenapiSchema) {\n\t\tself.params.path_params = Some(params);\n\t}\n\n\tpub(crate) fn set_query_params(\u0026mut self, params: OpenapiSchema) {\n\t\tself.params.query_params = Some(params);\n\t}\n\n\tpub(crate) fn set_body\u003cBody: RequestBody\u003e(\u0026mut self, schema: ReferenceOr\u003cSchema\u003e) {\n\t\tself.body_schema = Some(schema);\n\t\tself.supported_types = Body::supported_types();\n\t}\n\n\tfn schema_to_content(types: Vec\u003cMime\u003e, schema: ReferenceOr\u003cSchema\u003e) -\u003e IndexMap\u003cString, MediaType\u003e {\n\t\tlet mut content: IndexMap\u003cString, MediaType\u003e = IndexMap::new();\n\t\tfor ty in types {\n\t\t\tcontent.insert(ty.to_string(), MediaType {\n\t\t\t\tschema: Some(schema.clone()),\n\t\t\t\t..Default::default()\n\t\t\t});\n\t\t}\n\t\tcontent\n\t}\n\n\tpub(crate) fn into_operation(self) -\u003e Operation {\n\t\t// this is unfortunately neccessary to prevent rust from complaining about partially moving self\n\t\tlet (operation_id, description, accepted_types, responses, params, body_schema, supported_types, requires_auth) = (\n\t\t\tself.operation_id,\n\t\t\tself.description,\n\t\t\tself.accepted_types,\n\t\t\tself.responses,\n\t\t\tself.params,\n\t\t\tself.body_schema,\n\t\t\tself.supported_types,\n\t\t\tself.requires_auth\n\t\t);\n\n\t\tlet responses: IndexMap\u003cOAStatusCode, ReferenceOr\u003cResponse\u003e\u003e = responses\n\t\t\t.into_iter()\n\t\t\t.map(|(code, schema)| {\n\t\t\t\tlet content = Self::schema_to_content(accepted_types.clone().or_all_types(), schema);\n\t\t\t\t(\n\t\t\t\t\tOAStatusCode::Code(code.as_u16()),\n\t\t\t\t\tItem(Response {\n\t\t\t\t\t\tdescription: code.canonical_reason().map(|d| d.to_string()).unwrap_or_default(),\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t..Default::default()\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t})\n\t\t\t.collect();\n\n\t\tlet request_body = body_schema.map(|schema| {\n\t\t\tItem(OARequestBody {\n\t\t\t\tcontent: Self::schema_to_content(supported_types.or_all_types(), schema),\n\t\t\t\trequired: true,\n\t\t\t\t..Default::default()\n\t\t\t})\n\t\t});\n\n\t\tlet mut security = Vec::new();\n\t\tif requires_auth {\n\t\t\tlet mut sec = IndexMap::new();\n\t\t\tsec.insert(SECURITY_NAME.to_owned(), Vec::new());\n\t\t\tsecurity.push(sec);\n\t\t}\n\n\t\tOperation {\n\t\t\ttags: Vec::new(),\n\t\t\toperation_id,\n\t\t\tdescription,\n\t\t\tparameters: params.into_params(),\n\t\t\trequest_body,\n\t\t\tresponses: Responses {\n\t\t\t\tdefault: None,\n\t\t\t\tresponses\n\t\t\t},\n\t\t\tdeprecated: false,\n\t\t\tsecurity,\n\t\t\t..Default::default()\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse crate::{NoContent, Raw, ResponseSchema};\n\n\t#[test]\n\tfn no_content_schema_to_content() {\n\t\tlet types = NoContent::accepted_types();\n\t\tlet schema = \u003cNoContent as ResponseSchema\u003e::schema(StatusCode::NO_CONTENT);\n\t\tlet content = OperationDescription::schema_to_content(types.or_all_types(), Item(schema.into_schema()));\n\t\tassert!(content.is_empty());\n\t}\n\n\t#[test]\n\tfn raw_schema_to_content() {\n\t\tlet types = Raw::\u003c\u0026str\u003e::accepted_types();\n\t\tlet schema = \u003cRaw\u003c\u0026str\u003e as ResponseSchema\u003e::schema(StatusCode::OK);\n\t\tlet content = OperationDescription::schema_to_content(types.or_all_types(), Item(schema.into_schema()));\n\t\tassert_eq!(content.len(), 1);\n\t\tlet json = serde_json::to_string(\u0026content.values().nth(0).unwrap()).unwrap();\n\t\tassert_eq!(json, r#\"{\"schema\":{\"type\":\"string\",\"format\":\"binary\"}}\"#);\n\t}\n}\n","traces":[{"line":15,"address":[2556349,2555856],"length":1,"stats":{"Line":1},"fn_name":"new_parameter_data"},{"line":21,"address":[2555931],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[2556021],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[2556040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[2558206,2556448],"length":1,"stats":{"Line":2},"fn_name":"add_path_params"},{"line":36,"address":[2556552,2556479],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[2556519,2556589,2557781],"length":1,"stats":{"Line":3},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[2557764,2556643,2556684],"length":1,"stats":{"Line":3},"fn_name":null},{"line":44,"address":[2556759,2557673,2557007],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[2557313],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[2557529],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[2557395],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[2557512],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[2560206,2558432],"length":1,"stats":{"Line":2},"fn_name":"add_query_params"},{"line":54,"address":[2558536,2558463],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[2558503,2558573,2559781],"length":1,"stats":{"Line":3},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[2558627,2559764,2558668],"length":1,"stats":{"Line":3},"fn_name":null},{"line":62,"address":[2558743,2559673,2558991],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[2559297],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[2559513],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[2559379],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[2559496],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[2560432,2560644],"length":1,"stats":{"Line":2},"fn_name":"into_params"},{"line":74,"address":[2560457],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[2560505],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[2560559],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":113,"address":[2560893,2560768],"length":1,"stats":{"Line":1},"fn_name":"set_path_params"},{"line":114,"address":[2560913,2560822],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[2560976,2561107],"length":1,"stats":{"Line":1},"fn_name":"set_query_params"},{"line":118,"address":[2561030,2561127],"length":1,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":126,"address":[2561184,2562306],"length":1,"stats":{"Line":3},"fn_name":"schema_to_content"},{"line":127,"address":[2561223],"length":1,"stats":{"Line":3},"fn_name":null},{"line":128,"address":[2561259,2562194,2561414],"length":1,"stats":{"Line":6},"fn_name":null},{"line":129,"address":[2561832,2561941],"length":1,"stats":{"Line":6},"fn_name":null},{"line":130,"address":[2561844],"length":1,"stats":{"Line":3},"fn_name":null},{"line":131,"address":[2561901],"length":1,"stats":{"Line":3},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[2565342,2562640],"length":1,"stats":{"Line":2},"fn_name":"into_operation"},{"line":139,"address":[2563006,2562668],"length":1,"stats":{"Line":4},"fn_name":null},{"line":140,"address":[2562756],"length":1,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[2562779],"length":1,"stats":{"Line":2},"fn_name":null},{"line":142,"address":[2562803],"length":1,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[2562827],"length":1,"stats":{"Line":2},"fn_name":null},{"line":144,"address":[2562863],"length":1,"stats":{"Line":2},"fn_name":null},{"line":145,"address":[2562914],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[2562966],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[2562996],"length":1,"stats":{"Line":2},"fn_name":null},{"line":150,"address":[2563625,2563530],"length":1,"stats":{"Line":4},"fn_name":null},{"line":152,"address":[2563617,2566480,2566523,2567432],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}"},{"line":153,"address":[2566583],"length":1,"stats":{"Line":2},"fn_name":null},{"line":155,"address":[2566705],"length":1,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[2566926],"length":1,"stats":{"Line":2},"fn_name":null},{"line":157,"address":[2566432,2566454,2566743],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}"},{"line":158,"address":[2566823],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[2566919],"length":1,"stats":{"Line":2},"fn_name":null},{"line":165,"address":[2563687,2567664,2568086],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":166,"address":[2567689,2567837],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[2567705],"length":1,"stats":{"Line":1},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":169,"address":[2567825],"length":1,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[2563806],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[2563829,2563858],"length":1,"stats":{"Line":4},"fn_name":null},{"line":175,"address":[2563851],"length":1,"stats":{"Line":1},"fn_name":null},{"line":176,"address":[2565761,2563863],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[2563995],"length":1,"stats":{"Line":1},"fn_name":null},{"line":181,"address":[2564114],"length":1,"stats":{"Line":2},"fn_name":null},{"line":184,"address":[2564213],"length":1,"stats":{"Line":2},"fn_name":null},{"line":186,"address":[2564445],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":76,"coverable":85},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","router.rs"],"content":"use super::{\n\tbuilder::OpenapiBuilder,\n\thandler::{OpenapiDocHandler, OpenapiSpecHandler},\n\toperation::OperationDescription\n};\nuse crate::{routing::*, EndpointWithSchema, ResourceWithSchema, ResponseSchema};\nuse gotham::{\n\thyper::{Method, StatusCode},\n\tpipeline::chain::PipelineHandleChain,\n\trouter::builder::*\n};\nuse lazy_regex::regex_replace_all;\nuse openapi_type::OpenapiType;\nuse std::{collections::HashMap, panic::RefUnwindSafe};\n\n/// This trait adds the `openapi_spec` and `openapi_doc` method to an OpenAPI-aware router.\npub trait GetOpenapi {\n\t/// Register a GET route to `path` that returns the OpenAPI specification in JSON format.\n\tfn openapi_spec(\u0026mut self, path: \u0026str);\n\n\t/// Register a GET route to `path` that returns the OpenAPI documentation in HTML format.\n\tfn openapi_doc(\u0026mut self, path: \u0026str);\n}\n\n#[derive(Debug)]\npub struct OpenapiRouter\u003c'a, D\u003e {\n\tpub(crate) router: \u0026'a mut D,\n\tpub(crate) scope: Option\u003c\u0026'a str\u003e,\n\tpub(crate) openapi_builder: \u0026'a mut OpenapiBuilder\n}\n\nmacro_rules! implOpenapiRouter {\n\t($implType:ident) =\u003e {\n\t\timpl\u003c'a, 'b, C, P\u003e OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tpub fn scope\u003cF\u003e(\u0026mut self, path: \u0026str, callback: F)\n\t\t\twhere\n\t\t\t\tF: FnOnce(\u0026mut OpenapiRouter\u003c'_, ScopeBuilder\u003c'_, C, P\u003e\u003e)\n\t\t\t{\n\t\t\t\tlet mut openapi_builder = self.openapi_builder.clone();\n\t\t\t\tlet new_scope = self.scope.map(|scope| format!(\"{}/{}\", scope, path).replace(\"//\", \"/\"));\n\t\t\t\tself.router.scope(path, |router| {\n\t\t\t\t\tlet mut router = OpenapiRouter {\n\t\t\t\t\t\trouter,\n\t\t\t\t\t\tscope: Some(new_scope.as_ref().map(String::as_ref).unwrap_or(path)),\n\t\t\t\t\t\topenapi_builder: \u0026mut openapi_builder\n\t\t\t\t\t};\n\t\t\t\t\tcallback(\u0026mut router);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, 'b, C, P\u003e GetOpenapi for OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn openapi_spec(\u0026mut self, path: \u0026str) {\n\t\t\t\tself.router\n\t\t\t\t\t.get(path)\n\t\t\t\t\t.to_new_handler(OpenapiSpecHandler::new(self.openapi_builder.openapi.clone()));\n\t\t\t}\n\n\t\t\tfn openapi_doc(\u0026mut self, path: \u0026str) {\n\t\t\t\tself.router\n\t\t\t\t\t.get(path)\n\t\t\t\t\t.to_new_handler(OpenapiDocHandler::new(self.openapi_builder.openapi.clone()));\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, 'b, C, P\u003e DrawResourcesWithSchema for OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn resource\u003cR: ResourceWithSchema\u003e(\u0026mut self, mut path: \u0026str) {\n\t\t\t\tif path.starts_with('/') {\n\t\t\t\t\tpath = \u0026path[1..];\n\t\t\t\t}\n\t\t\t\tR::setup((self, path));\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, 'b, C, P\u003e DrawResourceRoutesWithSchema for (\u0026mut OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e, \u0026str)\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn endpoint\u003cE: EndpointWithSchema + 'static\u003e(\u0026mut self) {\n\t\t\t\tlet mut responses: HashMap\u003cStatusCode, _\u003e = HashMap::new();\n\t\t\t\tfor code in E::Output::status_codes() {\n\t\t\t\t\tresponses.insert(code, (self.0).openapi_builder.add_schema(E::Output::schema(code)));\n\t\t\t\t}\n\t\t\t\tlet mut path = format!(\"{}/{}\", self.0.scope.unwrap_or_default(), self.1);\n\t\t\t\tlet mut descr = OperationDescription::new::\u003cE\u003e(responses, \u0026path);\n\t\t\t\tif E::has_placeholders() {\n\t\t\t\t\tdescr.set_path_params(E::Placeholders::schema());\n\t\t\t\t}\n\t\t\t\tif E::needs_params() {\n\t\t\t\t\tdescr.set_query_params(E::Params::schema());\n\t\t\t\t}\n\t\t\t\tif E::needs_body() {\n\t\t\t\t\tlet body_schema = (self.0).openapi_builder.add_schema(E::Body::schema());\n\t\t\t\t\tdescr.set_body::\u003cE::Body\u003e(body_schema);\n\t\t\t\t}\n\n\t\t\t\tlet uri: \u0026str = \u0026E::uri();\n\t\t\t\tlet uri = regex_replace_all!(r#\"(^|/):([^/]+)(/|$)\"#, uri, |_, prefix, name, suffix| {\n\t\t\t\t\tformat!(\"{}{{{}}}{}\", prefix, name, suffix)\n\t\t\t\t});\n\t\t\t\tif !uri.is_empty() {\n\t\t\t\t\tpath = format!(\"{}/{}\", path, uri);\n\t\t\t\t}\n\n\t\t\t\tlet op = descr.into_operation();\n\t\t\t\tlet mut item = (self.0).openapi_builder.remove_path(\u0026path);\n\t\t\t\tmatch E::http_method() {\n\t\t\t\t\tMethod::GET =\u003e item.get = Some(op),\n\t\t\t\t\tMethod::PUT =\u003e item.put = Some(op),\n\t\t\t\t\tMethod::POST =\u003e item.post = Some(op),\n\t\t\t\t\tMethod::DELETE =\u003e item.delete = Some(op),\n\t\t\t\t\tMethod::OPTIONS =\u003e item.options = Some(op),\n\t\t\t\t\tMethod::HEAD =\u003e item.head = Some(op),\n\t\t\t\t\tMethod::PATCH =\u003e item.patch = Some(op),\n\t\t\t\t\tMethod::TRACE =\u003e item.trace = Some(op),\n\t\t\t\t\tmethod =\u003e warn!(\"Ignoring unsupported method '{}' in OpenAPI Specification\", method)\n\t\t\t\t};\n\t\t\t\t(self.0).openapi_builder.add_path(path, item);\n\n\t\t\t\t(\u0026mut *(self.0).router, self.1).endpoint::\u003cE\u003e()\n\t\t\t}\n\t\t}\n\t};\n}\n\nimplOpenapiRouter!(RouterBuilder);\nimplOpenapiRouter!(ScopeBuilder);\n","traces":[{"line":39,"address":[3546859,3547664,3547899,3546624],"length":1,"stats":{"Line":2},"fn_name":"scope\u003c(),(),closure-0\u003e"},{"line":43,"address":[3547693,3546653],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[3547232,3548307,3547736,3547267,3546696,3548272],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003c(),(),closure-0\u003e"},{"line":45,"address":[3547181,3546944,3546735,3547775,3547984,3548221],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003c(),(),closure-0\u003e"},{"line":46,"address":[3548156,3547116,3546969,3548009],"length":1,"stats":{"Line":4},"fn_name":null},{"line":48,"address":[3548019,3546979],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[3548152,3547112],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[3548186,3547146],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[3549360,3549497],"length":1,"stats":{"Line":2},"fn_name":"openapi_spec\u003c(),()\u003e"},{"line":62,"address":[3549390,3549470],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[3549509,3549418,3549487],"length":1,"stats":{"Line":4},"fn_name":null},{"line":79,"address":[3549728,3549552],"length":1,"stats":{"Line":5},"fn_name":"resource\u003c(),(),openapi_supports_scope::FooResource\u003e"},{"line":80,"address":[3549659,3549576,3549835,3549752],"length":1,"stats":{"Line":9},"fn_name":null},{"line":81,"address":[3549670,3549611,3549787,3549846],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[3549861,3549685],"length":1,"stats":{"Line":5},"fn_name":null},{"line":92,"address":[3549904,3554198,3557200,3561494],"length":1,"stats":{"Line":8},"fn_name":"endpoint\u003c(),(),openapi_supports_scope::read_all___gotham_restful_endpoint\u003e"},{"line":93,"address":[3557229,3549933],"length":1,"stats":{"Line":8},"fn_name":null},{"line":94,"address":[3557555,3557734,3550082,3550259,3550438,3557378],"length":1,"stats":{"Line":16},"fn_name":null},{"line":95,"address":[3557605,3550309],"length":1,"stats":{"Line":8},"fn_name":null},{"line":97,"address":[3557747,3550451],"length":1,"stats":{"Line":8},"fn_name":null},{"line":98,"address":[3558185,3555579,3550889,3562875],"length":1,"stats":{"Line":8},"fn_name":null},{"line":99,"address":[3558349,3558426,3551101,3558397,3551053,3551130],"length":1,"stats":{"Line":16},"fn_name":null},{"line":100,"address":[3551082,3558399,3558378,3551103],"length":1,"stats":{"Line":8},"fn_name":null},{"line":102,"address":[3551209,3551180,3558476,3558428,3551132,3558505],"length":1,"stats":{"Line":16},"fn_name":null},{"line":103,"address":[3551182,3558478,3558457,3551161],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[3551211,3558676,3551282,3551380,3558578,3558507],"length":1,"stats":{"Line":16},"fn_name":null},{"line":106,"address":[3551292,3551248,3558588,3558544],"length":1,"stats":{"Line":4},"fn_name":null},{"line":107,"address":[3551355,3558651],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[3558686,3551390],"length":1,"stats":{"Line":8},"fn_name":null},{"line":111,"address":[2099004,2099215,2099260,2098992,2099248,2099471],"length":1,"stats":{"Line":58},"fn_name":"{{closure}}"},{"line":112,"address":[3556781,3564077],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[3551761,3554330,3559057,3558857,3551561,3561626],"length":1,"stats":{"Line":16},"fn_name":null},{"line":115,"address":[3558953,3551657,3561509,3554213,3559102,3551806],"length":1,"stats":{"Line":10},"fn_name":null},{"line":118,"address":[3552030,3559326],"length":1,"stats":{"Line":8},"fn_name":null},{"line":119,"address":[3559415,3552119],"length":1,"stats":{"Line":8},"fn_name":null},{"line":120,"address":[3552295,3559591,3555046,3554960,3554868,3554408,3554776,3561704,3554592,3561796,3562164,3562072,3554684,3562256,3562342,3554500,3561980,3561888],"length":1,"stats":{"Line":16},"fn_name":null},{"line":121,"address":[3552302,3552442,3554335,3559598,3559738,3561631],"length":1,"stats":{"Line":14},"fn_name":null},{"line":122,"address":[3561709,3559856,3552560,3554413],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[3552678,3559974,3554505,3561801],"length":1,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[3552796,3561893,3560092,3554597],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[3560210,3561985,3554689,3552914],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[3560328,3553032,3562077,3554781],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[3560428,3553132,3554873,3562169],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[3560528,3562258,3553232,3554962],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[3561405,3553332,3554109,3552356,3553408,3560628,3560704,3559652],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[3553702,3560998],"length":1,"stats":{"Line":8},"fn_name":null},{"line":133,"address":[3561188,3553892],"length":1,"stats":{"Line":8},"fn_name":null}],"covered":41,"coverable":47},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","auth_result.rs"],"content":"use gotham_restful_derive::ResourceError;\n\n/**\nThis is an error type that always yields a _403 Forbidden_ response. This type is best used in\ncombination with [AuthSuccess] or [AuthResult].\n*/\n#[derive(Debug, Clone, Copy, ResourceError)]\npub enum AuthError {\n\t#[status(FORBIDDEN)]\n\t#[display(\"Forbidden\")]\n\tForbidden\n}\n\n/**\nThis return type can be used to wrap any type implementing [IntoResponse](crate::IntoResponse)\nthat can only be returned if the client is authenticated. Otherwise, an empty _403 Forbidden_\nresponse will be issued.\n\nUse can look something like this (assuming the `auth` feature is enabled):\n\n```rust\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"auth\")]\n# mod auth_feature_enabled {\n# use gotham::state::State;\n# use gotham_restful::*;\n# use serde::Deserialize;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n# #[derive(Clone, Deserialize)]\n# struct MyAuthData { exp : u64 }\n#\n#[read_all]\nfn read_all(auth : AuthStatus\u003cMyAuthData\u003e) -\u003e AuthSuccess\u003cNoContent\u003e {\n\tlet auth_data = match auth {\n\t\tAuthStatus::Authenticated(data) =\u003e data,\n\t\t_ =\u003e return Err(Forbidden)\n\t};\n\t// do something\n\tOk(NoContent::default())\n}\n# }\n```\n*/\npub type AuthSuccess\u003cT\u003e = Result\u003cT, AuthError\u003e;\n\n/**\nThis is an error type that either yields a _403 Forbidden_ respone if produced from an authentication\nerror, or delegates to another error type. This type is best used with [AuthResult].\n*/\n#[derive(Debug, ResourceError)]\npub enum AuthErrorOrOther\u003cE\u003e {\n\t#[status(FORBIDDEN)]\n\t#[display(\"Forbidden\")]\n\tForbidden,\n\t#[status(INTERNAL_SERVER_ERROR)]\n\t#[display(\"{0}\")]\n\tOther(E)\n}\n\nimpl\u003cE\u003e From\u003cAuthError\u003e for AuthErrorOrOther\u003cE\u003e {\n\tfn from(err: AuthError) -\u003e Self {\n\t\tmatch err {\n\t\t\tAuthError::Forbidden =\u003e Self::Forbidden\n\t\t}\n\t}\n}\n\nmod private {\n\tuse gotham::handler::HandlerError;\n\tpub trait Sealed {}\n\timpl\u003cE: Into\u003cHandlerError\u003e\u003e Sealed for E {}\n}\n\nimpl\u003cE, F\u003e From\u003cF\u003e for AuthErrorOrOther\u003cE\u003e\nwhere\n\t// TODO https://github.com/msrd0/gotham_restful/issues/20\n\tF: private::Sealed + Into\u003cE\u003e\n{\n\tfn from(err: F) -\u003e Self {\n\t\tSelf::Other(err.into())\n\t}\n}\n\n/**\nThis return type can be used to wrap any type implementing [IntoResponse](crate::IntoResponse)\nthat can only be returned if the client is authenticated. Otherwise, an empty _403 Forbidden_\nresponse will be issued.\n\nUse can look something like this (assuming the `auth` feature is enabled):\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"auth\")]\n# mod auth_feature_enabled {\n# use gotham::state::State;\n# use gotham_restful::*;\n# use serde::Deserialize;\n# use std::io;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n# #[derive(Clone, Deserialize)]\n# struct MyAuthData { exp : u64 }\n#\n#[read_all]\nfn read_all(auth : AuthStatus\u003cMyAuthData\u003e) -\u003e AuthResult\u003cNoContent, io::Error\u003e {\n\tlet auth_data = match auth {\n\t\tAuthStatus::Authenticated(data) =\u003e data,\n\t\t_ =\u003e Err(Forbidden)?\n\t};\n\t// do something\n\tOk(NoContent::default().into())\n}\n# }\n*/\npub type AuthResult\u003cT, E\u003e = Result\u003cT, AuthErrorOrOther\u003cE\u003e\u003e;\n","traces":[{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","mod.rs"],"content":"use futures_util::future::{self, BoxFuture, FutureExt};\nuse gotham::{\n\thandler::HandlerError,\n\thyper::{\n\t\theader::{HeaderMap, HeaderName, HeaderValue},\n\t\tBody, StatusCode\n\t}\n};\nuse mime::{Mime, APPLICATION_JSON, STAR_STAR};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\nuse serde::Serialize;\nuse std::{\n\tconvert::Infallible,\n\tfmt::{Debug, Display},\n\tfuture::Future,\n\tpin::Pin\n};\n\nmod auth_result;\n#[allow(unreachable_pub)]\npub use auth_result::{AuthError, AuthErrorOrOther, AuthResult, AuthSuccess};\n\nmod no_content;\n#[allow(unreachable_pub)]\npub use no_content::NoContent;\n\nmod raw;\n#[allow(unreachable_pub)]\npub use raw::Raw;\n\nmod redirect;\n#[allow(unreachable_pub)]\npub use redirect::Redirect;\n\nmod result;\n#[allow(unreachable_pub)]\npub use result::IntoResponseError;\n\nmod success;\n#[allow(unreachable_pub)]\npub use success::Success;\n\npub(crate) trait OrAllTypes {\n\tfn or_all_types(self) -\u003e Vec\u003cMime\u003e;\n}\n\nimpl OrAllTypes for Option\u003cVec\u003cMime\u003e\u003e {\n\tfn or_all_types(self) -\u003e Vec\u003cMime\u003e {\n\t\tself.unwrap_or_else(|| vec![STAR_STAR])\n\t}\n}\n\n/// A response, used to create the final gotham response from.\n#[derive(Debug)]\npub struct Response {\n\tpub(crate) status: StatusCode,\n\tpub(crate) body: Body,\n\tpub(crate) mime: Option\u003cMime\u003e,\n\tpub(crate) headers: HeaderMap\n}\n\nimpl Response {\n\t/// Create a new [Response] from raw data.\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn new\u003cB: Into\u003cBody\u003e\u003e(status: StatusCode, body: B, mime: Option\u003cMime\u003e) -\u003e Self {\n\t\tSelf {\n\t\t\tstatus,\n\t\t\tbody: body.into(),\n\t\t\tmime,\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Create a [Response] with mime type json from already serialized data.\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn json\u003cB: Into\u003cBody\u003e\u003e(status: StatusCode, body: B) -\u003e Self {\n\t\tSelf {\n\t\t\tstatus,\n\t\t\tbody: body.into(),\n\t\t\tmime: Some(APPLICATION_JSON),\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Create a _204 No Content_ [Response].\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn no_content() -\u003e Self {\n\t\tSelf {\n\t\t\tstatus: StatusCode::NO_CONTENT,\n\t\t\tbody: Body::empty(),\n\t\t\tmime: None,\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Create an empty _403 Forbidden_ [Response].\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn forbidden() -\u003e Self {\n\t\tSelf {\n\t\t\tstatus: StatusCode::FORBIDDEN,\n\t\t\tbody: Body::empty(),\n\t\t\tmime: None,\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Return the status code of this [Response].\n\tpub fn status(\u0026self) -\u003e StatusCode {\n\t\tself.status\n\t}\n\n\t/// Return the mime type of this [Response].\n\tpub fn mime(\u0026self) -\u003e Option\u003c\u0026Mime\u003e {\n\t\tself.mime.as_ref()\n\t}\n\n\t/// Add an HTTP header to the [Response].\n\tpub fn header(\u0026mut self, name: HeaderName, value: HeaderValue) {\n\t\tself.headers.insert(name, value);\n\t}\n\n\tpub(crate) fn with_headers(mut self, headers: HeaderMap) -\u003e Self {\n\t\tself.headers = headers;\n\t\tself\n\t}\n\n\t#[cfg(test)]\n\tpub(crate) fn full_body(mut self) -\u003e Result\u003cVec\u003cu8\u003e, \u003cBody as gotham::hyper::body::HttpBody\u003e::Error\u003e {\n\t\tuse futures_executor::block_on;\n\t\tuse gotham::hyper::body::to_bytes;\n\n\t\tlet bytes: \u0026[u8] = \u0026block_on(to_bytes(\u0026mut self.body))?;\n\t\tOk(bytes.to_vec())\n\t}\n}\n\nimpl IntoResponse for Response {\n\ttype Err = Infallible;\n\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e {\n\t\tfuture::ok(self).boxed()\n\t}\n}\n\n/// This trait needs to be implemented by every type returned from an endpoint to\n/// to provide the response.\npub trait IntoResponse {\n\ttype Err: Into\u003cHandlerError\u003e + Send + Sync + 'static;\n\n\t/// Turn this into a response that can be returned to the browser. This api will likely\n\t/// change in the future.\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e;\n\n\t/// Return a list of supported mime types.\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tNone\n\t}\n}\n\n/// Additional details for [IntoResponse] to be used with an OpenAPI-aware router.\n#[cfg(feature = \"openapi\")]\npub trait ResponseSchema {\n\t/// All status codes returned by this response. Returns `[StatusCode::OK]` by default.\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::OK]\n\t}\n\n\t/// Return the schema of the response for the given status code. The code may\n\t/// only be one that was previously returned by [Self::status_codes]. The\n\t/// implementation should panic if that is not the case.\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema;\n}\n\n#[cfg(feature = \"openapi\")]\nmod private {\n\tpub trait Sealed {}\n}\n\n/// A trait provided to convert a resource's result to json, and provide an OpenAPI schema to the\n/// router. This trait is implemented for all types that implement [IntoResponse] and\n/// [ResponseSchema].\n#[cfg(feature = \"openapi\")]\npub trait IntoResponseWithSchema: IntoResponse + ResponseSchema + private::Sealed {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cR: IntoResponse + ResponseSchema\u003e private::Sealed for R {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cR: IntoResponse + ResponseSchema\u003e IntoResponseWithSchema for R {}\n\n/// The default json returned on an 500 Internal Server Error.\n#[derive(Debug, Serialize)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\npub(crate) struct ResourceError {\n\t/// This is always `true` and can be used to detect an error response without looking at the\n\t/// HTTP status code.\n\terror: bool,\n\t/// The error message.\n\tmessage: String\n}\n\nimpl\u003cT: ToString\u003e From\u003cT\u003e for ResourceError {\n\tfn from(message: T) -\u003e Self {\n\t\tSelf {\n\t\t\terror: true,\n\t\t\tmessage: message.to_string()\n\t\t}\n\t}\n}\n\n#[cfg(feature = \"errorlog\")]\nfn errorlog\u003cE: Display\u003e(e: E) {\n\terror!(\"The handler encountered an error: {}\", e);\n}\n\n#[cfg(not(feature = \"errorlog\"))]\nfn errorlog\u003cE\u003e(_e: E) {}\n\nfn handle_error\u003cE\u003e(e: E) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, E::Err\u003e\u003e + Send\u003e\u003e\nwhere\n\tE: Display + IntoResponseError\n{\n\tlet msg = e.to_string();\n\tlet res = e.into_response_error();\n\tmatch \u0026res {\n\t\tOk(res) if res.status.is_server_error() =\u003e errorlog(msg),\n\t\tErr(err) =\u003e {\n\t\t\terrorlog(msg);\n\t\t\terrorlog(\u0026err);\n\t\t},\n\t\t_ =\u003e {}\n\t};\n\tfuture::ready(res).boxed()\n}\n\nimpl\u003cRes\u003e IntoResponse for Pin\u003cBox\u003cdyn Future\u003cOutput = Res\u003e + Send\u003e\u003e\nwhere\n\tRes: IntoResponse + 'static\n{\n\ttype Err = Res::Err;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, Self::Err\u003e\u003e + Send\u003e\u003e {\n\t\tself.then(IntoResponse::into_response).boxed()\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tRes::accepted_types()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cRes\u003e ResponseSchema for Pin\u003cBox\u003cdyn Future\u003cOutput = Res\u003e + Send\u003e\u003e\nwhere\n\tRes: ResponseSchema\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tRes::status_codes()\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tRes::schema(code)\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Deserialize, Serialize)]\n\t#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\n\tstruct Msg {\n\t\tmsg: String\n\t}\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn result_from_future() {\n\t\tlet nc = NoContent::default();\n\t\tlet res = block_on(nc.into_response()).unwrap();\n\n\t\tlet fut_nc = async move { NoContent::default() }.boxed();\n\t\tlet fut_res = block_on(fut_nc.into_response()).unwrap();\n\n\t\tassert_eq!(res.status, fut_res.status);\n\t\tassert_eq!(res.mime, fut_res.mime);\n\t\tassert_eq!(res.full_body().unwrap(), fut_res.full_body().unwrap());\n\t}\n}\n","traces":[{"line":49,"address":[2211776],"length":1,"stats":{"Line":3},"fn_name":"or_all_types"},{"line":50,"address":[2211788],"length":1,"stats":{"Line":9},"fn_name":null},{"line":66,"address":[2370352,2370679,2371094,2370768],"length":1,"stats":{"Line":8},"fn_name":"new\u003chyper::body::body::Body\u003e"},{"line":69,"address":[2370859,2370405],"length":1,"stats":{"Line":9},"fn_name":null},{"line":71,"address":[2370952,2370531],"length":1,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[2371184,2371479],"length":1,"stats":{"Line":2},"fn_name":"json\u003calloc::string::String\u003e"},{"line":80,"address":[2371216],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[2371258],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[2371342],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[2371693,2371520],"length":1,"stats":{"Line":2},"fn_name":"no_content"},{"line":91,"address":[2371537],"length":1,"stats":{"Line":2},"fn_name":null},{"line":93,"address":[2371556],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[2371917,2371744],"length":1,"stats":{"Line":0},"fn_name":"forbidden"},{"line":102,"address":[2371761],"length":1,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[2371780],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[2371968],"length":1,"stats":{"Line":1},"fn_name":"status"},{"line":110,"address":[2371973],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[2371984],"length":1,"stats":{"Line":1},"fn_name":"mime"},{"line":115,"address":[2371993],"length":1,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[2372032],"length":1,"stats":{"Line":2},"fn_name":"header"},{"line":120,"address":[2372052],"length":1,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[2372248,2372144],"length":1,"stats":{"Line":2},"fn_name":"with_headers"},{"line":124,"address":[2372177,2372268,2372307],"length":1,"stats":{"Line":4},"fn_name":null},{"line":125,"address":[2372339],"length":1,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[2372864],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":142,"address":[2372874],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[2283536],"length":1,"stats":{"Line":6},"fn_name":"accepted_types\u003cgotham_restful::response::redirect::Redirect\u003e"},{"line":157,"address":[2283539],"length":1,"stats":{"Line":6},"fn_name":null},{"line":165,"address":[2475648],"length":1,"stats":{"Line":4},"fn_name":"status_codes\u003cgotham_restful::response::success::Success\u003cgotham_restful::response::success::test::Msg\u003e\u003e"},{"line":166,"address":[2373006],"length":1,"stats":{"Line":4},"fn_name":null},{"line":204,"address":[2373056,2373159],"length":1,"stats":{"Line":2},"fn_name":"from\u003canyhow::Error\u003e"},{"line":207,"address":[2373085],"length":1,"stats":{"Line":2},"fn_name":null},{"line":213,"address":[2373200,2373970,2373548,2373600],"length":1,"stats":{"Line":1},"fn_name":"errorlog\u003c\u0026\u0026serde_json::error::Error\u003e"},{"line":214,"address":[2373719,2373319,2373612,2373212],"length":1,"stats":{"Line":2},"fn_name":null},{"line":220,"address":[2374656,2374476,2375756,2375296,2376396,2374016,2375936,2375116],"length":1,"stats":{"Line":1},"fn_name":"handle_error\u003cgotham_restful::response::redirect::test::MsgError\u003e"},{"line":224,"address":[2374065,2374705,2375345,2375985],"length":1,"stats":{"Line":1},"fn_name":null},{"line":225,"address":[2375360,2374080,2374720,2376000],"length":1,"stats":{"Line":1},"fn_name":null},{"line":226,"address":[2374138,2376259,2375619,2374339,2375418,2376058,2374778,2374979],"length":1,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[2376028,2374108,2375210,2375388,2375423,2374748,2375850,2376063,2376490,2374783,2374143,2374570],"length":1,"stats":{"Line":3},"fn_name":null},{"line":228,"address":[2376182,2374262,2375542,2374902],"length":1,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[2374275,2376195,2374915,2375555],"length":1,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[2375612,2374332,2374972,2376252],"length":1,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[2375621,2375943,2374663,2374341,2374981,2374023,2375303,2376261],"length":1,"stats":{"Line":2},"fn_name":null},{"line":243,"address":[1972048],"length":1,"stats":{"Line":1},"fn_name":"into_response\u003cgotham_restful::response::no_content::NoContent\u003e"},{"line":244,"address":[1972068],"length":1,"stats":{"Line":1},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":36,"coverable":51},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","no_content.rs"],"content":"use super::{handle_error, IntoResponse};\n#[cfg(feature = \"openapi\")]\nuse crate::ResponseSchema;\nuse crate::{IntoResponseError, Response};\nuse futures_util::{future, future::FutureExt};\nuse gotham::hyper::header::{HeaderMap, HeaderValue, IntoHeaderName};\n#[cfg(feature = \"openapi\")]\nuse gotham::hyper::StatusCode;\nuse mime::Mime;\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\nuse std::{fmt::Display, future::Future, pin::Pin};\n\n/**\nThis is the return type of a resource that doesn't actually return something. It will result\nin a _204 No Content_ answer by default. You don't need to use this type directly if using\nthe function attributes:\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# mod doc_tests_are_broken {\n# use gotham::state::State;\n# use gotham_restful::*;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n#[read_all]\nfn read_all() {\n\t// do something\n}\n# }\n```\n*/\n#[derive(Clone, Debug, Default)]\npub struct NoContent {\n\theaders: HeaderMap\n}\n\nimpl From\u003c()\u003e for NoContent {\n\tfn from(_: ()) -\u003e Self {\n\t\tSelf::default()\n\t}\n}\n\nimpl NoContent {\n\t/// Set a custom HTTP header. If a header with this name was set before, its value is being updated.\n\tpub fn header\u003cK: IntoHeaderName\u003e(\u0026mut self, name: K, value: HeaderValue) {\n\t\tself.headers.insert(name, value);\n\t}\n\n\t/// Allow manipulating HTTP headers.\n\tpub fn headers_mut(\u0026mut self) -\u003e \u0026mut HeaderMap {\n\t\t\u0026mut self.headers\n\t}\n}\n\nimpl IntoResponse for NoContent {\n\t// TODO this shouldn't be a serde_json::Error\n\ttype Err = serde_json::Error; // just for easier handling of `Result\u003cNoContent, E\u003e`\n\n\t/// This will always be a _204 No Content_ together with an empty string.\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, Self::Err\u003e\u003e + Send\u003e\u003e {\n\t\tfuture::ok(Response::no_content().with_headers(self.headers)).boxed()\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(Vec::new())\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl ResponseSchema for NoContent {\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::NO_CONTENT]\n\t}\n\n\t/// Returns the schema of the `()` type.\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::NO_CONTENT);\n\t\t\u003c()\u003e::schema()\n\t}\n}\n\nimpl\u003cE\u003e IntoResponse for Result\u003cNoContent, E\u003e\nwhere\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\ttype Err = serde_json::Error;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, serde_json::Error\u003e\u003e + Send\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(nc) =\u003e nc.into_response(),\n\t\t\tErr(e) =\u003e handle_error(e)\n\t\t}\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tNoContent::accepted_types()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cE\u003e ResponseSchema for Result\u003cNoContent, E\u003e\nwhere\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::NO_CONTENT);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::NO_CONTENT =\u003e \u003cNoContent as ResponseSchema\u003e::schema(StatusCode::NO_CONTENT),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse gotham::hyper::{header::ACCESS_CONTROL_ALLOW_ORIGIN, StatusCode};\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn no_content_has_empty_response() {\n\t\tlet no_content = NoContent::default();\n\t\tlet res = block_on(no_content.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::NO_CONTENT);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(NoContent::status_codes(), vec![StatusCode::NO_CONTENT]);\n\t}\n\n\t#[test]\n\tfn no_content_result() {\n\t\tlet no_content: Result\u003cNoContent, MsgError\u003e = Ok(NoContent::default());\n\t\tlet res = block_on(no_content.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::NO_CONTENT);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cResult\u003cNoContent, MsgError\u003e\u003e::status_codes(), vec![\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tStatusCode::NO_CONTENT\n\t\t]);\n\t}\n\n\t#[test]\n\tfn no_content_custom_headers() {\n\t\tlet mut no_content = NoContent::default();\n\t\tno_content.header(ACCESS_CONTROL_ALLOW_ORIGIN, HeaderValue::from_static(\"*\"));\n\t\tlet res = block_on(no_content.into_response()).expect(\"didn't expect error response\");\n\t\tlet cors = res.headers.get(ACCESS_CONTROL_ALLOW_ORIGIN);\n\t\tassert_eq!(cors.map(|value| value.to_str().unwrap()), Some(\"*\"));\n\t}\n}\n","traces":[{"line":42,"address":[4720688],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":43,"address":[4720700],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[4720720],"length":1,"stats":{"Line":0},"fn_name":"headers_mut"},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[2054832,2054608],"length":1,"stats":{"Line":2},"fn_name":"into_response"},{"line":65,"address":[4720748],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[4721040],"length":1,"stats":{"Line":4},"fn_name":"accepted_types"},{"line":69,"address":[4721053],"length":1,"stats":{"Line":4},"fn_name":null},{"line":75,"address":[2054960],"length":1,"stats":{"Line":2},"fn_name":"status_codes"},{"line":76,"address":[4721118],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[2055024],"length":1,"stats":{"Line":2},"fn_name":"schema"},{"line":82,"address":[2055166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[1970732,1970774],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[1970750,1970867],"length":1,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[1970896,1970955],"length":1,"stats":{"Line":1},"fn_name":"status_codes\u003cgotham_restful::response::no_content::test::MsgError\u003e"},{"line":110,"address":[1970913],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[1970928],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":16,"coverable":28},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","raw.rs"],"content":"use super::{handle_error, IntoResponse, IntoResponseError};\nuse crate::{types::ResourceType, FromBody, RequestBody, Response};\n#[cfg(feature = \"openapi\")]\nuse crate::{IntoResponseWithSchema, ResponseSchema};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\n\nuse futures_core::future::Future;\nuse futures_util::{future, future::FutureExt};\nuse gotham::hyper::{\n\tbody::{Body, Bytes},\n\tStatusCode\n};\nuse mime::Mime;\n#[cfg(feature = \"openapi\")]\nuse openapi_type::openapi::{SchemaKind, StringFormat, StringType, Type, VariantOrUnknownOrEmpty};\nuse serde_json::error::Error as SerdeJsonError;\nuse std::{convert::Infallible, fmt::Display, pin::Pin};\n\n/**\nThis type can be used both as a raw request body, as well as as a raw response. However, all types\nof request bodies are accepted by this type. It is therefore recommended to derive your own type\nfrom [RequestBody] and only use this when you need to return a raw response. This is a usage\nexample that simply returns its body:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n#[derive(Resource)]\n#[resource(create)]\nstruct ImageResource;\n\n#[create]\nfn create(body : Raw\u003cVec\u003cu8\u003e\u003e) -\u003e Raw\u003cVec\u003cu8\u003e\u003e {\n\tbody\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cImageResource\u003e(\"img\");\n# \t}));\n# }\n```\n*/\n#[derive(Debug)]\npub struct Raw\u003cT\u003e {\n\tpub raw: T,\n\tpub mime: Mime\n}\n\nimpl\u003cT\u003e Raw\u003cT\u003e {\n\tpub fn new(raw: T, mime: Mime) -\u003e Self {\n\t\tSelf { raw, mime }\n\t}\n}\n\nimpl\u003cT, U\u003e AsMut\u003cU\u003e for Raw\u003cT\u003e\nwhere\n\tT: AsMut\u003cU\u003e\n{\n\tfn as_mut(\u0026mut self) -\u003e \u0026mut U {\n\t\tself.raw.as_mut()\n\t}\n}\n\nimpl\u003cT, U\u003e AsRef\u003cU\u003e for Raw\u003cT\u003e\nwhere\n\tT: AsRef\u003cU\u003e\n{\n\tfn as_ref(\u0026self) -\u003e \u0026U {\n\t\tself.raw.as_ref()\n\t}\n}\n\nimpl\u003cT: Clone\u003e Clone for Raw\u003cT\u003e {\n\tfn clone(\u0026self) -\u003e Self {\n\t\tSelf {\n\t\t\traw: self.raw.clone(),\n\t\t\tmime: self.mime.clone()\n\t\t}\n\t}\n}\n\nimpl\u003cT: for\u003c'a\u003e From\u003c\u0026'a [u8]\u003e\u003e FromBody for Raw\u003cT\u003e {\n\ttype Err = Infallible;\n\n\tfn from_body(body: Bytes, mime: Mime) -\u003e Result\u003cSelf, Self::Err\u003e {\n\t\tOk(Self::new(body.as_ref().into(), mime))\n\t}\n}\n\nimpl\u003cT\u003e RequestBody for Raw\u003cT\u003e where Raw\u003cT\u003e: FromBody + ResourceType {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT\u003e OpenapiType for Raw\u003cT\u003e {\n\tfn schema() -\u003e OpenapiSchema {\n\t\tOpenapiSchema::new(SchemaKind::Type(Type::String(StringType {\n\t\t\tformat: VariantOrUnknownOrEmpty::Item(StringFormat::Binary),\n\t\t\t..Default::default()\n\t\t})))\n\t}\n}\n\nimpl\u003cT: Into\u003cBody\u003e\u003e IntoResponse for Raw\u003cT\u003e\nwhere\n\tSelf: Send\n{\n\ttype Err = SerdeJsonError; // just for easier handling of `Result\u003cRaw\u003cT\u003e, E\u003e`\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, SerdeJsonError\u003e\u003e + Send\u003e\u003e {\n\t\tfuture::ok(Response::new(StatusCode::OK, self.raw, Some(self.mime))).boxed()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT: Into\u003cBody\u003e\u003e ResponseSchema for Raw\u003cT\u003e\nwhere\n\tSelf: Send\n{\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::OK);\n\t\t\u003cSelf as OpenapiType\u003e::schema()\n\t}\n}\n\nimpl\u003cT, E\u003e IntoResponse for Result\u003cRaw\u003cT\u003e, E\u003e\nwhere\n\tRaw\u003cT\u003e: IntoResponse,\n\tE: Display + IntoResponseError\u003cErr = \u003cRaw\u003cT\u003e as IntoResponse\u003e::Err\u003e\n{\n\ttype Err = E::Err;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, E::Err\u003e\u003e + Send\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(raw) =\u003e raw.into_response(),\n\t\t\tErr(e) =\u003e handle_error(e)\n\t\t}\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT, E\u003e ResponseSchema for Result\u003cRaw\u003cT\u003e, E\u003e\nwhere\n\tRaw\u003cT\u003e: IntoResponseWithSchema,\n\tE: Display + IntoResponseError\u003cErr = \u003cRaw\u003cT\u003e as IntoResponse\u003e::Err\u003e\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::OK);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::OK =\u003e \u003cRaw\u003cT\u003e as ResponseSchema\u003e::schema(StatusCode::OK),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse mime::TEXT_PLAIN;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn raw_response() {\n\t\tlet msg = \"Test\";\n\t\tlet raw = Raw::new(msg, TEXT_PLAIN);\n\t\tlet res = block_on(raw.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(TEXT_PLAIN));\n\t\tassert_eq!(res.full_body().unwrap(), msg.as_bytes());\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cRaw\u003cString\u003e\u003e::status_codes(), vec![StatusCode::OK]);\n\t}\n\n\t#[test]\n\tfn raw_result() {\n\t\tlet msg = \"Test\";\n\t\tlet raw: Result\u003cRaw\u003c_\u003e, MsgError\u003e = Ok(Raw::new(msg, TEXT_PLAIN));\n\t\tlet res = block_on(raw.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(TEXT_PLAIN));\n\t\tassert_eq!(res.full_body().unwrap(), msg.as_bytes());\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cResult\u003cRaw\u003cString\u003e, MsgError\u003e\u003e::status_codes(), vec![\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tStatusCode::OK\n\t\t]);\n\t}\n}\n","traces":[{"line":52,"address":[3413904],"length":1,"stats":{"Line":7},"fn_name":"new\u003calloc::vec::Vec\u003cu8, alloc::alloc::Global\u003e\u003e"},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[2369697,2369248],"length":1,"stats":{"Line":3},"fn_name":"schema\u003c\u0026str\u003e"},{"line":97,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[2369265],"length":1,"stats":{"Line":3},"fn_name":null},{"line":99,"address":[2369303],"length":1,"stats":{"Line":3},"fn_name":null},{"line":110,"address":[2369776],"length":1,"stats":{"Line":5},"fn_name":"into_response\u003c\u0026str\u003e"},{"line":111,"address":[2439210],"length":1,"stats":{"Line":5},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":122,"address":[2370094],"length":1,"stats":{"Line":3},"fn_name":null},{"line":133,"address":[1970992],"length":1,"stats":{"Line":1},"fn_name":"into_response\u003c\u0026str,gotham_restful::response::raw::test::MsgError\u003e"},{"line":134,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[1971046,1971004],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[1971022,1971139],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[1971227,1971168],"length":1,"stats":{"Line":1},"fn_name":"status_codes\u003calloc::string::String,gotham_restful::response::raw::test::MsgError\u003e"},{"line":148,"address":[1971185],"length":1,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[1971200],"length":1,"stats":{"Line":1},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":17,"coverable":30},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","redirect.rs"],"content":"use super::{handle_error, IntoResponse};\nuse crate::{IntoResponseError, Response};\n#[cfg(feature = \"openapi\")]\nuse crate::{NoContent, ResponseSchema};\nuse futures_util::future::{BoxFuture, FutureExt, TryFutureExt};\nuse gotham::hyper::{\n\theader::{InvalidHeaderValue, LOCATION},\n\tBody, StatusCode\n};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiSchema;\nuse std::{\n\terror::Error as StdError,\n\tfmt::{Debug, Display}\n};\nuse thiserror::Error;\n\n/**\nThis is the return type of a resource that only returns a redirect. It will result\nin a _303 See Other_ answer, meaning the redirect will always result in a GET request\non the target.\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# mod doc_tests_are_broken {\n# use gotham::state::State;\n# use gotham_restful::*;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n#[read_all]\nfn read_all() -\u003e Redirect {\n\tRedirect {\n\t\tto: \"http://localhost:8080/cool/new/location\".to_owned()\n\t}\n}\n# }\n```\n*/\n#[derive(Clone, Debug, Default)]\npub struct Redirect {\n\tpub to: String\n}\n\nimpl IntoResponse for Redirect {\n\ttype Err = InvalidHeaderValue;\n\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e {\n\t\tasync move {\n\t\t\tlet mut res = Response::new(StatusCode::SEE_OTHER, Body::empty(), None);\n\t\t\tres.header(LOCATION, self.to.parse()?);\n\t\t\tOk(res)\n\t\t}\n\t\t.boxed()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl ResponseSchema for Redirect {\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::SEE_OTHER]\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::SEE_OTHER);\n\t\t\u003cNoContent as ResponseSchema\u003e::schema(StatusCode::NO_CONTENT)\n\t}\n}\n\n// private type due to parent mod\n#[derive(Debug, Error)]\npub enum RedirectError\u003cE: StdError + 'static\u003e {\n\t#[error(\"{0}\")]\n\tInvalidLocation(#[from] InvalidHeaderValue),\n\t#[error(\"{0}\")]\n\tOther(#[source] E)\n}\n\n#[allow(ambiguous_associated_items)] // an enum variant is not a type. never.\nimpl\u003cE\u003e IntoResponse for Result\u003cRedirect, E\u003e\nwhere\n\tE: Display + IntoResponseError,\n\t\u003cE as IntoResponseError\u003e::Err: StdError + Sync\n{\n\ttype Err = RedirectError\u003c\u003cE as IntoResponseError\u003e::Err\u003e;\n\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(nc) =\u003e nc.into_response().map_err(Into::into).boxed(),\n\t\t\tErr(e) =\u003e handle_error(e).map_err(RedirectError::Other).boxed()\n\t\t}\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cE\u003e ResponseSchema for Result\u003cRedirect, E\u003e\nwhere\n\tE: Display + IntoResponseError,\n\t\u003cE as IntoResponseError\u003e::Err: StdError + Sync\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::SEE_OTHER);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::SEE_OTHER =\u003e \u003cRedirect as ResponseSchema\u003e::schema(StatusCode::SEE_OTHER),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse gotham::hyper::StatusCode;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn redirect_response() {\n\t\tlet redir = Redirect {\n\t\t\tto: \"http://localhost/foo\".to_owned()\n\t\t};\n\t\tlet res = block_on(redir.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::SEE_OTHER);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(\n\t\t\tres.headers.get(LOCATION).map(|hdr| hdr.to_str().unwrap()),\n\t\t\tSome(\"http://localhost/foo\")\n\t\t);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(Redirect::status_codes(), vec![StatusCode::SEE_OTHER]);\n\t}\n\n\t#[test]\n\tfn redirect_result() {\n\t\tlet redir: Result\u003cRedirect, MsgError\u003e = Ok(Redirect {\n\t\t\tto: \"http://localhost/foo\".to_owned()\n\t\t});\n\t\tlet res = block_on(redir.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::SEE_OTHER);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(\n\t\t\tres.headers.get(LOCATION).map(|hdr| hdr.to_str().unwrap()),\n\t\t\tSome(\"http://localhost/foo\")\n\t\t);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cResult\u003cRedirect, MsgError\u003e\u003e::status_codes(), vec![\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tStatusCode::SEE_OTHER\n\t\t]);\n\t}\n}\n","traces":[{"line":50,"address":[2282240],"length":1,"stats":{"Line":1},"fn_name":"into_response"},{"line":51,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":52,"address":[4664866],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[4004551,4004096],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4004463],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[4665632],"length":1,"stats":{"Line":1},"fn_name":"status_codes"},{"line":63,"address":[4004814],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[4004864],"length":1,"stats":{"Line":0},"fn_name":"schema"},{"line":68,"address":[4005019],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[1971264],"length":1,"stats":{"Line":1},"fn_name":"into_response\u003cgotham_restful::response::redirect::test::MsgError\u003e"},{"line":90,"address":[1971495,1971567,1971312],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[1971276,1971319],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[1971659,1971600],"length":1,"stats":{"Line":1},"fn_name":"status_codes\u003cgotham_restful::response::redirect::test::MsgError\u003e"},{"line":104,"address":[1971617],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[1971632],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":13,"coverable":21},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","result.rs"],"content":"use super::{handle_error, IntoResponse, ResourceError};\n#[cfg(feature = \"openapi\")]\nuse crate::ResponseSchema;\nuse crate::{Response, ResponseBody, Success};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\n\nuse futures_core::future::Future;\nuse gotham::{anyhow::Error, hyper::StatusCode};\nuse mime::{Mime, APPLICATION_JSON};\nuse std::{fmt::Display, pin::Pin};\n\npub trait IntoResponseError {\n\ttype Err: Display + Send + 'static;\n\n\tfn into_response_error(self) -\u003e Result\u003cResponse, Self::Err\u003e;\n\n\t#[cfg(feature = \"openapi\")]\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e;\n\n\t#[cfg(feature = \"openapi\")]\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema;\n}\n\nimpl\u003cE\u003e IntoResponseError for E\nwhere\n\tE: Into\u003cError\u003e\n{\n\ttype Err = serde_json::Error;\n\n\tfn into_response_error(self) -\u003e Result\u003cResponse, Self::Err\u003e {\n\t\tlet err: Error = self.into();\n\t\tlet err: ResourceError = err.into();\n\t\tOk(Response::json(\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tserde_json::to_string(\u0026err)?\n\t\t))\n\t}\n\n\t#[cfg(feature = \"openapi\")]\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::INTERNAL_SERVER_ERROR]\n\t}\n\n\t#[cfg(feature = \"openapi\")]\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::INTERNAL_SERVER_ERROR);\n\t\tResourceError::schema()\n\t}\n}\n\nimpl\u003cR, E\u003e IntoResponse for Result\u003cR, E\u003e\nwhere\n\tR: ResponseBody,\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\ttype Err = E::Err;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, E::Err\u003e\u003e + Send\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(r) =\u003e Success::from(r).into_response(),\n\t\t\tErr(e) =\u003e handle_error(e)\n\t\t}\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(vec![APPLICATION_JSON])\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cR, E\u003e ResponseSchema for Result\u003cR, E\u003e\nwhere\n\tR: ResponseBody,\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::OK);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::OK =\u003e R::schema(),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse crate::response::OrAllTypes;\n\tuse futures_executor::block_on;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Deserialize, Serialize)]\n\t#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\n\tstruct Msg {\n\t\tmsg: String\n\t}\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn result_ok() {\n\t\tlet ok: Result\u003cMsg, MsgError\u003e = Ok(Msg::default());\n\t\tlet res = block_on(ok.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(APPLICATION_JSON));\n\t\tassert_eq!(res.full_body().unwrap(), br#\"{\"msg\":\"\"}\"#);\n\t}\n\n\t#[test]\n\tfn result_err() {\n\t\tlet err: Result\u003cMsg, MsgError\u003e = Err(MsgError::default());\n\t\tlet res = block_on(err.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::INTERNAL_SERVER_ERROR);\n\t\tassert_eq!(res.mime, Some(APPLICATION_JSON));\n\t\tassert_eq!(\n\t\t\tres.full_body().unwrap(),\n\t\t\tformat!(r#\"{{\"error\":true,\"message\":\"{}\"}}\"#, MsgError::default()).as_bytes()\n\t\t);\n\t}\n\n\t#[test]\n\tfn success_accepts_json() {\n\t\tassert!(\u003cResult\u003cMsg, MsgError\u003e\u003e::accepted_types()\n\t\t\t.or_all_types()\n\t\t\t.contains(\u0026APPLICATION_JSON))\n\t}\n}\n","traces":[{"line":31,"address":[2473296,2473650],"length":1,"stats":{"Line":2},"fn_name":"into_response_error\u003cgotham_restful::response::no_content::test::MsgError\u003e"},{"line":32,"address":[2416513,2416097],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[2473336],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[2416354,2416770,2416276,2416692],"length":1,"stats":{"Line":4},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[2416912],"length":1,"stats":{"Line":3},"fn_name":"status_codes\u003cgotham_restful::response::redirect::test::MsgError\u003e"},{"line":42,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[1971751,1971708],"length":1,"stats":{"Line":3},"fn_name":null},{"line":62,"address":[1971884,1971724],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[1971920],"length":1,"stats":{"Line":3},"fn_name":"accepted_types\u003cgotham_restful::response::result::test::Msg,gotham_restful::response::result::test::MsgError\u003e"},{"line":67,"address":[1971934],"length":1,"stats":{"Line":3},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":2},"fn_name":null}],"covered":19,"coverable":24},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","success.rs"],"content":"use super::IntoResponse;\n#[cfg(feature = \"openapi\")]\nuse crate::ResponseSchema;\nuse crate::{Response, ResponseBody};\nuse futures_util::future::{self, FutureExt};\nuse gotham::hyper::{\n\theader::{HeaderMap, HeaderValue, IntoHeaderName},\n\tStatusCode\n};\nuse mime::{Mime, APPLICATION_JSON};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiSchema;\nuse std::{fmt::Debug, future::Future, pin::Pin};\n\n/**\nThis can be returned from a resource when there is no cause of an error.\n\nUsage example:\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# mod doc_tests_are_broken {\n# use gotham::state::State;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n#[derive(Deserialize, Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct MyResponse {\n\tmessage: \u0026'static str\n}\n\n#[read_all]\nfn read_all() -\u003e Success\u003cMyResponse\u003e {\n\tlet res = MyResponse { message: \"I'm always happy\" };\n\tres.into()\n}\n# }\n```\n*/\n#[derive(Clone, Debug, Default)]\npub struct Success\u003cT\u003e {\n\tvalue: T,\n\theaders: HeaderMap\n}\n\nimpl\u003cT\u003e From\u003cT\u003e for Success\u003cT\u003e {\n\tfn from(t: T) -\u003e Self {\n\t\tSelf {\n\t\t\tvalue: t,\n\t\t\theaders: HeaderMap::new()\n\t\t}\n\t}\n}\n\nimpl\u003cT\u003e Success\u003cT\u003e {\n\t/// Set a custom HTTP header. If a header with this name was set before, its value is being updated.\n\tpub fn header\u003cK: IntoHeaderName\u003e(\u0026mut self, name: K, value: HeaderValue) {\n\t\tself.headers.insert(name, value);\n\t}\n\n\t/// Allow manipulating HTTP headers.\n\tpub fn headers_mut(\u0026mut self) -\u003e \u0026mut HeaderMap {\n\t\t\u0026mut self.headers\n\t}\n}\n\nimpl\u003cT: ResponseBody\u003e IntoResponse for Success\u003cT\u003e {\n\ttype Err = serde_json::Error;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, Self::Err\u003e\u003e + Send\u003e\u003e {\n\t\tlet res =\n\t\t\tserde_json::to_string(\u0026self.value).map(|body| Response::json(StatusCode::OK, body).with_headers(self.headers));\n\t\tfuture::ready(res).boxed()\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(vec![APPLICATION_JSON])\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT: ResponseBody\u003e ResponseSchema for Success\u003cT\u003e {\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::OK);\n\t\tT::schema()\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse crate::response::OrAllTypes;\n\tuse futures_executor::block_on;\n\tuse gotham::hyper::header::ACCESS_CONTROL_ALLOW_ORIGIN;\n\n\t#[derive(Debug, Default, Serialize)]\n\t#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\n\tstruct Msg {\n\t\tmsg: String\n\t}\n\n\t#[test]\n\tfn success_always_successfull() {\n\t\tlet success: Success\u003cMsg\u003e = Msg::default().into();\n\t\tlet res = block_on(success.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(APPLICATION_JSON));\n\t\tassert_eq!(res.full_body().unwrap(), br#\"{\"msg\":\"\"}\"#);\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cSuccess\u003cMsg\u003e\u003e::status_codes(), vec![StatusCode::OK]);\n\t}\n\n\t#[test]\n\tfn success_custom_headers() {\n\t\tlet mut success: Success\u003cMsg\u003e = Msg::default().into();\n\t\tsuccess.header(ACCESS_CONTROL_ALLOW_ORIGIN, HeaderValue::from_static(\"*\"));\n\t\tlet res = block_on(success.into_response()).expect(\"didn't expect error response\");\n\t\tlet cors = res.headers.get(ACCESS_CONTROL_ALLOW_ORIGIN);\n\t\tassert_eq!(cors.map(|value| value.to_str().unwrap()), Some(\"*\"));\n\t}\n\n\t#[test]\n\tfn success_accepts_json() {\n\t\tassert!(\u003cSuccess\u003cMsg\u003e\u003e::accepted_types().or_all_types().contains(\u0026APPLICATION_JSON))\n\t}\n}\n","traces":[{"line":52,"address":[3171742,3171648,3171792,3171913],"length":1,"stats":{"Line":3},"fn_name":"from\u003copenapi_specification::Secret\u003e"},{"line":55,"address":[2473809,2473969],"length":1,"stats":{"Line":3},"fn_name":null},{"line":62,"address":[2474096],"length":1,"stats":{"Line":1},"fn_name":"header\u003cgotham_restful::response::success::test::Msg,http::header::name::HeaderName\u003e"},{"line":63,"address":[2474116],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[3172229,3172304,3172589,3171952],"length":1,"stats":{"Line":2},"fn_name":"into_response\u003copenapi_specification::Secret\u003e"},{"line":76,"address":[2474247,2474912,2474933,2474599,2475237,2475216],"length":1,"stats":{"Line":9},"fn_name":"{{closure}}\u003cgotham_restful::response::result::test::Msg\u003e"},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[2474575,2474420,2474223,2474772],"length":1,"stats":{"Line":5},"fn_name":null},{"line":81,"address":[2475520],"length":1,"stats":{"Line":1},"fn_name":"accepted_types\u003cgotham_restful::response::success::test::Msg\u003e"},{"line":82,"address":[2475534],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":9,"coverable":14},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","routing.rs"],"content":"#[cfg(feature = \"openapi\")]\nuse crate::openapi::{\n\tbuilder::{OpenapiBuilder, OpenapiInfo},\n\trouter::OpenapiRouter\n};\nuse crate::{response::ResourceError, Endpoint, FromBody, IntoResponse, Resource, Response};\n#[cfg(feature = \"cors\")]\nuse gotham::router::route::matcher::AccessControlRequestMethodMatcher;\nuse gotham::{\n\thandler::HandlerError,\n\thelpers::http::response::{create_empty_response, create_response},\n\thyper::{body::to_bytes, header::CONTENT_TYPE, Body, HeaderMap, Method, StatusCode},\n\tpipeline::chain::PipelineHandleChain,\n\trouter::{\n\t\tbuilder::{DefineSingleRoute, DrawRoutes, RouterBuilder, ScopeBuilder},\n\t\tnon_match::RouteNonMatch,\n\t\troute::matcher::{AcceptHeaderRouteMatcher, ContentTypeHeaderRouteMatcher, RouteMatcher}\n\t},\n\tstate::{FromState, State}\n};\nuse mime::{Mime, APPLICATION_JSON};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse std::{any::TypeId, panic::RefUnwindSafe};\n\n/// Allow us to extract an id from a path.\n#[derive(Clone, Copy, Debug, Deserialize, StateData, StaticResponseExtender)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\npub struct PathExtractor\u003cID: RefUnwindSafe + Send + 'static\u003e {\n\tpub id: ID\n}\n\n/// This trait adds the `with_openapi` method to gotham's routing. It turns the default\n/// router into one that will only allow RESTful resources, but record them and generate\n/// an OpenAPI specification on request.\n#[cfg(feature = \"openapi\")]\npub trait WithOpenapi\u003cD\u003e {\n\tfn with_openapi\u003cF\u003e(\u0026mut self, info: OpenapiInfo, block: F)\n\twhere\n\t\tF: FnOnce(OpenapiRouter\u003c'_, D\u003e);\n}\n\n/// This trait adds the `resource` method to gotham's routing. It allows you to register\n/// any RESTful [Resource] with a path.\n#[_private_openapi_trait(DrawResourcesWithSchema)]\npub trait DrawResources {\n\t#[openapi_bound(\"R: crate::ResourceWithSchema\")]\n\t#[non_openapi_bound(\"R: crate::Resource\")]\n\tfn resource\u003cR\u003e(\u0026mut self, path: \u0026str);\n}\n\n/// This trait allows to draw routes within an resource. Use this only inside the\n/// [Resource::setup] method.\n#[_private_openapi_trait(DrawResourceRoutesWithSchema)]\npub trait DrawResourceRoutes {\n\t#[openapi_bound(\"E: crate::EndpointWithSchema\")]\n\t#[non_openapi_bound(\"E: crate::Endpoint\")]\n\tfn endpoint\u003cE: 'static\u003e(\u0026mut self);\n}\n\nfn response_from(res: Response, state: \u0026State) -\u003e gotham::hyper::Response\u003cBody\u003e {\n\tlet mut r = create_empty_response(state, res.status);\n\tlet headers = r.headers_mut();\n\tif let Some(mime) = res.mime {\n\t\theaders.insert(CONTENT_TYPE, mime.as_ref().parse().unwrap());\n\t}\n\tlet mut last_name = None;\n\tfor (name, value) in res.headers {\n\t\tif name.is_some() {\n\t\t\tlast_name = name;\n\t\t}\n\t\t// this unwrap is safe: the first item will always be Some\n\t\tlet name = last_name.clone().unwrap();\n\t\theaders.insert(name, value);\n\t}\n\n\tlet method = Method::borrow_from(state);\n\tif method != Method::HEAD {\n\t\t*r.body_mut() = res.body;\n\t}\n\n\t#[cfg(feature = \"cors\")]\n\tcrate::cors::handle_cors(state, \u0026mut r);\n\n\tr\n}\n\nasync fn endpoint_handler\u003cE: Endpoint\u003e(state: \u0026mut State) -\u003e Result\u003cgotham::hyper::Response\u003cBody\u003e, HandlerError\u003e\nwhere\n\tE: Endpoint,\n\t\u003cE::Output as IntoResponse\u003e::Err: Into\u003cHandlerError\u003e\n{\n\ttrace!(\"entering endpoint_handler\");\n\tlet placeholders = E::Placeholders::take_from(state);\n\t// workaround for E::Placeholders and E::Param being the same type\n\t// when fixed remove `Clone` requirement on endpoint\n\tif TypeId::of::\u003cE::Placeholders\u003e() == TypeId::of::\u003cE::Params\u003e() {\n\t\tstate.put(placeholders.clone());\n\t}\n\tlet params = E::Params::take_from(state);\n\n\tlet body = match E::needs_body() {\n\t\ttrue =\u003e {\n\t\t\tlet body = to_bytes(Body::take_from(state)).await?;\n\n\t\t\tlet content_type: Mime = match HeaderMap::borrow_from(state).get(CONTENT_TYPE) {\n\t\t\t\tSome(content_type) =\u003e content_type.to_str().unwrap().parse().unwrap(),\n\t\t\t\tNone =\u003e {\n\t\t\t\t\tdebug!(\"Missing Content-Type: Returning 415 Response\");\n\t\t\t\t\tlet res = create_empty_response(state, StatusCode::UNSUPPORTED_MEDIA_TYPE);\n\t\t\t\t\treturn Ok(res);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tmatch E::Body::from_body(body, content_type) {\n\t\t\t\tOk(body) =\u003e Some(body),\n\t\t\t\tErr(e) =\u003e {\n\t\t\t\t\tdebug!(\"Invalid Body: Returning 400 Response\");\n\t\t\t\t\tlet error: ResourceError = e.into();\n\t\t\t\t\tlet json = serde_json::to_string(\u0026error)?;\n\t\t\t\t\tlet res = create_response(state, StatusCode::BAD_REQUEST, APPLICATION_JSON, json);\n\t\t\t\t\treturn Ok(res);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tfalse =\u003e None\n\t};\n\n\tlet out = E::handle(state, placeholders, params, body).await;\n\tlet res = out.into_response().await.map_err(Into::into)?;\n\tdebug!(\"Returning response {:?}\", res);\n\tOk(response_from(res, state))\n}\n\n#[derive(Clone)]\nstruct MaybeMatchAcceptHeader {\n\tmatcher: Option\u003cAcceptHeaderRouteMatcher\u003e\n}\n\nimpl RouteMatcher for MaybeMatchAcceptHeader {\n\tfn is_match(\u0026self, state: \u0026State) -\u003e Result\u003c(), RouteNonMatch\u003e {\n\t\tmatch \u0026self.matcher {\n\t\t\tSome(matcher) =\u003e matcher.is_match(state),\n\t\t\tNone =\u003e Ok(())\n\t\t}\n\t}\n}\n\nimpl MaybeMatchAcceptHeader {\n\tfn new(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tlet types = match types {\n\t\t\tSome(types) if types.is_empty() =\u003e None,\n\t\t\ttypes =\u003e types\n\t\t};\n\t\tSelf {\n\t\t\tmatcher: types.map(AcceptHeaderRouteMatcher::new)\n\t\t}\n\t}\n}\n\nimpl From\u003cOption\u003cVec\u003cMime\u003e\u003e\u003e for MaybeMatchAcceptHeader {\n\tfn from(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tSelf::new(types)\n\t}\n}\n\n#[derive(Clone)]\nstruct MaybeMatchContentTypeHeader {\n\tmatcher: Option\u003cContentTypeHeaderRouteMatcher\u003e\n}\n\nimpl RouteMatcher for MaybeMatchContentTypeHeader {\n\tfn is_match(\u0026self, state: \u0026State) -\u003e Result\u003c(), RouteNonMatch\u003e {\n\t\tmatch \u0026self.matcher {\n\t\t\tSome(matcher) =\u003e matcher.is_match(state),\n\t\t\tNone =\u003e Ok(())\n\t\t}\n\t}\n}\n\nimpl MaybeMatchContentTypeHeader {\n\tfn new(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tSelf {\n\t\t\tmatcher: types.map(|types| ContentTypeHeaderRouteMatcher::new(types).allow_no_type())\n\t\t}\n\t}\n}\n\nimpl From\u003cOption\u003cVec\u003cMime\u003e\u003e\u003e for MaybeMatchContentTypeHeader {\n\tfn from(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tSelf::new(types)\n\t}\n}\n\nmacro_rules! implDrawResourceRoutes {\n\t($implType:ident) =\u003e {\n\t\t#[cfg(feature = \"openapi\")]\n\t\timpl\u003c'a, C, P\u003e WithOpenapi\u003cSelf\u003e for $implType\u003c'a, C, P\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn with_openapi\u003cF\u003e(\u0026mut self, info: OpenapiInfo, block: F)\n\t\t\twhere\n\t\t\t\tF: FnOnce(OpenapiRouter\u003c'_, $implType\u003c'a, C, P\u003e\u003e)\n\t\t\t{\n\t\t\t\tlet router = OpenapiRouter {\n\t\t\t\t\trouter: self,\n\t\t\t\t\tscope: None,\n\t\t\t\t\topenapi_builder: \u0026mut OpenapiBuilder::new(info)\n\t\t\t\t};\n\t\t\t\tblock(router);\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, C, P\u003e DrawResources for $implType\u003c'a, C, P\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn resource\u003cR: Resource\u003e(\u0026mut self, mut path: \u0026str) {\n\t\t\t\tif path.starts_with('/') {\n\t\t\t\t\tpath = \u0026path[1..];\n\t\t\t\t}\n\t\t\t\tR::setup((self, path));\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, C, P\u003e DrawResourceRoutes for (\u0026mut $implType\u003c'a, C, P\u003e, \u0026str)\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn endpoint\u003cE: Endpoint + 'static\u003e(\u0026mut self) {\n\t\t\t\tlet uri = format!(\"{}/{}\", self.1, E::uri());\n\t\t\t\tdebug!(\"Registering endpoint for {}\", uri);\n\t\t\t\tself.0.associate(\u0026uri, |assoc| {\n\t\t\t\t\tassoc\n\t\t\t\t\t\t.request(vec![E::http_method()])\n\t\t\t\t\t\t.add_route_matcher(MaybeMatchAcceptHeader::new(E::Output::accepted_types()))\n\t\t\t\t\t\t.with_path_extractor::\u003cE::Placeholders\u003e()\n\t\t\t\t\t\t.with_query_string_extractor::\u003cE::Params\u003e()\n\t\t\t\t\t\t.to_async_borrowing(endpoint_handler::\u003cE\u003e);\n\n\t\t\t\t\t#[cfg(feature = \"cors\")]\n\t\t\t\t\tif E::http_method() != Method::GET {\n\t\t\t\t\t\tassoc\n\t\t\t\t\t\t\t.options()\n\t\t\t\t\t\t\t.add_route_matcher(AccessControlRequestMethodMatcher::new(E::http_method()))\n\t\t\t\t\t\t\t.to(crate::cors::cors_preflight_handler);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n}\n\nimplDrawResourceRoutes!(RouterBuilder);\nimplDrawResourceRoutes!(ScopeBuilder);\n","traces":[{"line":61,"address":[2095200,2097120],"length":1,"stats":{"Line":5},"fn_name":"response_from"},{"line":62,"address":[4665947],"length":1,"stats":{"Line":5},"fn_name":null},{"line":63,"address":[4666073],"length":1,"stats":{"Line":5},"fn_name":null},{"line":64,"address":[4666115],"length":1,"stats":{"Line":5},"fn_name":null},{"line":65,"address":[2095541],"length":1,"stats":{"Line":4},"fn_name":null},{"line":67,"address":[2095756],"length":1,"stats":{"Line":5},"fn_name":null},{"line":68,"address":[2096001,2096761,2095764],"length":1,"stats":{"Line":5},"fn_name":null},{"line":69,"address":[2096496,2097192,2096395],"length":1,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[2097135,2096418],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[2096514],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[2096556],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[2096771],"length":1,"stats":{"Line":5},"fn_name":null},{"line":78,"address":[2096803,2096925,2097278],"length":1,"stats":{"Line":10},"fn_name":null},{"line":79,"address":[4667566,4667648,4667944,4668165],"length":1,"stats":{"Line":10},"fn_name":null},{"line":83,"address":[2096964],"length":1,"stats":{"Line":5},"fn_name":null},{"line":85,"address":[2096976],"length":1,"stats":{"Line":5},"fn_name":null},{"line":88,"address":[1913440,1913568,1949481,1913376,1913056,1925529,1913312,1913504,1919609,1913248,1937529,1913120,1955481,1961337,1913184,1913753,1931609,1943529],"length":1,"stats":{"Line":42},"fn_name":"endpoint_handler\u003casync_methods::search___gotham_restful_endpoint\u003e"},{"line":93,"address":[1931648,1943568,1925568,1949648,1925696,1943696,1955520,1949520,1913920,1961376,1955648,1961504,1919648,1931776,1919776,1913792,1937696,1937568],"length":1,"stats":{"Line":42},"fn_name":null},{"line":94,"address":[1937872,1943872,1931952,1925872,1914096,1919952,1949824,1955824,1961680],"length":1,"stats":{"Line":21},"fn_name":null},{"line":97,"address":[1955847,1961703,1961843,1926117,1938052,1932017,1944035,1944052,1914119,1920017,1961860,1925937,1914259,1949987,1914276,1926092,1937895,1932172,1949847,1956004,1955987,1920172,1932197,1943895,1938035,1920197,1950004],"length":1,"stats":{"Line":42},"fn_name":null},{"line":98,"address":[1926058,1955997,1944045,1920138,1955968,1961853,1949997,1920190,1926110,1932138,1932190,1938016,1938045,1961824,1949968,1944016,1914240,1914269],"length":1,"stats":{"Line":26},"fn_name":null},{"line":100,"address":[1926127,1961870,1914286,1932207,1944062,1920207,1950014,1956014,1938062],"length":1,"stats":{"Line":21},"fn_name":null},{"line":102,"address":[1915976,1938085,1944089,1921897,1914346,1932267,1944126,1926191,1938126,1950037,1957704,1961893,1961930,1926150,1963560,1939870,1945756,1914309,1950078,1956037,1920267,1956074,1933897,1951822,1920230,1927935,1932230],"length":1,"stats":{"Line":42},"fn_name":null},{"line":103,"address":[1956060,1920253,1961916,1926173,1938108,1950060,1944112,1932253,1914332],"length":1,"stats":{"Line":21},"fn_name":null},{"line":104,"address":[3050865,3052421,3054757,3053265,3051301,3054049,3051665,3054401,3052017],"length":1,"stats":{"Line":16},"fn_name":null},{"line":106,"address":[1920747,1915110,1944606,1950558,1950682,1932747,1926671,1950842,1956838,1933031,1944730,1926795,1914826,1914950,1920871,1921031,1926955,1932871,1938606,1944890,1956554,1956678,1962534,1962694,1938730,1938890,1962410],"length":1,"stats":{"Line":16},"fn_name":null},{"line":107,"address":[1932962,1944821,1956840,1962625,1926886,1915112,1944892,1921033,1938892,1938821,1920962,1926957,1950773,1915041,1956769,1962696,1933033,1950844],"length":1,"stats":{"Line":16},"fn_name":null},{"line":109,"address":[1915536,1963120,1951265,1933372,1927378,1920985,1921457,1926909,1945231,1927293,1915451,1945316,1915064,1939228,1944844,1921372,1951180,1939313,1956792,1932985,1933457,1957179,1950796,1957264,1962648,1963035,1938844],"length":1,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[1939489,1951441,1933633,1915712,1963296,1945492,1921633,1927554,1957440],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[1957520,1945572,1951521,1927634,1933713,1921713,1915792,1939569,1963376],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[1945066,1921887,1921791,1951676,1921207,1957598,1963550,1915870,1957694,1927131,1933887,1951018,1933791,1945746,1945650,1939066,1927789,1957014,1962870,1963454,1915286,1933207,1915966,1939724],"length":1,"stats":{"Line":8},"fn_name":null},{"line":116,"address":[1921799,1921889,1951591,1963552,1951678,1933889,1927791,1939639,1957606,1957696,1945658,1915968,1945748,1915878,1933799,1963462,1927704,1939726],"length":1,"stats":{"Line":16},"fn_name":null},{"line":117,"address":[1933820,1963483,1945679,1951606,1957627,1915899,1939654,1921820,1927719],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[1927743,1945846,1957794,1921844,1939678,1963507,1963650,1951630,1951827,1945761,1945703,1951912,1933902,1915981,1916066,1939875,1963565,1933987,1915923,1927940,1928025,1939960,1921987,1957651,1957709,1933844,1921902],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[1934155,1928193,1963818,1922155,1916234,1957962,1940128,1952080,1946014],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[1934511,1958009,1958318,1963865,1964174,1966242,1928240,1952436,1946370,1936575,1916281,1922202,1922511,1948470,1934202,1928549,1918658,1940175,1952127,1960386,1954528,1930653,1916590,1940484,1942576,1924575,1946061],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[1952261,1963999,1940309,1916415,1934336,1958143,1928374,1922336,1946195],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[1964268,1916684,1928643,1946464,1940578,1934605,1922605,1952530,1958412],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[1914338,1950066,1944118,1932259,1956066,1920259,1961922,1926179,1938114],"length":1,"stats":{"Line":13},"fn_name":null},{"line":129,"address":[1928885,1934686,1954820,1942549,1918950,1964474,1924867,1948443,1952611,1954501,1942868,1934815,1930626,1960678,1946702,1952768,1936867,1958618,1918631,1966534,1922815,1916890,1930945,1936548,1964349,1958493,1946545,1922686,1960359,1940816,1928724,1940659,1916765,1948812,1966215,1924548],"length":1,"stats":{"Line":43},"fn_name":null},{"line":130,"address":[1941408,1923182,1965066,1929874,1935798,1924888,1942889,1964841,1936511,1959607,1960322,1923798,1917879,1917482,1953360,1947691,1959210,1918971,1930966,1917257,1929477,1935182,1958985,1960699,1930589,1935407,1966555,1947294,1924511,1947069,1948406,1953135,1954464,1953751,1918594,1941183,1941799,1948833,1929252,1954841,1923407,1965463,1942512,1966178,1936888],"length":1,"stats":{"Line":42},"fn_name":null},{"line":131,"address":[1929978,1923978,1947648,1965420,1965567,1918059,1953931,1965643,1947795,1923755,1923902,1929831,1930054,1917836,1953855,1947871,1935755,1941756,1941979,1917983,1935902,1959564,1959711,1941903,1959787,1935978,1953708],"length":1,"stats":{"Line":42},"fn_name":null},{"line":132,"address":[1942226,1948118,1960034,1936225,1965890,1954178,1930301,1924225,1918306],"length":1,"stats":{"Line":21},"fn_name":null},{"line":141,"address":[2098000],"length":1,"stats":{"Line":6},"fn_name":"is_match"},{"line":142,"address":[2098028,2098063],"length":1,"stats":{"Line":12},"fn_name":null},{"line":143,"address":[2098036,2098081],"length":1,"stats":{"Line":6},"fn_name":null},{"line":144,"address":[2098059],"length":1,"stats":{"Line":6},"fn_name":null},{"line":150,"address":[2098112,2098435],"length":1,"stats":{"Line":7},"fn_name":"new"},{"line":151,"address":[2098264,2098134],"length":1,"stats":{"Line":12},"fn_name":null},{"line":152,"address":[2098166,2098271],"length":1,"stats":{"Line":10},"fn_name":null},{"line":153,"address":[2098192],"length":1,"stats":{"Line":5},"fn_name":null},{"line":156,"address":[2098357],"length":1,"stats":{"Line":7},"fn_name":null},{"line":162,"address":[2098560],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":163,"address":[2098572],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[2098624],"length":1,"stats":{"Line":0},"fn_name":"is_match"},{"line":174,"address":[2098652,2098686],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[2098704,2098660],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[2098682],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[2098736],"length":1,"stats":{"Line":0},"fn_name":"new"},{"line":184,"address":[2098832,2098849,2098749],"length":1,"stats":{"Line":0},"fn_name":"{{closure}}"},{"line":190,"address":[2098928],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":191,"address":[2098940],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[3366752,3367039],"length":1,"stats":{"Line":2},"fn_name":"with_openapi\u003c(),(),closure-0\u003e"},{"line":207,"address":[3366772,3366886],"length":1,"stats":{"Line":4},"fn_name":null},{"line":209,"address":[3366788],"length":1,"stats":{"Line":2},"fn_name":null},{"line":210,"address":[3366797],"length":1,"stats":{"Line":2},"fn_name":null},{"line":212,"address":[3366921],"length":1,"stats":{"Line":2},"fn_name":null},{"line":221,"address":[3134048],"length":1,"stats":{"Line":5},"fn_name":"resource\u003c(),(),async_methods::FooResource\u003e"},{"line":222,"address":[3134155,3134072],"length":1,"stats":{"Line":8},"fn_name":null},{"line":223,"address":[3134166,3134107],"length":1,"stats":{"Line":4},"fn_name":null},{"line":225,"address":[3134181],"length":1,"stats":{"Line":5},"fn_name":null},{"line":234,"address":[3148304,3151232,3149185,3155041,3151137,3156993,3155136,3152208,3156017,3150256,3153089,3154065,3154160,3152113,3156112,3150161,3153184,3149280],"length":1,"stats":{"Line":30},"fn_name":"endpoint\u003c(),(),async_methods::delete___gotham_restful_endpoint\u003e"},{"line":235,"address":[3155159,3149303,3156135,3148327,3153059,3151107,3152083,3150279,3152231,3154035,3155987,3150131,3149155,3154183,3156963,3155011,3153207,3151255],"length":1,"stats":{"Line":30},"fn_name":null},{"line":236,"address":[3156607,3152703,3154539,3154655,3152587,3153679,3155515,3155631,3148683,3148799,3156491,3149775,3149659,3150635,3153563,3150751,3151611,3151727],"length":1,"stats":{"Line":60},"fn_name":null},{"line":237,"address":[1910176,1907296,1908555,1911435,1908016,1910715,1909456,1907115,1912875,1912155,1909995,1912336,1906576,1911616,1909275,1910896,1908736,1907835],"length":1,"stats":{"Line":60},"fn_name":"{{closure}}\u003c(),(),async_methods::delete___gotham_restful_endpoint\u003e"},{"line":238,"address":[1908958,1906596,1912605,1912487,1907565,1910327,1907447,1909607,1909476,1908238,1911767,1907316,1908036,1908756,1906798,1911047,1906845,1908285,1911838,1906727,1911165,1907518,1911885,1909725,1910445,1910398,1910916,1911118,1912558,1910196,1911636,1909678,1912356,1908167,1908887,1909005],"length":1,"stats":{"Line":120},"fn_name":null},{"line":239,"address":[1907184,1908782,1910942,1907904,1908624,1908062,1910784,1910064,1910348,1906748,1908908,1912224,1909344,1909628,1906622,1911662,1911504,1912382,1912944,1909502,1911068,1907468,1908188,1910222,1907342,1911788,1912508],"length":1,"stats":{"Line":60},"fn_name":null},{"line":240,"address":[1909717,1911477,1908597,1911084,1911804,1910037,1912197,1912524,1910364,1907557,1907877,1911877,1908277,1908997,1912597,1907157,1909317,1909644,1907484,1911157,1906764,1906837,1910437,1908924,1910757,1912917,1908204],"length":1,"stats":{"Line":60},"fn_name":null},{"line":246,"address":[1912861,1911934,1907091,1909971,1912851,1907707,1912131,1906894,1907821,1909251,1907811,1908334,1910587,1912141,1911421,1908427,1912654,1907614,1909054,1908531,1910701,1908541,1911307,1912747,1912027,1909867,1909261,1910494,1909147,1910691,1911214,1911411,1909981,1909774,1906987,1907101],"length":1,"stats":{"Line":60},"fn_name":null},{"line":247,"address":[1911398,1908518,1912071,1906964,1908404,1910678,1912118,1912838,1908471,1911351,1907684,1907751,1909958,1912004,1910564,1910631,1911284,1909844,1912791,1907078,1909124,1909911,1909238,1907031,1909191,1912724,1907798],"length":1,"stats":{"Line":45},"fn_name":null},{"line":249,"address":[1912170,1908437,1912830,1912890,1909877,1907790,1910730,1910597,1908510,1911390,1912037,1911317,1912757,1907717,1909157,1909290,1909950,1907130,1906997,1910010,1911450,1909230,1912110,1907850,1908570,1910670,1907070],"length":1,"stats":{"Line":30},"fn_name":null}],"covered":58,"coverable":81},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","types.rs"],"content":"use gotham::hyper::body::Bytes;\nuse mime::{Mime, APPLICATION_JSON};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse serde::{de::DeserializeOwned, Serialize};\nuse std::error::Error;\n\n#[cfg(not(feature = \"openapi\"))]\npub trait ResourceType {}\n\n#[cfg(not(feature = \"openapi\"))]\nimpl\u003cT\u003e ResourceType for T {}\n\n#[cfg(feature = \"openapi\")]\npub trait ResourceType: OpenapiType {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT: OpenapiType\u003e ResourceType for T {}\n\n/// A type that can be used inside a response body. Implemented for every type that is\n/// serializable with serde. If the `openapi` feature is used, it must also be of type\n/// [OpenapiType].\n///\n///  [OpenapiType]: trait.OpenapiType.html\npub trait ResponseBody: ResourceType + Serialize {}\n\nimpl\u003cT: ResourceType + Serialize\u003e ResponseBody for T {}\n\n/**\nThis trait should be implemented for every type that can be built from an HTTP request body\nplus its media type.\n\nFor most use cases it is sufficient to derive this trait, you usually don't need to manually\nimplement this. Therefore, make sure that the first variable of your struct can be built from\n[Bytes], and the second one can be build from [Mime]. If you have any additional variables, they\nneed to be [Default]. This is an example of such a struct:\n\n```rust\n# #[macro_use] extern crate gotham_restful;\n# use gotham_restful::*;\n#[derive(FromBody, RequestBody)]\n#[supported_types(mime::IMAGE_GIF, mime::IMAGE_JPEG, mime::IMAGE_PNG)]\nstruct RawImage {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n```\n*/\npub trait FromBody: Sized {\n\t/// The error type returned by the conversion if it was unsuccessfull. When using the derive\n\t/// macro, there is no way to trigger an error, so [std::convert::Infallible] is used here.\n\t/// However, this might change in the future.\n\ttype Err: Error;\n\n\t/// Perform the conversion.\n\tfn from_body(body: Bytes, content_type: Mime) -\u003e Result\u003cSelf, Self::Err\u003e;\n}\n\nimpl\u003cT: DeserializeOwned\u003e FromBody for T {\n\ttype Err = serde_json::Error;\n\n\tfn from_body(body: Bytes, _content_type: Mime) -\u003e Result\u003cSelf, Self::Err\u003e {\n\t\tserde_json::from_slice(\u0026body)\n\t}\n}\n\n/**\nA type that can be used inside a request body. Implemented for every type that is deserializable\nwith serde. If the `openapi` feature is used, it must also be of type [OpenapiType].\n\nIf you want a non-deserializable type to be used as a request body, e.g. because you'd like to\nget the raw data, you can derive it for your own type. All you need is to have a type implementing\n[FromBody] and optionally a list of supported media types:\n\n```rust\n# #[macro_use] extern crate gotham_restful;\n# use gotham_restful::*;\n#[derive(FromBody, RequestBody)]\n#[supported_types(mime::IMAGE_GIF, mime::IMAGE_JPEG, mime::IMAGE_PNG)]\nstruct RawImage {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n```\n\n [OpenapiType]: trait.OpenapiType.html\n*/\npub trait RequestBody: ResourceType + FromBody {\n\t/// Return all types that are supported as content types. Use `None` if all types are supported.\n\tfn supported_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tNone\n\t}\n}\n\nimpl\u003cT: ResourceType + DeserializeOwned\u003e RequestBody for T {\n\tfn supported_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(vec![APPLICATION_JSON])\n\t}\n}\n","traces":[{"line":62,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[2558942],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":4,"coverable":6},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","async_methods.rs"],"content":"#[macro_use]\nextern crate gotham_derive;\n\nuse gotham::{\n\thyper::{HeaderMap, Method},\n\trouter::builder::*,\n\tstate::State,\n\ttest::TestServer\n};\nuse gotham_restful::*;\nuse mime::{APPLICATION_JSON, TEXT_PLAIN};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse serde::Deserialize;\nuse tokio::time::{sleep, Duration};\n\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::{test_delete_response, test_get_response, test_post_response, test_put_response};\n\n#[derive(Resource)]\n#[resource(read_all, read, search, create, update_all, update, delete_all, delete, state_test)]\nstruct FooResource;\n\n#[derive(Deserialize)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooBody {\n\tdata: String\n}\n\n#[derive(Clone, Deserialize, StateData, StaticResponseExtender)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooSearch {\n\tquery: String\n}\n\nconst READ_ALL_RESPONSE: \u0026[u8] = b\"1ARwwSPVyOKpJKrYwqGgECPVWDl1BqajAAj7g7WJ3e\";\n#[read_all]\nasync fn read_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst READ_RESPONSE: \u0026[u8] = b\"FEReHoeBKU17X2bBpVAd1iUvktFL43CDu0cFYHdaP9\";\n#[read]\nasync fn read(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_RESPONSE, TEXT_PLAIN)\n}\n\nconst SEARCH_RESPONSE: \u0026[u8] = b\"AWqcQUdBRHXKh3at4u79mdupOAfEbnTcx71ogCVF0E\";\n#[search]\nasync fn search(_body: FooSearch) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(SEARCH_RESPONSE, TEXT_PLAIN)\n}\n\nconst CREATE_RESPONSE: \u0026[u8] = b\"y6POY7wOMAB0jBRBw0FJT7DOpUNbhmT8KdpQPLkI83\";\n#[create]\nasync fn create(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(CREATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_ALL_RESPONSE: \u0026[u8] = b\"QlbYg8gHE9OQvvk3yKjXJLTSXlIrg9mcqhfMXJmQkv\";\n#[update_all]\nasync fn update_all(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_RESPONSE: \u0026[u8] = b\"qGod55RUXkT1lgPO8h0uVM6l368O2S0GrwENZFFuRu\";\n#[update]\nasync fn update(_id: u64, _body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_ALL_RESPONSE: \u0026[u8] = b\"Y36kZ749MRk2Nem4BedJABOZiZWPLOtiwLfJlGTwm5\";\n#[delete_all]\nasync fn delete_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_RESPONSE: \u0026[u8] = b\"CwRzBrKErsVZ1N7yeNfjZuUn1MacvgBqk4uPOFfDDq\";\n#[delete]\nasync fn delete(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_RESPONSE, TEXT_PLAIN)\n}\n\nconst STATE_TEST_RESPONSE: \u0026[u8] = b\"xxJbxOuwioqR5DfzPuVqvaqRSfpdNQGluIvHU4n1LM\";\n#[endpoint(method = \"Method::GET\", uri = \"state_test\")]\nasync fn state_test(state: \u0026mut State) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tsleep(Duration::from_nanos(1)).await;\n\tstate.borrow::\u003cHeaderMap\u003e();\n\tsleep(Duration::from_nanos(1)).await;\n\tRaw::new(STATE_TEST_RESPONSE, TEXT_PLAIN)\n}\n\n#[test]\nfn async_methods() {\n\tlet _ = pretty_env_logger::try_init_timed();\n\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.resource::\u003cFooResource\u003e(\"foo\");\n\t}))\n\t.unwrap();\n\n\ttest_get_response(\u0026server, \"http://localhost/foo\", READ_ALL_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/1\", READ_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/search?query=hello+world\", SEARCH_RESPONSE);\n\ttest_post_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tCREATE_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_ALL_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo/1\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_RESPONSE\n\t);\n\ttest_delete_response(\u0026server, \"http://localhost/foo\", DELETE_ALL_RESPONSE);\n\ttest_delete_response(\u0026server, \"http://localhost/foo/1\", DELETE_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/state_test\", STATE_TEST_RESPONSE);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","cors_handling.rs"],"content":"#![cfg(feature = \"cors\")]\nuse gotham::{\n\thyper::{body::Body, client::connect::Connect, header::*, StatusCode},\n\tpipeline::{new_pipeline, single::single_pipeline},\n\trouter::builder::*,\n\ttest::{Server, TestRequest, TestServer}\n};\nuse gotham_restful::{\n\tcors::{Headers, Origin},\n\tread_all, update_all, CorsConfig, DrawResources, Raw, Resource\n};\nuse mime::TEXT_PLAIN;\n\n#[derive(Resource)]\n#[resource(read_all, update_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() {}\n\n#[update_all]\nfn update_all(_body: Raw\u003cVec\u003cu8\u003e\u003e) {}\n\nfn test_server(cfg: CorsConfig) -\u003e TestServer {\n\tlet (chain, pipeline) = single_pipeline(new_pipeline().add(cfg).build());\n\tTestServer::new(build_router(chain, pipeline, |router| router.resource::\u003cFooResource\u003e(\"/foo\"))).unwrap()\n}\n\nfn test_response\u003cTS, C\u003e(req: TestRequest\u003cTS, C\u003e, origin: Option\u003c\u0026str\u003e, vary: Option\u003c\u0026str\u003e, credentials: bool)\nwhere\n\tTS: Server + 'static,\n\tC: Connect + Clone + Send + Sync + 'static\n{\n\tlet res = req\n\t\t.with_header(ORIGIN, \"http://example.org\".parse().unwrap())\n\t\t.perform()\n\t\t.unwrap();\n\tassert_eq!(res.status(), StatusCode::NO_CONTENT);\n\tlet headers = res.headers();\n\tprintln!(\"{}\", headers.keys().map(|name| name.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\",\"));\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_ORIGIN)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.as_deref(),\n\t\torigin\n\t);\n\tassert_eq!(headers.get(VARY).and_then(|value| value.to_str().ok()).as_deref(), vary);\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_CREDENTIALS)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.map(|value| value == \"true\")\n\t\t\t.unwrap_or(false),\n\t\tcredentials\n\t);\n\tassert!(headers.get(ACCESS_CONTROL_MAX_AGE).is_none());\n}\n\nfn test_preflight(server: \u0026TestServer, method: \u0026str, origin: Option\u003c\u0026str\u003e, vary: \u0026str, credentials: bool, max_age: u64) {\n\tlet res = server\n\t\t.client()\n\t\t.options(\"http://example.org/foo\")\n\t\t.with_header(ACCESS_CONTROL_REQUEST_METHOD, method.parse().unwrap())\n\t\t.with_header(ORIGIN, \"http://example.org\".parse().unwrap())\n\t\t.perform()\n\t\t.unwrap();\n\tassert_eq!(res.status(), StatusCode::NO_CONTENT);\n\tlet headers = res.headers();\n\tprintln!(\"{}\", headers.keys().map(|name| name.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\",\"));\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_METHODS)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.as_deref(),\n\t\tSome(method)\n\t);\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_ORIGIN)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.as_deref(),\n\t\torigin\n\t);\n\tassert_eq!(headers.get(VARY).and_then(|value| value.to_str().ok()).as_deref(), Some(vary));\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_CREDENTIALS)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.map(|value| value == \"true\")\n\t\t\t.unwrap_or(false),\n\t\tcredentials\n\t);\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_MAX_AGE)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.and_then(|value| value.parse().ok()),\n\t\tSome(max_age)\n\t);\n}\n\nfn test_preflight_headers(\n\tserver: \u0026TestServer,\n\tmethod: \u0026str,\n\trequest_headers: Option\u003c\u0026str\u003e,\n\tallowed_headers: Option\u003c\u0026str\u003e,\n\tvary: \u0026str\n) {\n\tlet client = server.client();\n\tlet mut res = client\n\t\t.options(\"http://example.org/foo\")\n\t\t.with_header(ACCESS_CONTROL_REQUEST_METHOD, method.parse().unwrap())\n\t\t.with_header(ORIGIN, \"http://example.org\".parse().unwrap());\n\tif let Some(hdr) = request_headers {\n\t\tres = res.with_header(ACCESS_CONTROL_REQUEST_HEADERS, hdr.parse().unwrap());\n\t}\n\tlet res = res.perform().unwrap();\n\tassert_eq!(res.status(), StatusCode::NO_CONTENT);\n\tlet headers = res.headers();\n\tprintln!(\"{}\", headers.keys().map(|name| name.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\",\"));\n\tif let Some(hdr) = allowed_headers {\n\t\tassert_eq!(\n\t\t\theaders\n\t\t\t\t.get(ACCESS_CONTROL_ALLOW_HEADERS)\n\t\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t\t.as_deref(),\n\t\t\tSome(hdr)\n\t\t)\n\t} else {\n\t\tassert!(!headers.contains_key(ACCESS_CONTROL_ALLOW_HEADERS));\n\t}\n\tassert_eq!(headers.get(VARY).and_then(|value| value.to_str().ok()).as_deref(), Some(vary));\n}\n\n#[test]\nfn cors_origin_none() {\n\tlet cfg = Default::default();\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", None, \"access-control-request-method\", false, 0);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), None, None, false);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tNone,\n\t\tNone,\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_origin_star() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::Star,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", Some(\"*\"), \"access-control-request-method\", false, 0);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), Some(\"*\"), None, false);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tSome(\"*\"),\n\t\tNone,\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_origin_single() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::Single(\"https://foo.com\".to_owned()),\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"https://foo.com\"),\n\t\t\"access-control-request-method\",\n\t\tfalse,\n\t\t0\n\t);\n\n\ttest_response(\n\t\tserver.client().get(\"http://example.org/foo\"),\n\t\tSome(\"https://foo.com\"),\n\t\tNone,\n\t\tfalse\n\t);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tSome(\"https://foo.com\"),\n\t\tNone,\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_origin_copy() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::Copy,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"http://example.org\"),\n\t\t\"access-control-request-method,origin\",\n\t\tfalse,\n\t\t0\n\t);\n\n\ttest_response(\n\t\tserver.client().get(\"http://example.org/foo\"),\n\t\tSome(\"http://example.org\"),\n\t\tSome(\"origin\"),\n\t\tfalse\n\t);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tSome(\"http://example.org\"),\n\t\tSome(\"origin\"),\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_headers_none() {\n\tlet cfg = Default::default();\n\tlet server = test_server(cfg);\n\n\ttest_preflight_headers(\u0026server, \"PUT\", None, None, \"access-control-request-method\");\n\ttest_preflight_headers(\u0026server, \"PUT\", Some(\"Content-Type\"), None, \"access-control-request-method\");\n}\n\n#[test]\nfn cors_headers_list() {\n\tlet cfg = CorsConfig {\n\t\theaders: Headers::List(vec![CONTENT_TYPE]),\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight_headers(\u0026server, \"PUT\", None, Some(\"content-type\"), \"access-control-request-method\");\n\ttest_preflight_headers(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"content-type\"),\n\t\tSome(\"content-type\"),\n\t\t\"access-control-request-method\"\n\t);\n}\n\n#[test]\nfn cors_headers_copy() {\n\tlet cfg = CorsConfig {\n\t\theaders: Headers::Copy,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight_headers(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tNone,\n\t\tNone,\n\t\t\"access-control-request-method,access-control-request-headers\"\n\t);\n\ttest_preflight_headers(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"content-type\"),\n\t\tSome(\"content-type\"),\n\t\t\"access-control-request-method,access-control-request-headers\"\n\t);\n}\n\n#[test]\nfn cors_credentials() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::None,\n\t\tcredentials: true,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", None, \"access-control-request-method\", true, 0);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), None, None, true);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tNone,\n\t\tNone,\n\t\ttrue\n\t);\n}\n\n#[test]\nfn cors_max_age() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::None,\n\t\tmax_age: 31536000,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", None, \"access-control-request-method\", false, 31536000);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), None, None, false);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tNone,\n\t\tNone,\n\t\tfalse\n\t);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","custom_request_body.rs"],"content":"use gotham::{hyper::header::CONTENT_TYPE, router::builder::*, test::TestServer};\nuse gotham_restful::*;\nuse mime::TEXT_PLAIN;\n\nconst RESPONSE: \u0026[u8] = b\"This is the only valid response.\";\n\n#[derive(Resource)]\n#[resource(create)]\nstruct FooResource;\n\n#[derive(FromBody, RequestBody)]\n#[supported_types(TEXT_PLAIN)]\nstruct Foo {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n\n#[create]\nfn create(body: Foo) -\u003e Raw\u003cVec\u003cu8\u003e\u003e {\n\tRaw::new(body.content, body.content_type)\n}\n\n#[test]\nfn custom_request_body() {\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.resource::\u003cFooResource\u003e(\"foo\");\n\t}))\n\t.unwrap();\n\n\tlet res = server\n\t\t.client()\n\t\t.post(\"http://localhost/foo\", RESPONSE, TEXT_PLAIN)\n\t\t.perform()\n\t\t.unwrap();\n\tassert_eq!(res.headers().get(CONTENT_TYPE).unwrap().to_str().unwrap(), \"text/plain\");\n\tlet res = res.read_body().unwrap();\n\tlet body: \u0026[u8] = res.as_ref();\n\tassert_eq!(body, RESPONSE);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","openapi_specification.rs"],"content":"#![cfg(all(feature = \"auth\", feature = \"openapi\"))]\n\n#[macro_use]\nextern crate gotham_derive;\n#[macro_use]\nextern crate pretty_assertions;\n\nuse gotham::{\n\thyper::Method,\n\tpipeline::{new_pipeline, single::single_pipeline},\n\trouter::builder::*,\n\ttest::TestServer\n};\nuse gotham_restful::*;\nuse mime::IMAGE_PNG;\nuse openapi_type::OpenapiType;\nuse serde::{Deserialize, Serialize};\n\n#[allow(dead_code)]\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::test_openapi_response;\n\nconst IMAGE_RESPONSE : \u0026[u8] = b\"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUA/wA0XsCoAAAAAXRSTlN/gFy0ywAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=\";\n\n#[derive(Resource)]\n#[resource(get_image, set_image)]\nstruct ImageResource;\n\n#[derive(FromBody, RequestBody)]\n#[supported_types(IMAGE_PNG)]\nstruct Image(Vec\u003cu8\u003e);\n\n#[read(operation_id = \"getImage\")]\nfn get_image(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(IMAGE_RESPONSE, \"image/png;base64\".parse().unwrap())\n}\n\n#[update(operation_id = \"setImage\")]\nfn set_image(_id: u64, _image: Image) {}\n\n#[derive(Resource)]\n#[resource(read_secret, search_secret)]\nstruct SecretResource;\n\n#[derive(Deserialize, Clone)]\nstruct AuthData {\n\tsub: String,\n\tiat: u64,\n\texp: u64\n}\n\ntype AuthStatus = gotham_restful::AuthStatus\u003cAuthData\u003e;\n\n#[derive(OpenapiType, Serialize)]\nstruct Secret {\n\tcode: f32\n}\n\n#[derive(OpenapiType, Serialize)]\nstruct Secrets {\n\tsecrets: Vec\u003cSecret\u003e\n}\n\n#[derive(Clone, Deserialize, OpenapiType, StateData, StaticResponseExtender)]\nstruct SecretQuery {\n\tdate: String,\n\thour: Option\u003cu16\u003e,\n\tminute: Option\u003cu16\u003e\n}\n\n/// This endpoint gives access to the secret.\n///\n/// You need to be authenticated to call this endpoint.\n#[read]\nfn read_secret(auth: AuthStatus, _id: String) -\u003e AuthSuccess\u003cSecret\u003e {\n\tauth.ok()?;\n\tOk(Secret { code: 4.2 })\n}\n\n#[search]\nfn search_secret(auth: AuthStatus, _query: SecretQuery) -\u003e AuthSuccess\u003cSecrets\u003e {\n\tauth.ok()?;\n\tOk(Secrets {\n\t\tsecrets: vec![Secret { code: 4.2 }, Secret { code: 3.14 }]\n\t})\n}\n\n#[derive(Resource)]\n#[resource(custom_read_with, custom_patch)]\nstruct CustomResource;\n\n#[derive(Clone, Deserialize, OpenapiType, StateData, StaticResponseExtender)]\nstruct ReadWithPath {\n\tfrom: String,\n\tid: u64\n}\n\n#[endpoint(method = \"Method::GET\", uri = \"read/:from/with/:id\")]\nfn custom_read_with(_path: ReadWithPath) {}\n\n#[endpoint(method = \"Method::PATCH\", uri = \"\", body = true)]\nfn custom_patch(_body: String) {}\n\n#[test]\nfn openapi_specification() {\n\tlet info = OpenapiInfo {\n\t\ttitle: \"This is just a test\".to_owned(),\n\t\tversion: \"1.2.3\".to_owned(),\n\t\turls: vec![\"http://localhost:12345/api/v1\".to_owned()]\n\t};\n\tlet auth: AuthMiddleware\u003cAuthData, _\u003e = AuthMiddleware::new(\n\t\tAuthSource::AuthorizationHeader,\n\t\tAuthValidation::default(),\n\t\tStaticAuthHandler::from_array(b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\")\n\t);\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(auth).build());\n\tlet server = TestServer::new(build_router(chain, pipelines, |router| {\n\t\trouter.with_openapi(info, |mut router| {\n\t\t\t// the leading slash tests that the spec doesn't contain '//img' nonsense\n\t\t\trouter.resource::\u003cImageResource\u003e(\"/img\");\n\t\t\trouter.resource::\u003cSecretResource\u003e(\"secret\");\n\t\t\trouter.resource::\u003cCustomResource\u003e(\"custom\");\n\t\t\trouter.openapi_spec(\"openapi\");\n\t\t});\n\t}))\n\t.unwrap();\n\n\ttest_openapi_response(\u0026server, \"http://localhost/openapi\", \"tests/openapi_specification.json\");\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","openapi_supports_scope.rs"],"content":"#![cfg(feature = \"openapi\")]\n\n#[macro_use]\nextern crate pretty_assertions;\n\nuse gotham::{router::builder::*, test::TestServer};\nuse gotham_restful::*;\nuse mime::TEXT_PLAIN;\n\n#[allow(dead_code)]\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::{test_get_response, test_openapi_response};\n\nconst RESPONSE: \u0026[u8] = b\"This is the only valid response.\";\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(RESPONSE, TEXT_PLAIN)\n}\n\n#[test]\nfn openapi_supports_scope() {\n\tlet info = OpenapiInfo {\n\t\ttitle: \"Test\".to_owned(),\n\t\tversion: \"1.2.3\".to_owned(),\n\t\turls: Vec::new()\n\t};\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.with_openapi(info, |mut router| {\n\t\t\trouter.openapi_spec(\"openapi\");\n\t\t\trouter.resource::\u003cFooResource\u003e(\"foo1\");\n\t\t\trouter.scope(\"/bar\", |router| {\n\t\t\t\trouter.resource::\u003cFooResource\u003e(\"foo2\");\n\t\t\t\trouter.scope(\"/baz\", |router| {\n\t\t\t\t\trouter.resource::\u003cFooResource\u003e(\"foo3\");\n\t\t\t\t})\n\t\t\t});\n\t\t\trouter.resource::\u003cFooResource\u003e(\"foo4\");\n\t\t});\n\t}))\n\t.unwrap();\n\n\ttest_get_response(\u0026server, \"http://localhost/foo1\", RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/bar/foo2\", RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/bar/baz/foo3\", RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo4\", RESPONSE);\n\ttest_openapi_response(\u0026server, \"http://localhost/openapi\", \"tests/openapi_supports_scope.json\");\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","resource_error.rs"],"content":"use gotham_restful::ResourceError;\n\n#[derive(ResourceError)]\nenum Error {\n\t#[display(\"I/O Error: {0}\")]\n\tIoError(#[from] std::io::Error),\n\n\t#[status(INTERNAL_SERVER_ERROR)]\n\t#[display(\"Internal Server Error: {0}\")]\n\tInternalServerError(String)\n}\n\n#[allow(deprecated)]\nmod resource_error {\n\tuse super::Error;\n\tuse gotham::hyper::StatusCode;\n\tuse gotham_restful::IntoResponseError;\n\tuse mime::APPLICATION_JSON;\n\n\t#[test]\n\tfn io_error() {\n\t\tlet err = Error::IoError(std::io::Error::last_os_error());\n\t\tlet res = err.into_response_error().unwrap();\n\t\tassert_eq!(res.status(), StatusCode::INTERNAL_SERVER_ERROR);\n\t\tassert_eq!(res.mime(), Some(\u0026APPLICATION_JSON));\n\t}\n\n\t#[test]\n\tfn internal_server_error() {\n\t\tlet err = Error::InternalServerError(\"Brocken\".to_owned());\n\t\tassert_eq!(\u0026format!(\"{}\", err), \"Internal Server Error: Brocken\");\n\n\t\tlet res = err.into_response_error().unwrap();\n\t\tassert_eq!(res.status(), StatusCode::INTERNAL_SERVER_ERROR);\n\t\tassert_eq!(res.mime(), None); // TODO shouldn't this be a json error message?\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","sync_methods.rs"],"content":"#[macro_use]\nextern crate gotham_derive;\n\nuse gotham::{router::builder::*, test::TestServer};\nuse gotham_restful::*;\nuse mime::{APPLICATION_JSON, TEXT_PLAIN};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse serde::Deserialize;\n\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::{test_delete_response, test_get_response, test_post_response, test_put_response};\n\n#[derive(Resource)]\n#[resource(read_all, read, search, create, update_all, update, delete_all, delete)]\nstruct FooResource;\n\n#[derive(Deserialize)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooBody {\n\tdata: String\n}\n\n#[derive(Clone, Deserialize, StateData, StaticResponseExtender)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooSearch {\n\tquery: String\n}\n\nconst READ_ALL_RESPONSE: \u0026[u8] = b\"1ARwwSPVyOKpJKrYwqGgECPVWDl1BqajAAj7g7WJ3e\";\n#[read_all]\nfn read_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst READ_RESPONSE: \u0026[u8] = b\"FEReHoeBKU17X2bBpVAd1iUvktFL43CDu0cFYHdaP9\";\n#[read]\nfn read(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_RESPONSE, TEXT_PLAIN)\n}\n\nconst SEARCH_RESPONSE: \u0026[u8] = b\"AWqcQUdBRHXKh3at4u79mdupOAfEbnTcx71ogCVF0E\";\n#[search]\nfn search(_body: FooSearch) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(SEARCH_RESPONSE, TEXT_PLAIN)\n}\n\nconst CREATE_RESPONSE: \u0026[u8] = b\"y6POY7wOMAB0jBRBw0FJT7DOpUNbhmT8KdpQPLkI83\";\n#[create]\nfn create(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(CREATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_ALL_RESPONSE: \u0026[u8] = b\"QlbYg8gHE9OQvvk3yKjXJLTSXlIrg9mcqhfMXJmQkv\";\n#[update_all]\nfn update_all(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_RESPONSE: \u0026[u8] = b\"qGod55RUXkT1lgPO8h0uVM6l368O2S0GrwENZFFuRu\";\n#[update]\nfn update(_id: u64, _body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_ALL_RESPONSE: \u0026[u8] = b\"Y36kZ749MRk2Nem4BedJABOZiZWPLOtiwLfJlGTwm5\";\n#[delete_all]\nfn delete_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_RESPONSE: \u0026[u8] = b\"CwRzBrKErsVZ1N7yeNfjZuUn1MacvgBqk4uPOFfDDq\";\n#[delete]\nfn delete(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_RESPONSE, TEXT_PLAIN)\n}\n\n#[test]\nfn sync_methods() {\n\tlet _ = pretty_env_logger::try_init_timed();\n\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.resource::\u003cFooResource\u003e(\"foo\");\n\t}))\n\t.unwrap();\n\n\ttest_get_response(\u0026server, \"http://localhost/foo\", READ_ALL_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/1\", READ_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/search?query=hello+world\", SEARCH_RESPONSE);\n\ttest_post_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tCREATE_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_ALL_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo/1\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_RESPONSE\n\t);\n\ttest_delete_response(\u0026server, \"http://localhost/foo\", DELETE_ALL_RESPONSE);\n\ttest_delete_response(\u0026server, \"http://localhost/foo/1\", DELETE_RESPONSE);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","trybuild_ui.rs"],"content":"use trybuild::TestCases;\n\n#[test]\n#[ignore]\nfn trybuild_ui() {\n\tlet t = TestCases::new();\n\tt.compile_fail(\"tests/ui/endpoint/*.rs\");\n\tt.compile_fail(\"tests/ui/from_body/*.rs\");\n\tt.compile_fail(\"tests/ui/resource/*.rs\");\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","async_state.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham::state::State;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nasync fn read_all(state: \u0026State) {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","auth_data_non_clone.rs"],"content":"use gotham_restful::*;\nuse serde::Deserialize;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[derive(Deserialize)]\nstruct AuthData {\n\tiat: u64,\n\texp: u64\n}\n\n#[read_all]\nasync fn read_all(auth: AuthStatus\u003cAuthData\u003e) -\u003e Result\u003cNoContent, AuthError\u003e {\n\tauth.ok()?;\n\tOk(NoContent::default())\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_method_invalid_expr.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(method = \"I like pizza\", uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_method_invalid_type.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(method = \"String::new()\", uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_method_missing.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_uri_missing.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(method = \"gotham_restful::gotham::hyper::Method::GET\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(FooResource)]\nfn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_body_ty.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\n#[derive(Debug)]\nstruct FooBody {\n\tfoo: String\n}\n\n#[endpoint(method = \"Method::GET\", uri = \"\", body = true)]\nfn endpoint(_: FooBody) {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_params_ty.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\n#[derive(Debug)]\nstruct FooParams {\n\tfoo: String\n}\n\n#[endpoint(method = \"Method::GET\", uri = \"\", params = true)]\nfn endpoint(_: FooParams) {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_placeholders_ty.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\n#[derive(Debug)]\nstruct FooPlaceholders {\n\tfoo: String\n}\n\n#[endpoint(method = \"Method::GET\", uri = \":foo\")]\nfn endpoint(_: FooPlaceholders) {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_return_type.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\nstruct FooResponse;\n\n#[endpoint(method = \"Method::GET\", uri = \"\")]\nfn endpoint() -\u003e FooResponse {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_body_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(body = false)]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_method_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(method = \"gotham_restful::gotham::hyper::Method::GET\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_params_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(params = true)]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_uri_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","self.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all(self) {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","too_few_args.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read)]\nstruct FooResource;\n\n#[read]\nfn read() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","too_many_args.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all(_id: u64) {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","unknown_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(pineapple = \"on pizza\")]\nfn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","unsafe.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nunsafe fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","wants_auth_non_bool.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(wants_auth = \"yes, please\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","from_body","enum.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(FromBody)]\nenum FromBodyEnum {\n\tSomeVariant(Vec\u003cu8\u003e),\n\tOtherVariant(String)\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","resource","unknown_method.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_any)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","util","mod.rs"],"content":"use gotham::{\n\thyper::Body,\n\ttest::TestServer\n};\nuse log::info;\nuse mime::Mime;\n#[allow(unused_imports)]\nuse std::{fs::File, io::{Read, Write}, str};\n\npub fn test_get_response(server : \u0026TestServer, path : \u0026str, expected : \u0026[u8])\n{\n\tinfo!(\"GET {}\", path);\n\tlet res = server.client().get(path).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\npub fn test_post_response\u003cB\u003e(server : \u0026TestServer, path : \u0026str, body : B, mime : Mime, expected : \u0026[u8])\nwhere\n\tB : Into\u003cBody\u003e\n{\n\tinfo!(\"POST {}\", path);\n\tlet res = server.client().post(path, body, mime).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\npub fn test_put_response\u003cB\u003e(server : \u0026TestServer, path : \u0026str, body : B, mime : Mime, expected : \u0026[u8])\nwhere\n\tB : Into\u003cBody\u003e\n{\n\tinfo!(\"PUT {}\", path);\n\tlet res = server.client().put(path, body, mime).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\npub fn test_delete_response(server : \u0026TestServer, path : \u0026str, expected : \u0026[u8])\n{\n\tinfo!(\"DELETE {}\", path);\n\tlet res = server.client().delete(path).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\n#[cfg(feature = \"openapi\")]\npub fn test_openapi_response(server : \u0026TestServer, path : \u0026str, output_file : \u0026str)\n{\n\tinfo!(\"GET {}\", path);\n\tlet res = server.client().get(path).perform().unwrap().read_body().unwrap();\n\tlet body: serde_json::Value = serde_json::from_slice(\u0026res).unwrap();\n\n\tlet mut file = File::open(output_file).unwrap();\n\tlet expected: serde_json::Value = serde_json::from_reader(\u0026mut file).unwrap();\n\n\t//eprintln!(\"{}\", body);\n\tassert_eq!(body, expected);\n}\n","traces":[],"covered":0,"coverable":0}]};
        var previousData = {"files":[{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","endpoint.rs"],"content":"use crate::util::{CollectToResult, ExpectLit};\nuse lazy_regex::regex_is_match;\nuse paste::paste;\nuse proc_macro2::{Ident, Span, TokenStream};\nuse quote::{format_ident, quote, quote_spanned, ToTokens};\nuse std::str::FromStr;\nuse syn::{\n\tparse::Parse, spanned::Spanned, Attribute, AttributeArgs, Error, Expr, FnArg, ItemFn, LitBool, LitStr, Meta, NestedMeta,\n\tPatType, Result, ReturnType, Type\n};\n\n#[allow(clippy::large_enum_variant)]\npub enum EndpointType {\n\tReadAll,\n\tRead,\n\tSearch,\n\tCreate,\n\tUpdateAll,\n\tUpdate,\n\tDeleteAll,\n\tDelete,\n\tCustom {\n\t\tmethod: Option\u003cExpr\u003e,\n\t\turi: Option\u003cLitStr\u003e,\n\t\tparams: Option\u003cLitBool\u003e,\n\t\tbody: Option\u003cLitBool\u003e\n\t}\n}\n\nimpl EndpointType {\n\tpub fn custom() -\u003e Self {\n\t\tSelf::Custom {\n\t\t\tmethod: None,\n\t\t\turi: None,\n\t\t\tparams: None,\n\t\t\tbody: None\n\t\t}\n\t}\n}\n\nmacro_rules! endpoint_type_setter {\n\t($name:ident : $ty:ty) =\u003e {\n\t\timpl EndpointType {\n\t\t\tpaste! {\n\t\t\t\tfn [\u003cset_ $name\u003e](\u0026mut self, span: Span, [\u003cnew_ $name\u003e]: $ty) -\u003e Result\u003c()\u003e {\n\t\t\t\t\tmatch self {\n\t\t\t\t\t\tSelf::Custom { $name, .. } if $name.is_some() =\u003e {\n\t\t\t\t\t\t\tErr(Error::new(span, concat!(\"`\", concat!(stringify!($name), \"` must not appear more than once\"))))\n\t\t\t\t\t\t},\n\t\t\t\t\t\tSelf::Custom { $name, .. } =\u003e {\n\t\t\t\t\t\t\t*$name = Some([\u003cnew_ $name\u003e]);\n\t\t\t\t\t\t\tOk(())\n\t\t\t\t\t\t},\n\t\t\t\t\t\t_ =\u003e Err(Error::new(span, concat!(\"`\", concat!(stringify!($name), \"` can only be used on custom endpoints\"))))\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nendpoint_type_setter!(method: Expr);\nendpoint_type_setter!(uri: LitStr);\nendpoint_type_setter!(params: LitBool);\nendpoint_type_setter!(body: LitBool);\n\nimpl FromStr for EndpointType {\n\ttype Err = Error;\n\n\tfn from_str(str: \u0026str) -\u003e Result\u003cSelf\u003e {\n\t\tmatch str {\n\t\t\t\"ReadAll\" | \"read_all\" =\u003e Ok(Self::ReadAll),\n\t\t\t\"Read\" | \"read\" =\u003e Ok(Self::Read),\n\t\t\t\"Search\" | \"search\" =\u003e Ok(Self::Search),\n\t\t\t\"Create\" | \"create\" =\u003e Ok(Self::Create),\n\t\t\t\"ChangeAll\" | \"change_all\" =\u003e Ok(Self::UpdateAll),\n\t\t\t\"Change\" | \"change\" =\u003e Ok(Self::Update),\n\t\t\t\"RemoveAll\" | \"remove_all\" =\u003e Ok(Self::DeleteAll),\n\t\t\t\"Remove\" | \"remove\" =\u003e Ok(Self::Delete),\n\t\t\t_ =\u003e Err(Error::new(Span::call_site(), format!(\"Unknown method: `{}'\", str)))\n\t\t}\n\t}\n}\n\nimpl EndpointType {\n\tfn http_method(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tlet hyper_method = quote!(::gotham_restful::gotham::hyper::Method);\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Search =\u003e Some(quote!(#hyper_method::GET)),\n\t\t\tSelf::Create =\u003e Some(quote!(#hyper_method::POST)),\n\t\t\tSelf::UpdateAll | Self::Update =\u003e Some(quote!(#hyper_method::PUT)),\n\t\t\tSelf::DeleteAll | Self::Delete =\u003e Some(quote!(#hyper_method::DELETE)),\n\t\t\tSelf::Custom { method, .. } =\u003e method.as_ref().map(ToTokens::to_token_stream)\n\t\t}\n\t}\n\n\tfn uri(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Create | Self::UpdateAll | Self::DeleteAll =\u003e Some(quote!(\"\")),\n\t\t\tSelf::Read | Self::Update | Self::Delete =\u003e Some(quote!(\":id\")),\n\t\t\tSelf::Search =\u003e Some(quote!(\"search\")),\n\t\t\tSelf::Custom { uri, .. } =\u003e uri.as_ref().map(ToTokens::to_token_stream)\n\t\t}\n\t}\n\n\tfn operation_verb(\u0026self) -\u003e TokenStream {\n\t\tlet some = quote!(::core::option::Option::Some);\n\t\tmatch self {\n\t\t\tSelf::ReadAll =\u003e quote!(#some(\"read_all\")),\n\t\t\tSelf::Read =\u003e quote!(#some(\"read\")),\n\t\t\tSelf::Search =\u003e quote!(#some(\"search\")),\n\t\t\tSelf::Create =\u003e quote!(#some(\"create\")),\n\t\t\tSelf::UpdateAll =\u003e quote!(#some(\"update_all\")),\n\t\t\tSelf::Update =\u003e quote!(#some(\"update\")),\n\t\t\tSelf::DeleteAll =\u003e quote!(#some(\"delete_all\")),\n\t\t\tSelf::Delete =\u003e quote!(#some(\"delete\")),\n\t\t\tSelf::Custom { .. } =\u003e quote!(::core::option::Option::None)\n\t\t}\n\t}\n\n\tfn has_placeholders(\u0026self) -\u003e LitBool {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Search | Self::Create | Self::UpdateAll | Self::DeleteAll =\u003e LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Read | Self::Update | Self::Delete =\u003e LitBool {\n\t\t\t\tvalue: true,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Custom { uri, .. } =\u003e LitBool {\n\t\t\t\tvalue: uri\n\t\t\t\t\t.as_ref()\n\t\t\t\t\t.map(|uri| regex_is_match!(r#\"(^|/):[^/]+(/|$)\"#, \u0026uri.value()))\n\t\t\t\t\t.unwrap_or(false),\n\t\t\t\tspan: Span::call_site()\n\t\t\t}\n\t\t}\n\t}\n\n\tfn placeholders_ty(\u0026self, arg_ty: Option\u003c\u0026Type\u003e) -\u003e TokenStream {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Search | Self::Create | Self::UpdateAll | Self::DeleteAll =\u003e {\n\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t},\n\t\t\tSelf::Read | Self::Update | Self::Delete =\u003e quote!(::gotham_restful::private::IdPlaceholder::\u003c#arg_ty\u003e),\n\t\t\tSelf::Custom { .. } =\u003e {\n\t\t\t\tif self.has_placeholders().value {\n\t\t\t\t\targ_ty.to_token_stream()\n\t\t\t\t} else {\n\t\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfn needs_params(\u0026self) -\u003e LitBool {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Create | Self::UpdateAll | Self::Update | Self::DeleteAll | Self::Delete =\u003e {\n\t\t\t\tLitBool {\n\t\t\t\t\tvalue: false,\n\t\t\t\t\tspan: Span::call_site()\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::Search =\u003e LitBool {\n\t\t\t\tvalue: true,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Custom { params, .. } =\u003e params.clone().unwrap_or_else(|| LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t})\n\t\t}\n\t}\n\n\tfn params_ty(\u0026self, arg_ty: Option\u003c\u0026Type\u003e) -\u003e TokenStream {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Create | Self::UpdateAll | Self::Update | Self::DeleteAll | Self::Delete =\u003e {\n\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t},\n\t\t\tSelf::Search =\u003e quote!(#arg_ty),\n\t\t\tSelf::Custom { .. } =\u003e {\n\t\t\t\tif self.needs_params().value {\n\t\t\t\t\targ_ty.to_token_stream()\n\t\t\t\t} else {\n\t\t\t\t\tquote!(::gotham_restful::NoopExtractor)\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfn needs_body(\u0026self) -\u003e LitBool {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Search | Self::DeleteAll | Self::Delete =\u003e LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Create | Self::UpdateAll | Self::Update =\u003e LitBool {\n\t\t\t\tvalue: true,\n\t\t\t\tspan: Span::call_site()\n\t\t\t},\n\t\t\tSelf::Custom { body, .. } =\u003e body.clone().unwrap_or_else(|| LitBool {\n\t\t\t\tvalue: false,\n\t\t\t\tspan: Span::call_site()\n\t\t\t})\n\t\t}\n\t}\n\n\tfn body_ty(\u0026self, arg_ty: Option\u003c\u0026Type\u003e) -\u003e TokenStream {\n\t\tmatch self {\n\t\t\tSelf::ReadAll | Self::Read | Self::Search | Self::DeleteAll | Self::Delete =\u003e quote!(()),\n\t\t\tSelf::Create | Self::UpdateAll | Self::Update =\u003e quote!(#arg_ty),\n\t\t\tSelf::Custom { .. } =\u003e {\n\t\t\t\tif self.needs_body().value {\n\t\t\t\t\targ_ty.to_token_stream()\n\t\t\t\t} else {\n\t\t\t\t\tquote!(())\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n}\n\n#[allow(clippy::large_enum_variant)]\nenum HandlerArgType {\n\tStateRef,\n\tStateMutRef,\n\tMethodArg(Type),\n\tDatabaseConnection(Type),\n\tAuthStatus(Type),\n\tAuthStatusRef(Type)\n}\n\nimpl HandlerArgType {\n\tfn is_method_arg(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::MethodArg(_))\n\t}\n\n\tfn is_database_conn(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::DatabaseConnection(_))\n\t}\n\n\tfn is_auth_status(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::AuthStatus(_) | Self::AuthStatusRef(_))\n\t}\n\n\tfn ty(\u0026self) -\u003e Option\u003c\u0026Type\u003e {\n\t\tmatch self {\n\t\t\tSelf::MethodArg(ty) | Self::DatabaseConnection(ty) | Self::AuthStatus(ty) | Self::AuthStatusRef(ty) =\u003e Some(ty),\n\t\t\t_ =\u003e None\n\t\t}\n\t}\n\n\tfn quote_ty(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tself.ty().map(|ty| quote!(#ty))\n\t}\n}\n\nstruct HandlerArg {\n\tident_span: Span,\n\tty: HandlerArgType\n}\n\nimpl Spanned for HandlerArg {\n\tfn span(\u0026self) -\u003e Span {\n\t\tself.ident_span\n\t}\n}\n\nfn interpret_arg_ty(attrs: \u0026[Attribute], name: \u0026str, ty: Type) -\u003e Result\u003cHandlerArgType\u003e {\n\tlet attr = attrs\n\t\t.iter()\n\t\t.find(|arg| arg.path.segments.iter().any(|path| \u0026path.ident.to_string() == \"rest_arg\"))\n\t\t.map(|arg| arg.tokens.to_string());\n\n\t// TODO issue a warning for _state usage once diagnostics become stable\n\tif attr.as_deref() == Some(\"state\") || (attr.is_none() \u0026\u0026 (name == \"state\" || name == \"_state\")) {\n\t\treturn match ty {\n\t\t\tType::Reference(ty) =\u003e Ok(if ty.mutability.is_none() {\n\t\t\t\tHandlerArgType::StateRef\n\t\t\t} else {\n\t\t\t\tHandlerArgType::StateMutRef\n\t\t\t}),\n\t\t\t_ =\u003e Err(Error::new(\n\t\t\t\tty.span(),\n\t\t\t\t\"The state parameter has to be a (mutable) reference to gotham_restful::State\"\n\t\t\t))\n\t\t};\n\t}\n\n\tif cfg!(feature = \"auth\") \u0026\u0026 (attr.as_deref() == Some(\"auth\") || (attr.is_none() \u0026\u0026 name == \"auth\")) {\n\t\treturn Ok(match ty {\n\t\t\tType::Reference(ty) =\u003e HandlerArgType::AuthStatusRef(*ty.elem),\n\t\t\tty =\u003e HandlerArgType::AuthStatus(ty)\n\t\t});\n\t}\n\n\tif cfg!(feature = \"database\")\n\t\t\u0026\u0026 (attr.as_deref() == Some(\"connection\") || attr.as_deref() == Some(\"conn\") || (attr.is_none() \u0026\u0026 name == \"conn\"))\n\t{\n\t\treturn Ok(HandlerArgType::DatabaseConnection(match ty {\n\t\t\tType::Reference(ty) =\u003e *ty.elem,\n\t\t\tty =\u003e ty\n\t\t}));\n\t}\n\n\tOk(HandlerArgType::MethodArg(ty))\n}\n\nfn interpret_arg(_index: usize, arg: \u0026PatType) -\u003e Result\u003cHandlerArg\u003e {\n\tlet pat = \u0026arg.pat;\n\tlet orig_name = quote!(#pat);\n\tlet ty = interpret_arg_ty(\u0026arg.attrs, \u0026orig_name.to_string(), *arg.ty.clone())?;\n\n\tOk(HandlerArg {\n\t\tident_span: arg.pat.span(),\n\t\tty\n\t})\n}\n\n#[cfg(feature = \"openapi\")]\nfn expand_operation_verb(operation_verb: TokenStream) -\u003e Option\u003cTokenStream\u003e {\n\tSome(quote! {\n\t\tfn operation_verb() -\u003e ::core::option::Option\u003c\u0026'static ::core::primitive::str\u003e {\n\t\t\t#operation_verb\n\t\t}\n\t})\n}\n\n#[cfg(not(feature = \"openapi\"))]\nfn expand_operation_verb(_: TokenStream) -\u003e Option\u003cTokenStream\u003e {\n\tNone\n}\n\n#[cfg(feature = \"openapi\")]\nfn expand_operation_id(operation_id: Option\u003cLitStr\u003e) -\u003e Option\u003cTokenStream\u003e {\n\toperation_id.map(|operation_id| {\n\t\tquote! {\n\t\t\tfn operation_id() -\u003e ::core::option::Option\u003c::std::string::String\u003e {\n\t\t\t\t::core::option::Option::Some(::std::string::String::from(#operation_id))\n\t\t\t}\n\t\t}\n\t})\n}\n\n#[cfg(not(feature = \"openapi\"))]\nfn expand_operation_id(_: Option\u003cLitStr\u003e) -\u003e Option\u003cTokenStream\u003e {\n\tNone\n}\n\nfn expand_wants_auth(wants_auth: Option\u003cLitBool\u003e, default: bool) -\u003e TokenStream {\n\tlet wants_auth = wants_auth.unwrap_or_else(|| LitBool {\n\t\tvalue: default,\n\t\tspan: Span::call_site()\n\t});\n\n\tquote! {\n\t\tfn wants_auth() -\u003e ::core::primitive::bool {\n\t\t\t#wants_auth\n\t\t}\n\t}\n}\n\npub fn endpoint_ident(fn_ident: \u0026Ident) -\u003e Ident {\n\tformat_ident!(\"{}___gotham_restful_endpoint\", fn_ident)\n}\n\n// clippy doesn't realize that vectors can be used in closures\n#[cfg_attr(feature = \"cargo-clippy\", allow(clippy::needless_collect))]\nfn expand_endpoint_type(mut ty: EndpointType, attrs: AttributeArgs, fun: \u0026ItemFn) -\u003e Result\u003cTokenStream\u003e {\n\t// reject unsafe functions\n\tif let Some(unsafety) = fun.sig.unsafety {\n\t\treturn Err(Error::new(unsafety.span(), \"Endpoint handler methods must not be unsafe\"));\n\t}\n\n\t// parse arguments\n\tlet mut debug: bool = false;\n\tlet mut operation_id: Option\u003cLitStr\u003e = None;\n\tlet mut wants_auth: Option\u003cLitBool\u003e = None;\n\tfor meta in attrs {\n\t\tmatch meta {\n\t\t\tNestedMeta::Meta(Meta::NameValue(kv)) =\u003e {\n\t\t\t\tif kv.path.is_ident(\"debug\") {\n\t\t\t\t\tdebug = kv.lit.expect_bool()?.value;\n\t\t\t\t} else if kv.path.is_ident(\"operation_id\") {\n\t\t\t\t\toperation_id = Some(kv.lit.expect_str()?);\n\t\t\t\t} else if kv.path.is_ident(\"wants_auth\") {\n\t\t\t\t\twants_auth = Some(kv.lit.expect_bool()?);\n\t\t\t\t} else if kv.path.is_ident(\"method\") {\n\t\t\t\t\tty.set_method(kv.path.span(), kv.lit.expect_str()?.parse_with(Expr::parse)?)?;\n\t\t\t\t} else if kv.path.is_ident(\"uri\") {\n\t\t\t\t\tty.set_uri(kv.path.span(), kv.lit.expect_str()?)?;\n\t\t\t\t} else if kv.path.is_ident(\"params\") {\n\t\t\t\t\tty.set_params(kv.path.span(), kv.lit.expect_bool()?)?;\n\t\t\t\t} else if kv.path.is_ident(\"body\") {\n\t\t\t\t\tty.set_body(kv.path.span(), kv.lit.expect_bool()?)?;\n\t\t\t\t} else {\n\t\t\t\t\treturn Err(Error::new(kv.path.span(), \"Unknown attribute\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\t_ =\u003e return Err(Error::new(meta.span(), \"Invalid attribute syntax\"))\n\t\t}\n\t}\n\t#[cfg(not(feature = \"openapi\"))]\n\tif let Some(operation_id) = operation_id {\n\t\treturn Err(Error::new(\n\t\t\toperation_id.span(),\n\t\t\t\"`operation_id` is only supported with the openapi feature\"\n\t\t));\n\t}\n\n\t// extract the documentation\n\tlet mut doc: Vec\u003cString\u003e = Vec::new();\n\tfor attr in \u0026fun.attrs {\n\t\tif attr.path.is_ident(\"doc\") {\n\t\t\tif let Some(lit) = attr.parse_meta().and_then(|meta| {\n\t\t\t\tOk(match meta {\n\t\t\t\t\tMeta::NameValue(kv) =\u003e Some(kv.lit.expect_str()?),\n\t\t\t\t\t_ =\u003e None\n\t\t\t\t})\n\t\t\t})? {\n\t\t\t\tdoc.push(lit.value());\n\t\t\t}\n\t\t}\n\t}\n\tlet doc = doc.join(\"\\n\");\n\t#[allow(unused_variables)]\n\tlet doc = doc.trim();\n\n\t#[allow(unused_mut)]\n\tlet mut description = quote!();\n\t#[cfg(feature = \"openapi\")]\n\tif !doc.is_empty() {\n\t\tdescription = quote! {\n\t\t\tfn description() -\u003e ::core::option::Option\u003c::std::string::String\u003e {\n\t\t\t\t::core::option::Option::Some(::std::string::String::from(#doc))\n\t\t\t}\n\t\t};\n\t}\n\n\t// extract arguments into pattern, ident and type\n\tlet args = fun\n\t\t.sig\n\t\t.inputs\n\t\t.iter()\n\t\t.enumerate()\n\t\t.map(|(i, arg)| match arg {\n\t\t\tFnArg::Typed(arg) =\u003e interpret_arg(i, arg),\n\t\t\tFnArg::Receiver(_) =\u003e Err(Error::new(arg.span(), \"Didn't expect self parameter\"))\n\t\t})\n\t\t.collect_to_result()?;\n\n\tlet fun_vis = \u0026fun.vis;\n\tlet fun_ident = \u0026fun.sig.ident;\n\tlet fun_is_async = fun.sig.asyncness.is_some();\n\n\tlet ident = endpoint_ident(fun_ident);\n\tlet dummy_ident = format_ident!(\"_IMPL_Endpoint_for_{}\", ident);\n\tlet (output_ty, is_no_content) = match \u0026fun.sig.output {\n\t\tReturnType::Default =\u003e (quote!(::gotham_restful::NoContent), true),\n\t\tReturnType::Type(_, ty) =\u003e (quote!(#ty), false)\n\t};\n\tlet output_typedef = quote_spanned!(output_ty.span() =\u003e type Output = #output_ty;);\n\n\tlet arg_tys = args.iter().filter(|arg| arg.ty.is_method_arg()).collect::\u003cVec\u003c_\u003e\u003e();\n\tlet mut arg_ty_idx = 0;\n\tlet mut next_arg_ty = |return_none: bool| {\n\t\tif return_none {\n\t\t\treturn Ok(None);\n\t\t}\n\t\tif arg_ty_idx \u003e= arg_tys.len() {\n\t\t\treturn Err(Error::new(fun_ident.span(), \"Too few arguments\"));\n\t\t}\n\t\tlet ty = arg_tys[arg_ty_idx].ty.ty().unwrap();\n\t\targ_ty_idx += 1;\n\t\tOk(Some(ty))\n\t};\n\n\tlet http_method = ty.http_method().ok_or_else(|| {\n\t\tError::new(\n\t\t\tSpan::call_site(),\n\t\t\t\"Missing `method` attribute (e.g. `#[endpoint(method = \\\"gotham_restful::gotham::hyper::Method::GET\\\")]`)\"\n\t\t)\n\t})?;\n\tlet uri = ty.uri().ok_or_else(|| {\n\t\tError::new(\n\t\t\tSpan::call_site(),\n\t\t\t\"Missing `uri` attribute (e.g. `#[endpoint(uri = \\\"custom_endpoint\\\")]`)\"\n\t\t)\n\t})?;\n\tlet has_placeholders = ty.has_placeholders();\n\tlet placeholder_ty = ty.placeholders_ty(next_arg_ty(!has_placeholders.value)?);\n\tlet placeholder_typedef = quote_spanned!(placeholder_ty.span() =\u003e type Placeholders = #placeholder_ty;);\n\tlet needs_params = ty.needs_params();\n\tlet params_ty = ty.params_ty(next_arg_ty(!needs_params.value)?);\n\tlet params_typedef = quote_spanned!(params_ty.span() =\u003e type Params = #params_ty;);\n\tlet needs_body = ty.needs_body();\n\tlet body_ty = ty.body_ty(next_arg_ty(!needs_body.value)?);\n\tlet body_typedef = quote_spanned!(body_ty.span() =\u003e type Body = #body_ty;);\n\n\tif arg_ty_idx \u003c arg_tys.len() {\n\t\treturn Err(Error::new(fun_ident.span(), \"Too many arguments\"));\n\t}\n\n\tlet mut handle_args: Vec\u003cTokenStream\u003e = Vec::new();\n\tif has_placeholders.value {\n\t\tif matches!(ty, EndpointType::Custom { .. }) {\n\t\t\thandle_args.push(quote!(placeholders));\n\t\t} else {\n\t\t\thandle_args.push(quote!(placeholders.id));\n\t\t}\n\t}\n\tif needs_params.value {\n\t\thandle_args.push(quote!(params));\n\t}\n\tif needs_body.value {\n\t\thandle_args.push(quote!(body.unwrap()));\n\t}\n\tlet handle_args = args.iter().map(|arg| match arg.ty {\n\t\tHandlerArgType::StateRef | HandlerArgType::StateMutRef =\u003e quote!(state),\n\t\tHandlerArgType::MethodArg(_) =\u003e handle_args.remove(0),\n\t\tHandlerArgType::DatabaseConnection(_) =\u003e quote!(\u0026conn),\n\t\tHandlerArgType::AuthStatus(_) =\u003e quote!(auth),\n\t\tHandlerArgType::AuthStatusRef(_) =\u003e quote!(\u0026auth)\n\t});\n\n\tlet expand_handle_content = || {\n\t\tlet mut state_block = quote!();\n\t\tif let Some(arg) = args.iter().find(|arg| arg.ty.is_auth_status()) {\n\t\t\tlet auth_ty = arg.ty.quote_ty();\n\t\t\tlet auth_borrow = quote_spanned! { auth_ty.span() =\u003e\n\t\t\t\t\u003c#auth_ty as ::core::clone::Clone\u003e::clone(\n\t\t\t\t\t\u003c#auth_ty as ::gotham_restful::gotham::state::FromState\u003e::borrow_from(state)\n\t\t\t\t)\n\t\t\t};\n\t\t\tstate_block = quote! {\n\t\t\t\t#state_block\n\t\t\t\tlet auth: #auth_ty = #auth_borrow;\n\t\t\t}\n\t\t}\n\n\t\tlet mut handle_content = quote!(#fun_ident(#(#handle_args),*));\n\t\tif fun_is_async {\n\t\t\tif let Some(arg) = args.iter().find(|arg| matches!(arg.ty, HandlerArgType::StateRef)) {\n\t\t\t\treturn Err(Error::new(arg.span(), \"Endpoint handler functions that are async must not take `\u0026State` as an argument, consider taking `\u0026mut State`\"));\n\t\t\t}\n\t\t\thandle_content = quote!(#handle_content.await);\n\t\t}\n\t\tif is_no_content {\n\t\t\thandle_content = quote!(#handle_content; \u003c::gotham_restful::NoContent as ::std::default::Default\u003e::default())\n\t\t}\n\n\t\tif let Some(arg) = args.iter().find(|arg| arg.ty.is_database_conn()) {\n\t\t\tlet conn_ty = arg.ty.quote_ty();\n\t\t\tstate_block = quote! {\n\t\t\t\t#state_block\n\t\t\t\tlet repo = \u003c::gotham_restful::private::Repo\u003c#conn_ty\u003e\u003e::borrow_from(state).clone();\n\t\t\t};\n\t\t\thandle_content = quote! {\n\t\t\t\trepo.run::\u003c_, _, ()\u003e(move |conn| {\n\t\t\t\t\tOk({ #handle_content })\n\t\t\t\t}).await.unwrap()\n\t\t\t};\n\t\t}\n\n\t\tOk(quote! {\n\t\t\tuse ::gotham_restful::private::FutureExt as _;\n\t\t\tuse ::gotham_restful::gotham::state::FromState as _;\n\t\t\t#state_block\n\t\t\tasync move {\n\t\t\t\t#handle_content\n\t\t\t}.boxed()\n\t\t})\n\t};\n\tlet handle_content = match expand_handle_content() {\n\t\tOk(content) =\u003e content,\n\t\tErr(err) =\u003e err.to_compile_error()\n\t};\n\n\tlet tr8 = if cfg!(feature = \"openapi\") {\n\t\tquote!(::gotham_restful::EndpointWithSchema)\n\t} else {\n\t\tquote!(::gotham_restful::Endpoint)\n\t};\n\tlet operation_verb = expand_operation_verb(ty.operation_verb());\n\tlet operation_id = expand_operation_id(operation_id);\n\tlet wants_auth = expand_wants_auth(wants_auth, args.iter().any(|arg| arg.ty.is_auth_status()));\n\tlet code = quote! {\n\t\t#[doc(hidden)]\n\t\t/// `gotham_restful` implementation detail\n\t\t#[allow(non_camel_case_types)]\n\t\t#fun_vis struct #ident;\n\n\t\t#[allow(non_upper_case_globals)]\n\t\tstatic #dummy_ident: () = {\n\t\t\timpl #tr8 for #ident {\n\t\t\t\tfn http_method() -\u003e ::gotham_restful::gotham::hyper::Method {\n\t\t\t\t\t#http_method\n\t\t\t\t}\n\n\t\t\t\tfn uri() -\u003e ::std::borrow::Cow\u003c'static, ::core::primitive::str\u003e {\n\t\t\t\t\t{ #uri }.into()\n\t\t\t\t}\n\n\t\t\t\t#operation_verb\n\n\t\t\t\t#output_typedef\n\n\t\t\t\tfn has_placeholders() -\u003e ::core::primitive::bool {\n\t\t\t\t\t#has_placeholders\n\t\t\t\t}\n\t\t\t\t#placeholder_typedef\n\n\t\t\t\tfn needs_params() -\u003e ::core::primitive::bool {\n\t\t\t\t\t#needs_params\n\t\t\t\t}\n\t\t\t\t#params_typedef\n\n\t\t\t\tfn needs_body() -\u003e ::core::primitive::bool {\n\t\t\t\t\t#needs_body\n\t\t\t\t}\n\t\t\t\t#body_typedef\n\n\t\t\t\tfn handle\u003c'a\u003e(\n\t\t\t\t\tstate: \u0026'a mut ::gotham_restful::gotham::state::State,\n\t\t\t\t\tplaceholders: Self::Placeholders,\n\t\t\t\t\tparams: Self::Params,\n\t\t\t\t\tbody: ::core::option::Option\u003cSelf::Body\u003e\n\t\t\t\t) -\u003e ::gotham_restful::private::BoxFuture\u003c'a, Self::Output\u003e {\n\t\t\t\t\t#handle_content\n\t\t\t\t}\n\n\t\t\t\t#operation_id\n\t\t\t\t#description\n\t\t\t\t#wants_auth\n\t\t\t}\n\t\t};\n\t};\n\tif debug {\n\t\teprintln!(\"{}\", code);\n\t}\n\tOk(code)\n}\n\npub fn expand_endpoint(ty: EndpointType, attrs: AttributeArgs, fun: ItemFn) -\u003e Result\u003cTokenStream\u003e {\n\tlet endpoint_type = match expand_endpoint_type(ty, attrs, \u0026fun) {\n\t\tOk(code) =\u003e code,\n\t\tErr(err) =\u003e err.to_compile_error()\n\t};\n\tOk(quote! {\n\t\t#fun\n\t\t#endpoint_type\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","from_body.rs"],"content":"use proc_macro2::TokenStream;\nuse quote::{format_ident, quote};\nuse std::cmp::min;\nuse syn::{spanned::Spanned, Data, DeriveInput, Error, Field, Fields, Ident, Result, Type};\n\nstruct ParsedFields {\n\tfields: Vec\u003c(Ident, Type)\u003e,\n\tnamed: bool\n}\n\nimpl ParsedFields {\n\tfn from_named\u003cI\u003e(fields: I) -\u003e Self\n\twhere\n\t\tI: Iterator\u003cItem = Field\u003e\n\t{\n\t\tlet fields = fields.map(|field| (field.ident.unwrap(), field.ty)).collect();\n\t\tSelf { fields, named: true }\n\t}\n\n\tfn from_unnamed\u003cI\u003e(fields: I) -\u003e Self\n\twhere\n\t\tI: Iterator\u003cItem = Field\u003e\n\t{\n\t\tlet fields = fields\n\t\t\t.enumerate()\n\t\t\t.map(|(i, field)| (format_ident!(\"arg{}\", i), field.ty))\n\t\t\t.collect();\n\t\tSelf { fields, named: false }\n\t}\n\n\tfn from_unit() -\u003e Self {\n\t\tSelf {\n\t\t\tfields: Vec::new(),\n\t\t\tnamed: false\n\t\t}\n\t}\n}\n\npub fn expand_from_body(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\tlet generics = input.generics;\n\n\tlet strukt = match input.data {\n\t\tData::Enum(inum) =\u003e Err(inum.enum_token.span()),\n\t\tData::Struct(strukt) =\u003e Ok(strukt),\n\t\tData::Union(uni) =\u003e Err(uni.union_token.span())\n\t}\n\t.map_err(|span| Error::new(span, \"#[derive(FromBody)] only works for structs\"))?;\n\n\tlet fields = match strukt.fields {\n\t\tFields::Named(named) =\u003e ParsedFields::from_named(named.named.into_iter()),\n\t\tFields::Unnamed(unnamed) =\u003e ParsedFields::from_unnamed(unnamed.unnamed.into_iter()),\n\t\tFields::Unit =\u003e ParsedFields::from_unit()\n\t};\n\n\tlet mut where_clause = quote!();\n\tlet mut block = quote!();\n\tlet mut body_ident = format_ident!(\"_body\");\n\tlet mut type_ident = format_ident!(\"_type\");\n\n\tif let Some(body_field) = fields.fields.get(0) {\n\t\tbody_ident = body_field.0.clone();\n\t\tlet body_ty = \u0026body_field.1;\n\t\twhere_clause = quote! {\n\t\t\t#where_clause\n\t\t\t#body_ty: for\u003c'a\u003e From\u003c\u0026'a [u8]\u003e,\n\t\t};\n\t\tblock = quote! {\n\t\t\t#block\n\t\t\tlet #body_ident: \u0026[u8] = \u0026#body_ident;\n\t\t\tlet #body_ident: #body_ty = #body_ident.into();\n\t\t};\n\t}\n\n\tif let Some(type_field) = fields.fields.get(1) {\n\t\ttype_ident = type_field.0.clone();\n\t\tlet type_ty = \u0026type_field.1;\n\t\twhere_clause = quote! {\n\t\t\t#where_clause\n\t\t\t#type_ty: From\u003c::gotham_restful::Mime\u003e,\n\t\t};\n\t\tblock = quote! {\n\t\t\t#block\n\t\t\tlet #type_ident: #type_ty = #type_ident.into();\n\t\t};\n\t}\n\n\tfor field in \u0026fields.fields[min(2, fields.fields.len())..] {\n\t\tlet field_ident = \u0026field.0;\n\t\tlet field_ty = \u0026field.1;\n\t\twhere_clause = quote! {\n\t\t\t#where_clause\n\t\t\t#field_ty: ::std::default::Default,\n\t\t};\n\t\tblock = quote! {\n\t\t\t#block\n\t\t\tlet #field_ident: #field_ty = Default::default();\n\t\t};\n\t}\n\n\tlet field_names: Vec\u003c\u0026Ident\u003e = fields.fields.iter().map(|field| \u0026field.0).collect();\n\tlet ctor = if fields.named {\n\t\tquote!(Self { #(#field_names),* })\n\t} else {\n\t\tquote!(Self ( #(#field_names),* ))\n\t};\n\n\tOk(quote! {\n\t\timpl #generics ::gotham_restful::FromBody for #ident #generics\n\t\twhere #where_clause\n\t\t{\n\t\t\ttype Err = ::std::convert::Infallible;\n\n\t\t\tfn from_body(\n\t\t\t\t#body_ident: ::gotham_restful::gotham::hyper::body::Bytes,\n\t\t\t\t#type_ident: ::gotham_restful::Mime\n\t\t\t) -\u003e ::std::result::Result\u003cSelf, ::std::convert::Infallible\u003e\n\t\t\t{\n\t\t\t\t#block\n\t\t\t\t::std::result::Result::Ok(#ctor)\n\t\t\t}\n\t\t}\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","lib.rs"],"content":"#![warn(missing_debug_implementations, rust_2018_idioms)]\n#![deny(broken_intra_doc_links)]\n#![forbid(unsafe_code)]\n\nuse proc_macro::TokenStream;\nuse proc_macro2::TokenStream as TokenStream2;\nuse syn::{parse_macro_input, parse_macro_input::ParseMacroInput, DeriveInput, Result};\n\nmod util;\n\nmod endpoint;\nuse endpoint::{expand_endpoint, EndpointType};\n\nmod from_body;\nuse from_body::expand_from_body;\n\nmod request_body;\nuse request_body::expand_request_body;\n\nmod resource;\nuse resource::expand_resource;\n\nmod resource_error;\nuse resource_error::expand_resource_error;\n\nmod private_openapi_trait;\nuse private_openapi_trait::expand_private_openapi_trait;\n\n#[inline]\nfn print_tokens(tokens: TokenStream2) -\u003e TokenStream {\n\t// eprintln!(\"{}\", tokens);\n\ttokens.into()\n}\n\n#[inline]\nfn expand_derive\u003cF\u003e(input: TokenStream, expand: F) -\u003e TokenStream\nwhere\n\tF: FnOnce(DeriveInput) -\u003e Result\u003cTokenStream2\u003e\n{\n\tprint_tokens(expand(parse_macro_input!(input)).unwrap_or_else(|err| err.to_compile_error()))\n}\n\n#[inline]\nfn expand_macro\u003cF, A, I\u003e(attrs: TokenStream, item: TokenStream, expand: F) -\u003e TokenStream\nwhere\n\tF: FnOnce(A, I) -\u003e Result\u003cTokenStream2\u003e,\n\tA: ParseMacroInput,\n\tI: ParseMacroInput\n{\n\tprint_tokens(expand(parse_macro_input!(attrs), parse_macro_input!(item)).unwrap_or_else(|err| err.to_compile_error()))\n}\n\n#[proc_macro_derive(FromBody)]\npub fn derive_from_body(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_from_body)\n}\n\n#[proc_macro_derive(RequestBody, attributes(supported_types))]\npub fn derive_request_body(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_request_body)\n}\n\n#[proc_macro_derive(Resource, attributes(resource))]\npub fn derive_resource(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_resource)\n}\n\n#[proc_macro_derive(ResourceError, attributes(display, from, status))]\npub fn derive_resource_error(input: TokenStream) -\u003e TokenStream {\n\texpand_derive(input, expand_resource_error)\n}\n\n#[proc_macro_attribute]\npub fn endpoint(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::custom(), attr, item))\n}\n\n#[proc_macro_attribute]\npub fn read_all(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::ReadAll, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn read(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Read, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn search(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Search, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn create(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Create, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn update_all(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::UpdateAll, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn update(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Update, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn delete_all(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::DeleteAll, attr, item))\n}\n\n#[proc_macro_attribute]\npub fn delete(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, |attr, item| expand_endpoint(EndpointType::Delete, attr, item))\n}\n\n/// PRIVATE MACRO - DO NOT USE\n#[doc(hidden)]\n#[proc_macro_attribute]\npub fn _private_openapi_trait(attr: TokenStream, item: TokenStream) -\u003e TokenStream {\n\texpand_macro(attr, item, expand_private_openapi_trait)\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","private_openapi_trait.rs"],"content":"use crate::util::{remove_parens, CollectToResult};\nuse proc_macro2::{Span, TokenStream};\nuse quote::{quote, ToTokens};\nuse syn::{\n\tparse::Parse, spanned::Spanned, Attribute, AttributeArgs, Error, ItemTrait, LitStr, Meta, NestedMeta, PredicateType,\n\tResult, TraitItem, WherePredicate\n};\n\nstruct TraitItemAttrs {\n\topenapi_only: bool,\n\topenapi_bound: Vec\u003cPredicateType\u003e,\n\tnon_openapi_bound: Vec\u003cPredicateType\u003e,\n\tother_attrs: Vec\u003cAttribute\u003e\n}\n\nimpl TraitItemAttrs {\n\tfn parse(attrs: Vec\u003cAttribute\u003e) -\u003e Result\u003cSelf\u003e {\n\t\tlet mut openapi_only = false;\n\t\tlet mut openapi_bound = Vec::new();\n\t\tlet mut non_openapi_bound = Vec::new();\n\t\tlet mut other = Vec::new();\n\n\t\tfor attr in attrs {\n\t\t\tif attr.path.is_ident(\"openapi_only\") {\n\t\t\t\topenapi_only = true;\n\t\t\t} else if attr.path.is_ident(\"openapi_bound\") {\n\t\t\t\tlet attr_arg: LitStr = syn::parse2(remove_parens(attr.tokens))?;\n\t\t\t\tlet predicate = attr_arg.parse_with(WherePredicate::parse)?;\n\t\t\t\topenapi_bound.push(match predicate {\n\t\t\t\t\tWherePredicate::Type(ty) =\u003e ty,\n\t\t\t\t\t_ =\u003e return Err(Error::new(predicate.span(), \"Expected type bound\"))\n\t\t\t\t});\n\t\t\t} else if attr.path.is_ident(\"non_openapi_bound\") {\n\t\t\t\tlet attr_arg: LitStr = syn::parse2(remove_parens(attr.tokens))?;\n\t\t\t\tlet predicate = attr_arg.parse_with(WherePredicate::parse)?;\n\t\t\t\tnon_openapi_bound.push(match predicate {\n\t\t\t\t\tWherePredicate::Type(ty) =\u003e ty,\n\t\t\t\t\t_ =\u003e return Err(Error::new(predicate.span(), \"Expected type bound\"))\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tother.push(attr);\n\t\t\t}\n\t\t}\n\n\t\tOk(Self {\n\t\t\topenapi_only,\n\t\t\topenapi_bound,\n\t\t\tnon_openapi_bound,\n\t\t\tother_attrs: other\n\t\t})\n\t}\n}\n\npub(crate) fn expand_private_openapi_trait(mut attrs: AttributeArgs, tr8: ItemTrait) -\u003e Result\u003cTokenStream\u003e {\n\tlet tr8_attrs = \u0026tr8.attrs;\n\tlet vis = \u0026tr8.vis;\n\tlet ident = \u0026tr8.ident;\n\tlet generics = \u0026tr8.generics;\n\tlet colon_token = \u0026tr8.colon_token;\n\tlet supertraits = \u0026tr8.supertraits;\n\n\tif attrs.len() != 1 {\n\t\treturn Err(Error::new(\n\t\t\tSpan::call_site(),\n\t\t\t\"Expected one argument. Example: #[_private_openapi_trait(OpenapiTraitName)]\"\n\t\t));\n\t}\n\tlet openapi_ident = match attrs.remove(0) {\n\t\tNestedMeta::Meta(Meta::Path(path)) =\u003e path,\n\t\tp =\u003e {\n\t\t\treturn Err(Error::new(\n\t\t\t\tp.span(),\n\t\t\t\t\"Expected name of the Resource struct this method belongs to\"\n\t\t\t))\n\t\t},\n\t};\n\n\tlet orig_trait = {\n\t\tlet items = tr8\n\t\t\t.items\n\t\t\t.clone()\n\t\t\t.into_iter()\n\t\t\t.map(|item| {\n\t\t\t\tOk(match item {\n\t\t\t\t\tTraitItem::Method(mut method) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(method.attrs)?;\n\t\t\t\t\t\tmethod.attrs = attrs.other_attrs;\n\t\t\t\t\t\tfor bound in attrs.non_openapi_bound {\n\t\t\t\t\t\t\t// we compare two incompatible types using their `Display` implementation\n\t\t\t\t\t\t\t// this triggers a false positive in clippy\n\t\t\t\t\t\t\t#[cfg_attr(feature = \"cargo-clippy\", allow(clippy::cmp_owned))]\n\t\t\t\t\t\t\tmethod\n\t\t\t\t\t\t\t\t.sig\n\t\t\t\t\t\t\t\t.generics\n\t\t\t\t\t\t\t\t.type_params_mut()\n\t\t\t\t\t\t\t\t.filter(|param| param.ident.to_string() == bound.bounded_ty.to_token_stream().to_string())\n\t\t\t\t\t\t\t\t.for_each(|param| param.bounds.extend(bound.bounds.clone()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif attrs.openapi_only {\n\t\t\t\t\t\t\tNone\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tSome(TraitItem::Method(method))\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tTraitItem::Type(mut ty) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(ty.attrs)?;\n\t\t\t\t\t\tty.attrs = attrs.other_attrs;\n\t\t\t\t\t\tSome(TraitItem::Type(ty))\n\t\t\t\t\t},\n\t\t\t\t\titem =\u003e Some(item)\n\t\t\t\t})\n\t\t\t})\n\t\t\t.collect_to_result()?;\n\t\tquote! {\n\t\t\t#(#tr8_attrs)*\n\t\t\t#vis trait #ident #generics #colon_token #supertraits {\n\t\t\t\t#(#items)*\n\t\t\t}\n\t\t}\n\t};\n\n\tlet openapi_trait = if !cfg!(feature = \"openapi\") {\n\t\tNone\n\t} else {\n\t\tlet items = tr8\n\t\t\t.items\n\t\t\t.clone()\n\t\t\t.into_iter()\n\t\t\t.map(|item| {\n\t\t\t\tOk(match item {\n\t\t\t\t\tTraitItem::Method(mut method) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(method.attrs)?;\n\t\t\t\t\t\tmethod.attrs = attrs.other_attrs;\n\t\t\t\t\t\tfor bound in attrs.openapi_bound {\n\t\t\t\t\t\t\t// we compare two incompatible types using their `Display` implementation\n\t\t\t\t\t\t\t// this triggers a false positive in clippy\n\t\t\t\t\t\t\t#[cfg_attr(feature = \"cargo-clippy\", allow(clippy::cmp_owned))]\n\t\t\t\t\t\t\tmethod\n\t\t\t\t\t\t\t\t.sig\n\t\t\t\t\t\t\t\t.generics\n\t\t\t\t\t\t\t\t.type_params_mut()\n\t\t\t\t\t\t\t\t.filter(|param| param.ident.to_string() == bound.bounded_ty.to_token_stream().to_string())\n\t\t\t\t\t\t\t\t.for_each(|param| param.bounds.extend(bound.bounds.clone()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTraitItem::Method(method)\n\t\t\t\t\t},\n\t\t\t\t\tTraitItem::Type(mut ty) =\u003e {\n\t\t\t\t\t\tlet attrs = TraitItemAttrs::parse(ty.attrs)?;\n\t\t\t\t\t\tty.attrs = attrs.other_attrs;\n\t\t\t\t\t\tfor bound in attrs.openapi_bound {\n\t\t\t\t\t\t\tty.bounds.extend(bound.bounds.clone());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTraitItem::Type(ty)\n\t\t\t\t\t},\n\t\t\t\t\titem =\u003e item\n\t\t\t\t})\n\t\t\t})\n\t\t\t.collect_to_result()?;\n\t\tSome(quote! {\n\t\t\t#(#tr8_attrs)*\n\t\t\t#vis trait #openapi_ident #generics #colon_token #supertraits {\n\t\t\t\t#(#items)*\n\t\t\t}\n\t\t})\n\t};\n\n\tOk(quote! {\n\t\t#orig_trait\n\t\t#openapi_trait\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","request_body.rs"],"content":"use crate::util::CollectToResult;\nuse proc_macro2::{Ident, TokenStream};\nuse quote::quote;\nuse std::iter;\nuse syn::{\n\tparse::{Parse, ParseStream},\n\tpunctuated::Punctuated,\n\tspanned::Spanned,\n\tDeriveInput, Error, Generics, Path, Result, Token\n};\n\nstruct MimeList(Punctuated\u003cPath, Token![,]\u003e);\n\nimpl Parse for MimeList {\n\tfn parse(input: ParseStream\u003c'_\u003e) -\u003e Result\u003cSelf\u003e {\n\t\tlet list = Punctuated::parse_separated_nonempty(\u0026input)?;\n\t\tOk(Self(list))\n\t}\n}\n\n#[cfg(not(feature = \"openapi\"))]\nfn impl_openapi_type(_ident: \u0026Ident, _generics: \u0026Generics) -\u003e TokenStream {\n\tquote!()\n}\n\n#[cfg(feature = \"openapi\")]\nfn impl_openapi_type(ident: \u0026Ident, generics: \u0026Generics) -\u003e TokenStream {\n\tlet openapi = quote!(::gotham_restful::private::openapi);\n\tquote! {\n\t\timpl #generics ::gotham_restful::private::OpenapiType for #ident #generics {\n\t\t\tfn schema() -\u003e ::gotham_restful::private::OpenapiSchema {\n\t\t\t\t::gotham_restful::private::OpenapiSchema::new(\n\t\t\t\t\t#openapi::SchemaKind::Type(\n\t\t\t\t\t\t#openapi::Type::String(\n\t\t\t\t\t\t\t#openapi::StringType {\n\t\t\t\t\t\t\t\tformat: #openapi::VariantOrUnknownOrEmpty::Item(\n\t\t\t\t\t\t\t\t\t#openapi::StringFormat::Binary\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t.. ::std::default::Default::default()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\t}\n}\n\npub fn expand_request_body(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\tlet generics = input.generics;\n\n\tlet types = input\n\t\t.attrs\n\t\t.into_iter()\n\t\t.filter(|attr| {\n\t\t\tattr.path.segments.iter().last().map(|segment| segment.ident.to_string()) == Some(\"supported_types\".to_string())\n\t\t})\n\t\t.flat_map(|attr| {\n\t\t\tlet span = attr.span();\n\t\t\tattr.parse_args::\u003cMimeList\u003e()\n\t\t\t\t.map(|list| Box::new(list.0.into_iter().map(Ok)) as Box\u003cdyn Iterator\u003cItem = Result\u003cPath\u003e\u003e\u003e)\n\t\t\t\t.unwrap_or_else(|mut err| {\n\t\t\t\t\terr.combine(Error::new(\n\t\t\t\t\t\tspan,\n\t\t\t\t\t\t\"Hint: Types list should look like #[supported_types(TEXT_PLAIN, APPLICATION_JSON)]\"\n\t\t\t\t\t));\n\t\t\t\t\tBox::new(iter::once(Err(err)))\n\t\t\t\t})\n\t\t})\n\t\t.collect_to_result()?;\n\n\tlet types = match types {\n\t\tref types if types.is_empty() =\u003e quote!(None),\n\t\ttypes =\u003e quote!(Some(vec![#(#types),*]))\n\t};\n\n\tlet impl_openapi_type = impl_openapi_type(\u0026ident, \u0026generics);\n\n\tOk(quote! {\n\t\timpl #generics ::gotham_restful::RequestBody for #ident #generics\n\t\twhere #ident #generics : ::gotham_restful::FromBody\n\t\t{\n\t\t\tfn supported_types() -\u003e ::core::option::Option\u003c::std::vec::Vec\u003c::gotham_restful::Mime\u003e\u003e {\n\t\t\t\t#types\n\t\t\t}\n\t\t}\n\n\t\t#impl_openapi_type\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","resource.rs"],"content":"use crate::{endpoint::endpoint_ident, util::CollectToResult};\nuse proc_macro2::{Ident, TokenStream};\nuse quote::quote;\nuse std::iter;\nuse syn::{\n\tparenthesized,\n\tparse::{Parse, ParseStream},\n\tpunctuated::Punctuated,\n\tDeriveInput, Result, Token\n};\n\nstruct MethodList(Punctuated\u003cIdent, Token![,]\u003e);\n\nimpl Parse for MethodList {\n\tfn parse(input: ParseStream\u003c'_\u003e) -\u003e Result\u003cSelf\u003e {\n\t\tlet content;\n\t\tlet _paren = parenthesized!(content in input);\n\t\tlet list = Punctuated::parse_separated_nonempty(\u0026content)?;\n\t\tOk(Self(list))\n\t}\n}\n\npub fn expand_resource(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\n\tlet methods = input\n\t\t.attrs\n\t\t.into_iter()\n\t\t.filter(|attr| attr.path.is_ident(\"resource\"))\n\t\t.map(|attr| syn::parse2(attr.tokens).map(|m: MethodList| m.0.into_iter()))\n\t\t.flat_map(|list| match list {\n\t\t\tOk(iter) =\u003e Box::new(iter.map(|method| {\n\t\t\t\tlet ident = endpoint_ident(\u0026method);\n\t\t\t\tOk(quote!(route.endpoint::\u003c#ident\u003e();))\n\t\t\t})) as Box\u003cdyn Iterator\u003cItem = Result\u003cTokenStream\u003e\u003e\u003e,\n\t\t\tErr(err) =\u003e Box::new(iter::once(Err(err)))\n\t\t})\n\t\t.collect_to_result()?;\n\n\tlet non_openapi_impl = quote! {\n\t\timpl ::gotham_restful::Resource for #ident {\n\t\t\tfn setup\u003cD: ::gotham_restful::DrawResourceRoutes\u003e(mut route: D) {\n\t\t\t\t#(#methods)*\n\t\t\t}\n\t\t}\n\t};\n\tlet openapi_impl = if !cfg!(feature = \"openapi\") {\n\t\tNone\n\t} else {\n\t\tSome(quote! {\n\t\t\timpl ::gotham_restful::ResourceWithSchema for #ident {\n\t\t\t\tfn setup\u003cD: ::gotham_restful::DrawResourceRoutesWithSchema\u003e(mut route: D) {\n\t\t\t\t\t#(#methods)*\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\tOk(quote! {\n\t\t#non_openapi_impl\n\t\t#openapi_impl\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","resource_error.rs"],"content":"use crate::util::{remove_parens, CollectToResult};\nuse proc_macro2::{Ident, TokenStream};\nuse quote::{format_ident, quote};\nuse std::iter;\nuse syn::{\n\tspanned::Spanned, Attribute, Data, DeriveInput, Error, Fields, GenericParam, LitStr, Path, PathSegment, Result, Type,\n\tVariant\n};\n\nstruct ErrorVariantField {\n\tattrs: Vec\u003cAttribute\u003e,\n\tident: Ident,\n\tty: Type\n}\n\nstruct ErrorVariant {\n\tident: Ident,\n\tstatus: Option\u003cPath\u003e,\n\tis_named: bool,\n\tfields: Vec\u003cErrorVariantField\u003e,\n\tfrom_ty: Option\u003c(usize, Type)\u003e,\n\tdisplay: Option\u003cLitStr\u003e\n}\n\nfn process_variant(variant: Variant) -\u003e Result\u003cErrorVariant\u003e {\n\tlet status =\n\t\tmatch variant.attrs.iter().find(|attr| {\n\t\t\tattr.path.segments.iter().last().map(|segment| segment.ident.to_string()) == Some(\"status\".to_string())\n\t\t}) {\n\t\t\tSome(attr) =\u003e Some(syn::parse2(remove_parens(attr.tokens.clone()))?),\n\t\t\tNone =\u003e None\n\t\t};\n\n\tlet mut is_named = false;\n\tlet mut fields = Vec::new();\n\tmatch variant.fields {\n\t\tFields::Named(named) =\u003e {\n\t\t\tis_named = true;\n\t\t\tfor field in named.named {\n\t\t\t\tlet span = field.span();\n\t\t\t\tfields.push(ErrorVariantField {\n\t\t\t\t\tattrs: field.attrs,\n\t\t\t\t\tident: field\n\t\t\t\t\t\t.ident\n\t\t\t\t\t\t.ok_or_else(|| Error::new(span, \"Missing ident for this enum variant field\"))?,\n\t\t\t\t\tty: field.ty\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tFields::Unnamed(unnamed) =\u003e {\n\t\t\tfor (i, field) in unnamed.unnamed.into_iter().enumerate() {\n\t\t\t\tfields.push(ErrorVariantField {\n\t\t\t\t\tattrs: field.attrs,\n\t\t\t\t\tident: format_ident!(\"arg{}\", i),\n\t\t\t\t\tty: field.ty\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tFields::Unit =\u003e {}\n\t}\n\n\tlet from_ty = fields\n\t\t.iter()\n\t\t.enumerate()\n\t\t.find(|(_, field)| {\n\t\t\tfield\n\t\t\t\t.attrs\n\t\t\t\t.iter()\n\t\t\t\t.any(|attr| attr.path.segments.last().map(|segment| segment.ident.to_string()) == Some(\"from\".to_string()))\n\t\t})\n\t\t.map(|(i, field)| (i, field.ty.clone()));\n\n\tlet display = match variant.attrs.iter().find(|attr| {\n\t\tattr.path.segments.iter().last().map(|segment| segment.ident.to_string()) == Some(\"display\".to_string())\n\t}) {\n\t\tSome(attr) =\u003e Some(syn::parse2(remove_parens(attr.tokens.clone()))?),\n\t\tNone =\u003e None\n\t};\n\n\tOk(ErrorVariant {\n\t\tident: variant.ident,\n\t\tstatus,\n\t\tis_named,\n\t\tfields,\n\t\tfrom_ty,\n\t\tdisplay\n\t})\n}\n\nfn path_segment(name: \u0026str) -\u003e PathSegment {\n\tPathSegment {\n\t\tident: format_ident!(\"{}\", name),\n\t\targuments: Default::default()\n\t}\n}\n\nimpl ErrorVariant {\n\tfn fields_pat(\u0026self) -\u003e TokenStream {\n\t\tlet mut fields = self.fields.iter().map(|field| \u0026field.ident).peekable();\n\t\tif fields.peek().is_none() {\n\t\t\tquote!()\n\t\t} else if self.is_named {\n\t\t\tquote!( { #( #fields ),* } )\n\t\t} else {\n\t\t\tquote!( ( #( #fields ),* ) )\n\t\t}\n\t}\n\n\tfn to_display_match_arm(\u0026self, formatter_ident: \u0026Ident, enum_ident: \u0026Ident) -\u003e Result\u003cTokenStream\u003e {\n\t\tlet ident = \u0026self.ident;\n\t\tlet display = self\n\t\t\t.display\n\t\t\t.as_ref()\n\t\t\t.ok_or_else(|| Error::new(self.ident.span(), \"Missing display string for this variant\"))?;\n\n\t\t// lets find all required format parameters\n\t\tlet display_str = display.value();\n\t\tlet mut params: Vec\u003c\u0026str\u003e = Vec::new();\n\t\tlet len = display_str.len();\n\t\tlet mut start = len;\n\t\tlet mut iter = display_str.chars().enumerate().peekable();\n\t\twhile let Some((i, c)) = iter.next() {\n\t\t\t// we found a new opening brace\n\t\t\tif start == len \u0026\u0026 c == '{' {\n\t\t\t\tstart = i + 1;\n\t\t\t}\n\t\t\t// we found a duplicate opening brace\n\t\t\telse if start == i \u0026\u0026 c == '{' {\n\t\t\t\tstart = len;\n\t\t\t}\n\t\t\t// we found a closing brace\n\t\t\telse if start \u003c i \u0026\u0026 c == '}' {\n\t\t\t\tmatch iter.peek() {\n\t\t\t\t\tSome((_, '}')) =\u003e {\n\t\t\t\t\t\treturn Err(Error::new(\n\t\t\t\t\t\t\tdisplay.span(),\n\t\t\t\t\t\t\t\"Error parsing format string: curly braces not allowed inside parameter name\"\n\t\t\t\t\t\t))\n\t\t\t\t\t},\n\t\t\t\t\t_ =\u003e params.push(\u0026display_str[start..i])\n\t\t\t\t};\n\t\t\t\tstart = len;\n\t\t\t}\n\t\t\t// we found a closing brace without content\n\t\t\telse if start == i \u0026\u0026 c == '}' {\n\t\t\t\treturn Err(Error::new(\n\t\t\t\t\tdisplay.span(),\n\t\t\t\t\t\"Error parsing format string: parameter name must not be empty\"\n\t\t\t\t));\n\t\t\t}\n\t\t}\n\t\tif start != len {\n\t\t\treturn Err(Error::new(\n\t\t\t\tdisplay.span(),\n\t\t\t\t\"Error parsing format string: Unmatched opening brace\"\n\t\t\t));\n\t\t}\n\t\tlet params = params\n\t\t\t.into_iter()\n\t\t\t.map(|name| format_ident!(\"{}{}\", if self.is_named { \"\" } else { \"arg\" }, name));\n\n\t\tlet fields_pat = self.fields_pat();\n\t\tOk(quote! {\n\t\t\t#enum_ident::#ident #fields_pat =\u003e ::std::write!(#formatter_ident, #display #(, #params = #params)*)\n\t\t})\n\t}\n\n\tfn status(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tself.status.as_ref().map(|status| {\n\t\t\t// the status might be relative to StatusCode, so let's fix that\n\t\t\tif status.leading_colon.is_none() \u0026\u0026 status.segments.len() \u003c 2 {\n\t\t\t\tlet status_ident = status.segments.first().cloned().unwrap_or_else(|| path_segment(\"OK\"));\n\t\t\t\tquote!(::gotham_restful::gotham::hyper::StatusCode::#status_ident)\n\t\t\t} else {\n\t\t\t\tquote!(::gotham_restful::gotham::hyper::StatusCode::from(#status))\n\t\t\t}\n\t\t})\n\t}\n\n\tfn into_match_arm(self, enum_ident: \u0026Ident) -\u003e Result\u003cTokenStream\u003e {\n\t\tlet ident = \u0026self.ident;\n\t\tlet fields_pat = self.fields_pat();\n\t\tlet status = self.status();\n\n\t\t// the response will come directly from the from_ty if present\n\t\tlet res = match (self.from_ty, status) {\n\t\t\t(Some((from_index, _)), None) =\u003e {\n\t\t\t\tlet from_field = \u0026self.fields[from_index].ident;\n\t\t\t\tquote!(#from_field.into_response_error())\n\t\t\t},\n\t\t\t(Some(_), Some(_)) =\u003e return Err(Error::new(ident.span(), \"When #[from] is used, #[status] must not be used!\")),\n\t\t\t(None, Some(status)) =\u003e quote!(::std::result::Result::Ok(::gotham_restful::Response::new(\n\t\t\t\t#status,\n\t\t\t\t::gotham_restful::gotham::hyper::Body::empty(),\n\t\t\t\t::core::option::Option::None\n\t\t\t))),\n\t\t\t(None, None) =\u003e return Err(Error::new(ident.span(), \"Missing #[status(code)] for this variant\"))\n\t\t};\n\n\t\tOk(quote! {\n\t\t\t#enum_ident::#ident #fields_pat =\u003e #res\n\t\t})\n\t}\n\n\tfn were(\u0026self) -\u003e Option\u003cTokenStream\u003e {\n\t\tself.from_ty.as_ref().map(|(_, ty)| quote!( #ty : ::std::error::Error ))\n\t}\n}\n\npub fn expand_resource_error(input: DeriveInput) -\u003e Result\u003cTokenStream\u003e {\n\tlet ident = input.ident;\n\tlet generics = input.generics;\n\n\tlet inum = match input.data {\n\t\tData::Enum(inum) =\u003e Ok(inum),\n\t\tData::Struct(strukt) =\u003e Err(strukt.struct_token.span()),\n\t\tData::Union(uni) =\u003e Err(uni.union_token.span())\n\t}\n\t.map_err(|span| Error::new(span, \"#[derive(ResourceError)] only works for enums\"))?;\n\tlet variants = inum.variants.into_iter().map(process_variant).collect_to_result()?;\n\n\tlet display_impl = if variants.iter().any(|v| v.display.is_none()) {\n\t\tNone // TODO issue warning if display is present on some but not all\n\t} else {\n\t\tlet were = generics.params.iter().filter_map(|param| match param {\n\t\t\tGenericParam::Type(ty) =\u003e {\n\t\t\t\tlet ident = \u0026ty.ident;\n\t\t\t\tSome(quote!(#ident : ::std::fmt::Display))\n\t\t\t},\n\t\t\t_ =\u003e None\n\t\t});\n\t\tlet formatter_ident = format_ident!(\"resource_error_display_formatter\");\n\t\tlet match_arms = variants\n\t\t\t.iter()\n\t\t\t.map(|v| v.to_display_match_arm(\u0026formatter_ident, \u0026ident))\n\t\t\t.collect_to_result()?;\n\t\tSome(quote! {\n\t\t\timpl #generics ::std::fmt::Display for #ident #generics\n\t\t\twhere #( #were ),*\n\t\t\t{\n\t\t\t\tfn fmt(\u0026self, #formatter_ident: \u0026mut ::std::fmt::Formatter\u003c'_\u003e) -\u003e ::std::fmt::Result {\n\t\t\t\t\tmatch self {\n\t\t\t\t\t\t#( #match_arms ),*\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tlet mut from_impls: Vec\u003cTokenStream\u003e = Vec::new();\n\n\tfor var in \u0026variants {\n\t\tlet var_ident = \u0026var.ident;\n\t\tlet (from_index, from_ty) = match var.from_ty.as_ref() {\n\t\t\tSome(f) =\u003e f,\n\t\t\tNone =\u003e continue\n\t\t};\n\t\tlet from_ident = \u0026var.fields[*from_index].ident;\n\n\t\tlet fields_pat = var.fields_pat();\n\t\tlet fields_where = var\n\t\t\t.fields\n\t\t\t.iter()\n\t\t\t.enumerate()\n\t\t\t.filter(|(i, _)| i != from_index)\n\t\t\t.map(|(_, field)| {\n\t\t\t\tlet ty = \u0026field.ty;\n\t\t\t\tquote!( #ty : Default )\n\t\t\t})\n\t\t\t.chain(iter::once(quote!( #from_ty : ::std::error::Error )));\n\t\tlet fields_let = var\n\t\t\t.fields\n\t\t\t.iter()\n\t\t\t.enumerate()\n\t\t\t.filter(|(i, _)| i != from_index)\n\t\t\t.map(|(_, field)| {\n\t\t\t\tlet id = \u0026field.ident;\n\t\t\t\tlet ty = \u0026field.ty;\n\t\t\t\tquote!( let #id : #ty = Default::default(); )\n\t\t\t});\n\n\t\tfrom_impls.push(quote! {\n\t\t\timpl #generics ::std::convert::From\u003c#from_ty\u003e for #ident #generics\n\t\t\twhere #( #fields_where ),*\n\t\t\t{\n\t\t\t\tfn from(#from_ident: #from_ty) -\u003e Self {\n\t\t\t\t\t#( #fields_let )*\n\t\t\t\t\tSelf::#var_ident #fields_pat\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet status_codes = if cfg!(feature = \"openapi\") {\n\t\tlet codes = variants.iter().map(|v| match v.status() {\n\t\t\tSome(code) =\u003e quote!(status_codes.push(#code);),\n\t\t\tNone =\u003e {\n\t\t\t\t// we would've errored before if from_ty was not set\n\t\t\t\tlet from_ty = \u0026v.from_ty.as_ref().unwrap().1;\n\t\t\t\tquote!(status_codes.extend(\u003c#from_ty as ::gotham_restful::IntoResponseError\u003e::status_codes());)\n\t\t\t}\n\t\t});\n\t\tSome(quote! {\n\t\t\tfn status_codes() -\u003e ::std::vec::Vec\u003c::gotham_restful::gotham::hyper::StatusCode\u003e {\n\t\t\t\tlet mut status_codes = \u003c::std::vec::Vec\u003c::gotham_restful::gotham::hyper::StatusCode\u003e\u003e::new();\n\t\t\t\t#(#codes)*\n\t\t\t\tstatus_codes\n\t\t\t}\n\t\t})\n\t} else {\n\t\tNone\n\t};\n\n\tlet schema = if cfg!(feature = \"openapi\") {\n\t\tlet codes = variants.iter().map(|v| match v.status() {\n\t\t\tSome(code) =\u003e quote! {\n\t\t\t\t#code =\u003e \u003c::gotham_restful::NoContent as ::gotham_restful::ResponseSchema\u003e::schema(\n\t\t\t\t\t::gotham_restful::gotham::hyper::StatusCode::NO_CONTENT\n\t\t\t\t)\n\t\t\t},\n\t\t\tNone =\u003e {\n\t\t\t\t// we would've errored before if from_ty was not set\n\t\t\t\tlet from_ty = \u0026v.from_ty.as_ref().unwrap().1;\n\t\t\t\tquote! {\n\t\t\t\t\tcode if \u003c#from_ty as ::gotham_restful::IntoResponseError\u003e::status_codes().contains(\u0026code) =\u003e {\n\t\t\t\t\t\t\u003c#from_ty as ::gotham_restful::IntoResponseError\u003e::schema(code)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tSome(quote! {\n\t\t\tfn schema(code: ::gotham_restful::gotham::hyper::StatusCode) -\u003e ::gotham_restful::private::OpenapiSchema {\n\t\t\t\tmatch code {\n\t\t\t\t\t#(#codes,)*\n\t\t\t\t\tcode =\u003e panic!(\"Invalid status code {}\", code)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tNone\n\t};\n\n\tlet were = variants.iter().filter_map(|variant| variant.were()).collect::\u003cVec\u003c_\u003e\u003e();\n\tlet variants = variants\n\t\t.into_iter()\n\t\t.map(|variant| variant.into_match_arm(\u0026ident))\n\t\t.collect_to_result()?;\n\n\tOk(quote! {\n\t\t#display_impl\n\n\t\timpl #generics ::gotham_restful::IntoResponseError for #ident #generics\n\t\twhere #( #were ),*\n\t\t{\n\t\t\ttype Err = ::gotham_restful::private::serde_json::Error;\n\n\t\t\tfn into_response_error(self) -\u003e ::std::result::Result\u003c::gotham_restful::Response, Self::Err\u003e\n\t\t\t{\n\t\t\t\tmatch self {\n\t\t\t\t\t#( #variants ),*\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t#status_codes\n\t\t\t#schema\n\t\t}\n\n\t\t#( #from_impls )*\n\t})\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","derive","src","util.rs"],"content":"use proc_macro2::{Delimiter, TokenStream, TokenTree};\nuse std::iter;\nuse syn::{Error, Lit, LitBool, LitStr, Result};\n\npub(crate) trait CollectToResult {\n\ttype Item;\n\n\tfn collect_to_result(self) -\u003e Result\u003cVec\u003cSelf::Item\u003e\u003e;\n}\n\nimpl\u003cItem, I\u003e CollectToResult for I\nwhere\n\tI: Iterator\u003cItem = Result\u003cItem\u003e\u003e\n{\n\ttype Item = Item;\n\n\tfn collect_to_result(self) -\u003e Result\u003cVec\u003cItem\u003e\u003e {\n\t\tself.fold(Ok(Vec::new()), |res, code| match (code, res) {\n\t\t\t(Ok(code), Ok(mut codes)) =\u003e {\n\t\t\t\tcodes.push(code);\n\t\t\t\tOk(codes)\n\t\t\t},\n\t\t\t(Ok(_), Err(errors)) =\u003e Err(errors),\n\t\t\t(Err(err), Ok(_)) =\u003e Err(err),\n\t\t\t(Err(err), Err(mut errors)) =\u003e {\n\t\t\t\terrors.combine(err);\n\t\t\t\tErr(errors)\n\t\t\t}\n\t\t})\n\t}\n}\n\npub(crate) trait ExpectLit {\n\tfn expect_bool(self) -\u003e Result\u003cLitBool\u003e;\n\tfn expect_str(self) -\u003e Result\u003cLitStr\u003e;\n}\n\nimpl ExpectLit for Lit {\n\tfn expect_bool(self) -\u003e Result\u003cLitBool\u003e {\n\t\tmatch self {\n\t\t\tSelf::Bool(bool) =\u003e Ok(bool),\n\t\t\t_ =\u003e Err(Error::new(self.span(), \"Expected boolean literal\"))\n\t\t}\n\t}\n\n\tfn expect_str(self) -\u003e Result\u003cLitStr\u003e {\n\t\tmatch self {\n\t\t\tSelf::Str(str) =\u003e Ok(str),\n\t\t\t_ =\u003e Err(Error::new(self.span(), \"Expected string literal\"))\n\t\t}\n\t}\n}\n\npub(crate) fn remove_parens(input: TokenStream) -\u003e TokenStream {\n\tlet iter = input.into_iter().flat_map(|tt| {\n\t\tif let TokenTree::Group(group) = \u0026tt {\n\t\t\tif group.delimiter() == Delimiter::Parenthesis {\n\t\t\t\treturn Box::new(group.stream().into_iter()) as Box\u003cdyn Iterator\u003cItem = TokenTree\u003e\u003e;\n\t\t\t}\n\t\t}\n\t\tBox::new(iter::once(tt))\n\t});\n\titer.collect()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","auth.rs"],"content":"use crate::{AuthError, Forbidden};\n\nuse cookie::CookieJar;\nuse futures_util::{\n\tfuture,\n\tfuture::{FutureExt, TryFutureExt}\n};\nuse gotham::{\n\tanyhow,\n\thandler::HandlerFuture,\n\thyper::header::{HeaderMap, HeaderName, AUTHORIZATION},\n\tmiddleware::{cookie::CookieParser, Middleware, NewMiddleware},\n\tstate::{FromState, State}\n};\nuse jsonwebtoken::{errors::ErrorKind, DecodingKey};\nuse serde::de::DeserializeOwned;\nuse std::{marker::PhantomData, panic::RefUnwindSafe, pin::Pin};\n\npub type AuthValidation = jsonwebtoken::Validation;\n\n/// The authentication status returned by the auth middleware for each request.\n#[derive(Debug, StateData)]\npub enum AuthStatus\u003cT: Send + 'static\u003e {\n\t/// The auth status is unknown.\n\tUnknown,\n\t/// The request has been performed without any kind of authentication.\n\tUnauthenticated,\n\t/// The request has been performed with an invalid authentication.\n\tInvalid,\n\t/// The request has been performed with an expired authentication.\n\tExpired,\n\t/// The request has been performed with a valid authentication.\n\tAuthenticated(T)\n}\n\nimpl\u003cT\u003e Clone for AuthStatus\u003cT\u003e\nwhere\n\tT: Clone + Send + 'static\n{\n\tfn clone(\u0026self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::Unknown =\u003e Self::Unknown,\n\t\t\tSelf::Unauthenticated =\u003e Self::Unauthenticated,\n\t\t\tSelf::Invalid =\u003e Self::Invalid,\n\t\t\tSelf::Expired =\u003e Self::Expired,\n\t\t\tSelf::Authenticated(data) =\u003e Self::Authenticated(data.clone())\n\t\t}\n\t}\n}\n\nimpl\u003cT\u003e Copy for AuthStatus\u003cT\u003e where T: Copy + Send + 'static {}\n\nimpl\u003cT: Send + 'static\u003e AuthStatus\u003cT\u003e {\n\tpub fn ok(self) -\u003e Result\u003cT, AuthError\u003e {\n\t\tmatch self {\n\t\t\tSelf::Authenticated(data) =\u003e Ok(data),\n\t\t\t_ =\u003e Err(Forbidden)\n\t\t}\n\t}\n}\n\n/// The source of the authentication token in the request.\n#[derive(Clone, Debug, StateData)]\npub enum AuthSource {\n\t/// Take the token from a cookie with the given name.\n\tCookie(String),\n\t/// Take the token from a header with the given name.\n\tHeader(HeaderName),\n\t/// Take the token from the HTTP Authorization header. This is different from `Header(\"Authorization\")`\n\t/// as it will follow the `scheme param` format from the HTTP specification. The `scheme` will\n\t/// be discarded, so its value doesn't matter.\n\tAuthorizationHeader\n}\n\n/**\nThis trait will help the auth middleware to determine the validity of an authentication token.\n\nA very basic implementation could look like this:\n\n```\n# use gotham_restful::{AuthHandler, gotham::state::State};\n#\nconst SECRET : \u0026'static [u8; 32] = b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\";\n\nstruct CustomAuthHandler;\nimpl\u003cT\u003e AuthHandler\u003cT\u003e for CustomAuthHandler {\n\tfn jwt_secret\u003cF : FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state : \u0026mut State, _decode_data : F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\tSome(SECRET.to_vec())\n\t}\n}\n```\n*/\npub trait AuthHandler\u003cData\u003e {\n\t/// Return the SHA256-HMAC secret used to verify the JWT token.\n\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cData\u003e\u003e(\u0026self, state: \u0026mut State, decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e;\n}\n\n/// An [AuthHandler] returning always the same secret. See [AuthMiddleware] for a usage example.\n#[derive(Clone, Debug)]\npub struct StaticAuthHandler {\n\tsecret: Vec\u003cu8\u003e\n}\n\nimpl StaticAuthHandler {\n\tpub fn from_vec(secret: Vec\u003cu8\u003e) -\u003e Self {\n\t\tSelf { secret }\n\t}\n\n\tpub fn from_array(secret: \u0026[u8]) -\u003e Self {\n\t\tSelf::from_vec(secret.to_vec())\n\t}\n}\n\nimpl\u003cT\u003e AuthHandler\u003cT\u003e for StaticAuthHandler {\n\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state: \u0026mut State, _decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\tSome(self.secret.clone())\n\t}\n}\n\n/**\nThis is the auth middleware. To use it, first make sure you have the `auth` feature enabled. Then\nsimply add it to your pipeline and request it inside your handler:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#\n#[derive(Resource)]\n#[resource(read_all)]\nstruct AuthResource;\n\n#[derive(Debug, Deserialize, Clone)]\nstruct AuthData {\n\tsub: String,\n\texp: u64\n}\n\n#[read_all]\nfn read_all(auth : \u0026AuthStatus\u003cAuthData\u003e) -\u003e Success\u003cString\u003e {\n\tformat!(\"{:?}\", auth).into()\n}\n\nfn main() {\n\tlet auth: AuthMiddleware\u003cAuthData, _\u003e = AuthMiddleware::new(\n\t\tAuthSource::AuthorizationHeader,\n\t\tAuthValidation::default(),\n\t\tStaticAuthHandler::from_array(b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\")\n\t);\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(auth).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cAuthResource\u003e(\"auth\");\n\t}));\n}\n```\n*/\n#[derive(Debug)]\npub struct AuthMiddleware\u003cData, Handler\u003e {\n\tsource: AuthSource,\n\tvalidation: AuthValidation,\n\thandler: Handler,\n\t_data: PhantomData\u003cData\u003e\n}\n\nimpl\u003cData, Handler\u003e Clone for AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tHandler: Clone\n{\n\tfn clone(\u0026self) -\u003e Self {\n\t\tSelf {\n\t\t\tsource: self.source.clone(),\n\t\t\tvalidation: self.validation.clone(),\n\t\t\thandler: self.handler.clone(),\n\t\t\t_data: self._data\n\t\t}\n\t}\n}\n\nimpl\u003cData, Handler\u003e AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tData: DeserializeOwned + Send,\n\tHandler: AuthHandler\u003cData\u003e + Default\n{\n\tpub fn from_source(source: AuthSource) -\u003e Self {\n\t\tSelf {\n\t\t\tsource,\n\t\t\tvalidation: Default::default(),\n\t\t\thandler: Default::default(),\n\t\t\t_data: Default::default()\n\t\t}\n\t}\n}\n\nimpl\u003cData, Handler\u003e AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tData: DeserializeOwned + Send,\n\tHandler: AuthHandler\u003cData\u003e\n{\n\tpub fn new(source: AuthSource, validation: AuthValidation, handler: Handler) -\u003e Self {\n\t\tSelf {\n\t\t\tsource,\n\t\t\tvalidation,\n\t\t\thandler,\n\t\t\t_data: Default::default()\n\t\t}\n\t}\n\n\tfn auth_status(\u0026self, state: \u0026mut State) -\u003e AuthStatus\u003cData\u003e {\n\t\t// extract the provided token, if any\n\t\tlet token = match \u0026self.source {\n\t\t\tAuthSource::Cookie(name) =\u003e CookieJar::try_borrow_from(\u0026state)\n\t\t\t\t.map(|jar| jar.get(\u0026name).map(|cookie| cookie.value().to_owned()))\n\t\t\t\t.unwrap_or_else(|| {\n\t\t\t\t\tCookieParser::from_state(\u0026state)\n\t\t\t\t\t\t.get(\u0026name)\n\t\t\t\t\t\t.map(|cookie| cookie.value().to_owned())\n\t\t\t\t}),\n\t\t\tAuthSource::Header(name) =\u003e HeaderMap::try_borrow_from(\u0026state)\n\t\t\t\t.and_then(|map| map.get(name))\n\t\t\t\t.and_then(|header| header.to_str().ok())\n\t\t\t\t.map(|value| value.to_owned()),\n\t\t\tAuthSource::AuthorizationHeader =\u003e HeaderMap::try_borrow_from(\u0026state)\n\t\t\t\t.and_then(|map| map.get(AUTHORIZATION))\n\t\t\t\t.and_then(|header| header.to_str().ok())\n\t\t\t\t.and_then(|value| value.split_whitespace().nth(1))\n\t\t\t\t.map(|value| value.to_owned())\n\t\t};\n\n\t\t// unauthed if no token\n\t\tlet token = match token {\n\t\t\tSome(token) =\u003e token,\n\t\t\tNone =\u003e return AuthStatus::Unauthenticated\n\t\t};\n\n\t\t// get the secret from the handler, possibly decoding claims ourselves\n\t\tlet secret = self.handler.jwt_secret(state, || {\n\t\t\tlet b64 = token.split('.').nth(1)?;\n\t\t\tlet raw = base64::decode_config(b64, base64::URL_SAFE_NO_PAD).ok()?;\n\t\t\tserde_json::from_slice(\u0026raw).ok()?\n\t\t});\n\n\t\t// unknown if no secret\n\t\tlet secret = match secret {\n\t\t\tSome(secret) =\u003e secret,\n\t\t\tNone =\u003e return AuthStatus::Unknown\n\t\t};\n\n\t\t// validate the token\n\t\tlet data: Data = match jsonwebtoken::decode(\u0026token, \u0026DecodingKey::from_secret(\u0026secret), \u0026self.validation) {\n\t\t\tOk(data) =\u003e data.claims,\n\t\t\tErr(e) =\u003e match e.into_kind() {\n\t\t\t\tErrorKind::ExpiredSignature =\u003e return AuthStatus::Expired,\n\t\t\t\t_ =\u003e return AuthStatus::Invalid\n\t\t\t}\n\t\t};\n\n\t\t// we found a valid token\n\t\tAuthStatus::Authenticated(data)\n\t}\n}\n\nimpl\u003cData, Handler\u003e Middleware for AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tData: DeserializeOwned + Send + 'static,\n\tHandler: AuthHandler\u003cData\u003e\n{\n\tfn call\u003cChain\u003e(self, mut state: State, chain: Chain) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\twhere\n\t\tChain: FnOnce(State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\t{\n\t\t// put the source in our state, required for e.g. openapi\n\t\tstate.put(self.source.clone());\n\n\t\t// put the status in our state\n\t\tlet status = self.auth_status(\u0026mut state);\n\t\tstate.put(status);\n\n\t\t// call the rest of the chain\n\t\tchain(state).and_then(|(state, res)| future::ok((state, res))).boxed()\n\t}\n}\n\nimpl\u003cData, Handler\u003e NewMiddleware for AuthMiddleware\u003cData, Handler\u003e\nwhere\n\tSelf: Clone + Middleware + Sync + RefUnwindSafe\n{\n\ttype Instance = Self;\n\n\tfn new_middleware(\u0026self) -\u003e anyhow::Result\u003cSelf\u003e {\n\t\tlet c: Self = self.clone();\n\t\tOk(c)\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse cookie::Cookie;\n\tuse gotham::hyper::header::COOKIE;\n\tuse std::fmt::Debug;\n\n\t// 256-bit random string\n\tconst JWT_SECRET: \u0026'static [u8; 32] = b\"Lyzsfnta0cdxyF0T9y6VGxp3jpgoMUuW\";\n\n\t// some known tokens\n\tconst VALID_TOKEN : \u0026'static str = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJtc3JkMCIsInN1YiI6ImdvdGhhbS1yZXN0ZnVsIiwiaWF0IjoxNTc3ODM2ODAwLCJleHAiOjQxMDI0NDQ4MDB9.8h8Ax-nnykqEQ62t7CxmM3ja6NzUQ4L0MLOOzddjLKk\";\n\tconst EXPIRED_TOKEN : \u0026'static str = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJtc3JkMCIsInN1YiI6ImdvdGhhbS1yZXN0ZnVsIiwiaWF0IjoxNTc3ODM2ODAwLCJleHAiOjE1Nzc4MzcxMDB9.eV1snaGLYrJ7qUoMk74OvBY3WUU9M0Je5HTU2xtX1v0\";\n\tconst INVALID_TOKEN : \u0026'static str = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJtc3JkMCIsInN1YiI6ImdvdGhhbS1yZXN0ZnVsIiwiaWF0IjoxNTc3ODM2ODAwLCJleHAiOjQxMDI0NDQ4MDB9\";\n\n\t#[derive(Debug, Deserialize, PartialEq)]\n\tstruct TestData {\n\t\tiss: String,\n\t\tsub: String,\n\t\tiat: u64,\n\t\texp: u64\n\t}\n\n\timpl Default for TestData {\n\t\tfn default() -\u003e Self {\n\t\t\tSelf {\n\t\t\t\tiss: \"msrd0\".to_owned(),\n\t\t\t\tsub: \"gotham-restful\".to_owned(),\n\t\t\t\tiat: 1577836800,\n\t\t\t\texp: 4102444800\n\t\t\t}\n\t\t}\n\t}\n\n\t#[derive(Default)]\n\tstruct NoneAuthHandler;\n\timpl\u003cT\u003e AuthHandler\u003cT\u003e for NoneAuthHandler {\n\t\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state: \u0026mut State, _decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\t\tNone\n\t\t}\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_none_secret() {\n\t\tlet middleware = \u003cAuthMiddleware\u003cTestData, NoneAuthHandler\u003e\u003e::from_source(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tmiddleware.auth_status(\u0026mut state);\n\t\t});\n\t}\n\n\t#[derive(Default)]\n\tstruct TestAssertingHandler;\n\timpl\u003cT\u003e AuthHandler\u003cT\u003e for TestAssertingHandler\n\twhere\n\t\tT: Debug + Default + PartialEq\n\t{\n\t\tfn jwt_secret\u003cF: FnOnce() -\u003e Option\u003cT\u003e\u003e(\u0026self, _state: \u0026mut State, decode_data: F) -\u003e Option\u003cVec\u003cu8\u003e\u003e {\n\t\t\tassert_eq!(decode_data(), Some(T::default()));\n\t\t\tSome(JWT_SECRET.to_vec())\n\t\t}\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_decode_data() {\n\t\tlet middleware = \u003cAuthMiddleware\u003cTestData, TestAssertingHandler\u003e\u003e::from_source(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tmiddleware.auth_status(\u0026mut state);\n\t\t});\n\t}\n\n\tfn new_middleware\u003cT\u003e(source: AuthSource) -\u003e AuthMiddleware\u003cT, StaticAuthHandler\u003e\n\twhere\n\t\tT: DeserializeOwned + Send\n\t{\n\t\tAuthMiddleware::new(source, Default::default(), StaticAuthHandler::from_array(JWT_SECRET))\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_no_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Unauthenticated =\u003e {},\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Unauthenticated, got {:?}\", status)\n\t\t\t};\n\t\t});\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_expired_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", EXPIRED_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Expired =\u003e {},\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Expired, got {:?}\", status)\n\t\t\t};\n\t\t});\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_invalid_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", INVALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Invalid =\u003e {},\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Invalid, got {:?}\", status)\n\t\t\t};\n\t\t});\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_auth_header_token() {\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::AuthorizationHeader);\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(AUTHORIZATION, format!(\"Bearer {}\", VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_header_token() {\n\t\tlet header_name = \"x-znoiprwmvfexju\";\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::Header(HeaderName::from_static(header_name)));\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(header_name, VALID_TOKEN.parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_cookie_token() {\n\t\tlet cookie_name = \"znoiprwmvfexju\";\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::Cookie(cookie_name.to_owned()));\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut jar = CookieJar::new();\n\t\t\tjar.add_original(Cookie::new(cookie_name, VALID_TOKEN));\n\t\t\tstate.put(jar);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n\n\t#[test]\n\tfn test_auth_middleware_cookie_no_jar() {\n\t\tlet cookie_name = \"znoiprwmvfexju\";\n\t\tlet middleware = new_middleware::\u003cTestData\u003e(AuthSource::Cookie(cookie_name.to_owned()));\n\t\tState::with_new(|mut state| {\n\t\t\tlet mut headers = HeaderMap::new();\n\t\t\theaders.insert(COOKIE, format!(\"{}={}\", cookie_name, VALID_TOKEN).parse().unwrap());\n\t\t\tstate.put(headers);\n\t\t\tlet status = middleware.auth_status(\u0026mut state);\n\t\t\tmatch status {\n\t\t\t\tAuthStatus::Authenticated(data) =\u003e assert_eq!(data, TestData::default()),\n\t\t\t\t_ =\u003e panic!(\"Expected AuthStatus::Authenticated, got {:?}\", status)\n\t\t\t};\n\t\t})\n\t}\n}\n","traces":[{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[2540512],"length":1,"stats":{"Line":2},"fn_name":"from_vec"},{"line":109,"address":[2540576],"length":1,"stats":{"Line":2},"fn_name":"from_array"},{"line":110,"address":[2540599],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[2540742,2540640],"length":1,"stats":{"Line":1},"fn_name":"jwt_secret\u003cgotham_restful::auth::test::TestData,closure-9\u003e"},{"line":116,"address":[2540683],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[2540934,2540784,2541024,2541174],"length":1,"stats":{"Line":2},"fn_name":"from_source\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":188,"address":[2541066,2540826],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[2541082,2540842],"length":1,"stats":{"Line":2},"fn_name":null},{"line":190,"address":[2540849,2541089],"length":1,"stats":{"Line":2},"fn_name":null},{"line":200,"address":[2541518,2541264],"length":1,"stats":{"Line":2},"fn_name":"new\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":205,"address":[2541370],"length":1,"stats":{"Line":2},"fn_name":null},{"line":209,"address":[2544678,2541568,2543216,2543030,2544864,2546333],"length":1,"stats":{"Line":4},"fn_name":"auth_status\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":211,"address":[2543263,2541690,2545143,2541615,2544986,2543495,2544911,2543338,2541847],"length":1,"stats":{"Line":5},"fn_name":null},{"line":212,"address":[2543405,2541810,2541757,2543458,2544996,2541626,2543348,2545053,2541700,2545106,2544922,2543274],"length":1,"stats":{"Line":9},"fn_name":null},{"line":213,"address":[2546781,2546672,2546592,2546976,2547005,2545037,2546752,2541741,2546702,2546622,2546864,2546512,2546893,2543389,2546542],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":214,"address":[2543426,2541778,2547536,2547705,2547913,2547497,2545074,2547744,2547328],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":215,"address":[2547837,2547782,2547574,2547629,2547366,2547421],"length":1,"stats":{"Line":2},"fn_name":null},{"line":216,"address":[2547385,2547801,2547593],"length":1,"stats":{"Line":1},"fn_name":null},{"line":217,"address":[2547118,2547198,2547248,2547168,2547088,2547278],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":219,"address":[2541860,2545156,2543508,2541917,2543565,2545213],"length":1,"stats":{"Line":2},"fn_name":null},{"line":220,"address":[2543549,2547979,2548107,2548016,2541901,2548080,2547952,2545197,2548043],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":221,"address":[2548144,2548313,2548233,2548304,2548153,2548224],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":222,"address":[2548406,2548454,2548502,2548432,2548480,2548384],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":223,"address":[2543636,2545284,2543312,2541664,2541988,2544960],"length":1,"stats":{"Line":8},"fn_name":null},{"line":224,"address":[2548608,2548528,2548541,2548701,2548688,2548621],"length":1,"stats":{"Line":8},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":225,"address":[2548937,2548768,2548777,2548857,2548848,2548928],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::StaticAuthHandler\u003e"},{"line":226,"address":[2549168,2549108,2549188,2549028,2549088,2549008],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":227,"address":[2549296,2549366,2549248,2549344,2549318,2549270],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::NoneAuthHandler\u003e"},{"line":231,"address":[2542109,2545405,2543757],"length":1,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[2543714,2542119,2545415,2543767,2542066,2545362],"length":1,"stats":{"Line":7},"fn_name":null},{"line":233,"address":[2543745,2542097,2545393],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[2550105,2545479,2549392,2543831,2542183],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003cgotham_restful::auth::test::TestData,gotham_restful::auth::test::TestAssertingHandler\u003e"},{"line":238,"address":[2549652,2549430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":239,"address":[2549588,2549838,2549675],"length":1,"stats":{"Line":2},"fn_name":null},{"line":240,"address":[2550017,2549804,2549878],"length":1,"stats":{"Line":2},"fn_name":null},{"line":244,"address":[2545576,2542273,2543921],"length":1,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[2542230,2545533,2543878,2543923,2542275,2545578],"length":1,"stats":{"Line":5},"fn_name":null},{"line":246,"address":[2542261,2545564,2543909],"length":1,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[2542549,2543995,2542347,2544197,2545650,2545852],"length":1,"stats":{"Line":2},"fn_name":null},{"line":251,"address":[2542499,2542551,2545802,2544147,2544199,2545854],"length":1,"stats":{"Line":4},"fn_name":null},{"line":252,"address":[2545817,2542514,2544162],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[2546011,2544356,2542669,2542708,2544317,2545972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[2545991,2544336,2542688],"length":1,"stats":{"Line":1},"fn_name":null},{"line":259,"address":[2544376,2542728,2546031],"length":1,"stats":{"Line":2},"fn_name":null},{"line":268,"address":[3828236,3827253,3828800,3825408,3825888,3829205,3825813,3826848,3828320,3826368,3827328,3827733,3828725,3827808,3826293,3826773],"length":1,"stats":{"Line":1},"fn_name":"call\u003copenapi_specification::AuthData,gotham_restful::auth::StaticAuthHandler,closure-0\u003e"},{"line":273,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":54,"coverable":68},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","cors.rs"],"content":"use gotham::{\n\thandler::HandlerFuture,\n\thelpers::http::response::create_empty_response,\n\thyper::{\n\t\theader::{\n\t\t\tHeaderMap, HeaderName, HeaderValue, ACCESS_CONTROL_ALLOW_CREDENTIALS, ACCESS_CONTROL_ALLOW_HEADERS,\n\t\t\tACCESS_CONTROL_ALLOW_METHODS, ACCESS_CONTROL_ALLOW_ORIGIN, ACCESS_CONTROL_MAX_AGE,\n\t\t\tACCESS_CONTROL_REQUEST_HEADERS, ACCESS_CONTROL_REQUEST_METHOD, ORIGIN, VARY\n\t\t},\n\t\tBody, Method, Response, StatusCode\n\t},\n\tmiddleware::Middleware,\n\tpipeline::chain::PipelineHandleChain,\n\trouter::{\n\t\tbuilder::{DefineSingleRoute, DrawRoutes, ExtendRouteMatcher},\n\t\troute::matcher::AccessControlRequestMethodMatcher\n\t},\n\tstate::{FromState, State}\n};\nuse std::{panic::RefUnwindSafe, pin::Pin};\n\n/**\nSpecify the allowed origins of the request. It is up to the browser to check the validity of the\norigin. This, when sent to the browser, will indicate whether or not the request's origin was\nallowed to make the request.\n*/\n#[derive(Clone, Debug)]\npub enum Origin {\n\t/// Do not send any `Access-Control-Allow-Origin` headers.\n\tNone,\n\t/// Send `Access-Control-Allow-Origin: *`. Note that browser will not send credentials.\n\tStar,\n\t/// Set the `Access-Control-Allow-Origin` header to a single origin.\n\tSingle(String),\n\t/// Copy the `Origin` header into the `Access-Control-Allow-Origin` header.\n\tCopy\n}\n\nimpl Default for Origin {\n\tfn default() -\u003e Self {\n\t\tSelf::None\n\t}\n}\n\nimpl Origin {\n\t/// Get the header value for the `Access-Control-Allow-Origin` header.\n\tfn header_value(\u0026self, state: \u0026State) -\u003e Option\u003cHeaderValue\u003e {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e None,\n\t\t\tSelf::Star =\u003e Some(\"*\".parse().unwrap()),\n\t\t\tSelf::Single(origin) =\u003e Some(origin.parse().unwrap()),\n\t\t\tSelf::Copy =\u003e {\n\t\t\t\tlet headers = HeaderMap::borrow_from(state);\n\t\t\t\theaders.get(ORIGIN).map(Clone::clone)\n\t\t\t}\n\t\t}\n\t}\n\n\t/// Returns true if the `Vary` header has to include `Origin`.\n\tfn varies(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::Copy)\n\t}\n}\n\n/**\nSpecify the allowed headers of the request. It is up to the browser to check that only the allowed\nheaders are sent with the request.\n*/\n#[derive(Clone, Debug)]\npub enum Headers {\n\t/// Do not send any `Access-Control-Allow-Headers` headers.\n\tNone,\n\t/// Set the `Access-Control-Allow-Headers` header to the following header list. If empty, this\n\t/// is treated as if it was [None].\n\tList(Vec\u003cHeaderName\u003e),\n\t/// Copy the `Access-Control-Request-Headers` header into the `Access-Control-Allow-Header`\n\t/// header.\n\tCopy\n}\n\nimpl Default for Headers {\n\tfn default() -\u003e Self {\n\t\tSelf::None\n\t}\n}\n\nimpl Headers {\n\t/// Get the header value for the `Access-Control-Allow-Headers` header.\n\tfn header_value(\u0026self, state: \u0026State) -\u003e Option\u003cHeaderValue\u003e {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e None,\n\t\t\tSelf::List(list) =\u003e Some(list.join(\",\").parse().unwrap()),\n\t\t\tSelf::Copy =\u003e {\n\t\t\t\tlet headers = HeaderMap::borrow_from(state);\n\t\t\t\theaders.get(ACCESS_CONTROL_REQUEST_HEADERS).map(Clone::clone)\n\t\t\t}\n\t\t}\n\t}\n\n\t/// Returns true if the `Vary` header has to include `Origin`.\n\tfn varies(\u0026self) -\u003e bool {\n\t\tmatches!(self, Self::Copy)\n\t}\n}\n\n/**\nThis is the configuration that the CORS handler will follow. Its default configuration is basically\nnot to touch any responses, resulting in the browser's default behaviour.\n\nTo change settings, you need to put this type into gotham's [State]:\n\n```rust,no_run\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::{*, cors::Origin};\n# #[cfg_attr(feature = \"cargo-clippy\", allow(clippy::needless_doctest_main))]\nfn main() {\n\tlet cors = CorsConfig {\n\t\torigin: Origin::Star,\n\t\t..Default::default()\n\t};\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(cors).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\t// your routing logic\n\t}));\n}\n```\n\nThis easy approach allows you to have one global cors configuration. If you prefer to have separate\nconfigurations for different scopes, you need to register the middleware inside your routing logic:\n\n```rust,no_run\n# use gotham::{router::builder::*, pipeline::*, pipeline::set::*, state::State};\n# use gotham_restful::{*, cors::Origin};\nlet pipelines = new_pipeline_set();\n\n// The first cors configuration\nlet cors_a = CorsConfig {\n\torigin: Origin::Star,\n\t..Default::default()\n};\nlet (pipelines, chain_a) = pipelines.add(\n\tnew_pipeline().add(cors_a).build()\n);\n\n// The second cors configuration\nlet cors_b = CorsConfig {\n\torigin: Origin::Copy,\n\t..Default::default()\n};\nlet (pipelines, chain_b) = pipelines.add(\n\tnew_pipeline().add(cors_b).build()\n);\n\nlet pipeline_set = finalize_pipeline_set(pipelines);\ngotham::start(\"127.0.0.1:8080\", build_router((), pipeline_set, |route| {\n\t// routing without any cors config\n\troute.with_pipeline_chain((chain_a, ()), |route| {\n\t\t// routing with cors config a\n\t});\n\troute.with_pipeline_chain((chain_b, ()), |route| {\n\t\t// routing with cors config b\n\t});\n}));\n```\n*/\n#[derive(Clone, Debug, Default, NewMiddleware, StateData)]\npub struct CorsConfig {\n\t/// The allowed origins.\n\tpub origin: Origin,\n\t/// The allowed headers.\n\tpub headers: Headers,\n\t/// The amount of seconds that the preflight request can be cached.\n\tpub max_age: u64,\n\t/// Whether or not the request may be made with supplying credentials.\n\tpub credentials: bool\n}\n\nimpl Middleware for CorsConfig {\n\tfn call\u003cChain\u003e(self, mut state: State, chain: Chain) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\twhere\n\t\tChain: FnOnce(State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e\n\t{\n\t\tstate.put(self);\n\t\tchain(state)\n\t}\n}\n\n/**\nHandle CORS for a non-preflight request. This means manipulating the `res` HTTP headers so that\nthe response is aligned with the `state`'s [CorsConfig].\n\nIf you are using the [Resource](crate::Resource) type (which is the recommended way), you'll never\nhave to call this method. However, if you are writing your own handler method, you might want to\ncall this after your request to add the required CORS headers.\n\nFor further information on CORS, read \u003chttps://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\u003e.\n*/\npub fn handle_cors(state: \u0026State, res: \u0026mut Response\u003cBody\u003e) {\n\tlet config = CorsConfig::try_borrow_from(state);\n\tif let Some(cfg) = config {\n\t\tlet headers = res.headers_mut();\n\n\t\t// non-preflight requests require the Access-Control-Allow-Origin header\n\t\tif let Some(header) = cfg.origin.header_value(state) {\n\t\t\theaders.insert(ACCESS_CONTROL_ALLOW_ORIGIN, header);\n\t\t}\n\n\t\t// if the origin is copied over, we should tell the browser by specifying the Vary header\n\t\tif cfg.origin.varies() {\n\t\t\tlet vary = headers.get(VARY).map(|vary| format!(\"{},origin\", vary.to_str().unwrap()));\n\t\t\theaders.insert(VARY, vary.as_deref().unwrap_or(\"origin\").parse().unwrap());\n\t\t}\n\n\t\t// if we allow credentials, tell the browser\n\t\tif cfg.credentials {\n\t\t\theaders.insert(ACCESS_CONTROL_ALLOW_CREDENTIALS, HeaderValue::from_static(\"true\"));\n\t\t}\n\t}\n}\n\n/// Add CORS routing for your path. This is required for handling preflight requests.\n///\n/// Example:\n///\n/// ```rust,no_run\n/// # use gotham::{hyper::{Body, Method, Response}, router::builder::*};\n/// # use gotham_restful::*;\n/// build_simple_router(|router| {\n/// \t// The handler that needs preflight handling\n/// \trouter.post(\"/foo\").to(|state| {\n/// \t\tlet mut res : Response\u003cBody\u003e = unimplemented!();\n/// \t\thandle_cors(\u0026state, \u0026mut res);\n/// \t\t(state, res)\n/// \t});\n/// \t// Add preflight handling\n/// \trouter.cors(\"/foo\", Method::POST);\n/// });\n/// ```\npub trait CorsRoute\u003cC, P\u003e\nwhere\n\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\tP: RefUnwindSafe + Send + Sync + 'static\n{\n\t/// Handle a preflight request on `path` for `method`. To configure the behaviour, use\n\t/// [CorsConfig].\n\tfn cors(\u0026mut self, path: \u0026str, method: Method);\n}\n\npub(crate) fn cors_preflight_handler(state: State) -\u003e (State, Response\u003cBody\u003e) {\n\tlet config = CorsConfig::try_borrow_from(\u0026state);\n\n\t// prepare the response\n\tlet mut res = create_empty_response(\u0026state, StatusCode::NO_CONTENT);\n\tlet headers = res.headers_mut();\n\tlet mut vary: Vec\u003cHeaderName\u003e = Vec::new();\n\n\t// copy the request method over to the response\n\tlet method = HeaderMap::borrow_from(\u0026state)\n\t\t.get(ACCESS_CONTROL_REQUEST_METHOD)\n\t\t.unwrap()\n\t\t.clone();\n\theaders.insert(ACCESS_CONTROL_ALLOW_METHODS, method);\n\tvary.push(ACCESS_CONTROL_REQUEST_METHOD);\n\n\tif let Some(cfg) = config {\n\t\t// if we allow any headers, copy them over\n\t\tif let Some(header) = cfg.headers.header_value(\u0026state) {\n\t\t\theaders.insert(ACCESS_CONTROL_ALLOW_HEADERS, header);\n\t\t}\n\n\t\t// if the headers are copied over, we should tell the browser by specifying the Vary header\n\t\tif cfg.headers.varies() {\n\t\t\tvary.push(ACCESS_CONTROL_REQUEST_HEADERS);\n\t\t}\n\n\t\t// set the max age for the preflight cache\n\t\tif let Some(age) = config.map(|cfg| cfg.max_age) {\n\t\t\theaders.insert(ACCESS_CONTROL_MAX_AGE, age.into());\n\t\t}\n\t}\n\n\t// make sure the browser knows that this request was based on the method\n\theaders.insert(VARY, vary.join(\",\").parse().unwrap());\n\n\thandle_cors(\u0026state, \u0026mut res);\n\t(state, res)\n}\n\nimpl\u003cD, C, P\u003e CorsRoute\u003cC, P\u003e for D\nwhere\n\tD: DrawRoutes\u003cC, P\u003e,\n\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\tP: RefUnwindSafe + Send + Sync + 'static\n{\n\tfn cors(\u0026mut self, path: \u0026str, method: Method) {\n\t\tlet matcher = AccessControlRequestMethodMatcher::new(method);\n\t\tself.options(path).extend_route_matcher(matcher).to(cors_preflight_handler);\n\t}\n}\n","traces":[{"line":40,"address":[2000864],"length":1,"stats":{"Line":2},"fn_name":"default"},{"line":41,"address":[2000867],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[2000880],"length":1,"stats":{"Line":1},"fn_name":"header_value"},{"line":48,"address":[2000981,2001176,2001063,2000992],"length":1,"stats":{"Line":3},"fn_name":null},{"line":49,"address":[2000988,2000923],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[2000997],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[2001073],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[2000957],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[2001178],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[2001264],"length":1,"stats":{"Line":1},"fn_name":"varies"},{"line":61,"address":[2001273],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[2001312],"length":1,"stats":{"Line":2},"fn_name":"default"},{"line":83,"address":[2001315],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[2001328,2001728],"length":1,"stats":{"Line":1},"fn_name":"header_value"},{"line":90,"address":[2001439,2001428],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[2001371,2001435],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[2001449,2001714],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[2001404],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[2001639],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[2001776],"length":1,"stats":{"Line":1},"fn_name":"varies"},{"line":102,"address":[2001785],"length":1,"stats":{"Line":1},"fn_name":null},{"line":179,"address":[1998380,1998448,1998044,1998716,1997776,1998112],"length":1,"stats":{"Line":3},"fn_name":"call\u003cclosure-0\u003e"},{"line":183,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":198,"address":[2001824,2002628],"length":1,"stats":{"Line":5},"fn_name":"handle_cors"},{"line":199,"address":[2001857],"length":1,"stats":{"Line":5},"fn_name":null},{"line":200,"address":[2001875],"length":1,"stats":{"Line":5},"fn_name":null},{"line":201,"address":[2001926],"length":1,"stats":{"Line":1},"fn_name":null},{"line":204,"address":[2001955],"length":1,"stats":{"Line":1},"fn_name":null},{"line":205,"address":[2002039],"length":1,"stats":{"Line":1},"fn_name":null},{"line":209,"address":[2002205,2002144,2002656],"length":1,"stats":{"Line":3},"fn_name":null},{"line":210,"address":[2002768,2002806,2002154,2002215],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":211,"address":[2002236],"length":1,"stats":{"Line":1},"fn_name":null},{"line":215,"address":[2002528,2002604,2002495],"length":1,"stats":{"Line":3},"fn_name":null},{"line":216,"address":[2002501,2002530],"length":1,"stats":{"Line":2},"fn_name":null},{"line":249,"address":[2004775,2003008],"length":1,"stats":{"Line":1},"fn_name":"cors_preflight_handler"},{"line":250,"address":[2003050],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[2003124],"length":1,"stats":{"Line":1},"fn_name":null},{"line":254,"address":[2003156],"length":1,"stats":{"Line":1},"fn_name":null},{"line":255,"address":[2003204],"length":1,"stats":{"Line":1},"fn_name":null},{"line":258,"address":[2003219],"length":1,"stats":{"Line":1},"fn_name":null},{"line":262,"address":[2003367],"length":1,"stats":{"Line":1},"fn_name":null},{"line":263,"address":[2003515],"length":1,"stats":{"Line":1},"fn_name":null},{"line":265,"address":[2003583],"length":1,"stats":{"Line":1},"fn_name":null},{"line":267,"address":[2003643],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[2003766],"length":1,"stats":{"Line":1},"fn_name":null},{"line":272,"address":[2004803,2004010,2003923],"length":1,"stats":{"Line":3},"fn_name":null},{"line":273,"address":[2003942],"length":1,"stats":{"Line":1},"fn_name":null},{"line":277,"address":[2005072,2004014,2004227,2005081],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":278,"address":[2004103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":283,"address":[2004237,2004746],"length":1,"stats":{"Line":1},"fn_name":null},{"line":285,"address":[2004532],"length":1,"stats":{"Line":1},"fn_name":null},{"line":286,"address":[2004547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":53,"coverable":58},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","endpoint.rs"],"content":"use crate::{IntoResponse, RequestBody};\nuse futures_util::future::BoxFuture;\nuse gotham::{\n\textractor::{PathExtractor, QueryStringExtractor},\n\thyper::{Body, Method, Response},\n\trouter::response::extender::StaticResponseExtender,\n\tstate::{State, StateData}\n};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\nuse serde::{Deserialize, Deserializer};\nuse std::borrow::Cow;\n\n/// A no-op extractor that can be used as a default type for [Endpoint::Placeholders] and\n/// [Endpoint::Params].\n#[derive(Debug, Clone, Copy)]\npub struct NoopExtractor;\n\nimpl\u003c'de\u003e Deserialize\u003c'de\u003e for NoopExtractor {\n\tfn deserialize\u003cD: Deserializer\u003c'de\u003e\u003e(_: D) -\u003e Result\u003cSelf, D::Error\u003e {\n\t\tOk(Self)\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl OpenapiType for NoopExtractor {\n\tfn schema() -\u003e OpenapiSchema {\n\t\twarn!(\"You're asking for the OpenAPI Schema for gotham_restful::NoopExtractor. This is probably not what you want.\");\n\t\t\u003c() as OpenapiType\u003e::schema()\n\t}\n}\n\nimpl StateData for NoopExtractor {}\n\nimpl StaticResponseExtender for NoopExtractor {\n\ttype ResBody = Body;\n\tfn extend(_: \u0026mut State, _: \u0026mut Response\u003cBody\u003e) {}\n}\n\n// TODO: Specify default types once https://github.com/rust-lang/rust/issues/29661 lands.\n#[_private_openapi_trait(EndpointWithSchema)]\npub trait Endpoint {\n\t/// The HTTP Verb of this endpoint.\n\tfn http_method() -\u003e Method;\n\t/// The URI that this endpoint listens on in gotham's format.\n\tfn uri() -\u003e Cow\u003c'static, str\u003e;\n\n\t/// The verb used for generating an operation id if [Self::operation_id] returns [None].\n\t/// For example `read`, `read_all`, `create`, `update` etc.\n\t#[openapi_only]\n\tfn operation_verb() -\u003e Option\u003c\u0026'static str\u003e;\n\n\t/// The output type that provides the response.\n\t#[openapi_bound(\"Output: crate::ResponseSchema\")]\n\ttype Output: IntoResponse + Send;\n\n\t/// Returns `true` _iff_ the URI contains placeholders. `false` by default.\n\tfn has_placeholders() -\u003e bool {\n\t\tfalse\n\t}\n\t/// The type that parses the URI placeholders. Use [NoopExtractor] if `has_placeholders()`\n\t/// returns `false`.\n\t#[openapi_bound(\"Placeholders: OpenapiType\")]\n\ttype Placeholders: PathExtractor\u003cBody\u003e + Clone + Sync;\n\n\t/// Returns `true` _iff_ the request parameters should be parsed. `false` by default.\n\tfn needs_params() -\u003e bool {\n\t\tfalse\n\t}\n\t/// The type that parses the request parameters. Use [NoopExtractor] if `needs_params()`\n\t/// returns `false`.\n\t#[openapi_bound(\"Params: OpenapiType\")]\n\ttype Params: QueryStringExtractor\u003cBody\u003e + Clone + Sync;\n\n\t/// Returns `true` _iff_ the request body should be parsed. `false` by default.\n\tfn needs_body() -\u003e bool {\n\t\tfalse\n\t}\n\t/// The type to parse the body into. Use `()` if `needs_body()` returns `false`.\n\ttype Body: RequestBody + Send;\n\n\t/// Returns `true` if the request wants to know the auth status of the client. `false` by default.\n\tfn wants_auth() -\u003e bool {\n\t\tfalse\n\t}\n\n\t/// Replace the automatically generated operation id with a custom one. Only relevant for the\n\t/// OpenAPI Specification.\n\t#[openapi_only]\n\tfn operation_id() -\u003e Option\u003cString\u003e {\n\t\tNone\n\t}\n\n\t/// Add a description to the openapi specification. Usually taken from the rustdoc comment\n\t/// when using the proc macro.\n\t#[openapi_only]\n\tfn description() -\u003e Option\u003cString\u003e {\n\t\tNone\n\t}\n\n\t/// The handler for this endpoint.\n\tfn handle(\n\t\tstate: \u0026mut State,\n\t\tplaceholders: Self::Placeholders,\n\t\tparams: Self::Params,\n\t\tbody: Option\u003cSelf::Body\u003e\n\t) -\u003e BoxFuture\u003c'_, Self::Output\u003e;\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cE: EndpointWithSchema\u003e Endpoint for E {\n\tfn http_method() -\u003e Method {\n\t\tE::http_method()\n\t}\n\tfn uri() -\u003e Cow\u003c'static, str\u003e {\n\t\tE::uri()\n\t}\n\n\ttype Output = E::Output;\n\n\tfn has_placeholders() -\u003e bool {\n\t\tE::has_placeholders()\n\t}\n\ttype Placeholders = E::Placeholders;\n\n\tfn needs_params() -\u003e bool {\n\t\tE::needs_params()\n\t}\n\ttype Params = E::Params;\n\n\tfn needs_body() -\u003e bool {\n\t\tE::needs_body()\n\t}\n\ttype Body = E::Body;\n\n\tfn wants_auth() -\u003e bool {\n\t\tE::wants_auth()\n\t}\n\n\tfn handle\u003c'a\u003e(\n\t\tstate: \u0026'a mut State,\n\t\tplaceholders: Self::Placeholders,\n\t\tparams: Self::Params,\n\t\tbody: Option\u003cSelf::Body\u003e\n\t) -\u003e BoxFuture\u003c'a, Self::Output\u003e {\n\t\tE::handle(state, placeholders, params, body)\n\t}\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":21,"address":[3277897,3277848],"length":1,"stats":{"Line":10},"fn_name":null},{"line":27,"address":[4106128],"length":1,"stats":{"Line":0},"fn_name":"schema"},{"line":28,"address":[4106142,4106213],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[4106338],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[4106381,4106386,4106368],"length":1,"stats":{"Line":0},"fn_name":"extend"},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":98,"address":[3111843],"length":1,"stats":{"Line":6},"fn_name":null},{"line":112,"address":[3187456],"length":1,"stats":{"Line":29},"fn_name":"http_method\u003copenapi_supports_scope::read_all___gotham_restful_endpoint\u003e"},{"line":113,"address":[3187464],"length":1,"stats":{"Line":29},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":29},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":29},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":21},"fn_name":null}],"covered":14,"coverable":32},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","lib.rs"],"content":"#![warn(missing_debug_implementations, rust_2018_idioms, unreachable_pub)]\n#![forbid(unsafe_code)]\n// deny warnings in CI\n#![cfg_attr(gotham_restful_deny_warnings, allow(renamed_and_removed_lints))]\n#![cfg_attr(gotham_restful_deny_warnings, deny(warnings))]\n// clippy doesn't like our code style\n#![cfg_attr(feature = \"cargo-clippy\", allow(clippy::tabs_in_doc_comments))]\n// intra-doc links only fully work when OpenAPI is enabled\n#![cfg_attr(feature = \"openapi\", deny(broken_intra_doc_links))]\n#![cfg_attr(not(feature = \"openapi\"), allow(broken_intra_doc_links))]\n\n/*!\nThis crate is an extension to the popular [gotham web framework][gotham] for Rust. It allows you to\ncreate resources with assigned endpoints that aim to be a more convenient way of creating handlers\nfor requests.\n\n# Features\n\n - Automatically parse **JSON** request and produce response bodies\n - Allow using **raw** request and response bodies\n - Convenient **macros** to create responses that can be registered with gotham's router\n - Auto-Generate an **OpenAPI** specification for your API\n - Manage **CORS** headers so you don't have to\n - Manage **Authentication** with JWT\n - Integrate diesel connection pools for easy **database** integration\n\n# Safety\n\nThis crate is just as safe as you'd expect from anything written in safe Rust - and\n`#![forbid(unsafe_code)]` ensures that no unsafe was used.\n\n# Endpoints\n\nThere are a set of pre-defined endpoints that should cover the majority of REST APIs. However,\nit is also possible to define your own endpoints.\n\n## Pre-defined Endpoints\n\nAssuming you assign `/foobar` to your resource, the following pre-defined endpoints exist:\n\n| Endpoint Name | Required Arguments | HTTP Verb | HTTP Path      |\n| ------------- | ------------------ | --------- | -------------- |\n| read_all      |                    | GET       | /foobar        |\n| read          | id                 | GET       | /foobar/:id    |\n| search        | query              | GET       | /foobar/search |\n| create        | body               | POST      | /foobar        |\n| update_all    | body               | PUT       | /foobar        |\n| update        | id, body           | PUT       | /foobar/:id    |\n| delete_all    |                    | DELETE    | /foobar        |\n| delete        | id                 | DELETE    | /foobar/:id    |\n\nEach of those endpoints has a macro that creates the neccessary boilerplate for the Resource. A\nsimple example looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n/// Our RESTful resource.\n#[derive(Resource)]\n#[resource(read)]\nstruct FooResource;\n\n/// The return type of the foo read endpoint.\n#[derive(Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Foo {\n\tid: u64\n}\n\n/// The foo read endpoint.\n#[read]\nfn read(id: u64) -\u003e Success\u003cFoo\u003e {\n\tFoo { id }.into()\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cFooResource\u003e(\"foo\");\n# \t}));\n# }\n```\n\n## Custom Endpoints\n\nDefining custom endpoints is done with the `#[endpoint]` macro. The syntax is similar to that\nof the pre-defined endpoints, but you need to give it more context:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_derive;\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(custom_endpoint)]\nstruct CustomResource;\n\n/// This type is used to parse path parameters.\n#[derive(Clone, Deserialize, StateData, StaticResponseExtender)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct CustomPath {\n\tname: String\n}\n\n#[endpoint(uri = \"custom/:name/read\", method = \"Method::GET\", params = false, body = false)]\nfn custom_endpoint(path: CustomPath) -\u003e Success\u003cString\u003e {\n\tpath.name.into()\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cCustomResource\u003e(\"custom\");\n# \t}));\n# }\n```\n\n# Arguments\n\nSome endpoints require arguments. Those should be\n * **id** Should be a deserializable json-primitive like [`i64`] or [`String`].\n * **body** Should be any deserializable object, or any type implementing [`RequestBody`].\n * **query** Should be any deserializable object whose variables are json-primitives. It will\n   however not be parsed from json, but from HTTP GET parameters like in `search?id=1`. The\n   type needs to implement [`QueryStringExtractor`](gotham::extractor::QueryStringExtractor).\n\nAdditionally, all handlers may take a reference to gotham's [`State`]. Please note that for async\nhandlers, it needs to be a mutable reference until rustc's lifetime checks across await bounds\nimprove.\n\n# Uploads and Downloads\n\nBy default, every request body is parsed from json, and every respone is converted to json using\n[serde_json]. However, you may also use raw bodies. This is an example where the request body\nis simply returned as the response again, no json parsing involved:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(create)]\nstruct ImageResource;\n\n#[derive(FromBody, RequestBody)]\n#[supported_types(mime::IMAGE_GIF, mime::IMAGE_JPEG, mime::IMAGE_PNG)]\nstruct RawImage {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n\n#[create]\nfn create(body : RawImage) -\u003e Raw\u003cVec\u003cu8\u003e\u003e {\n\tRaw::new(body.content, body.content_type)\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cImageResource\u003e(\"image\");\n# \t}));\n# }\n```\n\n# Custom HTTP Headers\n\nYou can read request headers from the state as you would in any other gotham handler, and specify\ncustom response headers using [Response::header].\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::hyper::header::{ACCEPT, HeaderMap, VARY};\n# use gotham::{router::builder::*, state::State};\n# use gotham_restful::*;\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nasync fn read_all(state: \u0026mut State) -\u003e NoContent {\n\tlet headers: \u0026HeaderMap = state.borrow();\n\tlet accept = \u0026headers[ACCEPT];\n# drop(accept);\n\n\tlet mut res = NoContent::default();\n\tres.header(VARY, \"accept\".parse().unwrap());\n\tres\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cFooResource\u003e(\"foo\");\n# \t}));\n# }\n```\n\n# Features\n\nTo make life easier for common use-cases, this create offers a few features that might be helpful\nwhen you implement your web server.  The complete feature list is\n - [`auth`](#authentication-feature) Advanced JWT middleware\n - `chrono` openapi support for chrono types\n - `full` enables all features except `without-openapi`\n - [`cors`](#cors-feature) CORS handling for all endpoint handlers\n - [`database`](#database-feature) diesel middleware support\n - `errorlog` log errors returned from endpoint handlers\n - [`openapi`](#openapi-feature) router additions to generate an openapi spec\n - `uuid` openapi support for uuid\n - `without-openapi` (**default**) disables `openapi` support.\n\n## Authentication Feature\n\nIn order to enable authentication support, enable the `auth` feature gate. This allows you to\nregister a middleware that can automatically check for the existence of an JWT authentication\ntoken. Besides being supported by the endpoint macros, it supports to lookup the required JWT secret\nwith the JWT data, hence you can use several JWT secrets and decide on the fly which secret to use.\nNone of this is currently supported by gotham's own JWT middleware.\n\nA simple example that uses only a single secret looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"auth\")]\n# mod auth_feature_enabled {\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(read)]\nstruct SecretResource;\n\n#[derive(Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Secret {\n\tid: u64,\n\tintended_for: String\n}\n\n#[derive(Deserialize, Clone)]\nstruct AuthData {\n\tsub: String,\n\texp: u64\n}\n\n#[read]\nfn read(auth: AuthStatus\u003cAuthData\u003e, id: u64) -\u003e AuthSuccess\u003cSecret\u003e {\n\tlet intended_for = auth.ok()?.sub;\n\tOk(Secret { id, intended_for })\n}\n\nfn main() {\n\tlet auth: AuthMiddleware\u003cAuthData, _\u003e = AuthMiddleware::new(\n\t\tAuthSource::AuthorizationHeader,\n\t\tAuthValidation::default(),\n\t\tStaticAuthHandler::from_array(b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\")\n\t);\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(auth).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cSecretResource\u003e(\"secret\");\n\t}));\n}\n# }\n```\n\n## CORS Feature\n\nThe cors feature allows an easy usage of this web server from other origins. By default, only\nthe `Access-Control-Allow-Methods` header is touched. To change the behaviour, add your desired\nconfiguration as a middleware.\n\nA simple example that allows authentication from every origin (note that `*` always disallows\nauthentication), and every content type, looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"cors\")]\n# mod cors_feature_enabled {\n# use gotham::{hyper::header::*, router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_restful::{*, cors::*};\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() {\n\t// your handler\n}\n\nfn main() {\n\tlet cors = CorsConfig {\n\t\torigin: Origin::Copy,\n\t\theaders: Headers::List(vec![CONTENT_TYPE]),\n\t\tmax_age: 0,\n\t\tcredentials: true\n\t};\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(cors).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cFooResource\u003e(\"foo\");\n\t}));\n}\n# }\n```\n\nThe cors feature can also be used for non-resource handlers. Take a look at [`CorsRoute`]\nfor an example.\n\n## Database Feature\n\nThe database feature allows an easy integration of [diesel] into your handler functions. Please\nnote however that due to the way gotham's diesel middleware implementation, it is not possible\nto run async code while holding a database connection. If you need to combine async and database,\nyou'll need to borrow the connection from the [`State`] yourself and return a boxed future.\n\nA simple non-async example looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate diesel;\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"database\")]\n# mod database_feature_enabled {\n# use diesel::{table, PgConnection, QueryResult, RunQueryDsl};\n# use gotham::{router::builder::*, pipeline::{new_pipeline, single::single_pipeline}, state::State};\n# use gotham_middleware_diesel::DieselMiddleware;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n# use std::env;\n# table! {\n#   foo (id) {\n#     id -\u003e Int8,\n#     value -\u003e Text,\n#   }\n# }\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[derive(Queryable, Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Foo {\n\tid: i64,\n\tvalue: String\n}\n\n#[read_all]\nfn read_all(conn: \u0026PgConnection) -\u003e QueryResult\u003cVec\u003cFoo\u003e\u003e {\n\tfoo::table.load(conn)\n}\n\ntype Repo = gotham_middleware_diesel::Repo\u003cPgConnection\u003e;\n\nfn main() {\n\tlet repo = Repo::new(\u0026env::var(\"DATABASE_URL\").unwrap());\n\tlet diesel = DieselMiddleware::new(repo);\n\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(diesel).build());\n\tgotham::start(\"127.0.0.1:8080\", build_router(chain, pipelines, |route| {\n\t\troute.resource::\u003cFooResource\u003e(\"foo\");\n\t}));\n}\n# }\n```\n\n## OpenAPI Feature\n\nThe OpenAPI feature is probably the most powerful one of this crate. Definitely read this section\ncarefully both as a binary as well as a library author to avoid unwanted suprises.\n\nIn order to automatically create an openapi specification, gotham-restful needs knowledge over\nall routes and the types returned. `serde` does a great job at serialization but doesn't give\nenough type information, so all types used in the router need to implement\n[`OpenapiType`](openapi_type::OpenapiType). This can be derived for almoust any type and there\nshould be no need to implement it manually. A simple example looks like this:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"openapi\")]\n# mod openapi_feature_enabled {\n# use gotham::{router::builder::*, state::State};\n# use gotham_restful::*;\n# use openapi_type::OpenapiType;\n# use serde::{Deserialize, Serialize};\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[derive(OpenapiType, Serialize)]\nstruct Foo {\n\tbar: String\n}\n\n#[read_all]\nfn read_all() -\u003e Success\u003cFoo\u003e {\n\tFoo { bar: \"Hello World\".to_owned() }.into()\n}\n\nfn main() {\n\tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n\t\tlet info = OpenapiInfo {\n\t\t\ttitle: \"My Foo API\".to_owned(),\n\t\t\tversion: \"0.1.0\".to_owned(),\n\t\t\turls: vec![\"https://example.org/foo/api/v1\".to_owned()]\n\t\t};\n\t\troute.with_openapi(info, |mut route| {\n\t\t\troute.resource::\u003cFooResource\u003e(\"foo\");\n\t\t\troute.openapi_spec(\"openapi\");\n\t\t\troute.openapi_doc(\"/\");\n\t\t});\n\t}));\n}\n# }\n```\n\nAbove example adds the resource as before, but adds two other endpoints as well: `/openapi` and `/`.\nThe first one will return the generated openapi specification in JSON format, allowing you to easily\ngenerate clients in different languages without worying to exactly replicate your api in each of those\nlanguages. The second one will return documentation in HTML format, so you can easily view your\napi and share it with other people.\n\nHowever, please note that by default, the `without-openapi` feature of this crate is enabled.\nDisabling it in favour of the `openapi` feature will add additional type bounds and method requirements\nto some of the traits and types in this crate, for example instead of [`Endpoint`] you now have to\nimplement [`EndpointWithSchema`]. This means that some code might only compile on either feature, but not\non both. If you are writing a library that uses gotham-restful, it is strongly recommended to pass both\nfeatures through and conditionally enable the openapi code, like this:\n\n```rust\n# #[macro_use] extern crate gotham_restful;\n# use serde::{Deserialize, Serialize};\n#[derive(Deserialize, Serialize)]\n#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct Foo;\n```\n\n [diesel]: https://diesel.rs/\n [`State`]: gotham::state::State\n*/\n\n#[cfg(all(feature = \"openapi\", feature = \"without-openapi\"))]\ncompile_error!(\"The 'openapi' and 'without-openapi' features cannot be combined\");\n\n#[cfg(all(not(feature = \"openapi\"), not(feature = \"without-openapi\")))]\ncompile_error!(\"Either the 'openapi' or 'without-openapi' feature needs to be enabled\");\n\n// weird proc macro issue\nextern crate self as gotham_restful;\n\n#[macro_use]\nextern crate gotham_derive;\n#[macro_use]\nextern crate gotham_restful_derive;\n#[macro_use]\nextern crate log;\n#[macro_use]\nextern crate serde;\n\n#[cfg(test)]\n#[macro_use]\nextern crate pretty_assertions;\n\n#[doc(no_inline)]\npub use gotham;\n#[doc(no_inline)]\npub use mime::Mime;\n\npub use gotham_restful_derive::*;\n\n/// Not public API\n#[doc(hidden)]\npub mod private {\n\tpub use crate::routing::PathExtractor as IdPlaceholder;\n\n\tpub use futures_util::future::{BoxFuture, FutureExt};\n\n\tpub use serde_json;\n\n\t#[cfg(feature = \"database\")]\n\tpub use gotham_middleware_diesel::Repo;\n\t#[cfg(feature = \"openapi\")]\n\tpub use openapi_type::{indexmap::IndexMap, openapi, OpenapiSchema, OpenapiType};\n}\n\n#[cfg(feature = \"auth\")]\nmod auth;\n#[cfg(feature = \"auth\")]\npub use auth::{AuthHandler, AuthMiddleware, AuthSource, AuthStatus, AuthValidation, StaticAuthHandler};\n\n#[cfg(feature = \"cors\")]\npub mod cors;\n#[cfg(feature = \"cors\")]\npub use cors::{handle_cors, CorsConfig, CorsRoute};\n\n#[cfg(feature = \"openapi\")]\nmod openapi;\n#[cfg(feature = \"openapi\")]\npub use openapi::{builder::OpenapiInfo, router::GetOpenapi};\n\nmod endpoint;\n#[cfg(feature = \"openapi\")]\npub use endpoint::EndpointWithSchema;\npub use endpoint::{Endpoint, NoopExtractor};\n\nmod response;\npub use response::{\n\tAuthError, AuthError::Forbidden, AuthErrorOrOther, AuthResult, AuthSuccess, IntoResponse, IntoResponseError, NoContent,\n\tRaw, Redirect, Response, Success\n};\n#[cfg(feature = \"openapi\")]\npub use response::{IntoResponseWithSchema, ResponseSchema};\n\nmod routing;\npub use routing::{DrawResourceRoutes, DrawResources};\n#[cfg(feature = \"openapi\")]\npub use routing::{DrawResourceRoutesWithSchema, DrawResourcesWithSchema, WithOpenapi};\n\nmod types;\npub use types::{FromBody, RequestBody, ResponseBody};\n\n/// This trait must be implemented for every resource. It allows you to register the different\n/// endpoints that can be handled by this resource to be registered with the underlying router.\n///\n/// It is not recommended to implement this yourself, just use `#[derive(Resource)]`.\n#[_private_openapi_trait(ResourceWithSchema)]\npub trait Resource {\n\t/// Register all methods handled by this resource with the underlying router.\n\t#[openapi_bound(\"D: crate::DrawResourceRoutesWithSchema\")]\n\t#[non_openapi_bound(\"D: crate::DrawResourceRoutes\")]\n\tfn setup\u003cD\u003e(route: D);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","builder.rs"],"content":"use openapi_type::{\n\tindexmap::IndexMap,\n\topenapi::{\n\t\tself, Components, OpenAPI, PathItem, ReferenceOr,\n\t\tReferenceOr::{Item, Reference},\n\t\tSchema, Server\n\t},\n\tOpenapiSchema\n};\nuse parking_lot::RwLock;\nuse std::sync::Arc;\n\n#[derive(Clone, Debug)]\npub struct OpenapiInfo {\n\tpub title: String,\n\tpub version: String,\n\tpub urls: Vec\u003cString\u003e\n}\n\n#[derive(Clone, Debug)]\npub(crate) struct OpenapiBuilder {\n\tpub(crate) openapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e\n}\n\nimpl OpenapiBuilder {\n\tpub(crate) fn new(info: OpenapiInfo) -\u003e Self {\n\t\tSelf {\n\t\t\topenapi: Arc::new(RwLock::new(OpenAPI {\n\t\t\t\topenapi: \"3.0.2\".to_string(),\n\t\t\t\tinfo: openapi::Info {\n\t\t\t\t\ttitle: info.title,\n\t\t\t\t\tversion: info.version,\n\t\t\t\t\t..Default::default()\n\t\t\t\t},\n\t\t\t\tservers: info\n\t\t\t\t\t.urls\n\t\t\t\t\t.into_iter()\n\t\t\t\t\t.map(|url| Server {\n\t\t\t\t\t\turl,\n\t\t\t\t\t\t..Default::default()\n\t\t\t\t\t})\n\t\t\t\t\t.collect(),\n\t\t\t\t..Default::default()\n\t\t\t}))\n\t\t}\n\t}\n\n\t/// Remove path from the OpenAPI spec, or return an empty one if not included. This is handy if you need to\n\t/// modify the path and add it back after the modification\n\tpub(crate) fn remove_path(\u0026mut self, path: \u0026str) -\u003e PathItem {\n\t\tlet mut openapi = self.openapi.write();\n\t\tmatch openapi.paths.swap_remove(path) {\n\t\t\tSome(Item(item)) =\u003e item,\n\t\t\t_ =\u003e PathItem::default()\n\t\t}\n\t}\n\n\tpub(crate) fn add_path\u003cPath: ToString\u003e(\u0026mut self, path: Path, item: PathItem) {\n\t\tlet mut openapi = self.openapi.write();\n\t\topenapi.paths.insert(path.to_string(), Item(item));\n\t}\n\n\tfn add_schema_impl(\u0026mut self, name: String, mut schema: OpenapiSchema) {\n\t\tself.add_schema_dependencies(\u0026mut schema.dependencies);\n\n\t\tlet mut openapi = self.openapi.write();\n\t\tmatch \u0026mut openapi.components {\n\t\t\tSome(comp) =\u003e {\n\t\t\t\tcomp.schemas.insert(name, Item(schema.into_schema()));\n\t\t\t},\n\t\t\tNone =\u003e {\n\t\t\t\tlet mut comp = Components::default();\n\t\t\t\tcomp.schemas.insert(name, Item(schema.into_schema()));\n\t\t\t\topenapi.components = Some(comp);\n\t\t\t}\n\t\t};\n\t}\n\n\tfn add_schema_dependencies(\u0026mut self, dependencies: \u0026mut IndexMap\u003cString, OpenapiSchema\u003e) {\n\t\tlet keys: Vec\u003cString\u003e = dependencies.keys().map(|k| k.to_string()).collect();\n\t\tfor dep in keys {\n\t\t\tlet dep_schema = dependencies.swap_remove(\u0026dep);\n\t\t\tif let Some(dep_schema) = dep_schema {\n\t\t\t\tself.add_schema_impl(dep, dep_schema);\n\t\t\t}\n\t\t}\n\t}\n\n\tpub(crate) fn add_schema(\u0026mut self, mut schema: OpenapiSchema) -\u003e ReferenceOr\u003cSchema\u003e {\n\t\tmatch schema.name.clone() {\n\t\t\tSome(name) =\u003e {\n\t\t\t\tlet reference = Reference {\n\t\t\t\t\treference: format!(\"#/components/schemas/{}\", name)\n\t\t\t\t};\n\t\t\t\tself.add_schema_impl(name, schema);\n\t\t\t\treference\n\t\t\t},\n\t\t\tNone =\u003e {\n\t\t\t\tself.add_schema_dependencies(\u0026mut schema.dependencies);\n\t\t\t\tItem(schema.into_schema())\n\t\t\t}\n\t\t}\n\t}\n}\n\n#[cfg(test)]\n#[allow(dead_code)]\nmod test {\n\tuse super::*;\n\tuse openapi_type::OpenapiType;\n\n\t#[derive(OpenapiType)]\n\tstruct Message {\n\t\tmsg: String\n\t}\n\n\t#[derive(OpenapiType)]\n\tstruct Messages {\n\t\tmsgs: Vec\u003cMessage\u003e\n\t}\n\n\tfn info() -\u003e OpenapiInfo {\n\t\tOpenapiInfo {\n\t\t\ttitle: \"TEST CASE\".to_owned(),\n\t\t\tversion: \"1.2.3\".to_owned(),\n\t\t\turls: vec![\"http://localhost:1234\".to_owned(), \"https://example.org\".to_owned()]\n\t\t}\n\t}\n\n\tfn openapi(builder: OpenapiBuilder) -\u003e OpenAPI {\n\t\tArc::try_unwrap(builder.openapi).unwrap().into_inner()\n\t}\n\n\t#[test]\n\tfn new_builder() {\n\t\tlet info = info();\n\t\tlet builder = OpenapiBuilder::new(info.clone());\n\t\tlet openapi = openapi(builder);\n\n\t\tassert_eq!(info.title, openapi.info.title);\n\t\tassert_eq!(info.version, openapi.info.version);\n\t\tassert_eq!(info.urls.len(), openapi.servers.len());\n\t}\n\n\t#[test]\n\tfn add_schema() {\n\t\tlet mut builder = OpenapiBuilder::new(info());\n\t\tbuilder.add_schema(\u003cOption\u003cMessages\u003e\u003e::schema());\n\t\tlet openapi = openapi(builder);\n\n\t\tassert_eq!(\n\t\t\topenapi.components.clone().unwrap_or_default().schemas[\"Message\"],\n\t\t\tReferenceOr::Item(Message::schema().into_schema())\n\t\t);\n\t\tassert_eq!(\n\t\t\topenapi.components.clone().unwrap_or_default().schemas[\"Messages\"],\n\t\t\tReferenceOr::Item(Messages::schema().into_schema())\n\t\t);\n\t}\n}\n","traces":[{"line":26,"address":[2217194,2215888],"length":1,"stats":{"Line":4},"fn_name":"new"},{"line":28,"address":[4160483,4159826],"length":1,"stats":{"Line":8},"fn_name":null},{"line":50,"address":[4162440,4162080],"length":1,"stats":{"Line":2},"fn_name":"remove_path"},{"line":51,"address":[4162150],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[2218236],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[2218336,2218291],"length":1,"stats":{"Line":3},"fn_name":null},{"line":54,"address":[2218641,2218326],"length":1,"stats":{"Line":4},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[2218720,2219704],"length":1,"stats":{"Line":2},"fn_name":"add_schema_impl"},{"line":64,"address":[2218775],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[2218858],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[4163225,4162882,4162969,4163796],"length":1,"stats":{"Line":6},"fn_name":null},{"line":68,"address":[2218949,2219009],"length":1,"stats":{"Line":4},"fn_name":null},{"line":69,"address":[2219880,2219017],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[2218979],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[2219258,2219818],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[2219490,2219802,2219653,2219724],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[2220144,2220884],"length":1,"stats":{"Line":3},"fn_name":"add_schema_dependencies"},{"line":80,"address":[2220190,2221152,2221187],"length":1,"stats":{"Line":7},"fn_name":"{{closure}}"},{"line":81,"address":[2220274,2220858,2220464],"length":1,"stats":{"Line":5},"fn_name":null},{"line":82,"address":[2220639],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[2220654],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[2220760],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[2221874,2221216],"length":1,"stats":{"Line":3},"fn_name":"add_schema"},{"line":90,"address":[2221349,2221740,2221262],"length":1,"stats":{"Line":4},"fn_name":null},{"line":91,"address":[2221351,2221302],"length":1,"stats":{"Line":4},"fn_name":null},{"line":93,"address":[2221384],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[2221615],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[2221714],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[2221332],"length":1,"stats":{"Line":3},"fn_name":null},{"line":100,"address":[2221747],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":33,"coverable":35},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","handler","mod.rs"],"content":"#![cfg_attr(not(feature = \"auth\"), allow(unused_imports))]\nuse super::SECURITY_NAME;\nuse either::Either;\nuse futures_util::{future, future::FutureExt};\nuse gotham::{\n\tanyhow,\n\thandler::{Handler, HandlerError, HandlerFuture, NewHandler},\n\thelpers::http::response::{create_empty_response, create_response},\n\thyper::{\n\t\theader::{\n\t\t\tHeaderMap, HeaderValue, CACHE_CONTROL, CONTENT_SECURITY_POLICY, ETAG, IF_NONE_MATCH, REFERRER_POLICY,\n\t\t\tX_CONTENT_TYPE_OPTIONS\n\t\t},\n\t\tBody, Response, StatusCode\n\t},\n\tstate::State\n};\nuse mime::{APPLICATION_JSON, TEXT_HTML_UTF_8, TEXT_PLAIN_UTF_8};\nuse openapi_type::{\n\tindexmap::IndexMap,\n\topenapi::{APIKeyLocation, OpenAPI, ReferenceOr, SecurityScheme}\n};\nuse parking_lot::RwLock;\nuse sha2::{Digest, Sha256};\nuse std::{io::Write, iter, panic::RefUnwindSafe, pin::Pin, sync::Arc};\n\n#[cfg(feature = \"auth\")]\nfn get_security(state: \u0026State) -\u003e IndexMap\u003cString, ReferenceOr\u003cSecurityScheme\u003e\u003e {\n\tuse crate::AuthSource;\n\tuse gotham::state::FromState;\n\n\tlet source = match AuthSource::try_borrow_from(state) {\n\t\tSome(source) =\u003e source,\n\t\tNone =\u003e return Default::default()\n\t};\n\n\tlet security_scheme = match source {\n\t\tAuthSource::Cookie(name) =\u003e SecurityScheme::APIKey {\n\t\t\tlocation: APIKeyLocation::Cookie,\n\t\t\tname: name.to_string()\n\t\t},\n\t\tAuthSource::Header(name) =\u003e SecurityScheme::APIKey {\n\t\t\tlocation: APIKeyLocation::Header,\n\t\t\tname: name.to_string()\n\t\t},\n\t\tAuthSource::AuthorizationHeader =\u003e SecurityScheme::HTTP {\n\t\t\tscheme: \"bearer\".to_owned(),\n\t\t\tbearer_format: Some(\"JWT\".to_owned())\n\t\t}\n\t};\n\n\tlet mut security_schemes: IndexMap\u003cString, ReferenceOr\u003cSecurityScheme\u003e\u003e = Default::default();\n\tsecurity_schemes.insert(SECURITY_NAME.to_owned(), ReferenceOr::Item(security_scheme));\n\n\tsecurity_schemes\n}\n\n#[cfg(not(feature = \"auth\"))]\nfn get_security(_state: \u0026State) -\u003e IndexMap\u003cString, ReferenceOr\u003cSecurityScheme\u003e\u003e {\n\tDefault::default()\n}\n\nfn openapi_string(state: \u0026State, openapi: \u0026Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Result\u003cString, serde_json::Error\u003e {\n\tlet openapi = openapi.read();\n\n\tlet mut openapi = openapi.clone();\n\tlet security_schemes = get_security(state);\n\tlet mut components = openapi.components.unwrap_or_default();\n\tcomponents.security_schemes = security_schemes;\n\topenapi.components = Some(components);\n\n\tserde_json::to_string(\u0026openapi)\n}\n\nfn create_openapi_response(state: \u0026State, openapi: \u0026Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Response\u003cBody\u003e {\n\tmatch openapi_string(state, openapi) {\n\t\tOk(body) =\u003e {\n\t\t\tlet mut res = create_response(state, StatusCode::OK, APPLICATION_JSON, body);\n\t\t\tlet headers = res.headers_mut();\n\t\t\theaders.insert(X_CONTENT_TYPE_OPTIONS, HeaderValue::from_static(\"nosniff\"));\n\t\t\tres\n\t\t},\n\t\tErr(e) =\u003e {\n\t\t\terror!(\"Unable to handle OpenAPI request due to error: {}\", e);\n\t\t\tcreate_response(state, StatusCode::INTERNAL_SERVER_ERROR, TEXT_PLAIN_UTF_8, \"\")\n\t\t}\n\t}\n}\n\n#[derive(Clone)]\npub(crate) struct OpenapiSpecHandler {\n\topenapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e\n}\n\n// safety: the handler only ever aquires a read lock, so this usage of\n// RwLock is, in fact, unwind safe\nimpl RefUnwindSafe for OpenapiSpecHandler {}\n\nimpl OpenapiSpecHandler {\n\tpub(crate) fn new(openapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Self {\n\t\tSelf { openapi }\n\t}\n}\n\nimpl NewHandler for OpenapiSpecHandler {\n\ttype Instance = Self;\n\n\tfn new_handler(\u0026self) -\u003e anyhow::Result\u003cSelf\u003e {\n\t\tOk(self.clone())\n\t}\n}\n\nimpl Handler for OpenapiSpecHandler {\n\tfn handle(self, mut state: State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e {\n\t\tlet res = create_openapi_response(\u0026mut state, \u0026self.openapi);\n\t\tfuture::ok((state, res)).boxed()\n\t}\n}\n\n#[derive(Clone)]\npub(crate) struct OpenapiDocHandler {\n\topenapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e\n}\n\n// safety: the handler only ever aquires a read lock, so this usage of\n// RwLock is, in fact, unwind safe\nimpl RefUnwindSafe for OpenapiDocHandler {}\n\nimpl OpenapiDocHandler {\n\tpub(crate) fn new(openapi: Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Self {\n\t\tSelf { openapi }\n\t}\n}\n\nimpl NewHandler for OpenapiDocHandler {\n\ttype Instance = Self;\n\n\tfn new_handler(\u0026self) -\u003e anyhow::Result\u003cSelf\u003e {\n\t\tOk(self.clone())\n\t}\n}\n\nfn redoc_handler(state: \u0026State, openapi: \u0026Arc\u003cRwLock\u003cOpenAPI\u003e\u003e) -\u003e Result\u003cResponse\u003cBody\u003e, HandlerError\u003e {\n\tlet spec = openapi_string(state, openapi)?;\n\tlet encoded_spec = spec\n\t\t.chars()\n\t\t.flat_map(|c| match c {\n\t\t\t'\u0026' =\u003e Either::Left(\"\u0026amp;\".chars()),\n\t\t\t'\u003c' =\u003e Either::Left(\"\u0026lt;\".chars()),\n\t\t\t'\u003e' =\u003e Either::Left(\"\u0026gt;\".chars()),\n\t\t\tc =\u003e Either::Right(iter::once(c))\n\t\t})\n\t\t.collect::\u003cString\u003e();\n\n\tlet script = include_str!(\"script.min.js\");\n\tlet mut script_hash = Sha256::new();\n\tscript_hash.update(\u0026script);\n\tlet script_hash = base64::encode(script_hash.finalize());\n\n\tlet mut buf = Vec::\u003cu8\u003e::new();\n\twrite!(\n\t\tbuf,\n\t\tr#\"\u003c!DOCTYPE HTML\u003e\u003chtml\u003e\u003chead\u003e\u003cmeta charset=\"utf-8\"/\u003e\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/\u003e\u003c/head\u003e\"#\n\t)?;\n\twrite!(\n\t\tbuf,\n\t\tr#\"\u003cbody style=\"margin:0\"\u003e\u003cdiv id=\"spec\" style=\"display:none\"\u003e{}\u003c/div\u003e\u003cdiv id=\"redoc\"\u003e\u003c/div\u003e\u003cscript\u003e{}\u003c/script\u003e\u003c/body\u003e\u003c/html\u003e\"#,\n\t\tencoded_spec, script\n\t)?;\n\n\tlet mut etag = Sha256::new();\n\tetag.update(\u0026buf);\n\tlet etag = format!(\"\\\"{}\\\"\", base64::encode(etag.finalize()));\n\n\tif state\n\t\t.borrow::\u003cHeaderMap\u003e()\n\t\t.get(IF_NONE_MATCH)\n\t\t.map_or(false, |header| header.as_bytes() == etag.as_bytes())\n\t{\n\t\tlet res = create_empty_response(\u0026state, StatusCode::NOT_MODIFIED);\n\t\treturn Ok(res);\n\t}\n\n\tlet mut res = create_response(state, StatusCode::OK, TEXT_HTML_UTF_8, buf);\n\tlet headers = res.headers_mut();\n\theaders.insert(CACHE_CONTROL, HeaderValue::from_static(\"public,max-age=2592000\"));\n\theaders.insert(\n\t\tCONTENT_SECURITY_POLICY,\n\t\tformat!(\n\t\t\t\"default-src 'none';base-uri 'none';script-src 'unsafe-inline' https://cdn.jsdelivr.net 'sha256-{}' 'strict-dynamic';style-src 'unsafe-inline' https://fonts.googleapis.com;font-src https://fonts.gstatic.com;connect-src 'self';img-src blob: data:\",\n\t\t\tscript_hash\n\t\t).parse().unwrap()\n\t);\n\theaders.insert(ETAG, etag.parse().unwrap());\n\theaders.insert(REFERRER_POLICY, HeaderValue::from_static(\"no-referrer\"));\n\theaders.insert(X_CONTENT_TYPE_OPTIONS, HeaderValue::from_static(\"nosniff\"));\n\tOk(res)\n}\n\nimpl Handler for OpenapiDocHandler {\n\tfn handle(self, state: State) -\u003e Pin\u003cBox\u003cHandlerFuture\u003e\u003e {\n\t\tmatch redoc_handler(\u0026state, \u0026self.openapi) {\n\t\t\tOk(res) =\u003e future::ok((state, res)).boxed(),\n\t\t\tErr(err) =\u003e future::err((state, err)).boxed()\n\t\t}\n\t}\n}\n","traces":[{"line":28,"address":[2006490,2005664],"length":1,"stats":{"Line":2},"fn_name":"get_security"},{"line":32,"address":[2005702,2005756],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[2005758,2005720],"length":1,"stats":{"Line":3},"fn_name":null},{"line":34,"address":[2005745],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[2005949,2005846,2006055],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[2005873],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[2005979],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[2005816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[2006060],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[2006229],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[2006248],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[2006421],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[2006608,2007065],"length":1,"stats":{"Line":2},"fn_name":"openapi_string"},{"line":64,"address":[2006665],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[2006727],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[2006780],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[2006795],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[2007080,2006874],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[2007207],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[2007339],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[2009025,2008048],"length":1,"stats":{"Line":2},"fn_name":"create_openapi_response"},{"line":76,"address":[2008164,2008086,2008501],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[2008166,2008096],"length":1,"stats":{"Line":4},"fn_name":null},{"line":78,"address":[2008199],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[2008306],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[2008346],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[2008483],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[2008108],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[2008121,2008506,2008582],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[2008837],"length":1,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[2009088],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":108,"address":[2009120],"length":1,"stats":{"Line":2},"fn_name":"new_handler"},{"line":109,"address":[2009129],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[2009184,2009495],"length":1,"stats":{"Line":2},"fn_name":"handle"},{"line":115,"address":[2009227],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[2009239,2009201],"length":1,"stats":{"Line":4},"fn_name":null},{"line":130,"address":[2009568],"length":1,"stats":{"Line":0},"fn_name":"new"},{"line":138,"address":[2009600],"length":1,"stats":{"Line":0},"fn_name":"new_handler"},{"line":139,"address":[2009609],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[2013627,2009664],"length":1,"stats":{"Line":0},"fn_name":"redoc_handler"},{"line":144,"address":[2009872,2009703],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[2009843,2009964],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[2014090,2013952,2014151,2014207],"length":1,"stats":{"Line":0},"fn_name":"{{closure}}"},{"line":148,"address":[2013979,2014034],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[2014095],"length":1,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[2014153],"length":1,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[2014218,2014016],"length":1,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[2010047],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[2010082],"length":1,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[2010105],"length":1,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[2010112],"length":1,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[2010270],"length":1,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[2010289,2010659,2010766],"length":1,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[2011299,2010821,2010555,2011192],"length":1,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[2011185],"length":1,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[2011330],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[2011337,2013553],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[2011843,2011718],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[2014240,2014272,2011835],"length":1,"stats":{"Line":0},"fn_name":"{{closure}}"},{"line":180,"address":[2011876],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[2012133],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[2011911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[2012201],"length":1,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[2012241],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[2012664],"length":1,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[2012381],"length":1,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[2012791],"length":1,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[2012982],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[2013114],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[2013288],"length":1,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[2014975,2014352],"length":1,"stats":{"Line":0},"fn_name":"handle"},{"line":202,"address":[2014369,2014862,2014919,2014585],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[2014402,2014587],"length":1,"stats":{"Line":0},"fn_name":null},{"line":204,"address":[2014423,2014864],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":30,"coverable":74},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","mod.rs"],"content":"const SECURITY_NAME: \u0026str = \"authToken\";\n\npub(crate) mod builder;\npub(crate) mod handler;\npub(crate) mod operation;\npub(crate) mod router;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","operation.rs"],"content":"use super::SECURITY_NAME;\nuse crate::{response::OrAllTypes, EndpointWithSchema, IntoResponse, RequestBody};\nuse gotham::hyper::StatusCode;\nuse mime::Mime;\nuse openapi_type::{\n\tindexmap::IndexMap,\n\topenapi::{\n\t\tMediaType, Operation, Parameter, ParameterData, ParameterSchemaOrContent, ReferenceOr, ReferenceOr::Item,\n\t\tRequestBody as OARequestBody, Response, Responses, Schema, SchemaKind, StatusCode as OAStatusCode, Type\n\t},\n\tOpenapiSchema\n};\nuse std::collections::HashMap;\n\nfn new_parameter_data(name: String, required: bool, schema: ReferenceOr\u003cBox\u003cSchema\u003e\u003e) -\u003e ParameterData {\n\tParameterData {\n\t\tname,\n\t\tdescription: None,\n\t\trequired,\n\t\tdeprecated: None,\n\t\tformat: ParameterSchemaOrContent::Schema(schema.unbox()),\n\t\texample: None,\n\t\texamples: Default::default(),\n\t\textensions: Default::default()\n\t}\n}\n\n#[derive(Default)]\nstruct OperationParams {\n\tpath_params: Option\u003cOpenapiSchema\u003e,\n\tquery_params: Option\u003cOpenapiSchema\u003e\n}\n\nimpl OperationParams {\n\tfn add_path_params(path_params: Option\u003cOpenapiSchema\u003e, params: \u0026mut Vec\u003cReferenceOr\u003cParameter\u003e\u003e) {\n\t\tlet path_params = match path_params {\n\t\t\tSome(pp) =\u003e pp.schema,\n\t\t\tNone =\u003e return\n\t\t};\n\t\tlet path_params = match path_params {\n\t\t\tSchemaKind::Type(Type::Object(ty)) =\u003e ty,\n\t\t\t_ =\u003e panic!(\"Path Parameters needs to be a plain struct\")\n\t\t};\n\t\tfor (name, schema) in path_params.properties {\n\t\t\tlet required = path_params.required.contains(\u0026name);\n\t\t\tparams.push(Item(Parameter::Path {\n\t\t\t\tparameter_data: new_parameter_data(name, required, schema),\n\t\t\t\tstyle: Default::default()\n\t\t\t}))\n\t\t}\n\t}\n\n\tfn add_query_params(query_params: Option\u003cOpenapiSchema\u003e, params: \u0026mut Vec\u003cReferenceOr\u003cParameter\u003e\u003e) {\n\t\tlet query_params = match query_params {\n\t\t\tSome(qp) =\u003e qp.schema,\n\t\t\tNone =\u003e return\n\t\t};\n\t\tlet query_params = match query_params {\n\t\t\tSchemaKind::Type(Type::Object(ty)) =\u003e ty,\n\t\t\t_ =\u003e panic!(\"Query Parameters needs to be a plain struct\")\n\t\t};\n\t\tfor (name, schema) in query_params.properties {\n\t\t\tlet required = query_params.required.contains(\u0026name);\n\t\t\tparams.push(Item(Parameter::Query {\n\t\t\t\tparameter_data: new_parameter_data(name, required, schema),\n\t\t\t\tallow_reserved: false,\n\t\t\t\tstyle: Default::default(),\n\t\t\t\tallow_empty_value: None\n\t\t\t}))\n\t\t}\n\t}\n\n\tfn into_params(self) -\u003e Vec\u003cReferenceOr\u003cParameter\u003e\u003e {\n\t\tlet mut params: Vec\u003cReferenceOr\u003cParameter\u003e\u003e = Vec::new();\n\t\tSelf::add_path_params(self.path_params, \u0026mut params);\n\t\tSelf::add_query_params(self.query_params, \u0026mut params);\n\t\tparams\n\t}\n}\n\npub(crate) struct OperationDescription {\n\toperation_id: Option\u003cString\u003e,\n\tdescription: Option\u003cString\u003e,\n\n\taccepted_types: Option\u003cVec\u003cMime\u003e\u003e,\n\tresponses: HashMap\u003cStatusCode, ReferenceOr\u003cSchema\u003e\u003e,\n\tparams: OperationParams,\n\tbody_schema: Option\u003cReferenceOr\u003cSchema\u003e\u003e,\n\tsupported_types: Option\u003cVec\u003cMime\u003e\u003e,\n\trequires_auth: bool\n}\n\nimpl OperationDescription {\n\t/// Create a new operation description for the given endpoint type and schema. If the endpoint\n\t/// does not specify an operation id, the path is used to generate one.\n\tpub(crate) fn new\u003cE: EndpointWithSchema\u003e(responses: HashMap\u003cStatusCode, ReferenceOr\u003cSchema\u003e\u003e, path: \u0026str) -\u003e Self {\n\t\tlet operation_id = E::operation_id().or_else(|| {\n\t\t\tE::operation_verb().map(|verb| format!(\"{}_{}\", verb, path.replace(\"/\", \"_\").trim_start_matches('_')))\n\t\t});\n\t\tSelf {\n\t\t\toperation_id,\n\t\t\tdescription: E::description(),\n\n\t\t\taccepted_types: E::Output::accepted_types(),\n\t\t\tresponses,\n\t\t\tparams: Default::default(),\n\t\t\tbody_schema: None,\n\t\t\tsupported_types: None,\n\t\t\trequires_auth: E::wants_auth()\n\t\t}\n\t}\n\n\tpub(crate) fn set_path_params(\u0026mut self, params: OpenapiSchema) {\n\t\tself.params.path_params = Some(params);\n\t}\n\n\tpub(crate) fn set_query_params(\u0026mut self, params: OpenapiSchema) {\n\t\tself.params.query_params = Some(params);\n\t}\n\n\tpub(crate) fn set_body\u003cBody: RequestBody\u003e(\u0026mut self, schema: ReferenceOr\u003cSchema\u003e) {\n\t\tself.body_schema = Some(schema);\n\t\tself.supported_types = Body::supported_types();\n\t}\n\n\tfn schema_to_content(types: Vec\u003cMime\u003e, schema: ReferenceOr\u003cSchema\u003e) -\u003e IndexMap\u003cString, MediaType\u003e {\n\t\tlet mut content: IndexMap\u003cString, MediaType\u003e = IndexMap::new();\n\t\tfor ty in types {\n\t\t\tcontent.insert(ty.to_string(), MediaType {\n\t\t\t\tschema: Some(schema.clone()),\n\t\t\t\t..Default::default()\n\t\t\t});\n\t\t}\n\t\tcontent\n\t}\n\n\tpub(crate) fn into_operation(self) -\u003e Operation {\n\t\t// this is unfortunately neccessary to prevent rust from complaining about partially moving self\n\t\tlet (operation_id, description, accepted_types, responses, params, body_schema, supported_types, requires_auth) = (\n\t\t\tself.operation_id,\n\t\t\tself.description,\n\t\t\tself.accepted_types,\n\t\t\tself.responses,\n\t\t\tself.params,\n\t\t\tself.body_schema,\n\t\t\tself.supported_types,\n\t\t\tself.requires_auth\n\t\t);\n\n\t\tlet responses: IndexMap\u003cOAStatusCode, ReferenceOr\u003cResponse\u003e\u003e = responses\n\t\t\t.into_iter()\n\t\t\t.map(|(code, schema)| {\n\t\t\t\tlet content = Self::schema_to_content(accepted_types.clone().or_all_types(), schema);\n\t\t\t\t(\n\t\t\t\t\tOAStatusCode::Code(code.as_u16()),\n\t\t\t\t\tItem(Response {\n\t\t\t\t\t\tdescription: code.canonical_reason().map(|d| d.to_string()).unwrap_or_default(),\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t..Default::default()\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t})\n\t\t\t.collect();\n\n\t\tlet request_body = body_schema.map(|schema| {\n\t\t\tItem(OARequestBody {\n\t\t\t\tcontent: Self::schema_to_content(supported_types.or_all_types(), schema),\n\t\t\t\trequired: true,\n\t\t\t\t..Default::default()\n\t\t\t})\n\t\t});\n\n\t\tlet mut security = Vec::new();\n\t\tif requires_auth {\n\t\t\tlet mut sec = IndexMap::new();\n\t\t\tsec.insert(SECURITY_NAME.to_owned(), Vec::new());\n\t\t\tsecurity.push(sec);\n\t\t}\n\n\t\tOperation {\n\t\t\ttags: Vec::new(),\n\t\t\toperation_id,\n\t\t\tdescription,\n\t\t\tparameters: params.into_params(),\n\t\t\trequest_body,\n\t\t\tresponses: Responses {\n\t\t\t\tdefault: None,\n\t\t\t\tresponses\n\t\t\t},\n\t\t\tdeprecated: false,\n\t\t\tsecurity,\n\t\t\t..Default::default()\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse crate::{NoContent, Raw, ResponseSchema};\n\n\t#[test]\n\tfn no_content_schema_to_content() {\n\t\tlet types = NoContent::accepted_types();\n\t\tlet schema = \u003cNoContent as ResponseSchema\u003e::schema(StatusCode::NO_CONTENT);\n\t\tlet content = OperationDescription::schema_to_content(types.or_all_types(), Item(schema.into_schema()));\n\t\tassert!(content.is_empty());\n\t}\n\n\t#[test]\n\tfn raw_schema_to_content() {\n\t\tlet types = Raw::\u003c\u0026str\u003e::accepted_types();\n\t\tlet schema = \u003cRaw\u003c\u0026str\u003e as ResponseSchema\u003e::schema(StatusCode::OK);\n\t\tlet content = OperationDescription::schema_to_content(types.or_all_types(), Item(schema.into_schema()));\n\t\tassert_eq!(content.len(), 1);\n\t\tlet json = serde_json::to_string(\u0026content.values().nth(0).unwrap()).unwrap();\n\t\tassert_eq!(json, r#\"{\"schema\":{\"type\":\"string\",\"format\":\"binary\"}}\"#);\n\t}\n}\n","traces":[{"line":15,"address":[2015565,2015072],"length":1,"stats":{"Line":1},"fn_name":"new_parameter_data"},{"line":21,"address":[2015147],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[2015237],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[2015256],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[2015664,2017422],"length":1,"stats":{"Line":2},"fn_name":"add_path_params"},{"line":36,"address":[2015768,2015695],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[2015805,2015735,2016997],"length":1,"stats":{"Line":3},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[2015900,2015859,2016980],"length":1,"stats":{"Line":3},"fn_name":null},{"line":44,"address":[2015975,2016889,2016223],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[2016529],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[2016745],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[2016611],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[2016728],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[2017648,2019422],"length":1,"stats":{"Line":2},"fn_name":"add_query_params"},{"line":54,"address":[2017679,2017752],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[2017789,2017719,2018997],"length":1,"stats":{"Line":3},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[2017843,2018980,2017884],"length":1,"stats":{"Line":3},"fn_name":null},{"line":62,"address":[2018889,2018207,2017959],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[2018513],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[2018729],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[2018595],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[2018712],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[2019648,2019860],"length":1,"stats":{"Line":2},"fn_name":"into_params"},{"line":74,"address":[2019673],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[2019721],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[2019775],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":113,"address":[2020109,2019984],"length":1,"stats":{"Line":1},"fn_name":"set_path_params"},{"line":114,"address":[2020129,2020038],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[2020323,2020192],"length":1,"stats":{"Line":1},"fn_name":"set_query_params"},{"line":118,"address":[2020246,2020343],"length":1,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":126,"address":[2021522,2020400],"length":1,"stats":{"Line":3},"fn_name":"schema_to_content"},{"line":127,"address":[2020439],"length":1,"stats":{"Line":3},"fn_name":null},{"line":128,"address":[2021410,2020475,2020630],"length":1,"stats":{"Line":6},"fn_name":null},{"line":129,"address":[2021157,2021048],"length":1,"stats":{"Line":6},"fn_name":null},{"line":130,"address":[2021060],"length":1,"stats":{"Line":3},"fn_name":null},{"line":131,"address":[2021117],"length":1,"stats":{"Line":3},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[2021856,2024558],"length":1,"stats":{"Line":2},"fn_name":"into_operation"},{"line":139,"address":[2021884,2022222],"length":1,"stats":{"Line":4},"fn_name":null},{"line":140,"address":[2021972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[2021995],"length":1,"stats":{"Line":2},"fn_name":null},{"line":142,"address":[2022019],"length":1,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[2022043],"length":1,"stats":{"Line":2},"fn_name":null},{"line":144,"address":[2022079],"length":1,"stats":{"Line":2},"fn_name":null},{"line":145,"address":[2022130],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[2022182],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[2022212],"length":1,"stats":{"Line":2},"fn_name":null},{"line":150,"address":[2022841,2022746],"length":1,"stats":{"Line":4},"fn_name":null},{"line":152,"address":[2026648,2022833,2025739,2025696],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}"},{"line":153,"address":[2025799],"length":1,"stats":{"Line":2},"fn_name":null},{"line":155,"address":[2025921],"length":1,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[2026142],"length":1,"stats":{"Line":2},"fn_name":null},{"line":157,"address":[2025648,2025959,2025670],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}"},{"line":158,"address":[2026039],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[2026135],"length":1,"stats":{"Line":2},"fn_name":null},{"line":165,"address":[2027302,2022903,2026880],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":166,"address":[2027053,2026905],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[2026921],"length":1,"stats":{"Line":1},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":169,"address":[2027041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[2023022],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[2023045,2023074],"length":1,"stats":{"Line":4},"fn_name":null},{"line":175,"address":[2023067],"length":1,"stats":{"Line":1},"fn_name":null},{"line":176,"address":[2024977,2023079],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[2023211],"length":1,"stats":{"Line":1},"fn_name":null},{"line":181,"address":[2023330],"length":1,"stats":{"Line":2},"fn_name":null},{"line":184,"address":[2023429],"length":1,"stats":{"Line":2},"fn_name":null},{"line":186,"address":[2023661],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":76,"coverable":85},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","openapi","router.rs"],"content":"use super::{\n\tbuilder::OpenapiBuilder,\n\thandler::{OpenapiDocHandler, OpenapiSpecHandler},\n\toperation::OperationDescription\n};\nuse crate::{routing::*, EndpointWithSchema, ResourceWithSchema, ResponseSchema};\nuse gotham::{\n\thyper::{Method, StatusCode},\n\tpipeline::chain::PipelineHandleChain,\n\trouter::builder::*\n};\nuse lazy_regex::regex_replace_all;\nuse openapi_type::OpenapiType;\nuse std::{collections::HashMap, panic::RefUnwindSafe};\n\n/// This trait adds the `openapi_spec` and `openapi_doc` method to an OpenAPI-aware router.\npub trait GetOpenapi {\n\t/// Register a GET route to `path` that returns the OpenAPI specification in JSON format.\n\tfn openapi_spec(\u0026mut self, path: \u0026str);\n\n\t/// Register a GET route to `path` that returns the OpenAPI documentation in HTML format.\n\tfn openapi_doc(\u0026mut self, path: \u0026str);\n}\n\n#[derive(Debug)]\npub struct OpenapiRouter\u003c'a, D\u003e {\n\tpub(crate) router: \u0026'a mut D,\n\tpub(crate) scope: Option\u003c\u0026'a str\u003e,\n\tpub(crate) openapi_builder: \u0026'a mut OpenapiBuilder\n}\n\nmacro_rules! implOpenapiRouter {\n\t($implType:ident) =\u003e {\n\t\timpl\u003c'a, 'b, C, P\u003e OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tpub fn scope\u003cF\u003e(\u0026mut self, path: \u0026str, callback: F)\n\t\t\twhere\n\t\t\t\tF: FnOnce(\u0026mut OpenapiRouter\u003c'_, ScopeBuilder\u003c'_, C, P\u003e\u003e)\n\t\t\t{\n\t\t\t\tlet mut openapi_builder = self.openapi_builder.clone();\n\t\t\t\tlet new_scope = self.scope.map(|scope| format!(\"{}/{}\", scope, path).replace(\"//\", \"/\"));\n\t\t\t\tself.router.scope(path, |router| {\n\t\t\t\t\tlet mut router = OpenapiRouter {\n\t\t\t\t\t\trouter,\n\t\t\t\t\t\tscope: Some(new_scope.as_ref().map(String::as_ref).unwrap_or(path)),\n\t\t\t\t\t\topenapi_builder: \u0026mut openapi_builder\n\t\t\t\t\t};\n\t\t\t\t\tcallback(\u0026mut router);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, 'b, C, P\u003e GetOpenapi for OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn openapi_spec(\u0026mut self, path: \u0026str) {\n\t\t\t\tself.router\n\t\t\t\t\t.get(path)\n\t\t\t\t\t.to_new_handler(OpenapiSpecHandler::new(self.openapi_builder.openapi.clone()));\n\t\t\t}\n\n\t\t\tfn openapi_doc(\u0026mut self, path: \u0026str) {\n\t\t\t\tself.router\n\t\t\t\t\t.get(path)\n\t\t\t\t\t.to_new_handler(OpenapiDocHandler::new(self.openapi_builder.openapi.clone()));\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, 'b, C, P\u003e DrawResourcesWithSchema for OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn resource\u003cR: ResourceWithSchema\u003e(\u0026mut self, mut path: \u0026str) {\n\t\t\t\tif path.starts_with('/') {\n\t\t\t\t\tpath = \u0026path[1..];\n\t\t\t\t}\n\t\t\t\tR::setup((self, path));\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, 'b, C, P\u003e DrawResourceRoutesWithSchema for (\u0026mut OpenapiRouter\u003c'a, $implType\u003c'b, C, P\u003e\u003e, \u0026str)\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn endpoint\u003cE: EndpointWithSchema + 'static\u003e(\u0026mut self) {\n\t\t\t\tlet mut responses: HashMap\u003cStatusCode, _\u003e = HashMap::new();\n\t\t\t\tfor code in E::Output::status_codes() {\n\t\t\t\t\tresponses.insert(code, (self.0).openapi_builder.add_schema(E::Output::schema(code)));\n\t\t\t\t}\n\t\t\t\tlet mut path = format!(\"{}/{}\", self.0.scope.unwrap_or_default(), self.1);\n\t\t\t\tlet mut descr = OperationDescription::new::\u003cE\u003e(responses, \u0026path);\n\t\t\t\tif E::has_placeholders() {\n\t\t\t\t\tdescr.set_path_params(E::Placeholders::schema());\n\t\t\t\t}\n\t\t\t\tif E::needs_params() {\n\t\t\t\t\tdescr.set_query_params(E::Params::schema());\n\t\t\t\t}\n\t\t\t\tif E::needs_body() {\n\t\t\t\t\tlet body_schema = (self.0).openapi_builder.add_schema(E::Body::schema());\n\t\t\t\t\tdescr.set_body::\u003cE::Body\u003e(body_schema);\n\t\t\t\t}\n\n\t\t\t\tlet uri: \u0026str = \u0026E::uri();\n\t\t\t\tlet uri = regex_replace_all!(r#\"(^|/):([^/]+)(/|$)\"#, uri, |_, prefix, name, suffix| {\n\t\t\t\t\tformat!(\"{}{{{}}}{}\", prefix, name, suffix)\n\t\t\t\t});\n\t\t\t\tif !uri.is_empty() {\n\t\t\t\t\tpath = format!(\"{}/{}\", path, uri);\n\t\t\t\t}\n\n\t\t\t\tlet op = descr.into_operation();\n\t\t\t\tlet mut item = (self.0).openapi_builder.remove_path(\u0026path);\n\t\t\t\tmatch E::http_method() {\n\t\t\t\t\tMethod::GET =\u003e item.get = Some(op),\n\t\t\t\t\tMethod::PUT =\u003e item.put = Some(op),\n\t\t\t\t\tMethod::POST =\u003e item.post = Some(op),\n\t\t\t\t\tMethod::DELETE =\u003e item.delete = Some(op),\n\t\t\t\t\tMethod::OPTIONS =\u003e item.options = Some(op),\n\t\t\t\t\tMethod::HEAD =\u003e item.head = Some(op),\n\t\t\t\t\tMethod::PATCH =\u003e item.patch = Some(op),\n\t\t\t\t\tMethod::TRACE =\u003e item.trace = Some(op),\n\t\t\t\t\tmethod =\u003e warn!(\"Ignoring unsupported method '{}' in OpenAPI Specification\", method)\n\t\t\t\t};\n\t\t\t\t(self.0).openapi_builder.add_path(path, item);\n\n\t\t\t\t(\u0026mut *(self.0).router, self.1).endpoint::\u003cE\u003e()\n\t\t\t}\n\t\t}\n\t};\n}\n\nimplOpenapiRouter!(RouterBuilder);\nimplOpenapiRouter!(ScopeBuilder);\n","traces":[{"line":39,"address":[3297120,3298395,3298160,3297355],"length":1,"stats":{"Line":2},"fn_name":"scope\u003c(),(),closure-0\u003e"},{"line":43,"address":[3298189,3297149],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[3297192,3297763,3298768,3297728,3298232,3298803],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003c(),(),closure-0\u003e"},{"line":45,"address":[3297440,3298271,3297677,3298717,3298480,3297231],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003c(),(),closure-0\u003e"},{"line":46,"address":[3297612,3298505,3297465,3298652],"length":1,"stats":{"Line":4},"fn_name":null},{"line":48,"address":[3298515,3297475],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[3297608,3298648],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[3297642,3298682],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[3299200,3299337],"length":1,"stats":{"Line":2},"fn_name":"openapi_spec\u003c(),()\u003e"},{"line":62,"address":[3299230,3299310],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[3299327,3299349,3299258],"length":1,"stats":{"Line":4},"fn_name":null},{"line":79,"address":[3299568,3299392],"length":1,"stats":{"Line":5},"fn_name":"resource\u003c(),(),openapi_supports_scope::FooResource\u003e"},{"line":80,"address":[3299499,3299675,3299592,3299416],"length":1,"stats":{"Line":9},"fn_name":null},{"line":81,"address":[3299510,3299451,3299686,3299627],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[3299525,3299701],"length":1,"stats":{"Line":5},"fn_name":null},{"line":92,"address":[3307040,3311334,3299744,3304038],"length":1,"stats":{"Line":8},"fn_name":"endpoint\u003c(),(),openapi_supports_scope::read_all___gotham_restful_endpoint\u003e"},{"line":93,"address":[3307069,3299773],"length":1,"stats":{"Line":8},"fn_name":null},{"line":94,"address":[3299922,3307574,3300278,3300099,3307395,3307218],"length":1,"stats":{"Line":16},"fn_name":null},{"line":95,"address":[3307445,3300149],"length":1,"stats":{"Line":8},"fn_name":null},{"line":97,"address":[3307587,3300291],"length":1,"stats":{"Line":8},"fn_name":null},{"line":98,"address":[3300729,3308025,3312715,3305419],"length":1,"stats":{"Line":8},"fn_name":null},{"line":99,"address":[3308189,3308266,3308237,3300970,3300941,3300893],"length":1,"stats":{"Line":16},"fn_name":null},{"line":100,"address":[3308239,3308218,3300922,3300943],"length":1,"stats":{"Line":8},"fn_name":null},{"line":102,"address":[3301020,3308316,3301049,3308268,3300972,3308345],"length":1,"stats":{"Line":16},"fn_name":null},{"line":103,"address":[3301022,3301001,3308297,3308318],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[3301051,3308516,3301122,3308418,3301220,3308347],"length":1,"stats":{"Line":16},"fn_name":null},{"line":106,"address":[3301132,3301088,3308428,3308384],"length":1,"stats":{"Line":4},"fn_name":null},{"line":107,"address":[3301195,3308491],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[3308526,3301230],"length":1,"stats":{"Line":8},"fn_name":null},{"line":111,"address":[2095728,2095484,2095740,2095472,2095951,2095695],"length":1,"stats":{"Line":58},"fn_name":"{{closure}}"},{"line":112,"address":[3306589,3313917],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[3301401,3301601,3304170,3308897,3311466,3308697],"length":1,"stats":{"Line":16},"fn_name":null},{"line":115,"address":[3308793,3308942,3311349,3301646,3304053,3301497],"length":1,"stats":{"Line":10},"fn_name":null},{"line":118,"address":[3309166,3301870],"length":1,"stats":{"Line":8},"fn_name":null},{"line":119,"address":[3301959,3309255],"length":1,"stats":{"Line":8},"fn_name":null},{"line":120,"address":[3309431,3311636,3304800,3311912,3304432,3304340,3311728,3311544,3304524,3312096,3302135,3304708,3304886,3304248,3312004,3311820,3304616,3312182],"length":1,"stats":{"Line":16},"fn_name":null},{"line":121,"address":[3309438,3302282,3309578,3311471,3302142,3304175],"length":1,"stats":{"Line":14},"fn_name":null},{"line":122,"address":[3309696,3304253,3311549,3302400],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[3309814,3311641,3302518,3304345],"length":1,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[3304437,3309932,3302636,3311733],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[3302754,3310050,3304529,3311825],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[3310168,3311917,3302872,3304621],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[3310268,3302972,3312009,3304713],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[3310368,3304802,3303072,3312098],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[3303172,3302196,3310544,3303248,3303949,3309492,3311245,3310468],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[3303542,3310838],"length":1,"stats":{"Line":8},"fn_name":null},{"line":133,"address":[3311028,3303732],"length":1,"stats":{"Line":8},"fn_name":null}],"covered":41,"coverable":47},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","auth_result.rs"],"content":"use gotham_restful_derive::ResourceError;\n\n/**\nThis is an error type that always yields a _403 Forbidden_ response. This type is best used in\ncombination with [AuthSuccess] or [AuthResult].\n*/\n#[derive(Debug, Clone, Copy, ResourceError)]\npub enum AuthError {\n\t#[status(FORBIDDEN)]\n\t#[display(\"Forbidden\")]\n\tForbidden\n}\n\n/**\nThis return type can be used to wrap any type implementing [IntoResponse](crate::IntoResponse)\nthat can only be returned if the client is authenticated. Otherwise, an empty _403 Forbidden_\nresponse will be issued.\n\nUse can look something like this (assuming the `auth` feature is enabled):\n\n```rust\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"auth\")]\n# mod auth_feature_enabled {\n# use gotham::state::State;\n# use gotham_restful::*;\n# use serde::Deserialize;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n# #[derive(Clone, Deserialize)]\n# struct MyAuthData { exp : u64 }\n#\n#[read_all]\nfn read_all(auth : AuthStatus\u003cMyAuthData\u003e) -\u003e AuthSuccess\u003cNoContent\u003e {\n\tlet auth_data = match auth {\n\t\tAuthStatus::Authenticated(data) =\u003e data,\n\t\t_ =\u003e return Err(Forbidden)\n\t};\n\t// do something\n\tOk(NoContent::default())\n}\n# }\n```\n*/\npub type AuthSuccess\u003cT\u003e = Result\u003cT, AuthError\u003e;\n\n/**\nThis is an error type that either yields a _403 Forbidden_ respone if produced from an authentication\nerror, or delegates to another error type. This type is best used with [AuthResult].\n*/\n#[derive(Debug, ResourceError)]\npub enum AuthErrorOrOther\u003cE\u003e {\n\t#[status(FORBIDDEN)]\n\t#[display(\"Forbidden\")]\n\tForbidden,\n\t#[status(INTERNAL_SERVER_ERROR)]\n\t#[display(\"{0}\")]\n\tOther(E)\n}\n\nimpl\u003cE\u003e From\u003cAuthError\u003e for AuthErrorOrOther\u003cE\u003e {\n\tfn from(err: AuthError) -\u003e Self {\n\t\tmatch err {\n\t\t\tAuthError::Forbidden =\u003e Self::Forbidden\n\t\t}\n\t}\n}\n\nmod private {\n\tuse gotham::handler::HandlerError;\n\tpub trait Sealed {}\n\timpl\u003cE: Into\u003cHandlerError\u003e\u003e Sealed for E {}\n}\n\nimpl\u003cE, F\u003e From\u003cF\u003e for AuthErrorOrOther\u003cE\u003e\nwhere\n\t// TODO https://github.com/msrd0/gotham_restful/issues/20\n\tF: private::Sealed + Into\u003cE\u003e\n{\n\tfn from(err: F) -\u003e Self {\n\t\tSelf::Other(err.into())\n\t}\n}\n\n/**\nThis return type can be used to wrap any type implementing [IntoResponse](crate::IntoResponse)\nthat can only be returned if the client is authenticated. Otherwise, an empty _403 Forbidden_\nresponse will be issued.\n\nUse can look something like this (assuming the `auth` feature is enabled):\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# #[cfg(feature = \"auth\")]\n# mod auth_feature_enabled {\n# use gotham::state::State;\n# use gotham_restful::*;\n# use serde::Deserialize;\n# use std::io;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n# #[derive(Clone, Deserialize)]\n# struct MyAuthData { exp : u64 }\n#\n#[read_all]\nfn read_all(auth : AuthStatus\u003cMyAuthData\u003e) -\u003e AuthResult\u003cNoContent, io::Error\u003e {\n\tlet auth_data = match auth {\n\t\tAuthStatus::Authenticated(data) =\u003e data,\n\t\t_ =\u003e Err(Forbidden)?\n\t};\n\t// do something\n\tOk(NoContent::default().into())\n}\n# }\n*/\npub type AuthResult\u003cT, E\u003e = Result\u003cT, AuthErrorOrOther\u003cE\u003e\u003e;\n","traces":[{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","mod.rs"],"content":"use futures_util::future::{self, BoxFuture, FutureExt};\nuse gotham::{\n\thandler::HandlerError,\n\thyper::{\n\t\theader::{HeaderMap, HeaderName, HeaderValue},\n\t\tBody, StatusCode\n\t}\n};\nuse mime::{Mime, APPLICATION_JSON, STAR_STAR};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\nuse serde::Serialize;\nuse std::{\n\tconvert::Infallible,\n\tfmt::{Debug, Display},\n\tfuture::Future,\n\tpin::Pin\n};\n\nmod auth_result;\n#[allow(unreachable_pub)]\npub use auth_result::{AuthError, AuthErrorOrOther, AuthResult, AuthSuccess};\n\nmod no_content;\n#[allow(unreachable_pub)]\npub use no_content::NoContent;\n\nmod raw;\n#[allow(unreachable_pub)]\npub use raw::Raw;\n\nmod redirect;\n#[allow(unreachable_pub)]\npub use redirect::Redirect;\n\nmod result;\n#[allow(unreachable_pub)]\npub use result::IntoResponseError;\n\nmod success;\n#[allow(unreachable_pub)]\npub use success::Success;\n\npub(crate) trait OrAllTypes {\n\tfn or_all_types(self) -\u003e Vec\u003cMime\u003e;\n}\n\nimpl OrAllTypes for Option\u003cVec\u003cMime\u003e\u003e {\n\tfn or_all_types(self) -\u003e Vec\u003cMime\u003e {\n\t\tself.unwrap_or_else(|| vec![STAR_STAR])\n\t}\n}\n\n/// A response, used to create the final gotham response from.\n#[derive(Debug)]\npub struct Response {\n\tpub(crate) status: StatusCode,\n\tpub(crate) body: Body,\n\tpub(crate) mime: Option\u003cMime\u003e,\n\tpub(crate) headers: HeaderMap\n}\n\nimpl Response {\n\t/// Create a new [Response] from raw data.\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn new\u003cB: Into\u003cBody\u003e\u003e(status: StatusCode, body: B, mime: Option\u003cMime\u003e) -\u003e Self {\n\t\tSelf {\n\t\t\tstatus,\n\t\t\tbody: body.into(),\n\t\t\tmime,\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Create a [Response] with mime type json from already serialized data.\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn json\u003cB: Into\u003cBody\u003e\u003e(status: StatusCode, body: B) -\u003e Self {\n\t\tSelf {\n\t\t\tstatus,\n\t\t\tbody: body.into(),\n\t\t\tmime: Some(APPLICATION_JSON),\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Create a _204 No Content_ [Response].\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn no_content() -\u003e Self {\n\t\tSelf {\n\t\t\tstatus: StatusCode::NO_CONTENT,\n\t\t\tbody: Body::empty(),\n\t\t\tmime: None,\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Create an empty _403 Forbidden_ [Response].\n\t#[must_use = \"Creating a response is pointless if you don't use it\"]\n\tpub fn forbidden() -\u003e Self {\n\t\tSelf {\n\t\t\tstatus: StatusCode::FORBIDDEN,\n\t\t\tbody: Body::empty(),\n\t\t\tmime: None,\n\t\t\theaders: Default::default()\n\t\t}\n\t}\n\n\t/// Return the status code of this [Response].\n\tpub fn status(\u0026self) -\u003e StatusCode {\n\t\tself.status\n\t}\n\n\t/// Return the mime type of this [Response].\n\tpub fn mime(\u0026self) -\u003e Option\u003c\u0026Mime\u003e {\n\t\tself.mime.as_ref()\n\t}\n\n\t/// Add an HTTP header to the [Response].\n\tpub fn header(\u0026mut self, name: HeaderName, value: HeaderValue) {\n\t\tself.headers.insert(name, value);\n\t}\n\n\tpub(crate) fn with_headers(mut self, headers: HeaderMap) -\u003e Self {\n\t\tself.headers = headers;\n\t\tself\n\t}\n\n\t#[cfg(test)]\n\tpub(crate) fn full_body(mut self) -\u003e Result\u003cVec\u003cu8\u003e, \u003cBody as gotham::hyper::body::HttpBody\u003e::Error\u003e {\n\t\tuse futures_executor::block_on;\n\t\tuse gotham::hyper::body::to_bytes;\n\n\t\tlet bytes: \u0026[u8] = \u0026block_on(to_bytes(\u0026mut self.body))?;\n\t\tOk(bytes.to_vec())\n\t}\n}\n\nimpl IntoResponse for Response {\n\ttype Err = Infallible;\n\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e {\n\t\tfuture::ok(self).boxed()\n\t}\n}\n\n/// This trait needs to be implemented by every type returned from an endpoint to\n/// to provide the response.\npub trait IntoResponse {\n\ttype Err: Into\u003cHandlerError\u003e + Send + Sync + 'static;\n\n\t/// Turn this into a response that can be returned to the browser. This api will likely\n\t/// change in the future.\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e;\n\n\t/// Return a list of supported mime types.\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tNone\n\t}\n}\n\n/// Additional details for [IntoResponse] to be used with an OpenAPI-aware router.\n#[cfg(feature = \"openapi\")]\npub trait ResponseSchema {\n\t/// All status codes returned by this response. Returns `[StatusCode::OK]` by default.\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::OK]\n\t}\n\n\t/// Return the schema of the response for the given status code. The code may\n\t/// only be one that was previously returned by [Self::status_codes]. The\n\t/// implementation should panic if that is not the case.\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema;\n}\n\n#[cfg(feature = \"openapi\")]\nmod private {\n\tpub trait Sealed {}\n}\n\n/// A trait provided to convert a resource's result to json, and provide an OpenAPI schema to the\n/// router. This trait is implemented for all types that implement [IntoResponse] and\n/// [ResponseSchema].\n#[cfg(feature = \"openapi\")]\npub trait IntoResponseWithSchema: IntoResponse + ResponseSchema + private::Sealed {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cR: IntoResponse + ResponseSchema\u003e private::Sealed for R {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cR: IntoResponse + ResponseSchema\u003e IntoResponseWithSchema for R {}\n\n/// The default json returned on an 500 Internal Server Error.\n#[derive(Debug, Serialize)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\npub(crate) struct ResourceError {\n\t/// This is always `true` and can be used to detect an error response without looking at the\n\t/// HTTP status code.\n\terror: bool,\n\t/// The error message.\n\tmessage: String\n}\n\nimpl\u003cT: ToString\u003e From\u003cT\u003e for ResourceError {\n\tfn from(message: T) -\u003e Self {\n\t\tSelf {\n\t\t\terror: true,\n\t\t\tmessage: message.to_string()\n\t\t}\n\t}\n}\n\n#[cfg(feature = \"errorlog\")]\nfn errorlog\u003cE: Display\u003e(e: E) {\n\terror!(\"The handler encountered an error: {}\", e);\n}\n\n#[cfg(not(feature = \"errorlog\"))]\nfn errorlog\u003cE\u003e(_e: E) {}\n\nfn handle_error\u003cE\u003e(e: E) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, E::Err\u003e\u003e + Send\u003e\u003e\nwhere\n\tE: Display + IntoResponseError\n{\n\tlet msg = e.to_string();\n\tlet res = e.into_response_error();\n\tmatch \u0026res {\n\t\tOk(res) if res.status.is_server_error() =\u003e errorlog(msg),\n\t\tErr(err) =\u003e {\n\t\t\terrorlog(msg);\n\t\t\terrorlog(\u0026err);\n\t\t},\n\t\t_ =\u003e {}\n\t};\n\tfuture::ready(res).boxed()\n}\n\nimpl\u003cRes\u003e IntoResponse for Pin\u003cBox\u003cdyn Future\u003cOutput = Res\u003e + Send\u003e\u003e\nwhere\n\tRes: IntoResponse + 'static\n{\n\ttype Err = Res::Err;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, Self::Err\u003e\u003e + Send\u003e\u003e {\n\t\tself.then(IntoResponse::into_response).boxed()\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tRes::accepted_types()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cRes\u003e ResponseSchema for Pin\u003cBox\u003cdyn Future\u003cOutput = Res\u003e + Send\u003e\u003e\nwhere\n\tRes: ResponseSchema\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tRes::status_codes()\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tRes::schema(code)\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Deserialize, Serialize)]\n\t#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\n\tstruct Msg {\n\t\tmsg: String\n\t}\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn result_from_future() {\n\t\tlet nc = NoContent::default();\n\t\tlet res = block_on(nc.into_response()).unwrap();\n\n\t\tlet fut_nc = async move { NoContent::default() }.boxed();\n\t\tlet fut_res = block_on(fut_nc.into_response()).unwrap();\n\n\t\tassert_eq!(res.status, fut_res.status);\n\t\tassert_eq!(res.mime, fut_res.mime);\n\t\tassert_eq!(res.full_body().unwrap(), fut_res.full_body().unwrap());\n\t}\n}\n","traces":[{"line":49,"address":[2222032],"length":1,"stats":{"Line":3},"fn_name":"or_all_types"},{"line":50,"address":[2222044],"length":1,"stats":{"Line":9},"fn_name":null},{"line":66,"address":[2442391,2442806,2442064,2442480],"length":1,"stats":{"Line":7},"fn_name":"new\u003chyper::body::body::Body\u003e"},{"line":69,"address":[2442571,2442117],"length":1,"stats":{"Line":7},"fn_name":null},{"line":71,"address":[2442664,2442243],"length":1,"stats":{"Line":7},"fn_name":null},{"line":77,"address":[2443191,2442896],"length":1,"stats":{"Line":2},"fn_name":"json\u003calloc::string::String\u003e"},{"line":80,"address":[2442928],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[2442970],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[2443054],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[2443232,2443405],"length":1,"stats":{"Line":3},"fn_name":"no_content"},{"line":91,"address":[2443249],"length":1,"stats":{"Line":3},"fn_name":null},{"line":93,"address":[2443268],"length":1,"stats":{"Line":3},"fn_name":null},{"line":99,"address":[2443629,2443456],"length":1,"stats":{"Line":0},"fn_name":"forbidden"},{"line":102,"address":[2443473],"length":1,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[2443492],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[2443680],"length":1,"stats":{"Line":1},"fn_name":"status"},{"line":110,"address":[2443685],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[2443696],"length":1,"stats":{"Line":1},"fn_name":"mime"},{"line":115,"address":[2443705],"length":1,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[2443744],"length":1,"stats":{"Line":1},"fn_name":"header"},{"line":120,"address":[2443764],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[2443856,2443960],"length":1,"stats":{"Line":3},"fn_name":"with_headers"},{"line":124,"address":[2443889,2443980,2444019],"length":1,"stats":{"Line":6},"fn_name":null},{"line":125,"address":[2444051],"length":1,"stats":{"Line":3},"fn_name":null},{"line":141,"address":[2444576],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":142,"address":[2444586],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[2353568],"length":1,"stats":{"Line":6},"fn_name":"accepted_types\u003cgotham_restful::response::redirect::Redirect\u003e"},{"line":157,"address":[2353571],"length":1,"stats":{"Line":6},"fn_name":null},{"line":165,"address":[2408528],"length":1,"stats":{"Line":4},"fn_name":"status_codes\u003cgotham_restful::response::raw::Raw\u003calloc::string::String\u003e\u003e"},{"line":166,"address":[2408542],"length":1,"stats":{"Line":4},"fn_name":null},{"line":204,"address":[2444688,2444791],"length":1,"stats":{"Line":2},"fn_name":"from\u003canyhow::Error\u003e"},{"line":207,"address":[2444717],"length":1,"stats":{"Line":2},"fn_name":null},{"line":213,"address":[2445248,2444832,2445596,2445202],"length":1,"stats":{"Line":1},"fn_name":"errorlog\u003calloc::string::String\u003e"},{"line":214,"address":[2444844,2444951,2445367,2445260],"length":1,"stats":{"Line":2},"fn_name":null},{"line":220,"address":[2446928,2447568,2445648,2446108,2446748,2446288,2447388,2448028],"length":1,"stats":{"Line":1},"fn_name":"handle_error\u003cgotham_restful::response::raw::test::MsgError\u003e"},{"line":224,"address":[2445697,2446337,2446977,2447617],"length":1,"stats":{"Line":1},"fn_name":null},{"line":225,"address":[2446992,2446352,2445712,2447632],"length":1,"stats":{"Line":1},"fn_name":null},{"line":226,"address":[2446611,2447251,2445971,2447690,2447891,2445770,2447050,2446410],"length":1,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[2446415,2447020,2447482,2445740,2446380,2445775,2447695,2446842,2446202,2447660,2447055,2448122],"length":1,"stats":{"Line":3},"fn_name":null},{"line":228,"address":[2447814,2447174,2446534,2445894],"length":1,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[2445907,2447187,2446547,2447827],"length":1,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[2447244,2447884,2445964,2446604],"length":1,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[2445655,2446295,2447575,2447893,2446613,2446935,2447253,2445973],"length":1,"stats":{"Line":2},"fn_name":null},{"line":243,"address":[1979456],"length":1,"stats":{"Line":1},"fn_name":"into_response\u003cgotham_restful::response::no_content::NoContent\u003e"},{"line":244,"address":[1979476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":36,"coverable":51},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","no_content.rs"],"content":"use super::{handle_error, IntoResponse};\n#[cfg(feature = \"openapi\")]\nuse crate::ResponseSchema;\nuse crate::{IntoResponseError, Response};\nuse futures_util::{future, future::FutureExt};\nuse gotham::hyper::header::{HeaderMap, HeaderValue, IntoHeaderName};\n#[cfg(feature = \"openapi\")]\nuse gotham::hyper::StatusCode;\nuse mime::Mime;\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\nuse std::{fmt::Display, future::Future, pin::Pin};\n\n/**\nThis is the return type of a resource that doesn't actually return something. It will result\nin a _204 No Content_ answer by default. You don't need to use this type directly if using\nthe function attributes:\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# mod doc_tests_are_broken {\n# use gotham::state::State;\n# use gotham_restful::*;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n#[read_all]\nfn read_all() {\n\t// do something\n}\n# }\n```\n*/\n#[derive(Clone, Debug, Default)]\npub struct NoContent {\n\theaders: HeaderMap\n}\n\nimpl From\u003c()\u003e for NoContent {\n\tfn from(_: ()) -\u003e Self {\n\t\tSelf::default()\n\t}\n}\n\nimpl NoContent {\n\t/// Set a custom HTTP header. If a header with this name was set before, its value is being updated.\n\tpub fn header\u003cK: IntoHeaderName\u003e(\u0026mut self, name: K, value: HeaderValue) {\n\t\tself.headers.insert(name, value);\n\t}\n\n\t/// Allow manipulating HTTP headers.\n\tpub fn headers_mut(\u0026mut self) -\u003e \u0026mut HeaderMap {\n\t\t\u0026mut self.headers\n\t}\n}\n\nimpl IntoResponse for NoContent {\n\t// TODO this shouldn't be a serde_json::Error\n\ttype Err = serde_json::Error; // just for easier handling of `Result\u003cNoContent, E\u003e`\n\n\t/// This will always be a _204 No Content_ together with an empty string.\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, Self::Err\u003e\u003e + Send\u003e\u003e {\n\t\tfuture::ok(Response::no_content().with_headers(self.headers)).boxed()\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(Vec::new())\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl ResponseSchema for NoContent {\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::NO_CONTENT]\n\t}\n\n\t/// Returns the schema of the `()` type.\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::NO_CONTENT);\n\t\t\u003c()\u003e::schema()\n\t}\n}\n\nimpl\u003cE\u003e IntoResponse for Result\u003cNoContent, E\u003e\nwhere\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\ttype Err = serde_json::Error;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, serde_json::Error\u003e\u003e + Send\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(nc) =\u003e nc.into_response(),\n\t\t\tErr(e) =\u003e handle_error(e)\n\t\t}\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tNoContent::accepted_types()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cE\u003e ResponseSchema for Result\u003cNoContent, E\u003e\nwhere\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::NO_CONTENT);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::NO_CONTENT =\u003e \u003cNoContent as ResponseSchema\u003e::schema(StatusCode::NO_CONTENT),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse gotham::hyper::{header::ACCESS_CONTROL_ALLOW_ORIGIN, StatusCode};\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn no_content_has_empty_response() {\n\t\tlet no_content = NoContent::default();\n\t\tlet res = block_on(no_content.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::NO_CONTENT);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(NoContent::status_codes(), vec![StatusCode::NO_CONTENT]);\n\t}\n\n\t#[test]\n\tfn no_content_result() {\n\t\tlet no_content: Result\u003cNoContent, MsgError\u003e = Ok(NoContent::default());\n\t\tlet res = block_on(no_content.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::NO_CONTENT);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cResult\u003cNoContent, MsgError\u003e\u003e::status_codes(), vec![\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tStatusCode::NO_CONTENT\n\t\t]);\n\t}\n\n\t#[test]\n\tfn no_content_custom_headers() {\n\t\tlet mut no_content = NoContent::default();\n\t\tno_content.header(ACCESS_CONTROL_ALLOW_ORIGIN, HeaderValue::from_static(\"*\"));\n\t\tlet res = block_on(no_content.into_response()).expect(\"didn't expect error response\");\n\t\tlet cors = res.headers.get(ACCESS_CONTROL_ALLOW_ORIGIN);\n\t\tassert_eq!(cors.map(|value| value.to_str().unwrap()), Some(\"*\"));\n\t}\n}\n","traces":[{"line":42,"address":[4253296],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":43,"address":[4253308],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[4253328],"length":1,"stats":{"Line":0},"fn_name":"headers_mut"},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[2119744,2119520],"length":1,"stats":{"Line":2},"fn_name":"into_response"},{"line":65,"address":[4253356],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[4253648],"length":1,"stats":{"Line":4},"fn_name":"accepted_types"},{"line":69,"address":[4253661],"length":1,"stats":{"Line":4},"fn_name":null},{"line":75,"address":[2119872],"length":1,"stats":{"Line":2},"fn_name":"status_codes"},{"line":76,"address":[4253726],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[2119936],"length":1,"stats":{"Line":2},"fn_name":"schema"},{"line":82,"address":[2120078],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[1978182,1978140],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[1978158,1978275],"length":1,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[1978304,1978363],"length":1,"stats":{"Line":1},"fn_name":"status_codes\u003cgotham_restful::response::no_content::test::MsgError\u003e"},{"line":110,"address":[1978321],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[1978336],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":16,"coverable":28},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","raw.rs"],"content":"use super::{handle_error, IntoResponse, IntoResponseError};\nuse crate::{types::ResourceType, FromBody, RequestBody, Response};\n#[cfg(feature = \"openapi\")]\nuse crate::{IntoResponseWithSchema, ResponseSchema};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\n\nuse futures_core::future::Future;\nuse futures_util::{future, future::FutureExt};\nuse gotham::hyper::{\n\tbody::{Body, Bytes},\n\tStatusCode\n};\nuse mime::Mime;\n#[cfg(feature = \"openapi\")]\nuse openapi_type::openapi::{SchemaKind, StringFormat, StringType, Type, VariantOrUnknownOrEmpty};\nuse serde_json::error::Error as SerdeJsonError;\nuse std::{convert::Infallible, fmt::Display, pin::Pin};\n\n/**\nThis type can be used both as a raw request body, as well as as a raw response. However, all types\nof request bodies are accepted by this type. It is therefore recommended to derive your own type\nfrom [RequestBody] and only use this when you need to return a raw response. This is a usage\nexample that simply returns its body:\n\n```rust,no_run\n# #[macro_use] extern crate gotham_restful_derive;\n# use gotham::router::builder::*;\n# use gotham_restful::*;\n#[derive(Resource)]\n#[resource(create)]\nstruct ImageResource;\n\n#[create]\nfn create(body : Raw\u003cVec\u003cu8\u003e\u003e) -\u003e Raw\u003cVec\u003cu8\u003e\u003e {\n\tbody\n}\n# fn main() {\n# \tgotham::start(\"127.0.0.1:8080\", build_simple_router(|route| {\n# \t\troute.resource::\u003cImageResource\u003e(\"img\");\n# \t}));\n# }\n```\n*/\n#[derive(Debug)]\npub struct Raw\u003cT\u003e {\n\tpub raw: T,\n\tpub mime: Mime\n}\n\nimpl\u003cT\u003e Raw\u003cT\u003e {\n\tpub fn new(raw: T, mime: Mime) -\u003e Self {\n\t\tSelf { raw, mime }\n\t}\n}\n\nimpl\u003cT, U\u003e AsMut\u003cU\u003e for Raw\u003cT\u003e\nwhere\n\tT: AsMut\u003cU\u003e\n{\n\tfn as_mut(\u0026mut self) -\u003e \u0026mut U {\n\t\tself.raw.as_mut()\n\t}\n}\n\nimpl\u003cT, U\u003e AsRef\u003cU\u003e for Raw\u003cT\u003e\nwhere\n\tT: AsRef\u003cU\u003e\n{\n\tfn as_ref(\u0026self) -\u003e \u0026U {\n\t\tself.raw.as_ref()\n\t}\n}\n\nimpl\u003cT: Clone\u003e Clone for Raw\u003cT\u003e {\n\tfn clone(\u0026self) -\u003e Self {\n\t\tSelf {\n\t\t\traw: self.raw.clone(),\n\t\t\tmime: self.mime.clone()\n\t\t}\n\t}\n}\n\nimpl\u003cT: for\u003c'a\u003e From\u003c\u0026'a [u8]\u003e\u003e FromBody for Raw\u003cT\u003e {\n\ttype Err = Infallible;\n\n\tfn from_body(body: Bytes, mime: Mime) -\u003e Result\u003cSelf, Self::Err\u003e {\n\t\tOk(Self::new(body.as_ref().into(), mime))\n\t}\n}\n\nimpl\u003cT\u003e RequestBody for Raw\u003cT\u003e where Raw\u003cT\u003e: FromBody + ResourceType {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT\u003e OpenapiType for Raw\u003cT\u003e {\n\tfn schema() -\u003e OpenapiSchema {\n\t\tOpenapiSchema::new(SchemaKind::Type(Type::String(StringType {\n\t\t\tformat: VariantOrUnknownOrEmpty::Item(StringFormat::Binary),\n\t\t\t..Default::default()\n\t\t})))\n\t}\n}\n\nimpl\u003cT: Into\u003cBody\u003e\u003e IntoResponse for Raw\u003cT\u003e\nwhere\n\tSelf: Send\n{\n\ttype Err = SerdeJsonError; // just for easier handling of `Result\u003cRaw\u003cT\u003e, E\u003e`\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, SerdeJsonError\u003e\u003e + Send\u003e\u003e {\n\t\tfuture::ok(Response::new(StatusCode::OK, self.raw, Some(self.mime))).boxed()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT: Into\u003cBody\u003e\u003e ResponseSchema for Raw\u003cT\u003e\nwhere\n\tSelf: Send\n{\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::OK);\n\t\t\u003cSelf as OpenapiType\u003e::schema()\n\t}\n}\n\nimpl\u003cT, E\u003e IntoResponse for Result\u003cRaw\u003cT\u003e, E\u003e\nwhere\n\tRaw\u003cT\u003e: IntoResponse,\n\tE: Display + IntoResponseError\u003cErr = \u003cRaw\u003cT\u003e as IntoResponse\u003e::Err\u003e\n{\n\ttype Err = E::Err;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, E::Err\u003e\u003e + Send\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(raw) =\u003e raw.into_response(),\n\t\t\tErr(e) =\u003e handle_error(e)\n\t\t}\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT, E\u003e ResponseSchema for Result\u003cRaw\u003cT\u003e, E\u003e\nwhere\n\tRaw\u003cT\u003e: IntoResponseWithSchema,\n\tE: Display + IntoResponseError\u003cErr = \u003cRaw\u003cT\u003e as IntoResponse\u003e::Err\u003e\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::OK);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::OK =\u003e \u003cRaw\u003cT\u003e as ResponseSchema\u003e::schema(StatusCode::OK),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse mime::TEXT_PLAIN;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn raw_response() {\n\t\tlet msg = \"Test\";\n\t\tlet raw = Raw::new(msg, TEXT_PLAIN);\n\t\tlet res = block_on(raw.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(TEXT_PLAIN));\n\t\tassert_eq!(res.full_body().unwrap(), msg.as_bytes());\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cRaw\u003cString\u003e\u003e::status_codes(), vec![StatusCode::OK]);\n\t}\n\n\t#[test]\n\tfn raw_result() {\n\t\tlet msg = \"Test\";\n\t\tlet raw: Result\u003cRaw\u003c_\u003e, MsgError\u003e = Ok(Raw::new(msg, TEXT_PLAIN));\n\t\tlet res = block_on(raw.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(TEXT_PLAIN));\n\t\tassert_eq!(res.full_body().unwrap(), msg.as_bytes());\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cResult\u003cRaw\u003cString\u003e, MsgError\u003e\u003e::status_codes(), vec![\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tStatusCode::OK\n\t\t]);\n\t}\n}\n","traces":[{"line":52,"address":[2983824],"length":1,"stats":{"Line":6},"fn_name":"new\u003calloc::vec::Vec\u003cu8, alloc::alloc::Global\u003e\u003e"},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[2407504,2407953],"length":1,"stats":{"Line":3},"fn_name":"schema\u003c\u0026str\u003e"},{"line":97,"address":[3478830],"length":1,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[2407521],"length":1,"stats":{"Line":3},"fn_name":null},{"line":99,"address":[2407559],"length":1,"stats":{"Line":3},"fn_name":null},{"line":110,"address":[2408032],"length":1,"stats":{"Line":5},"fn_name":"into_response\u003c\u0026str\u003e"},{"line":111,"address":[3399466],"length":1,"stats":{"Line":5},"fn_name":null},{"line":120,"address":[2408208],"length":1,"stats":{"Line":3},"fn_name":"schema\u003c\u0026str\u003e"},{"line":122,"address":[2408350],"length":1,"stats":{"Line":3},"fn_name":null},{"line":133,"address":[1978400],"length":1,"stats":{"Line":1},"fn_name":"into_response\u003c\u0026str,gotham_restful::response::raw::test::MsgError\u003e"},{"line":134,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[1978412,1978454],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[1978576,1978635],"length":1,"stats":{"Line":1},"fn_name":"status_codes\u003calloc::string::String,gotham_restful::response::raw::test::MsgError\u003e"},{"line":148,"address":[1978593],"length":1,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[1978608],"length":1,"stats":{"Line":1},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":17,"coverable":30},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","redirect.rs"],"content":"use super::{handle_error, IntoResponse};\nuse crate::{IntoResponseError, Response};\n#[cfg(feature = \"openapi\")]\nuse crate::{NoContent, ResponseSchema};\nuse futures_util::future::{BoxFuture, FutureExt, TryFutureExt};\nuse gotham::hyper::{\n\theader::{InvalidHeaderValue, LOCATION},\n\tBody, StatusCode\n};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiSchema;\nuse std::{\n\terror::Error as StdError,\n\tfmt::{Debug, Display}\n};\nuse thiserror::Error;\n\n/**\nThis is the return type of a resource that only returns a redirect. It will result\nin a _303 See Other_ answer, meaning the redirect will always result in a GET request\non the target.\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# mod doc_tests_are_broken {\n# use gotham::state::State;\n# use gotham_restful::*;\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n#[read_all]\nfn read_all() -\u003e Redirect {\n\tRedirect {\n\t\tto: \"http://localhost:8080/cool/new/location\".to_owned()\n\t}\n}\n# }\n```\n*/\n#[derive(Clone, Debug, Default)]\npub struct Redirect {\n\tpub to: String\n}\n\nimpl IntoResponse for Redirect {\n\ttype Err = InvalidHeaderValue;\n\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e {\n\t\tasync move {\n\t\t\tlet mut res = Response::new(StatusCode::SEE_OTHER, Body::empty(), None);\n\t\t\tres.header(LOCATION, self.to.parse()?);\n\t\t\tOk(res)\n\t\t}\n\t\t.boxed()\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl ResponseSchema for Redirect {\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::SEE_OTHER]\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::SEE_OTHER);\n\t\t\u003cNoContent as ResponseSchema\u003e::schema(StatusCode::NO_CONTENT)\n\t}\n}\n\n// private type due to parent mod\n#[derive(Debug, Error)]\npub enum RedirectError\u003cE: StdError + 'static\u003e {\n\t#[error(\"{0}\")]\n\tInvalidLocation(#[from] InvalidHeaderValue),\n\t#[error(\"{0}\")]\n\tOther(#[source] E)\n}\n\n#[allow(ambiguous_associated_items)] // an enum variant is not a type. never.\nimpl\u003cE\u003e IntoResponse for Result\u003cRedirect, E\u003e\nwhere\n\tE: Display + IntoResponseError,\n\t\u003cE as IntoResponseError\u003e::Err: StdError + Sync\n{\n\ttype Err = RedirectError\u003c\u003cE as IntoResponseError\u003e::Err\u003e;\n\n\tfn into_response(self) -\u003e BoxFuture\u003c'static, Result\u003cResponse, Self::Err\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(nc) =\u003e nc.into_response().map_err(Into::into).boxed(),\n\t\t\tErr(e) =\u003e handle_error(e).map_err(RedirectError::Other).boxed()\n\t\t}\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cE\u003e ResponseSchema for Result\u003cRedirect, E\u003e\nwhere\n\tE: Display + IntoResponseError,\n\t\u003cE as IntoResponseError\u003e::Err: StdError + Sync\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::SEE_OTHER);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::SEE_OTHER =\u003e \u003cRedirect as ResponseSchema\u003e::schema(StatusCode::SEE_OTHER),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse futures_executor::block_on;\n\tuse gotham::hyper::StatusCode;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn redirect_response() {\n\t\tlet redir = Redirect {\n\t\t\tto: \"http://localhost/foo\".to_owned()\n\t\t};\n\t\tlet res = block_on(redir.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::SEE_OTHER);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(\n\t\t\tres.headers.get(LOCATION).map(|hdr| hdr.to_str().unwrap()),\n\t\t\tSome(\"http://localhost/foo\")\n\t\t);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(Redirect::status_codes(), vec![StatusCode::SEE_OTHER]);\n\t}\n\n\t#[test]\n\tfn redirect_result() {\n\t\tlet redir: Result\u003cRedirect, MsgError\u003e = Ok(Redirect {\n\t\t\tto: \"http://localhost/foo\".to_owned()\n\t\t});\n\t\tlet res = block_on(redir.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::SEE_OTHER);\n\t\tassert_eq!(res.mime, None);\n\t\tassert_eq!(\n\t\t\tres.headers.get(LOCATION).map(|hdr| hdr.to_str().unwrap()),\n\t\t\tSome(\"http://localhost/foo\")\n\t\t);\n\t\tassert_eq!(res.full_body().unwrap(), \u0026[] as \u0026[u8]);\n\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cResult\u003cRedirect, MsgError\u003e\u003e::status_codes(), vec![\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tStatusCode::SEE_OTHER\n\t\t]);\n\t}\n}\n","traces":[{"line":50,"address":[2352272],"length":1,"stats":{"Line":1},"fn_name":"into_response"},{"line":51,"address":[4494928,4494836,4494971,4495563,4495611],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":52,"address":[4106594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[4000560,4001015],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[4000927],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[4107360],"length":1,"stats":{"Line":1},"fn_name":"status_codes"},{"line":63,"address":[4001278],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[4001328],"length":1,"stats":{"Line":0},"fn_name":"schema"},{"line":68,"address":[4001483],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[1978672],"length":1,"stats":{"Line":1},"fn_name":"into_response\u003cgotham_restful::response::redirect::test::MsgError\u003e"},{"line":90,"address":[1978975,1978903,1978720],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[1978684,1978727],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[1979008,1979067],"length":1,"stats":{"Line":1},"fn_name":"status_codes\u003cgotham_restful::response::redirect::test::MsgError\u003e"},{"line":104,"address":[1979025],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[1979040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":13,"coverable":21},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","result.rs"],"content":"use super::{handle_error, IntoResponse, ResourceError};\n#[cfg(feature = \"openapi\")]\nuse crate::ResponseSchema;\nuse crate::{Response, ResponseBody, Success};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::{OpenapiSchema, OpenapiType};\n\nuse futures_core::future::Future;\nuse gotham::{anyhow::Error, hyper::StatusCode};\nuse mime::{Mime, APPLICATION_JSON};\nuse std::{fmt::Display, pin::Pin};\n\npub trait IntoResponseError {\n\ttype Err: Display + Send + 'static;\n\n\tfn into_response_error(self) -\u003e Result\u003cResponse, Self::Err\u003e;\n\n\t#[cfg(feature = \"openapi\")]\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e;\n\n\t#[cfg(feature = \"openapi\")]\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema;\n}\n\nimpl\u003cE\u003e IntoResponseError for E\nwhere\n\tE: Into\u003cError\u003e\n{\n\ttype Err = serde_json::Error;\n\n\tfn into_response_error(self) -\u003e Result\u003cResponse, Self::Err\u003e {\n\t\tlet err: Error = self.into();\n\t\tlet err: ResourceError = err.into();\n\t\tOk(Response::json(\n\t\t\tStatusCode::INTERNAL_SERVER_ERROR,\n\t\t\tserde_json::to_string(\u0026err)?\n\t\t))\n\t}\n\n\t#[cfg(feature = \"openapi\")]\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tvec![StatusCode::INTERNAL_SERVER_ERROR]\n\t}\n\n\t#[cfg(feature = \"openapi\")]\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::INTERNAL_SERVER_ERROR);\n\t\tResourceError::schema()\n\t}\n}\n\nimpl\u003cR, E\u003e IntoResponse for Result\u003cR, E\u003e\nwhere\n\tR: ResponseBody,\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\ttype Err = E::Err;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, E::Err\u003e\u003e + Send\u003e\u003e {\n\t\tmatch self {\n\t\t\tOk(r) =\u003e Success::from(r).into_response(),\n\t\t\tErr(e) =\u003e handle_error(e)\n\t\t}\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(vec![APPLICATION_JSON])\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cR, E\u003e ResponseSchema for Result\u003cR, E\u003e\nwhere\n\tR: ResponseBody,\n\tE: Display + IntoResponseError\u003cErr = serde_json::Error\u003e\n{\n\tfn status_codes() -\u003e Vec\u003cStatusCode\u003e {\n\t\tlet mut status_codes = E::status_codes();\n\t\tstatus_codes.push(StatusCode::OK);\n\t\tstatus_codes\n\t}\n\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tmatch code {\n\t\t\tStatusCode::OK =\u003e R::schema(),\n\t\t\tcode =\u003e E::schema(code)\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse crate::response::OrAllTypes;\n\tuse futures_executor::block_on;\n\tuse thiserror::Error;\n\n\t#[derive(Debug, Default, Deserialize, Serialize)]\n\t#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\n\tstruct Msg {\n\t\tmsg: String\n\t}\n\n\t#[derive(Debug, Default, Error)]\n\t#[error(\"An Error\")]\n\tstruct MsgError;\n\n\t#[test]\n\tfn result_ok() {\n\t\tlet ok: Result\u003cMsg, MsgError\u003e = Ok(Msg::default());\n\t\tlet res = block_on(ok.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(APPLICATION_JSON));\n\t\tassert_eq!(res.full_body().unwrap(), br#\"{\"msg\":\"\"}\"#);\n\t}\n\n\t#[test]\n\tfn result_err() {\n\t\tlet err: Result\u003cMsg, MsgError\u003e = Err(MsgError::default());\n\t\tlet res = block_on(err.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::INTERNAL_SERVER_ERROR);\n\t\tassert_eq!(res.mime, Some(APPLICATION_JSON));\n\t\tassert_eq!(\n\t\t\tres.full_body().unwrap(),\n\t\t\tformat!(r#\"{{\"error\":true,\"message\":\"{}\"}}\"#, MsgError::default()).as_bytes()\n\t\t);\n\t}\n\n\t#[test]\n\tfn success_accepts_json() {\n\t\tassert!(\u003cResult\u003cMsg, MsgError\u003e\u003e::accepted_types()\n\t\t\t.or_all_types()\n\t\t\t.contains(\u0026APPLICATION_JSON))\n\t}\n}\n","traces":[{"line":31,"address":[2441426,2441488,2441072,2441842],"length":1,"stats":{"Line":2},"fn_name":"into_response_error\u003cgotham_restful::response::result::test::MsgError\u003e"},{"line":32,"address":[2441505,2441089],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[2504120],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[2441346,2441684,2441762,2441268],"length":1,"stats":{"Line":4},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[2579056],"length":1,"stats":{"Line":3},"fn_name":"status_codes\u003cgotham_restful::response::raw::test::MsgError\u003e"},{"line":42,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[1979116,1979159],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[1979292,1979132],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[1979328],"length":1,"stats":{"Line":3},"fn_name":"accepted_types\u003cgotham_restful::response::result::test::Msg,gotham_restful::response::result::test::MsgError\u003e"},{"line":67,"address":[1979342],"length":1,"stats":{"Line":3},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":2},"fn_name":null}],"covered":19,"coverable":24},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","response","success.rs"],"content":"use super::IntoResponse;\n#[cfg(feature = \"openapi\")]\nuse crate::ResponseSchema;\nuse crate::{Response, ResponseBody};\nuse futures_util::future::{self, FutureExt};\nuse gotham::hyper::{\n\theader::{HeaderMap, HeaderValue, IntoHeaderName},\n\tStatusCode\n};\nuse mime::{Mime, APPLICATION_JSON};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiSchema;\nuse std::{fmt::Debug, future::Future, pin::Pin};\n\n/**\nThis can be returned from a resource when there is no cause of an error.\n\nUsage example:\n\n```\n# #[macro_use] extern crate gotham_restful_derive;\n# mod doc_tests_are_broken {\n# use gotham::state::State;\n# use gotham_restful::*;\n# use serde::{Deserialize, Serialize};\n#\n# #[derive(Resource)]\n# #[resource(read_all)]\n# struct MyResource;\n#\n#[derive(Deserialize, Serialize)]\n# #[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\nstruct MyResponse {\n\tmessage: \u0026'static str\n}\n\n#[read_all]\nfn read_all() -\u003e Success\u003cMyResponse\u003e {\n\tlet res = MyResponse { message: \"I'm always happy\" };\n\tres.into()\n}\n# }\n```\n*/\n#[derive(Clone, Debug, Default)]\npub struct Success\u003cT\u003e {\n\tvalue: T,\n\theaders: HeaderMap\n}\n\nimpl\u003cT\u003e From\u003cT\u003e for Success\u003cT\u003e {\n\tfn from(t: T) -\u003e Self {\n\t\tSelf {\n\t\t\tvalue: t,\n\t\t\theaders: HeaderMap::new()\n\t\t}\n\t}\n}\n\nimpl\u003cT\u003e Success\u003cT\u003e {\n\t/// Set a custom HTTP header. If a header with this name was set before, its value is being updated.\n\tpub fn header\u003cK: IntoHeaderName\u003e(\u0026mut self, name: K, value: HeaderValue) {\n\t\tself.headers.insert(name, value);\n\t}\n\n\t/// Allow manipulating HTTP headers.\n\tpub fn headers_mut(\u0026mut self) -\u003e \u0026mut HeaderMap {\n\t\t\u0026mut self.headers\n\t}\n}\n\nimpl\u003cT: ResponseBody\u003e IntoResponse for Success\u003cT\u003e {\n\ttype Err = serde_json::Error;\n\n\tfn into_response(self) -\u003e Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cResponse, Self::Err\u003e\u003e + Send\u003e\u003e {\n\t\tlet res =\n\t\t\tserde_json::to_string(\u0026self.value).map(|body| Response::json(StatusCode::OK, body).with_headers(self.headers));\n\t\tfuture::ready(res).boxed()\n\t}\n\n\tfn accepted_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(vec![APPLICATION_JSON])\n\t}\n}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT: ResponseBody\u003e ResponseSchema for Success\u003cT\u003e {\n\tfn schema(code: StatusCode) -\u003e OpenapiSchema {\n\t\tassert_eq!(code, StatusCode::OK);\n\t\tT::schema()\n\t}\n}\n\n#[cfg(test)]\nmod test {\n\tuse super::*;\n\tuse crate::response::OrAllTypes;\n\tuse futures_executor::block_on;\n\tuse gotham::hyper::header::ACCESS_CONTROL_ALLOW_ORIGIN;\n\n\t#[derive(Debug, Default, Serialize)]\n\t#[cfg_attr(feature = \"openapi\", derive(openapi_type::OpenapiType))]\n\tstruct Msg {\n\t\tmsg: String\n\t}\n\n\t#[test]\n\tfn success_always_successfull() {\n\t\tlet success: Success\u003cMsg\u003e = Msg::default().into();\n\t\tlet res = block_on(success.into_response()).expect(\"didn't expect error response\");\n\t\tassert_eq!(res.status, StatusCode::OK);\n\t\tassert_eq!(res.mime, Some(APPLICATION_JSON));\n\t\tassert_eq!(res.full_body().unwrap(), br#\"{\"msg\":\"\"}\"#);\n\t\t#[cfg(feature = \"openapi\")]\n\t\tassert_eq!(\u003cSuccess\u003cMsg\u003e\u003e::status_codes(), vec![StatusCode::OK]);\n\t}\n\n\t#[test]\n\tfn success_custom_headers() {\n\t\tlet mut success: Success\u003cMsg\u003e = Msg::default().into();\n\t\tsuccess.header(ACCESS_CONTROL_ALLOW_ORIGIN, HeaderValue::from_static(\"*\"));\n\t\tlet res = block_on(success.into_response()).expect(\"didn't expect error response\");\n\t\tlet cors = res.headers.get(ACCESS_CONTROL_ALLOW_ORIGIN);\n\t\tassert_eq!(cors.map(|value| value.to_str().unwrap()), Some(\"*\"));\n\t}\n\n\t#[test]\n\tfn success_accepts_json() {\n\t\tassert!(\u003cSuccess\u003cMsg\u003e\u003e::accepted_types().or_all_types().contains(\u0026APPLICATION_JSON))\n\t}\n}\n","traces":[{"line":52,"address":[2896128,2896222,2895968,2896089],"length":1,"stats":{"Line":2},"fn_name":"from\u003copenapi_specification::Secrets\u003e"},{"line":55,"address":[2550209,2550369],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[2550496],"length":1,"stats":{"Line":1},"fn_name":"header\u003cgotham_restful::response::success::test::Msg,http::header::name::HeaderName\u003e"},{"line":63,"address":[2550516],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[2896909,2896549,2896624,2896272],"length":1,"stats":{"Line":2},"fn_name":"into_response\u003copenapi_specification::Secret\u003e"},{"line":76,"address":[2550999,2551333,2551312,2550647,2551637,2551616],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cgotham_restful::response::result::test::Msg\u003e"},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[2551172,2550820,2550975,2550623],"length":1,"stats":{"Line":4},"fn_name":null},{"line":81,"address":[2551920],"length":1,"stats":{"Line":1},"fn_name":"accepted_types\u003cgotham_restful::response::success::test::Msg\u003e"},{"line":82,"address":[2551934],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":9,"coverable":14},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","routing.rs"],"content":"#[cfg(feature = \"openapi\")]\nuse crate::openapi::{\n\tbuilder::{OpenapiBuilder, OpenapiInfo},\n\trouter::OpenapiRouter\n};\nuse crate::{response::ResourceError, Endpoint, FromBody, IntoResponse, Resource, Response};\n#[cfg(feature = \"cors\")]\nuse gotham::router::route::matcher::AccessControlRequestMethodMatcher;\nuse gotham::{\n\thandler::HandlerError,\n\thelpers::http::response::{create_empty_response, create_response},\n\thyper::{body::to_bytes, header::CONTENT_TYPE, Body, HeaderMap, Method, StatusCode},\n\tpipeline::chain::PipelineHandleChain,\n\trouter::{\n\t\tbuilder::{DefineSingleRoute, DrawRoutes, RouterBuilder, ScopeBuilder},\n\t\tnon_match::RouteNonMatch,\n\t\troute::matcher::{AcceptHeaderRouteMatcher, ContentTypeHeaderRouteMatcher, RouteMatcher}\n\t},\n\tstate::{FromState, State}\n};\nuse mime::{Mime, APPLICATION_JSON};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse std::{any::TypeId, panic::RefUnwindSafe};\n\n/// Allow us to extract an id from a path.\n#[derive(Clone, Copy, Debug, Deserialize, StateData, StaticResponseExtender)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\npub struct PathExtractor\u003cID: RefUnwindSafe + Send + 'static\u003e {\n\tpub id: ID\n}\n\n/// This trait adds the `with_openapi` method to gotham's routing. It turns the default\n/// router into one that will only allow RESTful resources, but record them and generate\n/// an OpenAPI specification on request.\n#[cfg(feature = \"openapi\")]\npub trait WithOpenapi\u003cD\u003e {\n\tfn with_openapi\u003cF\u003e(\u0026mut self, info: OpenapiInfo, block: F)\n\twhere\n\t\tF: FnOnce(OpenapiRouter\u003c'_, D\u003e);\n}\n\n/// This trait adds the `resource` method to gotham's routing. It allows you to register\n/// any RESTful [Resource] with a path.\n#[_private_openapi_trait(DrawResourcesWithSchema)]\npub trait DrawResources {\n\t#[openapi_bound(\"R: crate::ResourceWithSchema\")]\n\t#[non_openapi_bound(\"R: crate::Resource\")]\n\tfn resource\u003cR\u003e(\u0026mut self, path: \u0026str);\n}\n\n/// This trait allows to draw routes within an resource. Use this only inside the\n/// [Resource::setup] method.\n#[_private_openapi_trait(DrawResourceRoutesWithSchema)]\npub trait DrawResourceRoutes {\n\t#[openapi_bound(\"E: crate::EndpointWithSchema\")]\n\t#[non_openapi_bound(\"E: crate::Endpoint\")]\n\tfn endpoint\u003cE: 'static\u003e(\u0026mut self);\n}\n\nfn response_from(res: Response, state: \u0026State) -\u003e gotham::hyper::Response\u003cBody\u003e {\n\tlet mut r = create_empty_response(state, res.status);\n\tlet headers = r.headers_mut();\n\tif let Some(mime) = res.mime {\n\t\theaders.insert(CONTENT_TYPE, mime.as_ref().parse().unwrap());\n\t}\n\tlet mut last_name = None;\n\tfor (name, value) in res.headers {\n\t\tif name.is_some() {\n\t\t\tlast_name = name;\n\t\t}\n\t\t// this unwrap is safe: the first item will always be Some\n\t\tlet name = last_name.clone().unwrap();\n\t\theaders.insert(name, value);\n\t}\n\n\tlet method = Method::borrow_from(state);\n\tif method != Method::HEAD {\n\t\t*r.body_mut() = res.body;\n\t}\n\n\t#[cfg(feature = \"cors\")]\n\tcrate::cors::handle_cors(state, \u0026mut r);\n\n\tr\n}\n\nasync fn endpoint_handler\u003cE: Endpoint\u003e(state: \u0026mut State) -\u003e Result\u003cgotham::hyper::Response\u003cBody\u003e, HandlerError\u003e\nwhere\n\tE: Endpoint,\n\t\u003cE::Output as IntoResponse\u003e::Err: Into\u003cHandlerError\u003e\n{\n\ttrace!(\"entering endpoint_handler\");\n\tlet placeholders = E::Placeholders::take_from(state);\n\t// workaround for E::Placeholders and E::Param being the same type\n\t// when fixed remove `Clone` requirement on endpoint\n\tif TypeId::of::\u003cE::Placeholders\u003e() == TypeId::of::\u003cE::Params\u003e() {\n\t\tstate.put(placeholders.clone());\n\t}\n\tlet params = E::Params::take_from(state);\n\n\tlet body = match E::needs_body() {\n\t\ttrue =\u003e {\n\t\t\tlet body = to_bytes(Body::take_from(state)).await?;\n\n\t\t\tlet content_type: Mime = match HeaderMap::borrow_from(state).get(CONTENT_TYPE) {\n\t\t\t\tSome(content_type) =\u003e content_type.to_str().unwrap().parse().unwrap(),\n\t\t\t\tNone =\u003e {\n\t\t\t\t\tdebug!(\"Missing Content-Type: Returning 415 Response\");\n\t\t\t\t\tlet res = create_empty_response(state, StatusCode::UNSUPPORTED_MEDIA_TYPE);\n\t\t\t\t\treturn Ok(res);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tmatch E::Body::from_body(body, content_type) {\n\t\t\t\tOk(body) =\u003e Some(body),\n\t\t\t\tErr(e) =\u003e {\n\t\t\t\t\tdebug!(\"Invalid Body: Returning 400 Response\");\n\t\t\t\t\tlet error: ResourceError = e.into();\n\t\t\t\t\tlet json = serde_json::to_string(\u0026error)?;\n\t\t\t\t\tlet res = create_response(state, StatusCode::BAD_REQUEST, APPLICATION_JSON, json);\n\t\t\t\t\treturn Ok(res);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tfalse =\u003e None\n\t};\n\n\tlet out = E::handle(state, placeholders, params, body).await;\n\tlet res = out.into_response().await.map_err(Into::into)?;\n\tdebug!(\"Returning response {:?}\", res);\n\tOk(response_from(res, state))\n}\n\n#[derive(Clone)]\nstruct MaybeMatchAcceptHeader {\n\tmatcher: Option\u003cAcceptHeaderRouteMatcher\u003e\n}\n\nimpl RouteMatcher for MaybeMatchAcceptHeader {\n\tfn is_match(\u0026self, state: \u0026State) -\u003e Result\u003c(), RouteNonMatch\u003e {\n\t\tmatch \u0026self.matcher {\n\t\t\tSome(matcher) =\u003e matcher.is_match(state),\n\t\t\tNone =\u003e Ok(())\n\t\t}\n\t}\n}\n\nimpl MaybeMatchAcceptHeader {\n\tfn new(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tlet types = match types {\n\t\t\tSome(types) if types.is_empty() =\u003e None,\n\t\t\ttypes =\u003e types\n\t\t};\n\t\tSelf {\n\t\t\tmatcher: types.map(AcceptHeaderRouteMatcher::new)\n\t\t}\n\t}\n}\n\nimpl From\u003cOption\u003cVec\u003cMime\u003e\u003e\u003e for MaybeMatchAcceptHeader {\n\tfn from(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tSelf::new(types)\n\t}\n}\n\n#[derive(Clone)]\nstruct MaybeMatchContentTypeHeader {\n\tmatcher: Option\u003cContentTypeHeaderRouteMatcher\u003e\n}\n\nimpl RouteMatcher for MaybeMatchContentTypeHeader {\n\tfn is_match(\u0026self, state: \u0026State) -\u003e Result\u003c(), RouteNonMatch\u003e {\n\t\tmatch \u0026self.matcher {\n\t\t\tSome(matcher) =\u003e matcher.is_match(state),\n\t\t\tNone =\u003e Ok(())\n\t\t}\n\t}\n}\n\nimpl MaybeMatchContentTypeHeader {\n\tfn new(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tSelf {\n\t\t\tmatcher: types.map(|types| ContentTypeHeaderRouteMatcher::new(types).allow_no_type())\n\t\t}\n\t}\n}\n\nimpl From\u003cOption\u003cVec\u003cMime\u003e\u003e\u003e for MaybeMatchContentTypeHeader {\n\tfn from(types: Option\u003cVec\u003cMime\u003e\u003e) -\u003e Self {\n\t\tSelf::new(types)\n\t}\n}\n\nmacro_rules! implDrawResourceRoutes {\n\t($implType:ident) =\u003e {\n\t\t#[cfg(feature = \"openapi\")]\n\t\timpl\u003c'a, C, P\u003e WithOpenapi\u003cSelf\u003e for $implType\u003c'a, C, P\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn with_openapi\u003cF\u003e(\u0026mut self, info: OpenapiInfo, block: F)\n\t\t\twhere\n\t\t\t\tF: FnOnce(OpenapiRouter\u003c'_, $implType\u003c'a, C, P\u003e\u003e)\n\t\t\t{\n\t\t\t\tlet router = OpenapiRouter {\n\t\t\t\t\trouter: self,\n\t\t\t\t\tscope: None,\n\t\t\t\t\topenapi_builder: \u0026mut OpenapiBuilder::new(info)\n\t\t\t\t};\n\t\t\t\tblock(router);\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, C, P\u003e DrawResources for $implType\u003c'a, C, P\u003e\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn resource\u003cR: Resource\u003e(\u0026mut self, mut path: \u0026str) {\n\t\t\t\tif path.starts_with('/') {\n\t\t\t\t\tpath = \u0026path[1..];\n\t\t\t\t}\n\t\t\t\tR::setup((self, path));\n\t\t\t}\n\t\t}\n\n\t\timpl\u003c'a, C, P\u003e DrawResourceRoutes for (\u0026mut $implType\u003c'a, C, P\u003e, \u0026str)\n\t\twhere\n\t\t\tC: PipelineHandleChain\u003cP\u003e + Copy + Send + Sync + 'static,\n\t\t\tP: RefUnwindSafe + Send + Sync + 'static\n\t\t{\n\t\t\tfn endpoint\u003cE: Endpoint + 'static\u003e(\u0026mut self) {\n\t\t\t\tlet uri = format!(\"{}/{}\", self.1, E::uri());\n\t\t\t\tdebug!(\"Registering endpoint for {}\", uri);\n\t\t\t\tself.0.associate(\u0026uri, |assoc| {\n\t\t\t\t\tassoc\n\t\t\t\t\t\t.request(vec![E::http_method()])\n\t\t\t\t\t\t.add_route_matcher(MaybeMatchAcceptHeader::new(E::Output::accepted_types()))\n\t\t\t\t\t\t.with_path_extractor::\u003cE::Placeholders\u003e()\n\t\t\t\t\t\t.with_query_string_extractor::\u003cE::Params\u003e()\n\t\t\t\t\t\t.to_async_borrowing(endpoint_handler::\u003cE\u003e);\n\n\t\t\t\t\t#[cfg(feature = \"cors\")]\n\t\t\t\t\tif E::http_method() != Method::GET {\n\t\t\t\t\t\tassoc\n\t\t\t\t\t\t\t.options()\n\t\t\t\t\t\t\t.add_route_matcher(AccessControlRequestMethodMatcher::new(E::http_method()))\n\t\t\t\t\t\t\t.to(crate::cors::cors_preflight_handler);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n}\n\nimplDrawResourceRoutes!(RouterBuilder);\nimplDrawResourceRoutes!(ScopeBuilder);\n","traces":[{"line":61,"address":[2122160,2120240],"length":1,"stats":{"Line":5},"fn_name":"response_from"},{"line":62,"address":[4107675],"length":1,"stats":{"Line":5},"fn_name":null},{"line":63,"address":[4107801],"length":1,"stats":{"Line":5},"fn_name":null},{"line":64,"address":[4107843],"length":1,"stats":{"Line":5},"fn_name":null},{"line":65,"address":[2120581],"length":1,"stats":{"Line":4},"fn_name":null},{"line":67,"address":[2120796],"length":1,"stats":{"Line":5},"fn_name":null},{"line":68,"address":[2121041,2121801,2120804],"length":1,"stats":{"Line":5},"fn_name":null},{"line":69,"address":[2121435,2122232,2121536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[2122175,2121458],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[2121554],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[2121596],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[2121811],"length":1,"stats":{"Line":5},"fn_name":null},{"line":78,"address":[2122318,2121843,2121965],"length":1,"stats":{"Line":10},"fn_name":null},{"line":79,"address":[4109294,4109376,4109672,4109893],"length":1,"stats":{"Line":10},"fn_name":null},{"line":83,"address":[2122004],"length":1,"stats":{"Line":5},"fn_name":null},{"line":85,"address":[2122016],"length":1,"stats":{"Line":5},"fn_name":null},{"line":88,"address":[1893609,1893424],"length":1,"stats":{"Line":42},"fn_name":"endpoint_handler\u003copenapi_supports_scope::read_all___gotham_restful_endpoint\u003e"},{"line":93,"address":[1893648,1893776],"length":1,"stats":{"Line":42},"fn_name":null},{"line":94,"address":[1893952],"length":1,"stats":{"Line":21},"fn_name":null},{"line":97,"address":[1893975,1894115,1894132],"length":1,"stats":{"Line":42},"fn_name":null},{"line":98,"address":[1894096,1894125],"length":1,"stats":{"Line":26},"fn_name":null},{"line":100,"address":[1894142],"length":1,"stats":{"Line":21},"fn_name":null},{"line":102,"address":[1895832,1894165,1894202],"length":1,"stats":{"Line":42},"fn_name":null},{"line":103,"address":[1894188],"length":1,"stats":{"Line":21},"fn_name":null},{"line":104,"address":[2197313],"length":1,"stats":{"Line":16},"fn_name":null},{"line":106,"address":[1894966,1894806,1894682],"length":1,"stats":{"Line":16},"fn_name":null},{"line":107,"address":[1894897,1894968],"length":1,"stats":{"Line":16},"fn_name":null},{"line":109,"address":[1895307,1894920,1895392],"length":1,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[1895568],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[1895648],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[1895822,1895142,1895726],"length":1,"stats":{"Line":8},"fn_name":null},{"line":116,"address":[1895734,1895824],"length":1,"stats":{"Line":16},"fn_name":null},{"line":117,"address":[1895755],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[1895837,1895779,1895922],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[1896090],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[1896446,1898514,1896137],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[1896271],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[1896540],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[1894194],"length":1,"stats":{"Line":13},"fn_name":null},{"line":129,"address":[1896621,1898487,1896746,1898806],"length":1,"stats":{"Line":43},"fn_name":null},{"line":130,"address":[1897113,1897735,1897338,1898450,1898827],"length":1,"stats":{"Line":42},"fn_name":null},{"line":131,"address":[1897915,1897692,1897839],"length":1,"stats":{"Line":42},"fn_name":null},{"line":132,"address":[1898162],"length":1,"stats":{"Line":21},"fn_name":null},{"line":141,"address":[2123040],"length":1,"stats":{"Line":5},"fn_name":"is_match"},{"line":142,"address":[2123068,2123103],"length":1,"stats":{"Line":10},"fn_name":null},{"line":143,"address":[2123121,2123076],"length":1,"stats":{"Line":5},"fn_name":null},{"line":144,"address":[2123099],"length":1,"stats":{"Line":5},"fn_name":null},{"line":150,"address":[2123152,2123475],"length":1,"stats":{"Line":7},"fn_name":"new"},{"line":151,"address":[2123304,2123174],"length":1,"stats":{"Line":12},"fn_name":null},{"line":152,"address":[2123206,2123311],"length":1,"stats":{"Line":10},"fn_name":null},{"line":153,"address":[2123232],"length":1,"stats":{"Line":5},"fn_name":null},{"line":156,"address":[2123397],"length":1,"stats":{"Line":7},"fn_name":null},{"line":162,"address":[2123600],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":163,"address":[2123612],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[2123664],"length":1,"stats":{"Line":0},"fn_name":"is_match"},{"line":174,"address":[2123692,2123726],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[2123700,2123744],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[2123722],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[2123776],"length":1,"stats":{"Line":0},"fn_name":"new"},{"line":184,"address":[2123872,2123889,2123789],"length":1,"stats":{"Line":0},"fn_name":"{{closure}}"},{"line":190,"address":[2123968],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":191,"address":[2123980],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[3117472,3117759],"length":1,"stats":{"Line":2},"fn_name":"with_openapi\u003c(),(),closure-0\u003e"},{"line":207,"address":[3117492,3117606],"length":1,"stats":{"Line":4},"fn_name":null},{"line":209,"address":[3117508],"length":1,"stats":{"Line":2},"fn_name":null},{"line":210,"address":[3117517],"length":1,"stats":{"Line":2},"fn_name":null},{"line":212,"address":[3117641],"length":1,"stats":{"Line":2},"fn_name":null},{"line":221,"address":[2157776],"length":1,"stats":{"Line":5},"fn_name":"resource\u003c(borrow_bag::handle::Handle\u003cgotham::pipeline::Pipeline\u003c(gotham_restful::cors::CorsConfig, ())\u003e, borrow_bag::handle::Take\u003e, ()),(gotham::pipeline::Pipeline\u003c(gotham_restful::cors::CorsConfig, ())\u003e, ()),cors_handling::FooResource\u003e"},{"line":222,"address":[2157800,2157883],"length":1,"stats":{"Line":8},"fn_name":null},{"line":223,"address":[2157894,2157835],"length":1,"stats":{"Line":4},"fn_name":null},{"line":225,"address":[2157909],"length":1,"stats":{"Line":5},"fn_name":null},{"line":234,"address":[3109888,3111745,3110769,3110864],"length":1,"stats":{"Line":30},"fn_name":"endpoint\u003c(),(),openapi_supports_scope::read_all___gotham_restful_endpoint\u003e"},{"line":235,"address":[3111715,3109911,3110739,3110887],"length":1,"stats":{"Line":30},"fn_name":null},{"line":236,"address":[3110267,3111243,3110383,3111359],"length":1,"stats":{"Line":60},"fn_name":null},{"line":237,"address":[1892075,1892256,1892795,1891536],"length":1,"stats":{"Line":60},"fn_name":"{{closure}}\u003c(),(),openapi_supports_scope::read_all___gotham_restful_endpoint\u003e"},{"line":238,"address":[1891805,1891758,1891687,1892407,1892478,1892276,1892525,1891556],"length":1,"stats":{"Line":120},"fn_name":null},{"line":239,"address":[1892864,1892428,1892144,1892302,1891582,1891708],"length":1,"stats":{"Line":60},"fn_name":null},{"line":240,"address":[1892444,1892517,1891797,1891724,1892117,1892837],"length":1,"stats":{"Line":60},"fn_name":null},{"line":246,"address":[1892771,1892061,1891854,1892667,1892051,1892574,1892781,1891947],"length":1,"stats":{"Line":60},"fn_name":null},{"line":247,"address":[1892644,1892711,1891924,1891991,1892038,1892758],"length":1,"stats":{"Line":45},"fn_name":null},{"line":249,"address":[1892030,1891957,1892810,1892750,1892677,1892090],"length":1,"stats":{"Line":30},"fn_name":null}],"covered":58,"coverable":81},{"path":["/","home","runner","work","gotham_restful","gotham_restful","src","types.rs"],"content":"use gotham::hyper::body::Bytes;\nuse mime::{Mime, APPLICATION_JSON};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse serde::{de::DeserializeOwned, Serialize};\nuse std::error::Error;\n\n#[cfg(not(feature = \"openapi\"))]\npub trait ResourceType {}\n\n#[cfg(not(feature = \"openapi\"))]\nimpl\u003cT\u003e ResourceType for T {}\n\n#[cfg(feature = \"openapi\")]\npub trait ResourceType: OpenapiType {}\n\n#[cfg(feature = \"openapi\")]\nimpl\u003cT: OpenapiType\u003e ResourceType for T {}\n\n/// A type that can be used inside a response body. Implemented for every type that is\n/// serializable with serde. If the `openapi` feature is used, it must also be of type\n/// [OpenapiType].\n///\n///  [OpenapiType]: trait.OpenapiType.html\npub trait ResponseBody: ResourceType + Serialize {}\n\nimpl\u003cT: ResourceType + Serialize\u003e ResponseBody for T {}\n\n/**\nThis trait should be implemented for every type that can be built from an HTTP request body\nplus its media type.\n\nFor most use cases it is sufficient to derive this trait, you usually don't need to manually\nimplement this. Therefore, make sure that the first variable of your struct can be built from\n[Bytes], and the second one can be build from [Mime]. If you have any additional variables, they\nneed to be [Default]. This is an example of such a struct:\n\n```rust\n# #[macro_use] extern crate gotham_restful;\n# use gotham_restful::*;\n#[derive(FromBody, RequestBody)]\n#[supported_types(mime::IMAGE_GIF, mime::IMAGE_JPEG, mime::IMAGE_PNG)]\nstruct RawImage {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n```\n*/\npub trait FromBody: Sized {\n\t/// The error type returned by the conversion if it was unsuccessfull. When using the derive\n\t/// macro, there is no way to trigger an error, so [std::convert::Infallible] is used here.\n\t/// However, this might change in the future.\n\ttype Err: Error;\n\n\t/// Perform the conversion.\n\tfn from_body(body: Bytes, content_type: Mime) -\u003e Result\u003cSelf, Self::Err\u003e;\n}\n\nimpl\u003cT: DeserializeOwned\u003e FromBody for T {\n\ttype Err = serde_json::Error;\n\n\tfn from_body(body: Bytes, _content_type: Mime) -\u003e Result\u003cSelf, Self::Err\u003e {\n\t\tserde_json::from_slice(\u0026body)\n\t}\n}\n\n/**\nA type that can be used inside a request body. Implemented for every type that is deserializable\nwith serde. If the `openapi` feature is used, it must also be of type [OpenapiType].\n\nIf you want a non-deserializable type to be used as a request body, e.g. because you'd like to\nget the raw data, you can derive it for your own type. All you need is to have a type implementing\n[FromBody] and optionally a list of supported media types:\n\n```rust\n# #[macro_use] extern crate gotham_restful;\n# use gotham_restful::*;\n#[derive(FromBody, RequestBody)]\n#[supported_types(mime::IMAGE_GIF, mime::IMAGE_JPEG, mime::IMAGE_PNG)]\nstruct RawImage {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n```\n\n [OpenapiType]: trait.OpenapiType.html\n*/\npub trait RequestBody: ResourceType + FromBody {\n\t/// Return all types that are supported as content types. Use `None` if all types are supported.\n\tfn supported_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tNone\n\t}\n}\n\nimpl\u003cT: ResourceType + DeserializeOwned\u003e RequestBody for T {\n\tfn supported_types() -\u003e Option\u003cVec\u003cMime\u003e\u003e {\n\t\tSome(vec![APPLICATION_JSON])\n\t}\n}\n","traces":[{"line":62,"address":[2210824,2210688],"length":1,"stats":{"Line":2},"fn_name":"from_body\u003csync_methods::FooBody\u003e"},{"line":63,"address":[2210720],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":4,"coverable":6},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","async_methods.rs"],"content":"#[macro_use]\nextern crate gotham_derive;\n\nuse gotham::{\n\thyper::{HeaderMap, Method},\n\trouter::builder::*,\n\tstate::State,\n\ttest::TestServer\n};\nuse gotham_restful::*;\nuse mime::{APPLICATION_JSON, TEXT_PLAIN};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse serde::Deserialize;\nuse tokio::time::{sleep, Duration};\n\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::{test_delete_response, test_get_response, test_post_response, test_put_response};\n\n#[derive(Resource)]\n#[resource(read_all, read, search, create, update_all, update, delete_all, delete, state_test)]\nstruct FooResource;\n\n#[derive(Deserialize)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooBody {\n\tdata: String\n}\n\n#[derive(Clone, Deserialize, StateData, StaticResponseExtender)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooSearch {\n\tquery: String\n}\n\nconst READ_ALL_RESPONSE: \u0026[u8] = b\"1ARwwSPVyOKpJKrYwqGgECPVWDl1BqajAAj7g7WJ3e\";\n#[read_all]\nasync fn read_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst READ_RESPONSE: \u0026[u8] = b\"FEReHoeBKU17X2bBpVAd1iUvktFL43CDu0cFYHdaP9\";\n#[read]\nasync fn read(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_RESPONSE, TEXT_PLAIN)\n}\n\nconst SEARCH_RESPONSE: \u0026[u8] = b\"AWqcQUdBRHXKh3at4u79mdupOAfEbnTcx71ogCVF0E\";\n#[search]\nasync fn search(_body: FooSearch) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(SEARCH_RESPONSE, TEXT_PLAIN)\n}\n\nconst CREATE_RESPONSE: \u0026[u8] = b\"y6POY7wOMAB0jBRBw0FJT7DOpUNbhmT8KdpQPLkI83\";\n#[create]\nasync fn create(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(CREATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_ALL_RESPONSE: \u0026[u8] = b\"QlbYg8gHE9OQvvk3yKjXJLTSXlIrg9mcqhfMXJmQkv\";\n#[update_all]\nasync fn update_all(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_RESPONSE: \u0026[u8] = b\"qGod55RUXkT1lgPO8h0uVM6l368O2S0GrwENZFFuRu\";\n#[update]\nasync fn update(_id: u64, _body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_ALL_RESPONSE: \u0026[u8] = b\"Y36kZ749MRk2Nem4BedJABOZiZWPLOtiwLfJlGTwm5\";\n#[delete_all]\nasync fn delete_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_RESPONSE: \u0026[u8] = b\"CwRzBrKErsVZ1N7yeNfjZuUn1MacvgBqk4uPOFfDDq\";\n#[delete]\nasync fn delete(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_RESPONSE, TEXT_PLAIN)\n}\n\nconst STATE_TEST_RESPONSE: \u0026[u8] = b\"xxJbxOuwioqR5DfzPuVqvaqRSfpdNQGluIvHU4n1LM\";\n#[endpoint(method = \"Method::GET\", uri = \"state_test\")]\nasync fn state_test(state: \u0026mut State) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tsleep(Duration::from_nanos(1)).await;\n\tstate.borrow::\u003cHeaderMap\u003e();\n\tsleep(Duration::from_nanos(1)).await;\n\tRaw::new(STATE_TEST_RESPONSE, TEXT_PLAIN)\n}\n\n#[test]\nfn async_methods() {\n\tlet _ = pretty_env_logger::try_init_timed();\n\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.resource::\u003cFooResource\u003e(\"foo\");\n\t}))\n\t.unwrap();\n\n\ttest_get_response(\u0026server, \"http://localhost/foo\", READ_ALL_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/1\", READ_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/search?query=hello+world\", SEARCH_RESPONSE);\n\ttest_post_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tCREATE_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_ALL_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo/1\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_RESPONSE\n\t);\n\ttest_delete_response(\u0026server, \"http://localhost/foo\", DELETE_ALL_RESPONSE);\n\ttest_delete_response(\u0026server, \"http://localhost/foo/1\", DELETE_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/state_test\", STATE_TEST_RESPONSE);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","cors_handling.rs"],"content":"#![cfg(feature = \"cors\")]\nuse gotham::{\n\thyper::{body::Body, client::connect::Connect, header::*, StatusCode},\n\tpipeline::{new_pipeline, single::single_pipeline},\n\trouter::builder::*,\n\ttest::{Server, TestRequest, TestServer}\n};\nuse gotham_restful::{\n\tcors::{Headers, Origin},\n\tread_all, update_all, CorsConfig, DrawResources, Raw, Resource\n};\nuse mime::TEXT_PLAIN;\n\n#[derive(Resource)]\n#[resource(read_all, update_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() {}\n\n#[update_all]\nfn update_all(_body: Raw\u003cVec\u003cu8\u003e\u003e) {}\n\nfn test_server(cfg: CorsConfig) -\u003e TestServer {\n\tlet (chain, pipeline) = single_pipeline(new_pipeline().add(cfg).build());\n\tTestServer::new(build_router(chain, pipeline, |router| router.resource::\u003cFooResource\u003e(\"/foo\"))).unwrap()\n}\n\nfn test_response\u003cTS, C\u003e(req: TestRequest\u003cTS, C\u003e, origin: Option\u003c\u0026str\u003e, vary: Option\u003c\u0026str\u003e, credentials: bool)\nwhere\n\tTS: Server + 'static,\n\tC: Connect + Clone + Send + Sync + 'static\n{\n\tlet res = req\n\t\t.with_header(ORIGIN, \"http://example.org\".parse().unwrap())\n\t\t.perform()\n\t\t.unwrap();\n\tassert_eq!(res.status(), StatusCode::NO_CONTENT);\n\tlet headers = res.headers();\n\tprintln!(\"{}\", headers.keys().map(|name| name.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\",\"));\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_ORIGIN)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.as_deref(),\n\t\torigin\n\t);\n\tassert_eq!(headers.get(VARY).and_then(|value| value.to_str().ok()).as_deref(), vary);\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_CREDENTIALS)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.map(|value| value == \"true\")\n\t\t\t.unwrap_or(false),\n\t\tcredentials\n\t);\n\tassert!(headers.get(ACCESS_CONTROL_MAX_AGE).is_none());\n}\n\nfn test_preflight(server: \u0026TestServer, method: \u0026str, origin: Option\u003c\u0026str\u003e, vary: \u0026str, credentials: bool, max_age: u64) {\n\tlet res = server\n\t\t.client()\n\t\t.options(\"http://example.org/foo\")\n\t\t.with_header(ACCESS_CONTROL_REQUEST_METHOD, method.parse().unwrap())\n\t\t.with_header(ORIGIN, \"http://example.org\".parse().unwrap())\n\t\t.perform()\n\t\t.unwrap();\n\tassert_eq!(res.status(), StatusCode::NO_CONTENT);\n\tlet headers = res.headers();\n\tprintln!(\"{}\", headers.keys().map(|name| name.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\",\"));\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_METHODS)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.as_deref(),\n\t\tSome(method)\n\t);\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_ORIGIN)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.as_deref(),\n\t\torigin\n\t);\n\tassert_eq!(headers.get(VARY).and_then(|value| value.to_str().ok()).as_deref(), Some(vary));\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_ALLOW_CREDENTIALS)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.map(|value| value == \"true\")\n\t\t\t.unwrap_or(false),\n\t\tcredentials\n\t);\n\tassert_eq!(\n\t\theaders\n\t\t\t.get(ACCESS_CONTROL_MAX_AGE)\n\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t.and_then(|value| value.parse().ok()),\n\t\tSome(max_age)\n\t);\n}\n\nfn test_preflight_headers(\n\tserver: \u0026TestServer,\n\tmethod: \u0026str,\n\trequest_headers: Option\u003c\u0026str\u003e,\n\tallowed_headers: Option\u003c\u0026str\u003e,\n\tvary: \u0026str\n) {\n\tlet client = server.client();\n\tlet mut res = client\n\t\t.options(\"http://example.org/foo\")\n\t\t.with_header(ACCESS_CONTROL_REQUEST_METHOD, method.parse().unwrap())\n\t\t.with_header(ORIGIN, \"http://example.org\".parse().unwrap());\n\tif let Some(hdr) = request_headers {\n\t\tres = res.with_header(ACCESS_CONTROL_REQUEST_HEADERS, hdr.parse().unwrap());\n\t}\n\tlet res = res.perform().unwrap();\n\tassert_eq!(res.status(), StatusCode::NO_CONTENT);\n\tlet headers = res.headers();\n\tprintln!(\"{}\", headers.keys().map(|name| name.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\",\"));\n\tif let Some(hdr) = allowed_headers {\n\t\tassert_eq!(\n\t\t\theaders\n\t\t\t\t.get(ACCESS_CONTROL_ALLOW_HEADERS)\n\t\t\t\t.and_then(|value| value.to_str().ok())\n\t\t\t\t.as_deref(),\n\t\t\tSome(hdr)\n\t\t)\n\t} else {\n\t\tassert!(!headers.contains_key(ACCESS_CONTROL_ALLOW_HEADERS));\n\t}\n\tassert_eq!(headers.get(VARY).and_then(|value| value.to_str().ok()).as_deref(), Some(vary));\n}\n\n#[test]\nfn cors_origin_none() {\n\tlet cfg = Default::default();\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", None, \"access-control-request-method\", false, 0);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), None, None, false);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tNone,\n\t\tNone,\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_origin_star() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::Star,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", Some(\"*\"), \"access-control-request-method\", false, 0);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), Some(\"*\"), None, false);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tSome(\"*\"),\n\t\tNone,\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_origin_single() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::Single(\"https://foo.com\".to_owned()),\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"https://foo.com\"),\n\t\t\"access-control-request-method\",\n\t\tfalse,\n\t\t0\n\t);\n\n\ttest_response(\n\t\tserver.client().get(\"http://example.org/foo\"),\n\t\tSome(\"https://foo.com\"),\n\t\tNone,\n\t\tfalse\n\t);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tSome(\"https://foo.com\"),\n\t\tNone,\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_origin_copy() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::Copy,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"http://example.org\"),\n\t\t\"access-control-request-method,origin\",\n\t\tfalse,\n\t\t0\n\t);\n\n\ttest_response(\n\t\tserver.client().get(\"http://example.org/foo\"),\n\t\tSome(\"http://example.org\"),\n\t\tSome(\"origin\"),\n\t\tfalse\n\t);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tSome(\"http://example.org\"),\n\t\tSome(\"origin\"),\n\t\tfalse\n\t);\n}\n\n#[test]\nfn cors_headers_none() {\n\tlet cfg = Default::default();\n\tlet server = test_server(cfg);\n\n\ttest_preflight_headers(\u0026server, \"PUT\", None, None, \"access-control-request-method\");\n\ttest_preflight_headers(\u0026server, \"PUT\", Some(\"Content-Type\"), None, \"access-control-request-method\");\n}\n\n#[test]\nfn cors_headers_list() {\n\tlet cfg = CorsConfig {\n\t\theaders: Headers::List(vec![CONTENT_TYPE]),\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight_headers(\u0026server, \"PUT\", None, Some(\"content-type\"), \"access-control-request-method\");\n\ttest_preflight_headers(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"content-type\"),\n\t\tSome(\"content-type\"),\n\t\t\"access-control-request-method\"\n\t);\n}\n\n#[test]\nfn cors_headers_copy() {\n\tlet cfg = CorsConfig {\n\t\theaders: Headers::Copy,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight_headers(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tNone,\n\t\tNone,\n\t\t\"access-control-request-method,access-control-request-headers\"\n\t);\n\ttest_preflight_headers(\n\t\t\u0026server,\n\t\t\"PUT\",\n\t\tSome(\"content-type\"),\n\t\tSome(\"content-type\"),\n\t\t\"access-control-request-method,access-control-request-headers\"\n\t);\n}\n\n#[test]\nfn cors_credentials() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::None,\n\t\tcredentials: true,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", None, \"access-control-request-method\", true, 0);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), None, None, true);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tNone,\n\t\tNone,\n\t\ttrue\n\t);\n}\n\n#[test]\nfn cors_max_age() {\n\tlet cfg = CorsConfig {\n\t\torigin: Origin::None,\n\t\tmax_age: 31536000,\n\t\t..Default::default()\n\t};\n\tlet server = test_server(cfg);\n\n\ttest_preflight(\u0026server, \"PUT\", None, \"access-control-request-method\", false, 31536000);\n\n\ttest_response(server.client().get(\"http://example.org/foo\"), None, None, false);\n\ttest_response(\n\t\tserver.client().put(\"http://example.org/foo\", Body::empty(), TEXT_PLAIN),\n\t\tNone,\n\t\tNone,\n\t\tfalse\n\t);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","custom_request_body.rs"],"content":"use gotham::{hyper::header::CONTENT_TYPE, router::builder::*, test::TestServer};\nuse gotham_restful::*;\nuse mime::TEXT_PLAIN;\n\nconst RESPONSE: \u0026[u8] = b\"This is the only valid response.\";\n\n#[derive(Resource)]\n#[resource(create)]\nstruct FooResource;\n\n#[derive(FromBody, RequestBody)]\n#[supported_types(TEXT_PLAIN)]\nstruct Foo {\n\tcontent: Vec\u003cu8\u003e,\n\tcontent_type: Mime\n}\n\n#[create]\nfn create(body: Foo) -\u003e Raw\u003cVec\u003cu8\u003e\u003e {\n\tRaw::new(body.content, body.content_type)\n}\n\n#[test]\nfn custom_request_body() {\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.resource::\u003cFooResource\u003e(\"foo\");\n\t}))\n\t.unwrap();\n\n\tlet res = server\n\t\t.client()\n\t\t.post(\"http://localhost/foo\", RESPONSE, TEXT_PLAIN)\n\t\t.perform()\n\t\t.unwrap();\n\tassert_eq!(res.headers().get(CONTENT_TYPE).unwrap().to_str().unwrap(), \"text/plain\");\n\tlet res = res.read_body().unwrap();\n\tlet body: \u0026[u8] = res.as_ref();\n\tassert_eq!(body, RESPONSE);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","openapi_specification.rs"],"content":"#![cfg(all(feature = \"auth\", feature = \"openapi\"))]\n\n#[macro_use]\nextern crate gotham_derive;\n#[macro_use]\nextern crate pretty_assertions;\n\nuse gotham::{\n\thyper::Method,\n\tpipeline::{new_pipeline, single::single_pipeline},\n\trouter::builder::*,\n\ttest::TestServer\n};\nuse gotham_restful::*;\nuse mime::IMAGE_PNG;\nuse openapi_type::OpenapiType;\nuse serde::{Deserialize, Serialize};\n\n#[allow(dead_code)]\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::test_openapi_response;\n\nconst IMAGE_RESPONSE : \u0026[u8] = b\"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUA/wA0XsCoAAAAAXRSTlN/gFy0ywAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=\";\n\n#[derive(Resource)]\n#[resource(get_image, set_image)]\nstruct ImageResource;\n\n#[derive(FromBody, RequestBody)]\n#[supported_types(IMAGE_PNG)]\nstruct Image(Vec\u003cu8\u003e);\n\n#[read(operation_id = \"getImage\")]\nfn get_image(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(IMAGE_RESPONSE, \"image/png;base64\".parse().unwrap())\n}\n\n#[update(operation_id = \"setImage\")]\nfn set_image(_id: u64, _image: Image) {}\n\n#[derive(Resource)]\n#[resource(read_secret, search_secret)]\nstruct SecretResource;\n\n#[derive(Deserialize, Clone)]\nstruct AuthData {\n\tsub: String,\n\tiat: u64,\n\texp: u64\n}\n\ntype AuthStatus = gotham_restful::AuthStatus\u003cAuthData\u003e;\n\n#[derive(OpenapiType, Serialize)]\nstruct Secret {\n\tcode: f32\n}\n\n#[derive(OpenapiType, Serialize)]\nstruct Secrets {\n\tsecrets: Vec\u003cSecret\u003e\n}\n\n#[derive(Clone, Deserialize, OpenapiType, StateData, StaticResponseExtender)]\nstruct SecretQuery {\n\tdate: String,\n\thour: Option\u003cu16\u003e,\n\tminute: Option\u003cu16\u003e\n}\n\n/// This endpoint gives access to the secret.\n///\n/// You need to be authenticated to call this endpoint.\n#[read]\nfn read_secret(auth: AuthStatus, _id: String) -\u003e AuthSuccess\u003cSecret\u003e {\n\tauth.ok()?;\n\tOk(Secret { code: 4.2 })\n}\n\n#[search]\nfn search_secret(auth: AuthStatus, _query: SecretQuery) -\u003e AuthSuccess\u003cSecrets\u003e {\n\tauth.ok()?;\n\tOk(Secrets {\n\t\tsecrets: vec![Secret { code: 4.2 }, Secret { code: 3.14 }]\n\t})\n}\n\n#[derive(Resource)]\n#[resource(custom_read_with, custom_patch)]\nstruct CustomResource;\n\n#[derive(Clone, Deserialize, OpenapiType, StateData, StaticResponseExtender)]\nstruct ReadWithPath {\n\tfrom: String,\n\tid: u64\n}\n\n#[endpoint(method = \"Method::GET\", uri = \"read/:from/with/:id\")]\nfn custom_read_with(_path: ReadWithPath) {}\n\n#[endpoint(method = \"Method::PATCH\", uri = \"\", body = true)]\nfn custom_patch(_body: String) {}\n\n#[test]\nfn openapi_specification() {\n\tlet info = OpenapiInfo {\n\t\ttitle: \"This is just a test\".to_owned(),\n\t\tversion: \"1.2.3\".to_owned(),\n\t\turls: vec![\"http://localhost:12345/api/v1\".to_owned()]\n\t};\n\tlet auth: AuthMiddleware\u003cAuthData, _\u003e = AuthMiddleware::new(\n\t\tAuthSource::AuthorizationHeader,\n\t\tAuthValidation::default(),\n\t\tStaticAuthHandler::from_array(b\"zlBsA2QXnkmpe0QTh8uCvtAEa4j33YAc\")\n\t);\n\tlet (chain, pipelines) = single_pipeline(new_pipeline().add(auth).build());\n\tlet server = TestServer::new(build_router(chain, pipelines, |router| {\n\t\trouter.with_openapi(info, |mut router| {\n\t\t\t// the leading slash tests that the spec doesn't contain '//img' nonsense\n\t\t\trouter.resource::\u003cImageResource\u003e(\"/img\");\n\t\t\trouter.resource::\u003cSecretResource\u003e(\"secret\");\n\t\t\trouter.resource::\u003cCustomResource\u003e(\"custom\");\n\t\t\trouter.openapi_spec(\"openapi\");\n\t\t});\n\t}))\n\t.unwrap();\n\n\ttest_openapi_response(\u0026server, \"http://localhost/openapi\", \"tests/openapi_specification.json\");\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","openapi_supports_scope.rs"],"content":"#![cfg(feature = \"openapi\")]\n\n#[macro_use]\nextern crate pretty_assertions;\n\nuse gotham::{router::builder::*, test::TestServer};\nuse gotham_restful::*;\nuse mime::TEXT_PLAIN;\n\n#[allow(dead_code)]\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::{test_get_response, test_openapi_response};\n\nconst RESPONSE: \u0026[u8] = b\"This is the only valid response.\";\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(RESPONSE, TEXT_PLAIN)\n}\n\n#[test]\nfn openapi_supports_scope() {\n\tlet info = OpenapiInfo {\n\t\ttitle: \"Test\".to_owned(),\n\t\tversion: \"1.2.3\".to_owned(),\n\t\turls: Vec::new()\n\t};\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.with_openapi(info, |mut router| {\n\t\t\trouter.openapi_spec(\"openapi\");\n\t\t\trouter.resource::\u003cFooResource\u003e(\"foo1\");\n\t\t\trouter.scope(\"/bar\", |router| {\n\t\t\t\trouter.resource::\u003cFooResource\u003e(\"foo2\");\n\t\t\t\trouter.scope(\"/baz\", |router| {\n\t\t\t\t\trouter.resource::\u003cFooResource\u003e(\"foo3\");\n\t\t\t\t})\n\t\t\t});\n\t\t\trouter.resource::\u003cFooResource\u003e(\"foo4\");\n\t\t});\n\t}))\n\t.unwrap();\n\n\ttest_get_response(\u0026server, \"http://localhost/foo1\", RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/bar/foo2\", RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/bar/baz/foo3\", RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo4\", RESPONSE);\n\ttest_openapi_response(\u0026server, \"http://localhost/openapi\", \"tests/openapi_supports_scope.json\");\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","resource_error.rs"],"content":"use gotham_restful::ResourceError;\n\n#[derive(ResourceError)]\nenum Error {\n\t#[display(\"I/O Error: {0}\")]\n\tIoError(#[from] std::io::Error),\n\n\t#[status(INTERNAL_SERVER_ERROR)]\n\t#[display(\"Internal Server Error: {0}\")]\n\tInternalServerError(String)\n}\n\n#[allow(deprecated)]\nmod resource_error {\n\tuse super::Error;\n\tuse gotham::hyper::StatusCode;\n\tuse gotham_restful::IntoResponseError;\n\tuse mime::APPLICATION_JSON;\n\n\t#[test]\n\tfn io_error() {\n\t\tlet err = Error::IoError(std::io::Error::last_os_error());\n\t\tlet res = err.into_response_error().unwrap();\n\t\tassert_eq!(res.status(), StatusCode::INTERNAL_SERVER_ERROR);\n\t\tassert_eq!(res.mime(), Some(\u0026APPLICATION_JSON));\n\t}\n\n\t#[test]\n\tfn internal_server_error() {\n\t\tlet err = Error::InternalServerError(\"Brocken\".to_owned());\n\t\tassert_eq!(\u0026format!(\"{}\", err), \"Internal Server Error: Brocken\");\n\n\t\tlet res = err.into_response_error().unwrap();\n\t\tassert_eq!(res.status(), StatusCode::INTERNAL_SERVER_ERROR);\n\t\tassert_eq!(res.mime(), None); // TODO shouldn't this be a json error message?\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","sync_methods.rs"],"content":"#[macro_use]\nextern crate gotham_derive;\n\nuse gotham::{router::builder::*, test::TestServer};\nuse gotham_restful::*;\nuse mime::{APPLICATION_JSON, TEXT_PLAIN};\n#[cfg(feature = \"openapi\")]\nuse openapi_type::OpenapiType;\nuse serde::Deserialize;\n\nmod util {\n\tinclude!(\"util/mod.rs\");\n}\nuse util::{test_delete_response, test_get_response, test_post_response, test_put_response};\n\n#[derive(Resource)]\n#[resource(read_all, read, search, create, update_all, update, delete_all, delete)]\nstruct FooResource;\n\n#[derive(Deserialize)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooBody {\n\tdata: String\n}\n\n#[derive(Clone, Deserialize, StateData, StaticResponseExtender)]\n#[cfg_attr(feature = \"openapi\", derive(OpenapiType))]\n#[allow(dead_code)]\nstruct FooSearch {\n\tquery: String\n}\n\nconst READ_ALL_RESPONSE: \u0026[u8] = b\"1ARwwSPVyOKpJKrYwqGgECPVWDl1BqajAAj7g7WJ3e\";\n#[read_all]\nfn read_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst READ_RESPONSE: \u0026[u8] = b\"FEReHoeBKU17X2bBpVAd1iUvktFL43CDu0cFYHdaP9\";\n#[read]\nfn read(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(READ_RESPONSE, TEXT_PLAIN)\n}\n\nconst SEARCH_RESPONSE: \u0026[u8] = b\"AWqcQUdBRHXKh3at4u79mdupOAfEbnTcx71ogCVF0E\";\n#[search]\nfn search(_body: FooSearch) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(SEARCH_RESPONSE, TEXT_PLAIN)\n}\n\nconst CREATE_RESPONSE: \u0026[u8] = b\"y6POY7wOMAB0jBRBw0FJT7DOpUNbhmT8KdpQPLkI83\";\n#[create]\nfn create(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(CREATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_ALL_RESPONSE: \u0026[u8] = b\"QlbYg8gHE9OQvvk3yKjXJLTSXlIrg9mcqhfMXJmQkv\";\n#[update_all]\nfn update_all(_body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst UPDATE_RESPONSE: \u0026[u8] = b\"qGod55RUXkT1lgPO8h0uVM6l368O2S0GrwENZFFuRu\";\n#[update]\nfn update(_id: u64, _body: FooBody) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(UPDATE_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_ALL_RESPONSE: \u0026[u8] = b\"Y36kZ749MRk2Nem4BedJABOZiZWPLOtiwLfJlGTwm5\";\n#[delete_all]\nfn delete_all() -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_ALL_RESPONSE, TEXT_PLAIN)\n}\n\nconst DELETE_RESPONSE: \u0026[u8] = b\"CwRzBrKErsVZ1N7yeNfjZuUn1MacvgBqk4uPOFfDDq\";\n#[delete]\nfn delete(_id: u64) -\u003e Raw\u003c\u0026'static [u8]\u003e {\n\tRaw::new(DELETE_RESPONSE, TEXT_PLAIN)\n}\n\n#[test]\nfn sync_methods() {\n\tlet _ = pretty_env_logger::try_init_timed();\n\n\tlet server = TestServer::new(build_simple_router(|router| {\n\t\trouter.resource::\u003cFooResource\u003e(\"foo\");\n\t}))\n\t.unwrap();\n\n\ttest_get_response(\u0026server, \"http://localhost/foo\", READ_ALL_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/1\", READ_RESPONSE);\n\ttest_get_response(\u0026server, \"http://localhost/foo/search?query=hello+world\", SEARCH_RESPONSE);\n\ttest_post_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tCREATE_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_ALL_RESPONSE\n\t);\n\ttest_put_response(\n\t\t\u0026server,\n\t\t\"http://localhost/foo/1\",\n\t\tr#\"{\"data\":\"hello world\"}\"#,\n\t\tAPPLICATION_JSON,\n\t\tUPDATE_RESPONSE\n\t);\n\ttest_delete_response(\u0026server, \"http://localhost/foo\", DELETE_ALL_RESPONSE);\n\ttest_delete_response(\u0026server, \"http://localhost/foo/1\", DELETE_RESPONSE);\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","trybuild_ui.rs"],"content":"use trybuild::TestCases;\n\n#[test]\n#[ignore]\nfn trybuild_ui() {\n\tlet t = TestCases::new();\n\tt.compile_fail(\"tests/ui/endpoint/*.rs\");\n\tt.compile_fail(\"tests/ui/from_body/*.rs\");\n\tt.compile_fail(\"tests/ui/resource/*.rs\");\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","async_state.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham::state::State;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nasync fn read_all(state: \u0026State) {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","auth_data_non_clone.rs"],"content":"use gotham_restful::*;\nuse serde::Deserialize;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[derive(Deserialize)]\nstruct AuthData {\n\tiat: u64,\n\texp: u64\n}\n\n#[read_all]\nasync fn read_all(auth: AuthStatus\u003cAuthData\u003e) -\u003e Result\u003cNoContent, AuthError\u003e {\n\tauth.ok()?;\n\tOk(NoContent::default())\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_method_invalid_expr.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(method = \"I like pizza\", uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_method_invalid_type.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(method = \"String::new()\", uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_method_missing.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","custom_uri_missing.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[endpoint(method = \"gotham_restful::gotham::hyper::Method::GET\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(FooResource)]\nfn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_body_ty.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\n#[derive(Debug)]\nstruct FooBody {\n\tfoo: String\n}\n\n#[endpoint(method = \"Method::GET\", uri = \"\", body = true)]\nfn endpoint(_: FooBody) {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_params_ty.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\n#[derive(Debug)]\nstruct FooParams {\n\tfoo: String\n}\n\n#[endpoint(method = \"Method::GET\", uri = \"\", params = true)]\nfn endpoint(_: FooParams) {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_placeholders_ty.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\n#[derive(Debug)]\nstruct FooPlaceholders {\n\tfoo: String\n}\n\n#[endpoint(method = \"Method::GET\", uri = \":foo\")]\nfn endpoint(_: FooPlaceholders) {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","invalid_return_type.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\nuse gotham_restful::gotham::hyper::Method;\n\n#[derive(Resource)]\n#[resource(endpoint)]\nstruct FooResource;\n\nstruct FooResponse;\n\n#[endpoint(method = \"Method::GET\", uri = \"\")]\nfn endpoint() -\u003e FooResponse {\n\tunimplemented!()\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_body_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(body = false)]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_method_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(method = \"gotham_restful::gotham::hyper::Method::GET\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_params_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(params = true)]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","non_custom_uri_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(uri = \"custom_read\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","self.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all(self) {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","too_few_args.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read)]\nstruct FooResource;\n\n#[read]\nfn read() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","too_many_args.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nfn read_all(_id: u64) {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","unknown_attribute.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(pineapple = \"on pizza\")]\nfn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","unsafe.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all]\nunsafe fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","endpoint","wants_auth_non_bool.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_all)]\nstruct FooResource;\n\n#[read_all(wants_auth = \"yes, please\")]\nasync fn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","from_body","enum.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(FromBody)]\nenum FromBodyEnum {\n\tSomeVariant(Vec\u003cu8\u003e),\n\tOtherVariant(String)\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","ui","resource","unknown_method.rs"],"content":"#[macro_use]\nextern crate gotham_restful;\n\n#[derive(Resource)]\n#[resource(read_any)]\nstruct FooResource;\n\n#[read_all]\nfn read_all() {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","gotham_restful","gotham_restful","tests","util","mod.rs"],"content":"use gotham::{\n\thyper::Body,\n\ttest::TestServer\n};\nuse log::info;\nuse mime::Mime;\n#[allow(unused_imports)]\nuse std::{fs::File, io::{Read, Write}, str};\n\npub fn test_get_response(server : \u0026TestServer, path : \u0026str, expected : \u0026[u8])\n{\n\tinfo!(\"GET {}\", path);\n\tlet res = server.client().get(path).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\npub fn test_post_response\u003cB\u003e(server : \u0026TestServer, path : \u0026str, body : B, mime : Mime, expected : \u0026[u8])\nwhere\n\tB : Into\u003cBody\u003e\n{\n\tinfo!(\"POST {}\", path);\n\tlet res = server.client().post(path, body, mime).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\npub fn test_put_response\u003cB\u003e(server : \u0026TestServer, path : \u0026str, body : B, mime : Mime, expected : \u0026[u8])\nwhere\n\tB : Into\u003cBody\u003e\n{\n\tinfo!(\"PUT {}\", path);\n\tlet res = server.client().put(path, body, mime).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\npub fn test_delete_response(server : \u0026TestServer, path : \u0026str, expected : \u0026[u8])\n{\n\tinfo!(\"DELETE {}\", path);\n\tlet res = server.client().delete(path).perform().unwrap().read_body().unwrap();\n\tlet body : \u0026[u8] = res.as_ref();\n\tassert_eq!(body, expected);\n}\n\n#[cfg(feature = \"openapi\")]\npub fn test_openapi_response(server : \u0026TestServer, path : \u0026str, output_file : \u0026str)\n{\n\tinfo!(\"GET {}\", path);\n\tlet res = server.client().get(path).perform().unwrap().read_body().unwrap();\n\tlet body: serde_json::Value = serde_json::from_slice(\u0026res).unwrap();\n\n\tlet mut file = File::open(output_file).unwrap();\n\tlet expected: serde_json::Value = serde_json::from_reader(\u0026mut file).unwrap();\n\n\t//eprintln!(\"{}\", body);\n\tassert_eq!(body, expected);\n}\n","traces":[],"covered":0,"coverable":0}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, pathToString(file.path)),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('div', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('pre', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>